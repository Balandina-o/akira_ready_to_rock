{"version":3,"file":"128.js","mappings":"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AK,IAAM,GACXC,IAAK,IAAM,GACXC,GAAI,IAAM,GACVC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,GAAI,IAAM,GACVC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,GAAI,IAAM,EACVC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,GAAI,IAAM,GACVC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,EACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,EACXC,IAAK,IAAM,EACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,GAAI,IAAM,GACVC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IAAK,IAAM,GACXC,IA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","sources":["webpack://akira/./node_modules/excalibur/build/esm/excalibur.js"],"sourcesContent":["/*!\n * excalibur - 0.30.0-alpha.1295+8faedcb - 2024-12-5\n * https://github.com/excaliburjs/Excalibur\n * Copyright (c) 2024 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>\n * Licensed BSD-2-Clause\n * @preserve\n */\n/******/ var __webpack_modules__ = ({\n\n/***/ 851:\n/***/ ((module, __webpack_exports__, __webpack_require__) => {\n\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   A: () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(935);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  white-space: nowrap;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition:\n    background 250ms ease-in-out,\n    transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./Director/Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB;;wBAEsB;EACtB,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  white-space: nowrap;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition:\\n    background 250ms ease-in-out,\\n    transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n/***/ }),\n\n/***/ 296:\n/***/ ((module, __webpack_exports__, __webpack_require__) => {\n\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   A: () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(935);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `#ex-toast-container {\n  position: absolute;\n  height: 0;\n  min-width: 50%;\n  left: 50%;\n  top: 0;\n}\n\n.ex-toast-message {\n  left: -50%;\n  position: relative;\n  display: flex;\n  justify-content: space-between;\n\n  padding: 10px;\n  margin-top: 5px;\n  font-size: 18px;\n  font-family: sans-serif;\n  border-radius: 6px;\n  border: 3px solid #b7b779;\n  background-color: rgb(253, 253, 192);\n}\n\n.ex-toast-message button {\n  align-self: flex-start;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./Util/Toaster.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;EAE9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;AAEA;EACE,sBAAsB;AACxB\",\"sourcesContent\":[\"#ex-toast-container {\\n  position: absolute;\\n  height: 0;\\n  min-width: 50%;\\n  left: 50%;\\n  top: 0;\\n}\\n\\n.ex-toast-message {\\n  left: -50%;\\n  position: relative;\\n  display: flex;\\n  justify-content: space-between;\\n\\n  padding: 10px;\\n  margin-top: 5px;\\n  font-size: 18px;\\n  font-family: sans-serif;\\n  border-radius: 6px;\\n  border: 3px solid #b7b779;\\n  background-color: rgb(253, 253, 192);\\n}\\n\\n.ex-toast-message button {\\n  align-self: flex-start;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n/***/ }),\n\n/***/ 935:\n/***/ ((module) => {\n\n\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};\n\n/***/ }),\n\n/***/ 1:\n/***/ ((module) => {\n\n\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};\n\n/***/ })\n\n/******/ });\n/************************************************************************/\n/******/ // The module cache\n/******/ var __webpack_module_cache__ = {};\n/******/ \n/******/ // The require function\n/******/ function __webpack_require__(moduleId) {\n/******/ \t// Check if module is in cache\n/******/ \tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \tif (cachedModule !== undefined) {\n/******/ \t\treturn cachedModule.exports;\n/******/ \t}\n/******/ \t// Create a new module (and put it into the cache)\n/******/ \tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\tid: moduleId,\n/******/ \t\t// no module.loaded needed\n/******/ \t\texports: {}\n/******/ \t};\n/******/ \n/******/ \t// Execute the module function\n/******/ \t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \n/******/ \t// Return the exports of the module\n/******/ \treturn module.exports;\n/******/ }\n/******/ \n/************************************************************************/\n/******/ /* webpack/runtime/compat get default export */\n/******/ (() => {\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = (module) => {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\t() => (module['default']) :\n/******/ \t\t\t() => (module);\n/******/ \t\t__webpack_require__.d(getter, { a: getter });\n/******/ \t\treturn getter;\n/******/ \t};\n/******/ })();\n/******/ \n/******/ /* webpack/runtime/define property getters */\n/******/ (() => {\n/******/ \t// define getter functions for harmony exports\n/******/ \t__webpack_require__.d = (exports, definition) => {\n/******/ \t\tfor(var key in definition) {\n/******/ \t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t}\n/******/ \t\t}\n/******/ \t};\n/******/ })();\n/******/ \n/******/ /* webpack/runtime/hasOwnProperty shorthand */\n/******/ (() => {\n/******/ \t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ })();\n/******/ \n/******/ /* webpack/runtime/make namespace object */\n/******/ (() => {\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = (exports) => {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/ })();\n/******/ \n/************************************************************************/\nvar __webpack_exports__ = {};\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  eKr: () => (/* reexport */ ActionCompleteEvent),\n  yVm: () => (/* reexport */ ActionContext),\n  a7j: () => (/* reexport */ ActionQueue),\n  U_w: () => (/* reexport */ ActionSequence),\n  JF2: () => (/* reexport */ ActionStartEvent),\n  htg: () => (/* reexport */ ActionsComponent),\n  HXL: () => (/* reexport */ ActionsSystem),\n  mcg: () => (/* reexport */ ActivateEvent),\n  Agj: () => (/* reexport */ Actor),\n  J3_: () => (/* reexport */ ActorEvents),\n  Wgv: () => (/* reexport */ AddEvent),\n  u6S: () => (/* reexport */ AddedComponent),\n  x7M: () => (/* reexport */ AffineMatrix),\n  X55: () => (/* reexport */ Animation),\n  m3M: () => (/* reexport */ AnimationDirection),\n  aE5: () => (/* reexport */ AnimationEvents),\n  YJU: () => (/* reexport */ AnimationStrategy),\n  eZi: () => (/* reexport */ ArcadeSolver),\n  GNv: () => (/* reexport */ AudioContextFactory),\n  Y56: () => (/* reexport */ Axes),\n  _0v: () => (/* reexport */ Axis),\n  vhs: () => (/* reexport */ BaseAlign),\n  vrQ: () => (/* reexport */ BezierCurve),\n  Z8b: () => (/* reexport */ Blink),\n  Yfw: () => (/* reexport */ BodyComponent),\n  IcQ: () => (/* reexport */ BoundingBox),\n  kgJ: () => (/* reexport */ BrowserComponent),\n  GTT: () => (/* reexport */ BrowserEvents),\n  ypY: () => (/* reexport */ Buttons),\n  i7d: () => (/* reexport */ Camera),\n  fQ3: () => (/* reexport */ CameraEvents),\n  HlI: () => (/* reexport */ Canvas),\n  jlt: () => (/* reexport */ Circle),\n  VQc: () => (/* reexport */ CircleCollider),\n  zD7: () => (/* reexport */ Clock),\n  AUF: () => (/* reexport */ ClosestLineJumpTable),\n  JoF: () => (/* reexport */ Collider),\n  MlA: () => (/* reexport */ ColliderComponent),\n  PZh: () => (/* reexport */ CollisionContact),\n  qA: () => (/* reexport */ CollisionEndEvent),\n  CrD: () => (/* reexport */ CollisionGroup),\n  dQK: () => (/* reexport */ CollisionGroupManager),\n  D3r: () => (/* reexport */ CollisionJumpTable),\n  Qpo: () => (/* reexport */ CollisionPostSolveEvent),\n  D9n: () => (/* reexport */ CollisionPreSolveEvent),\n  b6v: () => (/* reexport */ CollisionStartEvent),\n  mvh: () => (/* reexport */ CollisionSystem),\n  Bpo: () => (/* reexport */ CollisionType),\n  Q1f: () => (/* reexport */ Color),\n  IKv: () => (/* reexport */ ColorBlindFlags),\n  fcV: () => (/* reexport */ ColorBlindnessMode),\n  Glf: () => (/* reexport */ ColorBlindnessPostProcessor),\n  uAl: () => (/* reexport */ Component),\n  ElT: () => (/* reexport */ CompositeCollider),\n  Z8r: () => (/* reexport */ ConsoleAppender),\n  QSL: () => (/* reexport */ ContactConstraintPoint),\n  sPV: () => (/* reexport */ ContactEndEvent),\n  nAn: () => (/* reexport */ ContactSolveBias),\n  zCU: () => (/* reexport */ ContactStartEvent),\n  QrV: () => (/* reexport */ CoordPlane),\n  fF9: () => (/* reexport */ CrossFade),\n  Jqv: () => (/* reexport */ CurveBy),\n  d_u: () => (/* reexport */ CurveTo),\n  xI8: () => (/* reexport */ DeactivateEvent),\n  yar: () => (/* reexport */ Debug),\n  SP7: () => (/* reexport */ DebugConfig),\n  oRy: () => (/* reexport */ DebugGraphicsComponent),\n  f5X: () => (/* reexport */ DebugSystem),\n  V1c: () => (/* reexport */ DebugText),\n  Mlx: () => (/* reexport */ DefaultAntialiasOptions),\n  ZiM: () => (/* reexport */ DefaultGarbageCollectionOptions),\n  ZCo: () => (/* reexport */ DefaultLoader),\n  Vy3: () => (/* reexport */ DefaultPhysicsConfig),\n  J5p: () => (/* reexport */ DefaultPixelArtOptions),\n  mL_: () => (/* reexport */ DegreeOfFreedom),\n  Guw: () => (/* reexport */ Delay),\n  N5j: () => (/* reexport */ Detector),\n  pgY: () => (/* reexport */ Die),\n  OP3: () => (/* reexport */ Direction),\n  rl5: () => (/* reexport */ Director),\n  eod: () => (/* reexport */ DirectorEvents),\n  q5Z: () => (/* reexport */ DisplayMode),\n  YUC: () => (/* reexport */ DynamicTree),\n  saR: () => (/* reexport */ DynamicTreeCollisionProcessor),\n  hvr: () => (/* binding */ EX_VERSION),\n  Qol: () => (/* reexport */ EaseBy),\n  Wf4: () => (/* reexport */ EaseTo),\n  JCs: () => (/* reexport */ EasingFunctions),\n  gJV: () => (/* reexport */ EdgeCollider),\n  fWD: () => (/* reexport */ ElasticToActorStrategy),\n  Va_: () => (/* reexport */ EmitterType),\n  N$8: () => (/* reexport */ Engine),\n  _jQ: () => (/* reexport */ EngineEvents),\n  rxj: () => (/* reexport */ EnterTriggerEvent),\n  rhv: () => (/* reexport */ EnterViewPortEvent),\n  wCu: () => (/* reexport */ Entity),\n  HAp: () => (/* reexport */ EntityEvents),\n  Zy1: () => (/* reexport */ EntityManager),\n  bkB: () => (/* reexport */ EventEmitter),\n  wfL: () => (/* reexport */ EventTypes),\n  sVA: () => (/* reexport */ Events_namespaceObject),\n  $Gs: () => (/* reexport */ ExResponse),\n  CJ0: () => (/* reexport */ ExcaliburGraphicsContext2DCanvas),\n  NWh: () => (/* reexport */ ExcaliburGraphicsContextWebGL),\n  tWi: () => (/* reexport */ ExitTriggerEvent),\n  xAj: () => (/* reexport */ ExitViewPortEvent),\n  zWh: () => (/* reexport */ Fade),\n  i_4: () => (/* reexport */ FadeInOut),\n  iIx: () => (/* reexport */ Flags),\n  Hxo: () => (/* reexport */ Flash),\n  c9e: () => (/* reexport */ Follow),\n  KQV: () => (/* reexport */ Font),\n  weH: () => (/* reexport */ FontCache),\n  jXp: () => (/* reexport */ FontSource),\n  zzY: () => (/* reexport */ FontStyle),\n  yRQ: () => (/* reexport */ FontUnit),\n  MtE: () => (/* reexport */ FpsSampler),\n  rPj: () => (/* reexport */ FrameStats),\n  KLc: () => (/* reexport */ Future),\n  Fir: () => (/* reexport */ GameEvent),\n  V5f: () => (/* reexport */ GameStartEvent),\n  Xj7: () => (/* reexport */ GameStopEvent),\n  Wud: () => (/* reexport */ Gamepad),\n  FVg: () => (/* reexport */ GamepadAxisEvent),\n  g5Y: () => (/* reexport */ GamepadButtonEvent),\n  YQB: () => (/* reexport */ GamepadConnectEvent),\n  KPb: () => (/* reexport */ GamepadDisconnectEvent),\n  nHK: () => (/* reexport */ Gamepads),\n  Jrb: () => (/* reexport */ GarbageCollector),\n  TX_: () => (/* reexport */ Gif),\n  Olt: () => (/* reexport */ GifParser),\n  r3n: () => (/* reexport */ GlobalCoordinates),\n  Fvk: () => (/* reexport */ GpuParticleEmitter),\n  gpR: () => (/* reexport */ GpuParticleRenderer),\n  vYh: () => (/* reexport */ Graphic),\n  hnk: () => (/* reexport */ GraphicsComponent),\n  D2R: () => (/* reexport */ GraphicsGroup),\n  n1o: () => (/* reexport */ GraphicsSystem),\n  h9O: () => (/* reexport */ HashColliderProxy),\n  X5j: () => (/* reexport */ HashGridCell),\n  p3P: () => (/* reexport */ HashGridProxy),\n  RLG: () => (/* reexport */ HiddenEvent),\n  fBU: () => (/* reexport */ HorizontalFirst),\n  Adb: () => (/* reexport */ ImageFiltering),\n  bEs: () => (/* reexport */ ImageSource),\n  wCy: () => (/* reexport */ ImageSourceAttributeConstants),\n  CbD: () => (/* reexport */ ImageWrapping),\n  x_C: () => (/* reexport */ InitializeEvent),\n  pGf: () => (/* reexport */ InputHost),\n  ibQ: () => (/* reexport */ InputMapper),\n  shR: () => (/* reexport */ IsometricEntityComponent),\n  Yjk: () => (/* reexport */ IsometricEntitySystem),\n  _u1: () => (/* reexport */ IsometricMap),\n  OBI: () => (/* reexport */ IsometricTile),\n  klh: () => (/* reexport */ KeyEvent),\n  s3S: () => (/* reexport */ Keyboard),\n  D$R: () => (/* reexport */ Keys),\n  xth: () => (/* reexport */ KillEvent),\n  JU7: () => (/* reexport */ Label),\n  h9x: () => (/* reexport */ LimitCameraBoundsStrategy),\n  N1A: () => (/* reexport */ Line),\n  e_k: () => (/* reexport */ LineSegment),\n  aHM: () => (/* reexport */ Loader),\n  tlv: () => (/* reexport */ LoaderEvents),\n  Vi9: () => (/* reexport */ LockCameraToActorAxisStrategy),\n  ieR: () => (/* reexport */ LockCameraToActorStrategy),\n  $bb: () => (/* reexport */ LogLevel),\n  VyI: () => (/* reexport */ Logger),\n  imn: () => (/* reexport */ Material),\n  uqu: () => (/* reexport */ Matrix),\n  QnL: () => (/* reexport */ MatrixLocations),\n  vnc: () => (/* reexport */ MediaEvent),\n  wk_: () => (/* reexport */ Meet),\n  GH0: () => (/* reexport */ MotionComponent),\n  _1r: () => (/* reexport */ MotionSystem),\n  l0X: () => (/* reexport */ MoveBy),\n  bT: () => (/* reexport */ MoveByWithOptions),\n  HHX: () => (/* reexport */ MoveTo),\n  jtW: () => (/* reexport */ MoveToWithOptions),\n  tjk: () => (/* reexport */ NativePointerButton),\n  rWe: () => (/* reexport */ NativeSoundEvent),\n  j9l: () => (/* reexport */ NativeSoundProcessedEvent),\n  l0$: () => (/* reexport */ NineSlice),\n  sGJ: () => (/* reexport */ NineSliceStretch),\n  NVp: () => (/* reexport */ None),\n  cPK: () => (/* reexport */ Observable),\n  XoL: () => (/* reexport */ OffscreenSystem),\n  RmF: () => (/* reexport */ Pair),\n  DXI: () => (/* reexport */ ParallaxComponent),\n  tCD: () => (/* reexport */ ParallelActions),\n  J3D: () => (/* reexport */ Particle),\n  vCJ: () => (/* reexport */ ParticleEmitter),\n  e6k: () => (/* reexport */ ParticleRenderer),\n  f9l: () => (/* reexport */ ParticleTransform),\n  v9m: () => (/* reexport */ PhysicsStats),\n  yRJ: () => (/* reexport */ PhysicsWorld),\n  EU6: () => (/* reexport */ PointerAbstraction),\n  m3O: () => (/* reexport */ PointerButton),\n  Ryz: () => (/* reexport */ PointerComponent),\n  OxP: () => (/* reexport */ PointerEvent),\n  LEs: () => (/* reexport */ PointerEventReceiver),\n  Ec: () => (/* reexport */ PointerScope),\n  Pi5: () => (/* reexport */ PointerSystem),\n  gmH: () => (/* reexport */ PointerType),\n  tS: () => (/* reexport */ Polygon),\n  XxX: () => (/* reexport */ PolygonCollider),\n  bCz: () => (/* reexport */ Pool),\n  nYS: () => (/* reexport */ PostCollisionEvent),\n  yiT: () => (/* reexport */ PostDebugDrawEvent),\n  NHl: () => (/* reexport */ PostDrawEvent),\n  mO8: () => (/* reexport */ PostFrameEvent),\n  PXI: () => (/* reexport */ PostKillEvent),\n  bn5: () => (/* reexport */ PostTransformDrawEvent),\n  Ywr: () => (/* reexport */ PostUpdateEvent),\n  cMd: () => (/* reexport */ PreCollisionEvent),\n  Bs6: () => (/* reexport */ PreDebugDrawEvent),\n  G0k: () => (/* reexport */ PreDrawEvent),\n  pyn: () => (/* reexport */ PreFrameEvent),\n  QeM: () => (/* reexport */ PreKillEvent),\n  aPX: () => (/* reexport */ PreLoadEvent),\n  ITP: () => (/* reexport */ PreTransformDrawEvent),\n  BY0: () => (/* reexport */ PreUpdateEvent),\n  MFw: () => (/* reexport */ Projection),\n  sBn: () => (/* reexport */ QuadIndexBuffer),\n  S3L: () => (/* reexport */ QuadTree),\n  XKQ: () => (/* reexport */ Query),\n  ESI: () => (/* reexport */ QueryManager),\n  uxz: () => (/* reexport */ RadiusAroundActorStrategy),\n  o8N: () => (/* reexport */ Random),\n  u_r: () => (/* reexport */ Raster),\n  RlV: () => (/* reexport */ Ray),\n  gVA: () => (/* reexport */ RealisticSolver),\n  M_G: () => (/* reexport */ Rectangle),\n  BpG: () => (/* reexport */ RemoveEvent),\n  GRB: () => (/* reexport */ RemovedComponent),\n  kM6: () => (/* reexport */ Repeat),\n  dO8: () => (/* reexport */ RepeatForever),\n  jgM: () => (/* reexport */ Resolution),\n  FWq: () => (/* reexport */ Resource),\n  s3j: () => (/* reexport */ ResourceEvents),\n  hlw: () => (/* reexport */ RotateBy),\n  L0q: () => (/* reexport */ RotateByWithOptions),\n  B7e: () => (/* reexport */ RotateTo),\n  PGN: () => (/* reexport */ RotateToWithOptions),\n  H_X: () => (/* reexport */ RotationType),\n  S_d: () => (/* reexport */ ScaleBy),\n  _Tq: () => (/* reexport */ ScaleByWithOptions),\n  U7E: () => (/* reexport */ ScaleTo),\n  IOH: () => (/* reexport */ ScaleToWithOptions),\n  Z58: () => (/* reexport */ Scene),\n  yh2: () => (/* reexport */ SceneEvents),\n  ff$: () => (/* reexport */ Screen),\n  cWi: () => (/* reexport */ ScreenAppender),\n  NBt: () => (/* reexport */ ScreenElement),\n  oNz: () => (/* reexport */ ScreenEvents),\n  QlU: () => (/* reexport */ ScreenShader),\n  Xey: () => (/* reexport */ ScrollPreventionMode),\n  jft: () => (/* reexport */ Semaphore),\n  _r8: () => (/* reexport */ SeparatingAxis),\n  bTC: () => (/* reexport */ SeparationInfo),\n  Mtr: () => (/* reexport */ Shader),\n  ypk: () => (/* reexport */ Shape),\n  mnM: () => (/* reexport */ Side),\n  q7S: () => (/* reexport */ Slide),\n  bAZ: () => (/* reexport */ SolverStrategy),\n  ABN: () => (/* reexport */ Sound),\n  VK6: () => (/* reexport */ SoundEvents),\n  Hj2: () => (/* reexport */ SparseHashGrid),\n  Df8: () => (/* reexport */ SparseHashGridCollisionProcessor),\n  oOx: () => (/* reexport */ SpatialPartitionStrategy),\n  kxk: () => (/* reexport */ Sprite),\n  DT1: () => (/* reexport */ SpriteFont),\n  FLG: () => (/* reexport */ SpriteSheet),\n  qN_: () => (/* reexport */ StandardClock),\n  Z37: () => (/* reexport */ StateMachine),\n  FtL: () => (/* reexport */ StrategyContainer),\n  Z6X: () => (/* reexport */ Stream),\n  iQT: () => (/* reexport */ System),\n  ziO: () => (/* reexport */ SystemManager),\n  OEF: () => (/* reexport */ SystemPriority),\n  uuE: () => (/* reexport */ SystemType),\n  tiv: () => (/* reexport */ TagQuery),\n  T$Y: () => (/* reexport */ TestClock),\n  EYj: () => (/* reexport */ Text),\n  nOB: () => (/* reexport */ TextAlign),\n  Tap: () => (/* reexport */ TextureLoader),\n  FAs: () => (/* reexport */ Tile),\n  B_P: () => (/* reexport */ TileMap),\n  aA5: () => (/* reexport */ TileMapEvents),\n  J3s: () => (/* reexport */ TiledAnimation),\n  Y0Q: () => (/* reexport */ TiledSprite),\n  M4G: () => (/* reexport */ Timer),\n  l$l: () => (/* reexport */ Toaster),\n  dLy: () => (/* reexport */ transform_Transform),\n  WZP: () => (/* reexport */ TransformComponent),\n  eB6: () => (/* reexport */ Transition),\n  nFK: () => (/* reexport */ TreeNode),\n  l9z: () => (/* reexport */ Trigger),\n  YOF: () => (/* reexport */ TriggerEvents),\n  yhB: () => (/* reexport */ TwoPI),\n  J0N: () => (/* reexport */ Util_Index_namespaceObject),\n  Miz: () => (/* reexport */ Vector),\n  Bj4: () => (/* reexport */ VectorView),\n  Rcs: () => (/* reexport */ VertexBuffer),\n  vJ4: () => (/* reexport */ VertexLayout),\n  TqC: () => (/* reexport */ VerticalFirst),\n  nM0: () => (/* reexport */ VisibleEvent),\n  X1u: () => (/* reexport */ WebAudio),\n  SpZ: () => (/* reexport */ WebAudioInstance),\n  DX8: () => (/* reexport */ WheelDeltaMode),\n  Yx$: () => (/* reexport */ WheelEvent),\n  HK4: () => (/* reexport */ World),\n  yt5: () => (/* reexport */ approximatelyEqual),\n  vAR: () => (/* reexport */ assert),\n  SE$: () => (/* reexport */ canonicalizeAngle),\n  qE8: () => (/* reexport */ clamp),\n  Pz7: () => (/* reexport */ coroutine),\n  sX_: () => (/* reexport */ createId),\n  JuI: () => (/* reexport */ frac),\n  Nl$: () => (/* reexport */ hasGraphicsTick),\n  zDr: () => (/* reexport */ hasOnAdd),\n  OwT: () => (/* reexport */ hasOnInitialize),\n  P$G: () => (/* reexport */ hasOnPostUpdate),\n  mHV: () => (/* reexport */ hasOnPreUpdate),\n  kEA: () => (/* reexport */ hasOnRemove),\n  Fx_: () => (/* reexport */ hasPostDraw),\n  WFC: () => (/* reexport */ hasPreDraw),\n  vKu: () => (/* reexport */ has_add),\n  aDq: () => (/* reexport */ has_initialize),\n  jIg: () => (/* reexport */ has_postupdate),\n  UH3: () => (/* reexport */ has_preupdate),\n  AJO: () => (/* reexport */ has_remove),\n  U4: () => (/* reexport */ inverseLerp),\n  xAc: () => (/* reexport */ inverseLerpVector),\n  _3Y: () => (/* reexport */ isActor),\n  K6X: () => (/* reexport */ isAddedComponent),\n  C1Y: () => (/* reexport */ isComponentCtor),\n  Aw1: () => (/* reexport */ isLoaderConstructor),\n  tm8: () => (/* reexport */ isMoveByOptions),\n  LBV: () => (/* reexport */ isMoveToOptions),\n  A8$: () => (/* reexport */ isRemovedComponent),\n  F5e: () => (/* reexport */ isRotateByOptions),\n  ran: () => (/* reexport */ isRotateToOptions),\n  c8L: () => (/* reexport */ isScaleByOptions),\n  o6M: () => (/* reexport */ isScaleToOptions),\n  hsx: () => (/* reexport */ isSceneConstructor),\n  l9E: () => (/* reexport */ isScreenElement),\n  aSf: () => (/* reexport */ isSystemConstructor),\n  CcK: () => (/* reexport */ lerp),\n  nU8: () => (/* reexport */ lerpAngle),\n  td6: () => (/* reexport */ lerpVector),\n  Zex: () => (/* reexport */ maxMessages),\n  bkJ: () => (/* reexport */ nextActionId),\n  mXP: () => (/* reexport */ obsolete),\n  vt$: () => (/* reexport */ parseImageFiltering),\n  hCA: () => (/* reexport */ parseImageWrapping),\n  pjR: () => (/* reexport */ pixelSnapEpsilon),\n  U43: () => (/* reexport */ randomInRange),\n  pSZ: () => (/* reexport */ randomIntInRange),\n  y17: () => (/* reexport */ range),\n  Ew7: () => (/* reexport */ remap),\n  hG1: () => (/* reexport */ remapVector),\n  jVr: () => (/* reexport */ resetObsoleteCounter),\n  _SZ: () => (/* reexport */ sign),\n  xWn: () => (/* reexport */ toDegrees),\n  ehJ: () => (/* reexport */ toRadians),\n  t6s: () => (/* reexport */ vec),\n  Eyn: () => (/* reexport */ webgl_util_namespaceObject)\n});\n\n// NAMESPACE OBJECT: ./Graphics/Context/webgl-util.ts\nvar webgl_util_namespaceObject = {};\n__webpack_require__.r(webgl_util_namespaceObject);\n__webpack_require__.d(webgl_util_namespaceObject, {\n  getAttributeComponentSize: () => (getAttributeComponentSize),\n  getAttributePointerType: () => (getAttributePointerType),\n  getGLTypeFromSource: () => (getGLTypeFromSource),\n  getGlTypeSizeBytes: () => (getGlTypeSizeBytes),\n  getMaxShaderComplexity: () => (getMaxShaderComplexity),\n  isAttributeInSource: () => (isAttributeInSource)\n});\n\n// NAMESPACE OBJECT: ./Util/DrawUtil.ts\nvar DrawUtil_namespaceObject = {};\n__webpack_require__.r(DrawUtil_namespaceObject);\n__webpack_require__.d(DrawUtil_namespaceObject, {\n  circle: () => (circle),\n  line: () => (line),\n  point: () => (point),\n  roundRect: () => (roundRect),\n  vector: () => (vector)\n});\n\n// NAMESPACE OBJECT: ./Events.ts\nvar Events_namespaceObject = {};\n__webpack_require__.r(Events_namespaceObject);\n__webpack_require__.d(Events_namespaceObject, {\n  ActionCompleteEvent: () => (ActionCompleteEvent),\n  ActionStartEvent: () => (ActionStartEvent),\n  ActivateEvent: () => (ActivateEvent),\n  AddEvent: () => (AddEvent),\n  CollisionEndEvent: () => (CollisionEndEvent),\n  CollisionPostSolveEvent: () => (CollisionPostSolveEvent),\n  CollisionPreSolveEvent: () => (CollisionPreSolveEvent),\n  CollisionStartEvent: () => (CollisionStartEvent),\n  ContactEndEvent: () => (ContactEndEvent),\n  ContactStartEvent: () => (ContactStartEvent),\n  DeactivateEvent: () => (DeactivateEvent),\n  EnterTriggerEvent: () => (EnterTriggerEvent),\n  EnterViewPortEvent: () => (EnterViewPortEvent),\n  EventTypes: () => (EventTypes),\n  ExitTriggerEvent: () => (ExitTriggerEvent),\n  ExitViewPortEvent: () => (ExitViewPortEvent),\n  GameEvent: () => (GameEvent),\n  GameStartEvent: () => (GameStartEvent),\n  GameStopEvent: () => (GameStopEvent),\n  GamepadAxisEvent: () => (GamepadAxisEvent),\n  GamepadButtonEvent: () => (GamepadButtonEvent),\n  GamepadConnectEvent: () => (GamepadConnectEvent),\n  GamepadDisconnectEvent: () => (GamepadDisconnectEvent),\n  HiddenEvent: () => (HiddenEvent),\n  InitializeEvent: () => (InitializeEvent),\n  KillEvent: () => (KillEvent),\n  PostCollisionEvent: () => (PostCollisionEvent),\n  PostDebugDrawEvent: () => (PostDebugDrawEvent),\n  PostDrawEvent: () => (PostDrawEvent),\n  PostFrameEvent: () => (PostFrameEvent),\n  PostKillEvent: () => (PostKillEvent),\n  PostTransformDrawEvent: () => (PostTransformDrawEvent),\n  PostUpdateEvent: () => (PostUpdateEvent),\n  PreCollisionEvent: () => (PreCollisionEvent),\n  PreDebugDrawEvent: () => (PreDebugDrawEvent),\n  PreDrawEvent: () => (PreDrawEvent),\n  PreFrameEvent: () => (PreFrameEvent),\n  PreKillEvent: () => (PreKillEvent),\n  PreTransformDrawEvent: () => (PreTransformDrawEvent),\n  PreUpdateEvent: () => (PreUpdateEvent),\n  RemoveEvent: () => (RemoveEvent),\n  VisibleEvent: () => (VisibleEvent)\n});\n\n// NAMESPACE OBJECT: ./Util/Index.ts\nvar Util_Index_namespaceObject = {};\n__webpack_require__.r(Util_Index_namespaceObject);\n__webpack_require__.d(Util_Index_namespaceObject, {\n  ConsoleAppender: () => (ConsoleAppender),\n  DrawUtil: () => (DrawUtil_namespaceObject),\n  EasingFunctions: () => (EasingFunctions),\n  LogLevel: () => (LogLevel),\n  Logger: () => (Logger),\n  Observable: () => (Observable),\n  ScreenAppender: () => (ScreenAppender),\n  addItemToArray: () => (addItemToArray),\n  contains: () => (contains),\n  delay: () => (delay),\n  fail: () => (fail),\n  getPosition: () => (getPosition),\n  isObject: () => (isObject),\n  mergeDeep: () => (mergeDeep),\n  omit: () => (omit),\n  removeItemFromArray: () => (removeItemFromArray)\n});\n\n;// ./Polyfill.ts\n/**\n * Polyfill adding function\n */\nfunction polyfill() {\n    /* istanbul ignore next */\n    if (typeof window === 'undefined') {\n        window = {\n            audioContext: function () {\n                return;\n            }\n        };\n    }\n    /* istanbul ignore next */\n    if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\n        window.requestAnimationFrame =\n            window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                function (callback) {\n                    window.setInterval(callback, 1000 / 60);\n                };\n    }\n    /* istanbul ignore next */\n    if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\n        window.cancelAnimationFrame =\n            window.webkitCancelAnimationFrame ||\n                window.mozCancelAnimationFrame ||\n                function () {\n                    return;\n                };\n    }\n    /* istanbul ignore next */\n    if (typeof window !== 'undefined' && !window.AudioContext) {\n        if (window.webkitAudioContext) {\n            const ctx = window.webkitAudioContext;\n            const replaceMe = ctx.prototype.decodeAudioData;\n            window.webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer) {\n                return new Promise((resolve, reject) => {\n                    replaceMe.call(this, arrayBuffer, resolve, reject);\n                });\n            };\n        }\n        window.AudioContext =\n            window.AudioContext ||\n                window.webkitAudioContext ||\n                window.mozAudioContext ||\n                window.msAudioContext ||\n                window.oAudioContext;\n    }\n    /* istanbul ignore next */\n    if (typeof window !== 'undefined' && !window.devicePixelRatio) {\n        window.devicePixelRatio = window.devicePixelRatio || 1;\n    }\n    /* istanbul ignore next */\n    if (typeof window !== 'undefined' && !window.requestIdleCallback) {\n        // Adapted from https://developer.chrome.com/blog/using-requestidlecallback#checking_for_requestidlecallback\n        window.requestIdleCallback =\n            window.requestIdleCallback ||\n                function (cb) {\n                    const start = Date.now();\n                    return setTimeout(function () {\n                        cb({\n                            didTimeout: false,\n                            timeRemaining: function () {\n                                return Math.max(0, 50 - (Date.now() - start));\n                            }\n                        });\n                    }, 1);\n                };\n        window.cancelIdleCallback =\n            window.cancelIdleCallback ||\n                function (id) {\n                    clearTimeout(id);\n                };\n    }\n}\n\n;// ./Flags.ts\n/**\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before {@apilink Engine} construction**\n * after which they are frozen and are read-only.\n *\n * Flags are used to enable experimental or preview features in Excalibur.\n */\nclass Flags {\n    /**\n     * Force excalibur to load the Canvas 2D graphics context fallback\n     * @warning not all features of excalibur are supported in the Canvas 2D fallback\n     */\n    static useCanvasGraphicsContext() {\n        Flags.enable('use-canvas-context');\n    }\n    /**\n     * Force excalibur to use the less optimized image renderer\n     */\n    static useLegacyImageRenderer() {\n        Flags.enable('use-legacy-image-renderer');\n    }\n    /**\n     * Freeze all flag modifications making them readonly\n     */\n    static freeze() {\n        Flags._FROZEN = true;\n    }\n    /**\n     * Resets internal flag state, not meant to be called by users. Only used for testing.\n     *\n     * Calling this in your game is UNSUPPORTED\n     * @internal\n     */\n    static _reset() {\n        Flags._FROZEN = false;\n        Flags._FLAGS = {};\n    }\n    /**\n     * Enable a specific feature flag by name. **Note: can only be set before {@apilink Engine} constructor time**\n     * @param flagName\n     */\n    static enable(flagName) {\n        if (this._FROZEN) {\n            throw Error('Feature flags can only be enabled before Engine constructor time');\n        }\n        Flags._FLAGS[flagName] = true;\n    }\n    /**\n     * Disable a specific feature flag by name. **Note: can only be set before {@apilink Engine} constructor time**\n     * @param flagName\n     */\n    static disable(flagName) {\n        if (this._FROZEN) {\n            throw Error('Feature flags can only be disabled before Engine constructor time');\n        }\n        Flags._FLAGS[flagName] = false;\n    }\n    /**\n     * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\n     * @param flagName\n     */\n    static isEnabled(flagName) {\n        return !!Flags._FLAGS[flagName];\n    }\n    /**\n     * Show a list of currently known flags\n     */\n    static show() {\n        return Object.keys(Flags._FLAGS);\n    }\n}\nFlags._FROZEN = false;\nFlags._FLAGS = {};\n\n;// ./Id.ts\n/**\n * Create a branded ID type from a number\n */\nfunction createId(type, value) {\n    return { type, value };\n}\n\n;// ./Util/Future.ts\n/**\n * Future is a wrapper around a native browser Promise to allow resolving/rejecting at any time\n */\nclass Future {\n    constructor() {\n        this._isCompleted = false;\n        this.promise = new Promise((resolve, reject) => {\n            this._resolver = resolve;\n            this._rejecter = reject;\n        });\n    }\n    get isCompleted() {\n        return this._isCompleted;\n    }\n    resolve(value) {\n        if (this._isCompleted) {\n            return;\n        }\n        this._isCompleted = true;\n        this._resolver(value);\n    }\n    reject(error) {\n        if (this._isCompleted) {\n            return;\n        }\n        this._isCompleted = true;\n        this._rejecter(error);\n    }\n}\n\n;// ./EventEmitter.ts\n/**\n * Excalibur's typed event emitter, this allows events to be sent with any string to Type mapping\n */\nclass EventEmitter {\n    constructor() {\n        this._paused = false;\n        this._empty = true;\n        this._listeners = {};\n        this._listenersOnce = {};\n        this._pipes = [];\n    }\n    /**\n     * Removes all listeners and pipes\n     */\n    clear() {\n        this._listeners = {};\n        this._listenersOnce = {};\n        this._pipes.length = 0;\n        this._empty = true;\n    }\n    on(eventName, handler) {\n        var _a;\n        this._empty = false;\n        this._listeners[eventName] = (_a = this._listeners[eventName]) !== null && _a !== void 0 ? _a : [];\n        this._listeners[eventName].push(handler);\n        return {\n            close: () => this.off(eventName, handler)\n        };\n    }\n    once(eventName, handler) {\n        var _a;\n        this._empty = false;\n        this._listenersOnce[eventName] = (_a = this._listenersOnce[eventName]) !== null && _a !== void 0 ? _a : [];\n        this._listenersOnce[eventName].push(handler);\n        return {\n            close: () => this.off(eventName, handler)\n        };\n    }\n    off(eventName, handler) {\n        var _a, _b;\n        if (handler) {\n            const newListeners = (_a = this._listeners[eventName]) === null || _a === void 0 ? void 0 : _a.filter((h) => h !== handler);\n            this._listeners[eventName] = newListeners;\n            const newOnceListeners = (_b = this._listenersOnce[eventName]) === null || _b === void 0 ? void 0 : _b.filter((h) => h !== handler);\n            this._listenersOnce[eventName] = newOnceListeners;\n        }\n        else {\n            delete this._listeners[eventName];\n        }\n    }\n    emit(eventName, event) {\n        if (this._empty) {\n            return;\n        }\n        if (this._paused) {\n            return;\n        }\n        const listeners = this._listeners[eventName];\n        if (listeners) {\n            for (let i = 0; i < listeners.length; i++) {\n                listeners[i](event);\n            }\n        }\n        const onces = this._listenersOnce[eventName];\n        this._listenersOnce[eventName] = [];\n        if (onces) {\n            for (let i = 0; i < onces.length; i++) {\n                onces[i](event);\n            }\n        }\n        for (let i = 0; i < this._pipes.length; i++) {\n            this._pipes[i].emit(eventName, event);\n        }\n    }\n    /**\n     * Replay events from this emitter to another\n     * @param emitter\n     */\n    pipe(emitter) {\n        if (this === emitter) {\n            throw Error('Cannot pipe to self');\n        }\n        this._empty = false;\n        this._pipes.push(emitter);\n        return {\n            close: () => {\n                const i = this._pipes.indexOf(emitter);\n                if (i > -1) {\n                    this._pipes.splice(i, 1);\n                }\n            }\n        };\n    }\n    /**\n     * Remove any piped emitters\n     * @param emitter\n     */\n    unpipe(emitter) {\n        const i = this._pipes.indexOf(emitter);\n        if (i > -1) {\n            this._pipes.splice(i, 1);\n        }\n    }\n    /**\n     * Paused event emitters do not emit events\n     */\n    pause() {\n        this._paused = true;\n    }\n    /**\n     * Unpaused event emitter do emit events\n     */\n    unpause() {\n        this._paused = false;\n    }\n}\n\n;// ./Input/PointerScope.ts\n/**\n * Determines the scope of handling mouse/touch events.\n */\nvar PointerScope;\n(function (PointerScope) {\n    /**\n     * Handle events on the `canvas` element only. Events originating outside the\n     * `canvas` will not be handled.\n     */\n    PointerScope[\"Canvas\"] = \"Canvas\";\n    /**\n     * Handles events on the entire document. All events will be handled by Excalibur.\n     */\n    PointerScope[\"Document\"] = \"Document\";\n})(PointerScope || (PointerScope = {}));\n\n;// ./Math/Random.ts\n/**\n * @module\n * Pseudo-Random Utility\n *\n * A pseudo-random utility to add seeded random support for help in\n * generating things like terrain or reproducible randomness. Uses the\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\n */\n/**\n * 32-bit mask\n */\nconst BITMASK32 = 0xffffffff;\n/**\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\n * of numbers each time it is called.\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\n *\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\n */\nclass Random {\n    /**\n     * If no seed is specified, the Date.now() is used\n     */\n    constructor(seed) {\n        this.seed = seed;\n        // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\n        this._lowerMask = 0x7fffffff; // 31 bits same as _r\n        this._upperMask = 0x80000000; // 34 high bits\n        // Word size, 64 bits\n        this._w = 32;\n        // Degree of recurrence\n        this._n = 624;\n        // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\n        this._m = 397;\n        // coefficients of teh rational normal form twist matrix\n        this._a = 0x9908b0df;\n        // tempering bit shifts and masks\n        this._u = 11;\n        this._s = 7;\n        this._b = 0x9d2c5680;\n        this._t = 15;\n        this._c = 0xefc60000;\n        this._l = 18;\n        this._f = 1812433253;\n        this._mt = new Array(this._n);\n        // need to mask to support higher bit machines\n        this._mt[0] = (seed || Date.now()) >>> 0;\n        for (let i = 1; i < this._n; i++) {\n            const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\n            // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\n            this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\n        }\n        this._index = this._n;\n    }\n    /**\n     * Apply the twist\n     */\n    _twist() {\n        const mag01 = [0x0, this._a];\n        let y = 0, i = 0;\n        for (; i < this._n - this._m; i++) {\n            y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n            this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n        }\n        for (; i < this._n - 1; i++) {\n            y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n            this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n        }\n        y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\n        this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n        this._index = 0;\n    }\n    /**\n     * Return next 32 bit integer number in sequence\n     */\n    nextInt() {\n        if (this._index >= this._n) {\n            this._twist();\n        }\n        let y = this._mt[this._index++];\n        y ^= y >>> this._u;\n        y ^= (y << this._s) & this._b;\n        y ^= (y << this._t) & this._c;\n        y ^= y >>> this._l;\n        return y >>> 0;\n    }\n    /**\n     * Return a random floating point number between [0, 1)\n     */\n    next() {\n        return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\n    }\n    /**\n     * Return a random floating point in range [min, max) min is included, max is not included\n     */\n    floating(min, max) {\n        return (max - min) * this.next() + min;\n    }\n    /**\n     * Return a random integer in range [min, max] min is included, max is included.\n     * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\n     */\n    integer(min, max) {\n        return Math.floor((max - min + 1) * this.next() + min);\n    }\n    /**\n     * Returns true or false randomly with 50/50 odds by default.\n     * By default the likelihood of returning a true is .5 (50%).\n     * @param likelihood takes values between [0, 1]\n     */\n    bool(likelihood = 0.5) {\n        return this.next() <= likelihood;\n    }\n    /**\n     * Returns one element from an array at random\n     */\n    pickOne(array) {\n        return array[this.integer(0, array.length - 1)];\n    }\n    /**\n     * Returns a new array random picking elements from the original\n     * @param array Original array to pick from\n     * @param numPicks can be any positive number\n     * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\n     * just that it is possible)\n     */\n    pickSet(array, numPicks, allowDuplicates = false) {\n        if (allowDuplicates) {\n            return this._pickSetWithDuplicates(array, numPicks);\n        }\n        else {\n            return this._pickSetWithoutDuplicates(array, numPicks);\n        }\n    }\n    /**\n     * Returns a new array randomly picking elements in the original (not reused)\n     * @param array Array to pick elements out of\n     * @param numPicks must be less than or equal to the number of elements in the array.\n     */\n    _pickSetWithoutDuplicates(array, numPicks) {\n        if (numPicks > array.length || numPicks < 0) {\n            throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\n        }\n        if (numPicks === array.length) {\n            return array;\n        }\n        const result = new Array(numPicks);\n        let currentPick = 0;\n        const tempArray = array.slice(0);\n        while (currentPick < numPicks) {\n            const index = this.integer(0, tempArray.length - 1);\n            result[currentPick++] = tempArray[index];\n            tempArray.splice(index, 1);\n        }\n        return result;\n    }\n    /**\n     * Returns a new array random picking elements from the original allowing duplicates\n     * @param array Array to pick elements out of\n     * @param numPicks can be any positive number\n     */\n    _pickSetWithDuplicates(array, numPicks) {\n        // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\n        if (numPicks < 0) {\n            throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\n        }\n        const result = new Array(numPicks);\n        for (let i = 0; i < numPicks; i++) {\n            result[i] = this.pickOne(array);\n        }\n        return result;\n    }\n    /**\n     * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\n     * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n     */\n    shuffle(array) {\n        const tempArray = array.slice(0);\n        let swap;\n        for (let i = 0; i < tempArray.length - 2; i++) {\n            const randomIndex = this.integer(i, tempArray.length - 1);\n            swap = tempArray[i];\n            tempArray[i] = tempArray[randomIndex];\n            tempArray[randomIndex] = swap;\n        }\n        return tempArray;\n    }\n    /**\n     * Generate a list of random integer numbers\n     * @param length the length of the final array\n     * @param min the minimum integer number to generate inclusive\n     * @param max the maximum integer number to generate inclusive\n     */\n    range(length, min, max) {\n        const result = new Array(length);\n        for (let i = 0; i < length; i++) {\n            result[i] = this.integer(min, max);\n        }\n        return result;\n    }\n    /**\n     * Returns the result of a d4 dice roll\n     */\n    d4() {\n        return this.integer(1, 4);\n    }\n    /**\n     * Returns the result of a d6 dice roll\n     */\n    d6() {\n        return this.integer(1, 6);\n    }\n    /**\n     * Returns the result of a d8 dice roll\n     */\n    d8() {\n        return this.integer(1, 8);\n    }\n    /**\n     * Returns the result of a d10 dice roll\n     */\n    d10() {\n        return this.integer(1, 10);\n    }\n    /**\n     * Returns the result of a d12 dice roll\n     */\n    d12() {\n        return this.integer(1, 12);\n    }\n    /**\n     * Returns the result of a d20 dice roll\n     */\n    d20() {\n        return this.integer(1, 20);\n    }\n}\n\n;// ./Math/util.ts\n\n/**\n * Two PI constant\n */\nconst TwoPI = Math.PI * 2;\n/**\n * Returns the fractional part of a number\n * @param x\n */\nfunction frac(x) {\n    if (x >= 0) {\n        return x - Math.floor(x);\n    }\n    else {\n        return x - Math.ceil(x);\n    }\n}\n/**\n * Returns the sign of a number, if 0 returns 0\n */\nfunction sign(val) {\n    if (val === 0) {\n        return 0;\n    }\n    return val < 0 ? -1 : 1;\n}\n/**\n * Clamps a value between a min and max inclusive\n */\nfunction clamp(val, min, max) {\n    return Math.min(Math.max(min, val), max);\n}\n/**\n * Approximately equals\n */\nfunction approximatelyEqual(val1, val2, tolerance) {\n    // https://dev.to/alldanielscott/how-to-compare-numbers-correctly-in-javascript-1l4i\n    return Math.abs(val1 - val2) < tolerance;\n}\n/**\n * Convert an angle to be the equivalent in the range [0, 2PI]\n */\nfunction canonicalizeAngle(angle) {\n    let tmpAngle = angle;\n    if (angle > TwoPI) {\n        while (tmpAngle > TwoPI) {\n            tmpAngle -= TwoPI;\n        }\n    }\n    if (angle < 0) {\n        while (tmpAngle < 0) {\n            tmpAngle += TwoPI;\n        }\n    }\n    return tmpAngle;\n}\n/**\n * Convert radians to degrees\n */\nfunction toDegrees(radians) {\n    return (180 / Math.PI) * radians;\n}\n/**\n * Convert degrees to radians\n */\nfunction toRadians(degrees) {\n    return (degrees / 180) * Math.PI;\n}\n/**\n * Generate a range of numbers\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\n * @param from inclusive\n * @param to inclusive\n */\nconst range = (from, to) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\n/**\n * Find a random floating point number in range\n */\nfunction randomInRange(min, max, random = new Random()) {\n    return random ? random.floating(min, max) : min + Math.random() * (max - min);\n}\n/**\n * Find a random integer in a range\n */\nfunction randomIntInRange(min, max, random = new Random()) {\n    return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\n}\n\n;// ./Math/vector.ts\n\n/**\n * A 2D vector on a plane.\n */\nclass Vector {\n    /**\n     * A (0, 0) vector\n     */\n    static get Zero() {\n        return new Vector(0, 0);\n    }\n    /**\n     * A (1, 1) vector\n     */\n    static get One() {\n        return new Vector(1, 1);\n    }\n    /**\n     * A (0.5, 0.5) vector\n     */\n    static get Half() {\n        return new Vector(0.5, 0.5);\n    }\n    /**\n     * A unit vector pointing up (0, -1)\n     */\n    static get Up() {\n        return new Vector(0, -1);\n    }\n    /**\n     * A unit vector pointing down (0, 1)\n     */\n    static get Down() {\n        return new Vector(0, 1);\n    }\n    /**\n     * A unit vector pointing left (-1, 0)\n     */\n    static get Left() {\n        return new Vector(-1, 0);\n    }\n    /**\n     * A unit vector pointing right (1, 0)\n     */\n    static get Right() {\n        return new Vector(1, 0);\n    }\n    /**\n     * Returns a vector of unit length in the direction of the specified angle in Radians.\n     * @param angle The angle to generate the vector\n     */\n    static fromAngle(angle) {\n        return new Vector(Math.cos(angle), Math.sin(angle));\n    }\n    /**\n     * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\n     */\n    static isValid(vec) {\n        if (vec === null || vec === undefined) {\n            return false;\n        }\n        if (isNaN(vec.x) || isNaN(vec.y)) {\n            return false;\n        }\n        if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Calculates distance between two Vectors\n     * @param vec1\n     * @param vec2\n     */\n    static distance(vec1, vec2) {\n        return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\n    }\n    static min(vec1, vec2) {\n        return new Vector(Math.min(vec1.x, vec2.x), Math.min(vec1.y, vec2.y));\n    }\n    static max(vec1, vec2) {\n        return new Vector(Math.max(vec1.x, vec2.x), Math.max(vec1.y, vec2.y));\n    }\n    /**\n     * @param x  X component of the Vector\n     * @param y  Y component of the Vector\n     */\n    constructor(x, y) {\n        this._x = 0;\n        this._y = 0;\n        this._x = x;\n        this._y = y;\n    }\n    /**\n     * Get the x component of the vector\n     */\n    get x() {\n        return this._x;\n    }\n    /**\n     * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\n     * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n     */\n    set x(val) {\n        this._x = val;\n    }\n    /**\n     * Get the y component of the vector\n     */\n    get y() {\n        return this._y;\n    }\n    /**\n     * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\n     * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n     */\n    set y(val) {\n        this._y = val;\n    }\n    /**\n     * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\n     * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\n     */\n    setTo(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n    /**\n     * Compares this point against another and tests for equality\n     * @param vector The other point to compare to\n     * @param tolerance Amount of euclidean distance off we are willing to tolerate\n     */\n    equals(vector, tolerance = Vector.EQUALS_EPSILON) {\n        return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\n    }\n    /**\n     * The distance to another vector. If no other Vector is specified, this will return the {@apilink magnitude}.\n     * @param v  The other vector. Leave blank to use origin vector.\n     */\n    distance(v) {\n        if (!v) {\n            return Math.sqrt(this.x * this.x + this.y * this.y);\n        }\n        const deltaX = this.x - v.x;\n        const deltaY = this.y - v.y;\n        return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n    }\n    squareDistance(v) {\n        if (!v) {\n            v = Vector.Zero;\n        }\n        const deltaX = this.x - v.x;\n        const deltaY = this.y - v.y;\n        return deltaX * deltaX + deltaY * deltaY;\n    }\n    /**\n     * Clamps the current vector's magnitude mutating it\n     * @param magnitude\n     */\n    clampMagnitude(magnitude) {\n        const size = this.magnitude;\n        const newSize = clamp(size, 0, magnitude);\n        this.magnitude = newSize;\n        return this;\n    }\n    /**\n     * The size (magnitude) of the Vector\n     * @deprecated Will be removed in v1, use Vector.magnitude\n     */\n    get size() {\n        return this.distance();\n    }\n    /**\n     * Setting the size mutates the current vector\n     * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\n     * @deprecated Will be removed in v1, use Vector.magnitude\n     */\n    set size(newLength) {\n        const v = this.normalize().scale(newLength);\n        this.setTo(v.x, v.y);\n    }\n    /**\n     * The magnitude (length) of the Vector\n     */\n    get magnitude() {\n        return this.distance();\n    }\n    /**\n     * Setting the size mutates the current vector\n     * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\n     */\n    set magnitude(newMagnitude) {\n        this.normalize().scale(newMagnitude, this);\n    }\n    /**\n     * Normalizes a non-zero vector to have a magnitude of 1. Zero vectors return a new zero vector.\n     */\n    normalize() {\n        const distance = this.distance();\n        if (distance === 0) {\n            return Vector.Zero;\n        }\n        return new Vector(this.x / distance, this.y / distance);\n    }\n    /**\n     * Returns the average (midpoint) between the current point and the specified\n     */\n    average(vec) {\n        return this.add(vec).scale(0.5);\n    }\n    scale(sizeOrScale, dest) {\n        const result = dest || new Vector(0, 0);\n        if (sizeOrScale instanceof Vector) {\n            result.x = this.x * sizeOrScale.x;\n            result.y = this.y * sizeOrScale.y;\n        }\n        else {\n            result.x = this.x * sizeOrScale;\n            result.y = this.y * sizeOrScale;\n        }\n        return result;\n    }\n    /**\n     * Adds one vector to another\n     * @param v The vector to add\n     * @param dest Optionally copy the result into a provided vector\n     */\n    add(v, dest) {\n        if (dest) {\n            dest.x = this.x + v.x;\n            dest.y = this.y + v.y;\n            return dest;\n        }\n        return new Vector(this.x + v.x, this.y + v.y);\n    }\n    /**\n     * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\n     * @param v The vector to subtract\n     */\n    sub(v, dest) {\n        const result = dest || new Vector(0, 0);\n        const x = this.x - v.x;\n        const y = this.y - v.y;\n        result.x = x;\n        result.y = y;\n        return result;\n    }\n    /**\n     * Adds one vector to this one modifying the original\n     * @param v The vector to add\n     * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n     */\n    addEqual(v) {\n        this.setTo(this.x + v.x, this.y + v.y);\n        return this;\n    }\n    /**\n     * Subtracts a vector from this one modifying the original\n     * @param v The vector to subtract\n     * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n     */\n    subEqual(v) {\n        this.setTo(this.x - v.x, this.y - v.y);\n        return this;\n    }\n    /**\n     * Scales this vector by a factor of size and modifies the original\n     * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n     */\n    scaleEqual(size) {\n        this.setTo(this.x * size, this.y * size);\n        return this;\n    }\n    /**\n     * Performs a dot product with another vector\n     * @param v  The vector to dot\n     */\n    dot(v) {\n        return this.x * v.x + this.y * v.y;\n    }\n    cross(v) {\n        if (v instanceof Vector) {\n            return this.x * v.y - this.y * v.x;\n        }\n        else if (typeof v === 'number') {\n            return new Vector(v * this.y, -v * this.x);\n        }\n    }\n    static cross(num, vec) {\n        return new Vector(-num * vec.y, num * vec.x);\n    }\n    /**\n     * Returns the perpendicular vector to this one\n     */\n    perpendicular() {\n        return new Vector(this.y, -this.x);\n    }\n    /**\n     * Returns the normal vector to this one, same as the perpendicular of length 1\n     */\n    normal() {\n        return this.perpendicular().normalize();\n    }\n    /**\n     * Negate the current vector\n     */\n    negate() {\n        return this.scale(-1);\n    }\n    /**\n     * Returns the angle of this vector.\n     */\n    toAngle() {\n        return canonicalizeAngle(Math.atan2(this.y, this.x));\n    }\n    /**\n     * Rotates the current vector around a point by a certain angle in radians.\n     */\n    rotate(angle, anchor, dest) {\n        const result = dest || new Vector(0, 0);\n        if (!anchor) {\n            anchor = new Vector(0, 0);\n        }\n        const sinAngle = Math.sin(angle);\n        const cosAngle = Math.cos(angle);\n        const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\n        const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\n        result.x = x;\n        result.y = y;\n        return result;\n    }\n    /**\n     * Creates new vector that has the same values as the previous.\n     */\n    clone(dest) {\n        const v = dest !== null && dest !== void 0 ? dest : new Vector(0, 0);\n        v.x = this.x;\n        v.y = this.y;\n        return v;\n    }\n    /**\n     * Returns a string representation of the vector.\n     */\n    toString(fixed) {\n        if (fixed) {\n            return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\n        }\n        return `(${this.x}, ${this.y})`;\n    }\n}\n/**\n * Get or set the vector equals epsilon, by default 0.001 meaning vectors within that tolerance on x or y will be considered equal.\n */\nVector.EQUALS_EPSILON = 0.001;\n/**\n * Shorthand for creating new Vectors - returns a new Vector instance with the\n * provided X and Y components.\n * @param x  X component of the Vector\n * @param y  Y component of the Vector\n */\nfunction vec(x, y) {\n    return new Vector(x, y);\n}\n\n;// ./Color.ts\n/**\n * Provides standard colors (e.g. {@apilink Color.Black})\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\n * useful color operations like {@apilink Color.lighten}, {@apilink Color.darken}, and more.\n */\nclass Color {\n    /**\n     * Creates a new instance of Color from an r, g, b, a\n     * @param r  The red component of color (0-255)\n     * @param g  The green component of color (0-255)\n     * @param b  The blue component of color (0-255)\n     * @param a  The alpha component of color (0-1.0)\n     */\n    constructor(r, g, b, a) {\n        this.r = r;\n        this.g = g;\n        this.b = b;\n        this.a = a != null ? a : 1;\n    }\n    /**\n     * Creates a new instance of Color from an r, g, b, a\n     * @param r  The red component of color (0-255)\n     * @param g  The green component of color (0-255)\n     * @param b  The blue component of color (0-255)\n     * @param a  The alpha component of color (0-1.0)\n     */\n    static fromRGB(r, g, b, a) {\n        return new Color(r, g, b, a);\n    }\n    /**\n     * Creates a new instance of Color from a rgb string\n     * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\n     */\n    static fromRGBString(string) {\n        const rgbaRegEx = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\n        let match = null;\n        if ((match = string.match(rgbaRegEx))) {\n            const r = parseInt(match[1], 10);\n            const g = parseInt(match[2], 10);\n            const b = parseInt(match[3], 10);\n            let a = 1;\n            if (match[4]) {\n                a = parseFloat(match[4]);\n            }\n            return new Color(r, g, b, a);\n        }\n        else {\n            throw new Error('Invalid rgb/a string: ' + string);\n        }\n    }\n    /**\n     * Creates a new instance of Color from a hex string\n     * @param hex  CSS color string of the form #ffffff, the alpha component is optional\n     */\n    static fromHex(hex) {\n        const hexRegEx = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n        let match = null;\n        if ((match = hex.match(hexRegEx))) {\n            const r = parseInt(match[1], 16);\n            const g = parseInt(match[2], 16);\n            const b = parseInt(match[3], 16);\n            let a = 1;\n            if (match[4]) {\n                a = parseInt(match[4], 16) / 255;\n            }\n            return new Color(r, g, b, a);\n        }\n        else {\n            throw new Error('Invalid hex string: ' + hex);\n        }\n    }\n    /**\n     * Creates a new instance of Color from hsla values\n     * @param h  Hue is represented [0-1]\n     * @param s  Saturation is represented [0-1]\n     * @param l  Luminance is represented [0-1]\n     * @param a  Alpha is represented [0-1]\n     */\n    static fromHSL(h, s, l, a = 1.0) {\n        const temp = new HSLColor(h, s, l, a);\n        return temp.toRGBA();\n    }\n    /**\n     * Lightens the current color by a specified amount\n     * @param factor  The amount to lighten by [0-1]\n     */\n    lighten(factor = 0.1) {\n        const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n        temp.l += (1 - temp.l) * factor;\n        return temp.toRGBA();\n    }\n    /**\n     * Darkens the current color by a specified amount\n     * @param factor  The amount to darken by [0-1]\n     */\n    darken(factor = 0.1) {\n        const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n        temp.l -= temp.l * factor;\n        return temp.toRGBA();\n    }\n    /**\n     * Saturates the current color by a specified amount\n     * @param factor  The amount to saturate by [0-1]\n     */\n    saturate(factor = 0.1) {\n        const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n        temp.s += temp.s * factor;\n        return temp.toRGBA();\n    }\n    /**\n     * Desaturates the current color by a specified amount\n     * @param factor  The amount to desaturate by [0-1]\n     */\n    desaturate(factor = 0.1) {\n        const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n        temp.s -= temp.s * factor;\n        return temp.toRGBA();\n    }\n    /**\n     * Multiplies a color by another, results in a darker color\n     * @param color  The other color\n     */\n    multiply(color) {\n        const newR = (((color.r / 255) * this.r) / 255) * 255;\n        const newG = (((color.g / 255) * this.g) / 255) * 255;\n        const newB = (((color.b / 255) * this.b) / 255) * 255;\n        const newA = color.a * this.a;\n        return new Color(newR, newG, newB, newA);\n    }\n    /**\n     * Screens a color by another, results in a lighter color\n     * @param color  The other color\n     */\n    screen(color) {\n        const color1 = color.invert();\n        const color2 = color.invert();\n        return color1.multiply(color2).invert();\n    }\n    /**\n     * Inverts the current color\n     */\n    invert() {\n        return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\n    }\n    /**\n     * Averages the current color with another\n     * @param color  The other color\n     */\n    average(color) {\n        const newR = (color.r + this.r) / 2;\n        const newG = (color.g + this.g) / 2;\n        const newB = (color.b + this.b) / 2;\n        const newA = (color.a + this.a) / 2;\n        return new Color(newR, newG, newB, newA);\n    }\n    equal(color) {\n        return this.toString() === color.toString();\n    }\n    /**\n     * Returns a CSS string representation of a color.\n     * @param format Color representation, accepts: rgb, hsl, or hex\n     */\n    toString(format = 'rgb') {\n        switch (format) {\n            case 'rgb':\n                return this.toRGBA();\n            case 'hsl':\n                return this.toHSLA();\n            case 'hex':\n                return this.toHex();\n            default:\n                throw new Error('Invalid Color format');\n        }\n    }\n    /**\n     * Returns Hex Value of a color component\n     * @param c color component\n     * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n     */\n    _componentToHex(c) {\n        // Handle negative and fractional numbers\n        const hex = Math.max(Math.round(c), 0).toString(16);\n        return hex.length === 1 ? '0' + hex : hex;\n    }\n    /**\n     * Return Hex representation of a color.\n     */\n    toHex() {\n        let hexRepresentation = '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\n        if (this.a !== 1) {\n            hexRepresentation += this._componentToHex(this.a * 255);\n        }\n        return hexRepresentation;\n    }\n    /**\n     * Return RGBA representation of a color.\n     */\n    toRGBA() {\n        const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\n        if (this.a !== undefined || this.a !== null) {\n            return 'rgba(' + result + ', ' + String(this.a) + ')';\n        }\n        return 'rgb(' + result + ')';\n    }\n    /**\n     * Return HSLA representation of a color.\n     */\n    toHSLA() {\n        return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\n    }\n    /**\n     * Returns a CSS string representation of a color.\n     */\n    fillStyle() {\n        return this.toString();\n    }\n    /**\n     * Returns a clone of the current color.\n     */\n    clone(dest) {\n        const result = dest || new Color(this.r, this.g, this.b, this.a);\n        result.r = this.r;\n        result.g = this.g;\n        result.b = this.b;\n        result.a = this.a;\n        return result;\n    }\n    /**\n     * Black (#000000)\n     */\n    static get Black() {\n        return Color.fromHex('#000000');\n    }\n    /**\n     * White (#FFFFFF)\n     */\n    static get White() {\n        return Color.fromHex('#FFFFFF');\n    }\n    /**\n     * Gray (#808080)\n     */\n    static get Gray() {\n        return Color.fromHex('#808080');\n    }\n    /**\n     * Light gray (#D3D3D3)\n     */\n    static get LightGray() {\n        return Color.fromHex('#D3D3D3');\n    }\n    /**\n     * Dark gray (#A9A9A9)\n     */\n    static get DarkGray() {\n        return Color.fromHex('#A9A9A9');\n    }\n    /**\n     * Yellow (#FFFF00)\n     */\n    static get Yellow() {\n        return Color.fromHex('#FFFF00');\n    }\n    /**\n     * Orange (#FFA500)\n     */\n    static get Orange() {\n        return Color.fromHex('#FFA500');\n    }\n    /**\n     * Red (#FF0000)\n     */\n    static get Red() {\n        return Color.fromHex('#FF0000');\n    }\n    /**\n     * Vermilion (#FF5B31)\n     */\n    static get Vermilion() {\n        return Color.fromHex('#FF5B31');\n    }\n    /**\n     * Rose (#FF007F)\n     */\n    static get Rose() {\n        return Color.fromHex('#FF007F');\n    }\n    /**\n     * Pink (#FFC0CB)\n     */\n    static get Pink() {\n        return Color.fromHex('#FFC0CB');\n    }\n    /**\n     * Magenta (#FF00FF)\n     */\n    static get Magenta() {\n        return Color.fromHex('#FF00FF');\n    }\n    /**\n     * Violet (#7F00FF)\n     */\n    static get Violet() {\n        return Color.fromHex('#7F00FF');\n    }\n    /**\n     * Purple (#800080)\n     */\n    static get Purple() {\n        return Color.fromHex('#800080');\n    }\n    /**\n     * Blue (#0000FF)\n     */\n    static get Blue() {\n        return Color.fromHex('#0000FF');\n    }\n    /**\n     * Azure (#007FFF)\n     */\n    static get Azure() {\n        return Color.fromHex('#007FFF');\n    }\n    /**\n     * Cyan (#00FFFF)\n     */\n    static get Cyan() {\n        return Color.fromHex('#00FFFF');\n    }\n    /**\n     * Viridian (#59978F)\n     */\n    static get Viridian() {\n        return Color.fromHex('#59978F');\n    }\n    /**\n     * Teal (#008080)\n     */\n    static get Teal() {\n        return Color.fromHex('#008080');\n    }\n    /**\n     * Green (#00FF00)\n     */\n    static get Green() {\n        return Color.fromHex('#00FF00');\n    }\n    /**\n     * Chartreuse (#7FFF00)\n     */\n    static get Chartreuse() {\n        return Color.fromHex('#7FFF00');\n    }\n    /**\n     * Transparent (#FFFFFF00)\n     */\n    static get Transparent() {\n        return Color.fromHex('#FFFFFF00');\n    }\n    /**\n     * ExcaliburBlue (#176BAA)\n     */\n    static get ExcaliburBlue() {\n        return Color.fromHex('#176BAA');\n    }\n    /**\n     * Brown (#964B00)\n     */\n    static get Brown() {\n        return Color.fromHex('#964B00');\n    }\n}\n/**\n * Internal HSL Color representation\n *\n * http://en.wikipedia.org/wiki/HSL_and_HSV\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n */\nclass HSLColor {\n    constructor(h, s, l, a) {\n        this.h = h;\n        this.s = s;\n        this.l = l;\n        this.a = a;\n    }\n    static hue2rgb(p, q, t) {\n        if (t < 0) {\n            t += 1;\n        }\n        if (t > 1) {\n            t -= 1;\n        }\n        if (t < 1 / 6) {\n            return p + (q - p) * 6 * t;\n        }\n        if (t < 1 / 2) {\n            return q;\n        }\n        if (t < 2 / 3) {\n            return p + (q - p) * (2 / 3 - t) * 6;\n        }\n        return p;\n    }\n    static fromRGBA(r, g, b, a) {\n        r /= 255;\n        g /= 255;\n        b /= 255;\n        const max = Math.max(r, g, b), min = Math.min(r, g, b);\n        let h, s;\n        const l = (max + min) / 2;\n        if (max === min) {\n            h = s = 0; // achromatic\n        }\n        else {\n            const d = max - min;\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n            switch (max) {\n                case r:\n                    h = (g - b) / d + (g < b ? 6 : 0);\n                    break;\n                case g:\n                    h = (b - r) / d + 2;\n                    break;\n                case b:\n                    h = (r - g) / d + 4;\n                    break;\n            }\n            h /= 6;\n        }\n        return new HSLColor(h, s, l, a);\n    }\n    toRGBA() {\n        let r, g, b;\n        if (this.s === 0) {\n            r = g = b = this.l; // achromatic\n        }\n        else {\n            const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\n            const p = 2 * this.l - q;\n            r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\n            g = HSLColor.hue2rgb(p, q, this.h);\n            b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\n        }\n        return new Color(r * 255, g * 255, b * 255, this.a);\n    }\n    toString() {\n        const h = this.h.toFixed(0), s = this.s.toFixed(0), l = this.l.toFixed(0), a = this.a.toFixed(0);\n        return `hsla(${h}, ${s}, ${l}, ${a})`;\n    }\n}\n\n;// ./Util/Log.ts\n/* eslint-disable no-console */\n\n\n/**\n * Logging level that Excalibur will tag\n */\nvar LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"Debug\"] = 0] = \"Debug\";\n    LogLevel[LogLevel[\"Info\"] = 1] = \"Info\";\n    LogLevel[LogLevel[\"Warn\"] = 2] = \"Warn\";\n    LogLevel[LogLevel[\"Error\"] = 3] = \"Error\";\n    LogLevel[LogLevel[\"Fatal\"] = 4] = \"Fatal\";\n})(LogLevel || (LogLevel = {}));\n/**\n * Static singleton that represents the logging facility for Excalibur.\n * Excalibur comes built-in with a {@apilink ConsoleAppender} and {@apilink ScreenAppender}.\n * Derive from {@apilink Appender} to create your own logging appenders.\n */\nclass Logger {\n    constructor() {\n        this._appenders = [];\n        /**\n         * Gets or sets the default logging level. Excalibur will only log\n         * messages if equal to or above this level. Default: {@apilink LogLevel.Info}\n         */\n        this.defaultLevel = LogLevel.Info;\n        this._logOnceSet = new Set();\n        if (Logger._INSTANCE) {\n            throw new Error('Logger is a singleton');\n        }\n        Logger._INSTANCE = this;\n        // Default console appender\n        Logger._INSTANCE.addAppender(new ConsoleAppender());\n        return Logger._INSTANCE;\n    }\n    /**\n     * Gets the current static instance of Logger\n     */\n    static getInstance() {\n        if (Logger._INSTANCE == null) {\n            Logger._INSTANCE = new Logger();\n        }\n        return Logger._INSTANCE;\n    }\n    /**\n     * Adds a new {@apilink Appender} to the list of appenders to write to\n     */\n    addAppender(appender) {\n        this._appenders.push(appender);\n    }\n    /**\n     * Clears all appenders from the logger\n     */\n    clearAppenders() {\n        this._appenders.length = 0;\n    }\n    /**\n     * Logs a message at a given LogLevel\n     * @param level  The LogLevel`to log the message at\n     * @param args   An array of arguments to write to an appender\n     */\n    _log(level, args) {\n        if (level == null) {\n            level = this.defaultLevel;\n        }\n        const len = this._appenders.length;\n        for (let i = 0; i < len; i++) {\n            if (level >= this.defaultLevel) {\n                this._appenders[i].log(level, args);\n            }\n        }\n    }\n    _logOnce(level, args) {\n        const serialized = level + args.join('+');\n        if (this._logOnceSet.has(serialized)) {\n            return;\n        }\n        else {\n            this._logOnceSet.add(serialized);\n            this._log(level, args);\n        }\n    }\n    /**\n     * Writes a log message at the {@apilink LogLevel.Debug} level\n     * @param args  Accepts any number of arguments\n     */\n    debug(...args) {\n        this._log(LogLevel.Debug, args);\n    }\n    /**\n     * Writes a log message once at the {@apilink LogLevel.Fatal} level, if it sees the same args again it wont log\n     * @param args  Accepts any number of arguments\n     */\n    debugOnce(...args) {\n        this._logOnce(LogLevel.Debug, args);\n    }\n    /**\n     * Writes a log message at the {@apilink LogLevel.Info} level\n     * @param args  Accepts any number of arguments\n     */\n    info(...args) {\n        this._log(LogLevel.Info, args);\n    }\n    /**\n     * Writes a log message once at the {@apilink LogLevel.Info} level, if it sees the same args again it wont log\n     * @param args  Accepts any number of arguments\n     */\n    infoOnce(...args) {\n        this._logOnce(LogLevel.Info, args);\n    }\n    /**\n     * Writes a log message at the {@apilink LogLevel.Warn} level\n     * @param args  Accepts any number of arguments\n     */\n    warn(...args) {\n        this._log(LogLevel.Warn, args);\n    }\n    /**\n     * Writes a log message once at the {@apilink LogLevel.Warn} level, if it sees the same args again it won't log\n     * @param args  Accepts any number of arguments\n     */\n    warnOnce(...args) {\n        this._logOnce(LogLevel.Warn, args);\n    }\n    /**\n     * Writes a log message at the {@apilink LogLevel.Error} level\n     * @param args  Accepts any number of arguments\n     */\n    error(...args) {\n        this._log(LogLevel.Error, args);\n    }\n    /**\n     * Writes a log message once at the {@apilink LogLevel.Error} level, if it sees the same args again it won't log\n     * @param args  Accepts any number of arguments\n     */\n    errorOnce(...args) {\n        this._logOnce(LogLevel.Error, args);\n    }\n    /**\n     * Writes a log message at the {@apilink LogLevel.Fatal} level\n     * @param args  Accepts any number of arguments\n     */\n    fatal(...args) {\n        this._log(LogLevel.Fatal, args);\n    }\n    /**\n     * Writes a log message once at the {@apilink LogLevel.Fatal} level, if it sees the same args again it won't log\n     * @param args  Accepts any number of arguments\n     */\n    fatalOnce(...args) {\n        this._logOnce(LogLevel.Fatal, args);\n    }\n}\nLogger._INSTANCE = null;\n/**\n * Console appender for browsers (i.e. `console.log`)\n */\nclass ConsoleAppender {\n    /**\n     * Logs a message at the given {@apilink LogLevel}\n     * @param level  Level to log at\n     * @param args   Arguments to log\n     */\n    log(level, args) {\n        // Check for console support\n        if (!console && !console.log && console.warn && console.error) {\n            // todo maybe do something better than nothing\n            return;\n        }\n        // Create a new console args array\n        const consoleArgs = [];\n        consoleArgs.unshift.apply(consoleArgs, args);\n        consoleArgs.unshift('[' + LogLevel[level] + '] : ');\n        if (level < LogLevel.Warn) {\n            // Call .log for Debug/Info\n            if (console.log.apply) {\n                // this is required on some older browsers that don't support apply on console.log :(\n                console.log.apply(console, consoleArgs);\n            }\n            else {\n                console.log(consoleArgs.join(' '));\n            }\n        }\n        else if (level < LogLevel.Error) {\n            // Call .warn for Warn\n            if (console.warn.apply) {\n                console.warn.apply(console, consoleArgs);\n            }\n            else {\n                console.warn(consoleArgs.join(' '));\n            }\n        }\n        else {\n            // Call .error for Error/Fatal\n            if (console.error.apply) {\n                console.error.apply(console, consoleArgs);\n            }\n            else {\n                console.error(consoleArgs.join(' '));\n            }\n        }\n    }\n}\n/**\n * On-screen (canvas) appender\n */\nclass ScreenAppender {\n    constructor(options) {\n        var _a, _b;\n        this._messages = [];\n        this._pos = 10;\n        this._color = Color.Black;\n        this._options = options;\n        this.canvas = document.createElement('canvas');\n        this._ctx = this.canvas.getContext('2d');\n        this.canvas.style.position = 'absolute';\n        this.canvas.style.zIndex = (_b = (_a = options.zIndex) === null || _a === void 0 ? void 0 : _a.toString()) !== null && _b !== void 0 ? _b : '99';\n        document.body.appendChild(this.canvas);\n        this._positionScreenAppenderCanvas();\n        options.engine.screen.events.on('resize', () => {\n            this._positionScreenAppenderCanvas();\n        });\n    }\n    _positionScreenAppenderCanvas() {\n        var _a, _b, _c, _d;\n        const options = this._options;\n        this.canvas.width = (_a = options.width) !== null && _a !== void 0 ? _a : options.engine.screen.resolution.width;\n        this.canvas.height = (_b = options.height) !== null && _b !== void 0 ? _b : options.engine.screen.resolution.height;\n        this.canvas.style.position = 'absolute';\n        const pagePos = options.engine.screen.screenToPageCoordinates(vec(0, 0));\n        this.canvas.style.left = pagePos.x + 'px';\n        this.canvas.style.top = pagePos.y + 'px';\n        this._pos = (_c = options.xPos) !== null && _c !== void 0 ? _c : this._pos;\n        this._color = (_d = options.color) !== null && _d !== void 0 ? _d : this._color;\n    }\n    /**\n     * Logs a message at the given {@apilink LogLevel}\n     * @param level  Level to log at\n     * @param args   Arguments to log\n     */\n    log(level, args) {\n        const message = args.join(',');\n        this._ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\n        let pos = 10;\n        this._messages = this._messages.slice(0, 1000);\n        for (let i = 0; i < this._messages.length; i++) {\n            this._ctx.fillStyle = this._color.toRGBA();\n            this._ctx.fillText(this._messages[i], this._pos, pos);\n            pos += 10;\n        }\n    }\n}\n\n;// ./Collision/Side.ts\n/**\n * An enum that describes the sides of an axis aligned box for collision\n */\nvar Side;\n(function (Side) {\n    Side[\"None\"] = \"None\";\n    Side[\"Top\"] = \"Top\";\n    Side[\"Bottom\"] = \"Bottom\";\n    Side[\"Left\"] = \"Left\";\n    Side[\"Right\"] = \"Right\";\n})(Side || (Side = {}));\n(function (Side) {\n    /**\n     * Returns the opposite side from the current\n     */\n    function getOpposite(side) {\n        if (side === Side.Top) {\n            return Side.Bottom;\n        }\n        if (side === Side.Bottom) {\n            return Side.Top;\n        }\n        if (side === Side.Left) {\n            return Side.Right;\n        }\n        if (side === Side.Right) {\n            return Side.Left;\n        }\n        return Side.None;\n    }\n    Side.getOpposite = getOpposite;\n    /**\n     * Given a vector, return the Side most in that direction\n     */\n    function fromDirection(direction) {\n        if (Math.abs(direction.x) >= Math.abs(direction.y)) {\n            if (direction.x <= 0) {\n                return Side.Left;\n            }\n            return Side.Right;\n        }\n        if (direction.y <= 0) {\n            return Side.Top;\n        }\n        return Side.Bottom;\n    }\n    Side.fromDirection = fromDirection;\n})(Side || (Side = {}));\n\n;// ./Collision/BoundingBox.ts\n\n\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nclass BoundingBox {\n    /**\n     * Constructor allows passing of either an object with all coordinate components,\n     * or the coordinate components passed separately.\n     * @param leftOrOptions    Either x coordinate of the left edge or an options object\n     * containing the four coordinate components.\n     * @param top     y coordinate of the top edge\n     * @param right   x coordinate of the right edge\n     * @param bottom  y coordinate of the bottom edge\n     */\n    constructor(leftOrOptions = 0, top = 0, right = 0, bottom = 0) {\n        // Cache bounding box point returns\n        this._points = [];\n        if (typeof leftOrOptions === 'object') {\n            this.left = leftOrOptions.left;\n            this.top = leftOrOptions.top;\n            this.right = leftOrOptions.right;\n            this.bottom = leftOrOptions.bottom;\n        }\n        else if (typeof leftOrOptions === 'number') {\n            this.left = leftOrOptions;\n            this.top = top;\n            this.right = right;\n            this.bottom = bottom;\n        }\n    }\n    /**\n     * Returns a new instance of {@apilink BoundingBox} that is a copy of the current instance\n     */\n    clone(dest) {\n        const result = dest || new BoundingBox(0, 0, 0, 0);\n        result.left = this.left;\n        result.right = this.right;\n        result.top = this.top;\n        result.bottom = this.bottom;\n        return result;\n    }\n    /**\n     * Resets the bounds to a zero width/height box\n     */\n    reset() {\n        this.left = 0;\n        this.top = 0;\n        this.bottom = 0;\n        this.right = 0;\n    }\n    /**\n     * Given bounding box A & B, returns the side relative to A when intersection is performed.\n     * @param intersection Intersection vector between 2 bounding boxes\n     */\n    static getSideFromIntersection(intersection) {\n        if (!intersection) {\n            return Side.None;\n        }\n        if (intersection) {\n            if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n                if (intersection.x < 0) {\n                    return Side.Right;\n                }\n                return Side.Left;\n            }\n            else {\n                if (intersection.y < 0) {\n                    return Side.Bottom;\n                }\n                return Side.Top;\n            }\n        }\n        return Side.None;\n    }\n    static fromPoints(points) {\n        let minX = Infinity;\n        let minY = Infinity;\n        let maxX = -Infinity;\n        let maxY = -Infinity;\n        for (let i = 0; i < points.length; i++) {\n            if (points[i].x < minX) {\n                minX = points[i].x;\n            }\n            if (points[i].x > maxX) {\n                maxX = points[i].x;\n            }\n            if (points[i].y < minY) {\n                minY = points[i].y;\n            }\n            if (points[i].y > maxY) {\n                maxY = points[i].y;\n            }\n        }\n        return new BoundingBox(minX, minY, maxX, maxY);\n    }\n    /**\n     * Creates a bounding box from a width and height\n     * @param width\n     * @param height\n     * @param anchor Default Vector.Half\n     * @param pos Default Vector.Zero\n     */\n    static fromDimension(width, height, anchor = Vector.Half, pos = Vector.Zero) {\n        return new BoundingBox(-width * anchor.x + pos.x, -height * anchor.y + pos.y, width - width * anchor.x + pos.x, height - height * anchor.y + pos.y);\n    }\n    /**\n     * Returns the calculated width of the bounding box\n     */\n    get width() {\n        return this.right - this.left;\n    }\n    /**\n     * Returns the calculated height of the bounding box\n     */\n    get height() {\n        return this.bottom - this.top;\n    }\n    /**\n     * Return whether the bounding box has zero dimensions in height,width or both\n     */\n    hasZeroDimensions() {\n        return this.width === 0 || this.height === 0;\n    }\n    /**\n     * Returns the center of the bounding box\n     */\n    get center() {\n        return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n    }\n    get topLeft() {\n        return new Vector(this.left, this.top);\n    }\n    get bottomRight() {\n        return new Vector(this.right, this.bottom);\n    }\n    get topRight() {\n        return new Vector(this.right, this.top);\n    }\n    get bottomLeft() {\n        return new Vector(this.left, this.bottom);\n    }\n    translate(pos) {\n        return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n    }\n    /**\n     * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n     * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n     */\n    rotate(angle, point = Vector.Zero) {\n        const points = this.getPoints().map((p) => p.rotate(angle, point));\n        return BoundingBox.fromPoints(points);\n    }\n    /**\n     * Scale a bounding box by a scale factor, optionally provide a point\n     * @param scale\n     * @param point\n     */\n    scale(scale, point = Vector.Zero) {\n        const shifted = this.translate(point);\n        return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n    }\n    /**\n     * Transform the axis aligned bounding box by a {@apilink Matrix}, producing a new axis aligned bounding box\n     * @param matrix\n     */\n    transform(matrix) {\n        // inlined these calculations to not use vectors would speed it up slightly\n        // const matFirstColumn = vec(matrix.data[0], matrix.data[1]);\n        // const xa = matFirstColumn.scale(this.left);\n        const xa1 = matrix.data[0] * this.left;\n        const xa2 = matrix.data[1] * this.left;\n        // const xb = matFirstColumn.scale(this.right);\n        const xb1 = matrix.data[0] * this.right;\n        const xb2 = matrix.data[1] * this.right;\n        // const matSecondColumn = vec(matrix.data[2], matrix.data[3]);\n        // const ya = matSecondColumn.scale(this.top);\n        const ya1 = matrix.data[2] * this.top;\n        const ya2 = matrix.data[3] * this.top;\n        // const yb = matSecondColumn.scale(this.bottom);\n        const yb1 = matrix.data[2] * this.bottom;\n        const yb2 = matrix.data[3] * this.bottom;\n        const matrixPos = matrix.getPosition();\n        // const topLeft = Vector.min(xa, xb).add(Vector.min(ya, yb)).add(matrixPos);\n        // const bottomRight = Vector.max(xa, xb).add(Vector.max(ya, yb)).add(matrixPos);\n        const left = Math.min(xa1, xb1) + Math.min(ya1, yb1) + matrixPos.x;\n        const top = Math.min(xa2, xb2) + Math.min(ya2, yb2) + matrixPos.y;\n        const right = Math.max(xa1, xb1) + Math.max(ya1, yb1) + matrixPos.x;\n        const bottom = Math.max(xa2, xb2) + Math.max(ya2, yb2) + matrixPos.y;\n        return new BoundingBox({\n            left, //: topLeft.x,\n            top, //: topLeft.y,\n            right, //: bottomRight.x,\n            bottom //: bottomRight.y\n        });\n    }\n    /**\n     * Returns the perimeter of the bounding box\n     */\n    getPerimeter() {\n        const wx = this.width;\n        const wy = this.height;\n        return 2 * (wx + wy);\n    }\n    /**\n     * Returns the world space points that make up the corners of the bounding box as a polygon\n     */\n    getPoints() {\n        if (this._left !== this.left || this._right !== this.right || this._top !== this.top || this._bottom !== this.bottom) {\n            this._points.length = 0;\n            this._points.push(new Vector(this.left, this.top));\n            this._points.push(new Vector(this.right, this.top));\n            this._points.push(new Vector(this.right, this.bottom));\n            this._points.push(new Vector(this.left, this.bottom));\n            this._left = this.left;\n            this._right = this.right;\n            this._top = this.top;\n            this._bottom = this.bottom;\n        }\n        return this._points;\n    }\n    /**\n     * Determines whether a ray intersects with a bounding box\n     */\n    rayCast(ray, farClipDistance = Infinity) {\n        // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n        let tMin = -Infinity;\n        let tMax = +Infinity;\n        const xInv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n        const yInv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n        const tx1 = (this.left - ray.pos.x) * xInv;\n        const tx2 = (this.right - ray.pos.x) * xInv;\n        tMin = Math.min(tx1, tx2);\n        tMax = Math.max(tx1, tx2);\n        const ty1 = (this.top - ray.pos.y) * yInv;\n        const ty2 = (this.bottom - ray.pos.y) * yInv;\n        tMin = Math.max(tMin, Math.min(ty1, ty2));\n        tMax = Math.min(tMax, Math.max(ty1, ty2));\n        return tMax >= Math.max(0, tMin) && tMin < farClipDistance;\n    }\n    rayCastTime(ray, farClipDistance = Infinity) {\n        // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n        let tMin = -Infinity;\n        let tMax = +Infinity;\n        const xInv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n        const yInv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n        const tx1 = (this.left - ray.pos.x) * xInv;\n        const tx2 = (this.right - ray.pos.x) * xInv;\n        tMin = Math.min(tx1, tx2);\n        tMax = Math.max(tx1, tx2);\n        const ty1 = (this.top - ray.pos.y) * yInv;\n        const ty2 = (this.bottom - ray.pos.y) * yInv;\n        tMin = Math.max(tMin, Math.min(ty1, ty2));\n        tMax = Math.min(tMax, Math.max(ty1, ty2));\n        if (tMax >= Math.max(0, tMin) && tMin < farClipDistance) {\n            return tMin;\n        }\n        return -1;\n    }\n    contains(val) {\n        if (val instanceof Vector) {\n            return this.left <= val.x && this.top <= val.y && val.y <= this.bottom && val.x <= this.right;\n        }\n        else if (val instanceof BoundingBox) {\n            return this.left <= val.left && this.top <= val.top && val.bottom <= this.bottom && val.right <= this.right;\n        }\n        return false;\n    }\n    /**\n     * Combines this bounding box and another together returning a new bounding box\n     * @param other  The bounding box to combine\n     */\n    combine(other, dest) {\n        const compositeBB = dest || new BoundingBox(0, 0, 0, 0);\n        const left = Math.min(this.left, other.left);\n        const top = Math.min(this.top, other.top);\n        const right = Math.max(this.right, other.right);\n        const bottom = Math.max(this.bottom, other.bottom);\n        compositeBB.left = left;\n        compositeBB.top = top;\n        compositeBB.right = right;\n        compositeBB.bottom = bottom;\n        return compositeBB;\n    }\n    get dimensions() {\n        return new Vector(this.width, this.height);\n    }\n    /**\n     * Returns true if the bounding boxes overlap.\n     * @param other\n     * @param epsilon Optionally specify a small epsilon (default 0) as amount of overlap to ignore as overlap.\n     * This epsilon is useful in stable collision simulations.\n     */\n    overlaps(other, epsilon) {\n        const e = epsilon || 0;\n        if (other.hasZeroDimensions()) {\n            return this.contains(other);\n        }\n        if (this.hasZeroDimensions()) {\n            return other.contains(this);\n        }\n        const totalBoundingBox = this.combine(other);\n        return totalBoundingBox.width + e < other.width + this.width && totalBoundingBox.height + e < other.height + this.height;\n    }\n    /**\n     * Test wether this bounding box intersects with another returning\n     * the intersection vector that can be used to resolve the collision. If there\n     * is no intersection null is returned.\n     * @param other  Other {@apilink BoundingBox} to test intersection with\n     * @returns A Vector in the direction of the current BoundingBox, this <- other\n     */\n    intersect(other) {\n        const totalBoundingBox = this.combine(other);\n        // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n        if (totalBoundingBox.width < other.width + this.width &&\n            totalBoundingBox.height < other.height + this.height &&\n            !totalBoundingBox.dimensions.equals(other.dimensions) &&\n            !totalBoundingBox.dimensions.equals(this.dimensions)) {\n            // collision\n            let overlapX = 0;\n            // right edge is between the other's left and right edge\n            /**\n             *     +-this-+\n             *     |      |\n             *     |    +-other-+\n             *     +----|-+     |\n             *          |       |\n             *          +-------+\n             *         <---\n             *          ^ overlap\n             */\n            if (this.right >= other.left && this.right <= other.right) {\n                overlapX = other.left - this.right;\n                // right edge is past the other's right edge\n                /**\n                 *     +-other-+\n                 *     |       |\n                 *     |    +-this-+\n                 *     +----|--+   |\n                 *          |      |\n                 *          +------+\n                 *          --->\n                 *          ^ overlap\n                 */\n            }\n            else {\n                overlapX = other.right - this.left;\n            }\n            let overlapY = 0;\n            // top edge is between the other's top and bottom edge\n            /**\n             *     +-other-+\n             *     |       |\n             *     |    +-this-+   | <- overlap\n             *     +----|--+   |   |\n             *          |      |  \\ /\n             *          +------+   '\n             */\n            if (this.top <= other.bottom && this.top >= other.top) {\n                overlapY = other.bottom - this.top;\n                // top edge is above the other top edge\n                /**\n                 *     +-this-+         .\n                 *     |      |        / \\\n                 *     |    +-other-+   | <- overlap\n                 *     +----|-+     |   |\n                 *          |       |\n                 *          +-------+\n                 */\n            }\n            else {\n                overlapY = other.top - this.bottom;\n            }\n            if (Math.abs(overlapX) < Math.abs(overlapY)) {\n                return new Vector(overlapX, 0);\n            }\n            else {\n                return new Vector(0, overlapY);\n            }\n            // Case of total containment of one bounding box by another\n        }\n        else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n            let overlapX = 0;\n            // this is wider than the other\n            if (this.width - other.width >= 0) {\n                // This right edge is closest to the others right edge\n                if (this.right - other.right <= other.left - this.left) {\n                    overlapX = other.left - this.right;\n                    // This left edge is closest to the others left edge\n                }\n                else {\n                    overlapX = other.right - this.left;\n                }\n                // other is wider than this\n            }\n            else {\n                // This right edge is closest to the others right edge\n                if (other.right - this.right <= this.left - other.left) {\n                    overlapX = this.left - other.right;\n                    // This left edge is closest to the others left edge\n                }\n                else {\n                    overlapX = this.right - other.left;\n                }\n            }\n            let overlapY = 0;\n            // this is taller than other\n            if (this.height - other.height >= 0) {\n                // The bottom edge is closest to the others bottom edge\n                if (this.bottom - other.bottom <= other.top - this.top) {\n                    overlapY = other.top - this.bottom;\n                }\n                else {\n                    overlapY = other.bottom - this.top;\n                }\n                // other is taller than this\n            }\n            else {\n                // The bottom edge is closest to the others bottom edge\n                if (other.bottom - this.bottom <= this.top - other.top) {\n                    overlapY = this.top - other.bottom;\n                }\n                else {\n                    overlapY = this.bottom - other.top;\n                }\n            }\n            if (Math.abs(overlapX) < Math.abs(overlapY)) {\n                return new Vector(overlapX, 0);\n            }\n            else {\n                return new Vector(0, overlapY);\n            }\n        }\n        else {\n            return null;\n        }\n    }\n    /**\n     * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n     * @param bb The other actor to test\n     */\n    intersectWithSide(bb) {\n        const intersect = this.intersect(bb);\n        return BoundingBox.getSideFromIntersection(intersect);\n    }\n    /**\n     * Draw a debug bounding box\n     * @param ex\n     * @param color\n     */\n    draw(ex, color = Color.Yellow) {\n        ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\n    }\n}\n\n;// ./Util/Util.ts\n\n\n/**\n * Find the screen position of an HTML element\n */\nfunction getPosition(el) {\n    // do we need the scroll too? technically the offset method before did that\n    if (el && el.getBoundingClientRect) {\n        const rect = el.getBoundingClientRect();\n        return vec(rect.x + window.scrollX, rect.y + window.scrollY);\n    }\n    return Vector.Zero;\n}\n/**\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\n * @deprecated Will be removed in v0.26.0\n */\nfunction addItemToArray(item, array) {\n    if (array.indexOf(item) === -1) {\n        array.push(item);\n        return true;\n    }\n    return false;\n}\n/**\n * Remove an item from an list\n * @deprecated Will be removed in v0.26.0\n */\nfunction removeItemFromArray(item, array) {\n    let index = -1;\n    if ((index = array.indexOf(item)) > -1) {\n        array.splice(index, 1);\n        return true;\n    }\n    return false;\n}\n/**\n * See if an array contains something\n */\nfunction contains(array, obj) {\n    for (let i = 0; i < array.length; i++) {\n        if (array[i] === obj) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Used for exhaustive checks at compile time\n */\nfunction fail(message) {\n    throw new Error(message);\n}\n/**\n * Create a promise that resolves after a certain number of milliseconds\n *\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\n * excalibur clock which would be unaffected by stop/pause.\n * @param milliseconds\n * @param clock\n */\nfunction delay(milliseconds, clock) {\n    var _a;\n    const future = new Future();\n    const schedule = (_a = clock === null || clock === void 0 ? void 0 : clock.schedule.bind(clock)) !== null && _a !== void 0 ? _a : setTimeout;\n    schedule(() => {\n        future.resolve();\n    }, milliseconds);\n    return future.promise;\n}\n/**\n * Remove keys from object literals\n * @param object\n * @param keys\n */\nfunction omit(object, keys) {\n    const newObj = {};\n    for (const key in object) {\n        if (!keys.includes(key)) {\n            newObj[key] = object[key];\n        }\n    }\n    return newObj;\n}\n/**\n * Simple object check.\n * @param item\n */\nfunction isObject(item) {\n    return item && typeof item === 'object' && !Array.isArray(item);\n}\n/**\n * Deep merge two objects.\n * @param target\n * @param sources\n */\nfunction mergeDeep(target, ...sources) {\n    if (!sources.length) {\n        return target;\n    }\n    const source = sources.shift();\n    if (isObject(target) && isObject(source)) {\n        for (const key in source) {\n            if (isObject(source[key])) {\n                if (!target[key]) {\n                    Object.assign(target, { [key]: {} });\n                }\n                mergeDeep(target[key], source[key]);\n            }\n            else {\n                Object.assign(target, { [key]: source[key] });\n            }\n        }\n    }\n    return mergeDeep(target, ...sources);\n}\n\n;// ./Math/matrix.ts\n\n\n\nvar MatrixLocations;\n(function (MatrixLocations) {\n    MatrixLocations[MatrixLocations[\"X\"] = 12] = \"X\";\n    MatrixLocations[MatrixLocations[\"Y\"] = 13] = \"Y\";\n})(MatrixLocations || (MatrixLocations = {}));\n/**\n * Excalibur Matrix helper for 4x4 matrices\n *\n * Useful for webgl 4x4 matrices\n */\nclass Matrix {\n    constructor() {\n        /**\n         *  4x4 matrix in column major order\n         *\n         * |         |         |          |          |\n         * | ------- | ------- | -------- | -------- |\n         * | data[0] | data[4] | data[8]  | data[12] |\n         * | data[1] | data[5] | data[9]  | data[13] |\n         * | data[2] | data[6] | data[10] | data[14] |\n         * | data[3] | data[7] | data[11] | data[15] |\n         *\n         */\n        this.data = new Float32Array(16);\n        this._scaleX = 1;\n        this._scaleSignX = 1;\n        this._scaleY = 1;\n        this._scaleSignY = 1;\n    }\n    /**\n     * Creates an orthographic (flat non-perspective) projection\n     * https://en.wikipedia.org/wiki/Orthographic_projection\n     * @param left\n     * @param right\n     * @param bottom\n     * @param top\n     * @param near\n     * @param far\n     */\n    static ortho(left, right, bottom, top, near, far) {\n        const mat = new Matrix();\n        mat.data[0] = 2 / (right - left);\n        mat.data[1] = 0;\n        mat.data[2] = 0;\n        mat.data[3] = 0;\n        mat.data[4] = 0;\n        mat.data[5] = 2 / (top - bottom);\n        mat.data[6] = 0;\n        mat.data[7] = 0;\n        mat.data[8] = 0;\n        mat.data[9] = 0;\n        mat.data[10] = -2 / (far - near);\n        mat.data[11] = 0;\n        mat.data[12] = -(right + left) / (right - left);\n        mat.data[13] = -(top + bottom) / (top - bottom);\n        mat.data[14] = -(far + near) / (far - near);\n        mat.data[15] = 1;\n        return mat;\n    }\n    /**\n     * Creates a new Matrix with the same data as the current 4x4\n     */\n    clone(dest) {\n        const mat = dest || new Matrix();\n        mat.data[0] = this.data[0];\n        mat.data[1] = this.data[1];\n        mat.data[2] = this.data[2];\n        mat.data[3] = this.data[3];\n        mat.data[4] = this.data[4];\n        mat.data[5] = this.data[5];\n        mat.data[6] = this.data[6];\n        mat.data[7] = this.data[7];\n        mat.data[8] = this.data[8];\n        mat.data[9] = this.data[9];\n        mat.data[10] = this.data[10];\n        mat.data[11] = this.data[11];\n        mat.data[12] = this.data[12];\n        mat.data[13] = this.data[13];\n        mat.data[14] = this.data[14];\n        mat.data[15] = this.data[15];\n        return mat;\n    }\n    /**\n     * Converts the current matrix into a DOMMatrix\n     *\n     * This is useful when working with the browser Canvas context\n     * @returns {DOMMatrix} DOMMatrix\n     */\n    toDOMMatrix() {\n        return new DOMMatrix([...this.data]);\n    }\n    static fromFloat32Array(data) {\n        const matrix = new Matrix();\n        matrix.data = data;\n        return matrix;\n    }\n    /**\n     * Creates a new identity matrix (a matrix that when applied does nothing)\n     */\n    static identity() {\n        const mat = new Matrix();\n        mat.data[0] = 1;\n        mat.data[1] = 0;\n        mat.data[2] = 0;\n        mat.data[3] = 0;\n        mat.data[4] = 0;\n        mat.data[5] = 1;\n        mat.data[6] = 0;\n        mat.data[7] = 0;\n        mat.data[8] = 0;\n        mat.data[9] = 0;\n        mat.data[10] = 1;\n        mat.data[11] = 0;\n        mat.data[12] = 0;\n        mat.data[13] = 0;\n        mat.data[14] = 0;\n        mat.data[15] = 1;\n        return mat;\n    }\n    /**\n     * Resets the current matrix to the identity matrix, mutating it\n     * @returns {Matrix} Current matrix as identity\n     */\n    reset() {\n        const mat = this;\n        mat.data[0] = 1;\n        mat.data[1] = 0;\n        mat.data[2] = 0;\n        mat.data[3] = 0;\n        mat.data[4] = 0;\n        mat.data[5] = 1;\n        mat.data[6] = 0;\n        mat.data[7] = 0;\n        mat.data[8] = 0;\n        mat.data[9] = 0;\n        mat.data[10] = 1;\n        mat.data[11] = 0;\n        mat.data[12] = 0;\n        mat.data[13] = 0;\n        mat.data[14] = 0;\n        mat.data[15] = 1;\n        return mat;\n    }\n    /**\n     * Creates a brand new translation matrix at the specified 3d point\n     * @param x\n     * @param y\n     */\n    static translation(x, y) {\n        const mat = Matrix.identity();\n        mat.data[12] = x;\n        mat.data[13] = y;\n        return mat;\n    }\n    /**\n     * Creates a brand new scaling matrix with the specified scaling factor\n     * @param sx\n     * @param sy\n     */\n    static scale(sx, sy) {\n        const mat = Matrix.identity();\n        mat.data[0] = sx;\n        mat.data[5] = sy;\n        mat.data[10] = 1;\n        mat.data[15] = 1;\n        return mat;\n    }\n    /**\n     * Creates a brand new rotation matrix with the specified angle\n     * @param angleRadians\n     */\n    static rotation(angleRadians) {\n        const mat = Matrix.identity();\n        mat.data[0] = Math.cos(angleRadians);\n        mat.data[4] = -Math.sin(angleRadians);\n        mat.data[1] = Math.sin(angleRadians);\n        mat.data[5] = Math.cos(angleRadians);\n        return mat;\n    }\n    multiply(vectorOrMatrix, dest) {\n        if (vectorOrMatrix instanceof Vector) {\n            const result = dest || new Vector(0, 0);\n            const vector = vectorOrMatrix;\n            // these shenanigans are to allow dest and vector to be the same instance\n            const resultX = vector.x * this.data[0] + vector.y * this.data[4] + this.data[12];\n            const resultY = vector.x * this.data[1] + vector.y * this.data[5] + this.data[13];\n            result.x = resultX;\n            result.y = resultY;\n            return result;\n        }\n        else {\n            const result = dest || new Matrix();\n            const other = vectorOrMatrix;\n            const a11 = this.data[0];\n            const a21 = this.data[1];\n            const a31 = this.data[2];\n            const a41 = this.data[3];\n            const a12 = this.data[4];\n            const a22 = this.data[5];\n            const a32 = this.data[6];\n            const a42 = this.data[7];\n            const a13 = this.data[8];\n            const a23 = this.data[9];\n            const a33 = this.data[10];\n            const a43 = this.data[11];\n            const a14 = this.data[12];\n            const a24 = this.data[13];\n            const a34 = this.data[14];\n            const a44 = this.data[15];\n            const b11 = other.data[0];\n            const b21 = other.data[1];\n            const b31 = other.data[2];\n            const b41 = other.data[3];\n            const b12 = other.data[4];\n            const b22 = other.data[5];\n            const b32 = other.data[6];\n            const b42 = other.data[7];\n            const b13 = other.data[8];\n            const b23 = other.data[9];\n            const b33 = other.data[10];\n            const b43 = other.data[11];\n            const b14 = other.data[12];\n            const b24 = other.data[13];\n            const b34 = other.data[14];\n            const b44 = other.data[15];\n            result.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n            result.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n            result.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n            result.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n            result.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n            result.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n            result.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n            result.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n            result.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n            result.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n            result.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n            result.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n            result.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n            result.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n            result.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n            result.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n            const s = this.getScale();\n            result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\n            result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\n            return result;\n        }\n    }\n    /**\n     * Applies translation to the current matrix mutating it\n     * @param x\n     * @param y\n     */\n    translate(x, y) {\n        const a11 = this.data[0];\n        const a21 = this.data[1];\n        const a31 = this.data[2];\n        const a41 = this.data[3];\n        const a12 = this.data[4];\n        const a22 = this.data[5];\n        const a32 = this.data[6];\n        const a42 = this.data[7];\n        const a13 = this.data[8];\n        const a23 = this.data[9];\n        const a33 = this.data[10];\n        const a43 = this.data[11];\n        const a14 = this.data[12];\n        const a24 = this.data[13];\n        const a34 = this.data[14];\n        const a44 = this.data[15];\n        // Doesn't change z\n        const z = 0;\n        const w = 1;\n        this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\n        this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\n        this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\n        this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\n        return this;\n    }\n    setPosition(x, y) {\n        this.data[12] = x;\n        this.data[13] = y;\n    }\n    getPosition() {\n        return vec(this.data[12], this.data[13]);\n    }\n    /**\n     * Applies rotation to the current matrix mutating it\n     * @param angle in Radians\n     */\n    rotate(angle) {\n        const a11 = this.data[0];\n        const a21 = this.data[1];\n        const a31 = this.data[2];\n        const a41 = this.data[3];\n        const a12 = this.data[4];\n        const a22 = this.data[5];\n        const a32 = this.data[6];\n        const a42 = this.data[7];\n        const sine = Math.sin(angle);\n        const cosine = Math.cos(angle);\n        this.data[0] = cosine * a11 + sine * a12;\n        this.data[1] = cosine * a21 + sine * a22;\n        this.data[2] = cosine * a31 + sine * a32;\n        this.data[3] = cosine * a41 + sine * a42;\n        this.data[4] = cosine * a12 - sine * a11;\n        this.data[5] = cosine * a22 - sine * a21;\n        this.data[6] = cosine * a32 - sine * a31;\n        this.data[7] = cosine * a42 - sine * a41;\n        return this;\n    }\n    /**\n     * Applies scaling to the current matrix mutating it\n     * @param x\n     * @param y\n     */\n    scale(x, y) {\n        const a11 = this.data[0];\n        const a21 = this.data[1];\n        const a31 = this.data[2];\n        const a41 = this.data[3];\n        const a12 = this.data[4];\n        const a22 = this.data[5];\n        const a32 = this.data[6];\n        const a42 = this.data[7];\n        this.data[0] = a11 * x;\n        this.data[1] = a21 * x;\n        this.data[2] = a31 * x;\n        this.data[3] = a41 * x;\n        this.data[4] = a12 * y;\n        this.data[5] = a22 * y;\n        this.data[6] = a32 * y;\n        this.data[7] = a42 * y;\n        return this;\n    }\n    setRotation(angle) {\n        const currentScale = this.getScale();\n        const sine = Math.sin(angle);\n        const cosine = Math.cos(angle);\n        this.data[0] = cosine * currentScale.x;\n        this.data[1] = sine * currentScale.y;\n        this.data[4] = -sine * currentScale.x;\n        this.data[5] = cosine * currentScale.y;\n    }\n    getRotation() {\n        const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n        return canonicalizeAngle(angle);\n    }\n    getScaleX() {\n        // absolute scale of the matrix (we lose sign so need to add it back)\n        const xscale = vec(this.data[0], this.data[4]).magnitude;\n        return this._scaleSignX * xscale;\n    }\n    getScaleY() {\n        // absolute scale of the matrix (we lose sign so need to add it back)\n        const yscale = vec(this.data[1], this.data[5]).magnitude;\n        return this._scaleSignY * yscale;\n    }\n    /**\n     * Get the scale of the matrix\n     */\n    getScale() {\n        return vec(this.getScaleX(), this.getScaleY());\n    }\n    setScaleX(val) {\n        if (this._scaleX === val) {\n            return;\n        }\n        this._scaleSignX = sign(val);\n        // negative scale acts like a 180 rotation, so flip\n        const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\n        this.data[0] = xscale.x * val;\n        this.data[4] = xscale.y * val;\n        this._scaleX = val;\n    }\n    setScaleY(val) {\n        if (this._scaleY === val) {\n            return;\n        }\n        this._scaleSignY = sign(val);\n        // negative scale acts like a 180 rotation, so flip\n        const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\n        this.data[1] = yscale.x * val;\n        this.data[5] = yscale.y * val;\n        this._scaleY = val;\n    }\n    setScale(scale) {\n        this.setScaleX(scale.x);\n        this.setScaleY(scale.y);\n    }\n    /**\n     * Determinant of the upper left 2x2 matrix\n     */\n    getBasisDeterminant() {\n        return this.data[0] * this.data[5] - this.data[1] * this.data[4];\n    }\n    /**\n     * Return the affine inverse, optionally store it in a target matrix.\n     *\n     * It's recommended you call .reset() the target unless you know what you're doing\n     * @param target\n     */\n    getAffineInverse(target) {\n        // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n        // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n        // Since we are actually only doing 2D transformations we can use this hack\n        // We don't actually use the 3rd or 4th dimension\n        const det = this.getBasisDeterminant();\n        const inverseDet = 1 / det; // todo zero check\n        const a = this.data[0];\n        const b = this.data[4];\n        const c = this.data[1];\n        const d = this.data[5];\n        const m = target || Matrix.identity();\n        // inverts rotation and scale\n        m.data[0] = d * inverseDet;\n        m.data[1] = -c * inverseDet;\n        m.data[4] = -b * inverseDet;\n        m.data[5] = a * inverseDet;\n        const tx = this.data[12];\n        const ty = this.data[13];\n        // invert translation\n        // transform translation into the matrix basis created by rot/scale\n        m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\n        m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\n        return m;\n    }\n    isIdentity() {\n        return (this.data[0] === 1 &&\n            this.data[1] === 0 &&\n            this.data[2] === 0 &&\n            this.data[3] === 0 &&\n            this.data[4] === 0 &&\n            this.data[5] === 1 &&\n            this.data[6] === 0 &&\n            this.data[7] === 0 &&\n            this.data[8] === 0 &&\n            this.data[9] === 0 &&\n            this.data[10] === 1 &&\n            this.data[11] === 0 &&\n            this.data[12] === 0 &&\n            this.data[13] === 0 &&\n            this.data[14] === 0 &&\n            this.data[15] === 1);\n    }\n    toString() {\n        return `\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`;\n    }\n}\n\n;// ./Math/affine-matrix.ts\n\n\n\nclass AffineMatrix {\n    constructor() {\n        /**\n         * |         |         |          |\n         * | ------- | ------- | -------- |\n         * | data[0] | data[2] | data[4]  |\n         * | data[1] | data[3] | data[5]  |\n         * |   0     |    0    |    1     |\n         */\n        this.data = new Float64Array(6);\n        this._scale = new Float64Array([1, 1]);\n        this._scaleSignX = 1;\n        this._scaleSignY = 1;\n    }\n    /**\n     * Converts the current matrix into a DOMMatrix\n     *\n     * This is useful when working with the browser Canvas context\n     * @returns {DOMMatrix} DOMMatrix\n     */\n    toDOMMatrix() {\n        return new DOMMatrix([...this.data]);\n    }\n    static identity() {\n        const mat = new AffineMatrix();\n        mat.data[0] = 1;\n        mat.data[1] = 0;\n        mat.data[2] = 0;\n        mat.data[3] = 1;\n        mat.data[4] = 0;\n        mat.data[5] = 0;\n        return mat;\n    }\n    /**\n     * Creates a brand new translation matrix at the specified 3d point\n     * @param x\n     * @param y\n     */\n    static translation(x, y) {\n        const mat = AffineMatrix.identity();\n        mat.data[4] = x;\n        mat.data[5] = y;\n        return mat;\n    }\n    /**\n     * Creates a brand new scaling matrix with the specified scaling factor\n     * @param sx\n     * @param sy\n     */\n    static scale(sx, sy) {\n        const mat = AffineMatrix.identity();\n        mat.data[0] = sx;\n        mat.data[3] = sy;\n        mat._scale[0] = sx;\n        mat._scale[1] = sy;\n        return mat;\n    }\n    /**\n     * Creates a brand new rotation matrix with the specified angle\n     * @param angleRadians\n     */\n    static rotation(angleRadians) {\n        const mat = AffineMatrix.identity();\n        mat.data[0] = Math.cos(angleRadians);\n        mat.data[1] = Math.sin(angleRadians);\n        mat.data[2] = -Math.sin(angleRadians);\n        mat.data[3] = Math.cos(angleRadians);\n        return mat;\n    }\n    setPosition(x, y) {\n        this.data[4] = x;\n        this.data[5] = y;\n    }\n    getPosition() {\n        return vec(this.data[4], this.data[5]);\n    }\n    /**\n     * Applies rotation to the current matrix mutating it\n     * @param angle in Radians\n     */\n    rotate(angle) {\n        const a11 = this.data[0];\n        const a21 = this.data[1];\n        const a12 = this.data[2];\n        const a22 = this.data[3];\n        const sine = Math.sin(angle);\n        const cosine = Math.cos(angle);\n        this.data[0] = cosine * a11 + sine * a12;\n        this.data[1] = cosine * a21 + sine * a22;\n        this.data[2] = cosine * a12 - sine * a11;\n        this.data[3] = cosine * a22 - sine * a21;\n        return this;\n    }\n    /**\n     * Applies translation to the current matrix mutating it\n     * @param x\n     * @param y\n     */\n    translate(x, y) {\n        const a11 = this.data[0];\n        const a21 = this.data[1];\n        // const a31 = 0;\n        const a12 = this.data[2];\n        const a22 = this.data[3];\n        // const a32 = 0;\n        const a13 = this.data[4];\n        const a23 = this.data[5];\n        // const a33 = 1;\n        // Doesn't change z\n        this.data[4] = a11 * x + a12 * y + a13;\n        this.data[5] = a21 * x + a22 * y + a23;\n        return this;\n    }\n    /**\n     * Applies scaling to the current matrix mutating it\n     * @param x\n     * @param y\n     */\n    scale(x, y) {\n        const a11 = this.data[0];\n        const a21 = this.data[1];\n        const a12 = this.data[2];\n        const a22 = this.data[3];\n        this.data[0] = a11 * x;\n        this.data[1] = a21 * x;\n        this.data[2] = a12 * y;\n        this.data[3] = a22 * y;\n        this._scale[0] = x;\n        this._scale[1] = y;\n        this._scaleSignX = sign(x);\n        this._scaleSignY = sign(y);\n        return this;\n    }\n    determinant() {\n        return this.data[0] * this.data[3] - this.data[1] * this.data[2];\n    }\n    /**\n     * Return the affine inverse, optionally store it in a target matrix.\n     *\n     * It's recommended you call .reset() the target unless you know what you're doing\n     * @param target\n     */\n    inverse(target) {\n        // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n        // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n        // Since we are actually only doing 2D transformations we can use this hack\n        // We don't actually use the 3rd or 4th dimension\n        const det = this.determinant();\n        let inverseDet = det; // default to a zero matrix if we have a singular matrix\n        if (det !== 0) {\n            inverseDet = 1 / det;\n        }\n        const a = this.data[0];\n        const b = this.data[2];\n        const c = this.data[1];\n        const d = this.data[3];\n        const m = target || AffineMatrix.identity();\n        // inverts rotation and scale\n        m.data[0] = d * inverseDet;\n        m.data[1] = -c * inverseDet;\n        m.data[2] = -b * inverseDet;\n        m.data[3] = a * inverseDet;\n        const tx = this.data[4];\n        const ty = this.data[5];\n        // invert translation\n        // transform translation into the matrix basis created by rot/scale\n        m.data[4] = -(tx * m.data[0] + ty * m.data[2]);\n        m.data[5] = -(tx * m.data[1] + ty * m.data[3]);\n        return m;\n    }\n    multiply(vectorOrMatrix, dest) {\n        if (vectorOrMatrix instanceof Vector) {\n            const result = dest || new Vector(0, 0);\n            const vector = vectorOrMatrix;\n            // these shenanigans are to allow dest and vector to be the same instance\n            const resultX = vector.x * this.data[0] + vector.y * this.data[2] + this.data[4];\n            const resultY = vector.x * this.data[1] + vector.y * this.data[3] + this.data[5];\n            result.x = resultX;\n            result.y = resultY;\n            return result;\n        }\n        else {\n            const result = dest || new AffineMatrix();\n            const other = vectorOrMatrix;\n            const a11 = this.data[0];\n            const a21 = this.data[1];\n            //  const a31 = 0;\n            const a12 = this.data[2];\n            const a22 = this.data[3];\n            //  const a32 = 0;\n            const a13 = this.data[4];\n            const a23 = this.data[5];\n            //  const a33 = 1;\n            const b11 = other.data[0];\n            const b21 = other.data[1];\n            //  const b31 = 0;\n            const b12 = other.data[2];\n            const b22 = other.data[3];\n            //  const b32 = 0;\n            const b13 = other.data[4];\n            const b23 = other.data[5];\n            //  const b33 = 1;\n            result.data[0] = a11 * b11 + a12 * b21; // + a13 * b31; // zero\n            result.data[1] = a21 * b11 + a22 * b21; // + a23 * b31; // zero\n            result.data[2] = a11 * b12 + a12 * b22; // + a13 * b32; // zero\n            result.data[3] = a21 * b12 + a22 * b22; // + a23 * b32; // zero\n            result.data[4] = a11 * b13 + a12 * b23 + a13; // * b33; // one\n            result.data[5] = a21 * b13 + a22 * b23 + a23; // * b33; // one\n            const signX = this._scaleSignX;\n            const signY = this._scaleSignY;\n            result._scaleSignX = signX * sign(result._scaleSignX);\n            result._scaleSignY = signY * sign(result._scaleSignY);\n            return result;\n        }\n    }\n    /**\n     * Packed array of length 8, that contains 4 vertices, with 2 components each\n     * So: [x0, y0, x1, y1, x2, y2, x3, y3]\n     * @param quad\n     */\n    multiplyQuadInPlace(quad) {\n        const resultTopLeftX = quad[0] * this.data[0] + quad[1] * this.data[2] + this.data[4];\n        const resultTopLeftY = quad[0] * this.data[1] + quad[1] * this.data[3] + this.data[5];\n        quad[0] = resultTopLeftX;\n        quad[1] = resultTopLeftY;\n        const resultTopRightX = quad[2] * this.data[0] + quad[3] * this.data[2] + this.data[4];\n        const resultTopRightY = quad[2] * this.data[1] + quad[3] * this.data[3] + this.data[5];\n        quad[2] = resultTopRightX;\n        quad[3] = resultTopRightY;\n        const resultBottomLeftX = quad[4] * this.data[0] + quad[5] * this.data[2] + this.data[4];\n        const resultBottomLeftY = quad[4] * this.data[1] + quad[5] * this.data[3] + this.data[5];\n        quad[4] = resultBottomLeftX;\n        quad[5] = resultBottomLeftY;\n        const resultBottomRightX = quad[6] * this.data[0] + quad[7] * this.data[2] + this.data[4];\n        const resultBottomRightY = quad[6] * this.data[1] + quad[7] * this.data[3] + this.data[5];\n        quad[6] = resultBottomRightX;\n        quad[7] = resultBottomRightY;\n    }\n    to4x4() {\n        const mat = new Matrix();\n        mat.data[0] = this.data[0];\n        mat.data[1] = this.data[1];\n        mat.data[2] = 0;\n        mat.data[3] = 0;\n        mat.data[4] = this.data[2];\n        mat.data[5] = this.data[3];\n        mat.data[6] = 0;\n        mat.data[7] = 0;\n        mat.data[8] = 0;\n        mat.data[9] = 0;\n        mat.data[10] = 1;\n        mat.data[11] = 0;\n        mat.data[12] = this.data[4];\n        mat.data[13] = this.data[5];\n        mat.data[14] = 0;\n        mat.data[15] = 1;\n        return mat;\n    }\n    setRotation(angle) {\n        const currentScale = this.getScale();\n        const sine = Math.sin(angle);\n        const cosine = Math.cos(angle);\n        this.data[0] = cosine * currentScale.x;\n        this.data[1] = sine * currentScale.y;\n        this.data[2] = -sine * currentScale.x;\n        this.data[3] = cosine * currentScale.y;\n    }\n    getRotation() {\n        const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n        return canonicalizeAngle(angle);\n    }\n    getScaleX() {\n        // absolute scale of the matrix (we lose sign so need to add it back)\n        const xScaleSq = this.data[0] * this.data[0] + this.data[2] * this.data[2];\n        if (xScaleSq === 1.0) {\n            // usually there isn't scale so we can avoid a sqrt\n            return this._scaleSignX;\n        }\n        return this._scaleSignX * Math.sqrt(xScaleSq);\n    }\n    getScaleY() {\n        // absolute scale of the matrix (we lose sign so need to add it back)\n        const yScaleSq = this.data[1] * this.data[1] + this.data[3] * this.data[3];\n        if (yScaleSq === 1.0) {\n            // usually there isn't scale so we can avoid a sqrt\n            return this._scaleSignY;\n        }\n        return this._scaleSignY * Math.sqrt(yScaleSq);\n    }\n    /**\n     * Get the scale of the matrix\n     */\n    getScale() {\n        return vec(this.getScaleX(), this.getScaleY());\n    }\n    setScaleX(val) {\n        if (val === this._scale[0]) {\n            return;\n        }\n        this._scaleSignX = sign(val);\n        // negative scale acts like a 180 rotation, so flip\n        const xscale = vec(this.data[0] * this._scaleSignX, this.data[2] * this._scaleSignX).normalize();\n        this.data[0] = xscale.x * val;\n        this.data[2] = xscale.y * val;\n        this._scale[0] = val;\n    }\n    setScaleY(val) {\n        if (val === this._scale[1]) {\n            return;\n        }\n        this._scaleSignY = sign(val);\n        // negative scale acts like a 180 rotation, so flip\n        const yscale = vec(this.data[1] * this._scaleSignY, this.data[3] * this._scaleSignY).normalize();\n        this.data[1] = yscale.x * val;\n        this.data[3] = yscale.y * val;\n        this._scale[1] = val;\n    }\n    setScale(scale) {\n        this.setScaleX(scale.x);\n        this.setScaleY(scale.y);\n    }\n    isIdentity() {\n        return this.data[0] === 1 && this.data[1] === 0 && this.data[2] === 0 && this.data[3] === 1 && this.data[4] === 0 && this.data[5] === 0;\n    }\n    /**\n     * Resets the current matrix to the identity matrix, mutating it\n     * @returns {AffineMatrix} Current matrix as identity\n     */\n    reset() {\n        const mat = this;\n        mat.data[0] = 1;\n        mat.data[1] = 0;\n        mat.data[2] = 0;\n        mat.data[3] = 1;\n        mat.data[4] = 0;\n        mat.data[5] = 0;\n        return mat;\n    }\n    /**\n     * Creates a new Matrix with the same data as the current {@apilink AffineMatrix}\n     */\n    clone(dest) {\n        const mat = dest || new AffineMatrix();\n        mat.data[0] = this.data[0];\n        mat.data[1] = this.data[1];\n        mat.data[2] = this.data[2];\n        mat.data[3] = this.data[3];\n        mat.data[4] = this.data[4];\n        mat.data[5] = this.data[5];\n        mat._scaleSignX = this._scaleSignX;\n        mat._scaleSignY = this._scaleSignY;\n        return mat;\n    }\n    toString() {\n        return `\n[${this.data[0]} ${this.data[2]} ${this.data[4]}]\n[${this.data[1]} ${this.data[3]} ${this.data[5]}]\n[0 0 1]\n`;\n    }\n}\n\n;// ./Util/RentalPool.ts\nclass RentalPool {\n    constructor(builder, cleaner, preAllocate = 1) {\n        this.builder = builder;\n        this.cleaner = cleaner;\n        this._pool = [];\n        this._size = 0;\n        this.grow(preAllocate);\n    }\n    /**\n     * Grow the pool size by an amount\n     * @param amount\n     */\n    grow(amount) {\n        if (amount > 0) {\n            this._size += amount;\n            for (let i = 0; i < amount; i++) {\n                this._pool.push(this.builder());\n            }\n        }\n    }\n    /**\n     * Rent an object from the pool, optionally clean it. If not cleaned previous state may be set.\n     *\n     * The pool will automatically double if depleted\n     * @param clean\n     */\n    rent(clean = false) {\n        if (this._pool.length === 0) {\n            this.grow(this._size);\n        }\n        return clean ? this.cleaner(this._pool.pop()) : this._pool.pop();\n    }\n    /**\n     * Return an object to the pool\n     * @param object\n     */\n    return(object) {\n        this._pool.push(object);\n    }\n}\n\n;// ./Graphics/Context/transform-stack.ts\n\n\nclass TransformStack {\n    constructor() {\n        this._pool = new RentalPool(() => AffineMatrix.identity(), (mat) => mat.reset(), 100);\n        this._transforms = [];\n        this._currentTransform = this._pool.rent(true);\n    }\n    save() {\n        this._transforms.push(this._currentTransform);\n        this._currentTransform = this._currentTransform.clone(this._pool.rent());\n    }\n    restore() {\n        this._pool.return(this._currentTransform);\n        this._currentTransform = this._transforms.pop();\n    }\n    translate(x, y) {\n        return this._currentTransform.translate(x, y);\n    }\n    rotate(angle) {\n        return this._currentTransform.rotate(angle);\n    }\n    scale(x, y) {\n        return this._currentTransform.scale(x, y);\n    }\n    reset() {\n        this._currentTransform.reset();\n    }\n    set current(matrix) {\n        this._currentTransform = matrix;\n    }\n    get current() {\n        return this._currentTransform;\n    }\n}\n\n;// ./Graphics/Context/state-stack.ts\n\n\nclass ContextState {\n    constructor() {\n        this.opacity = 1;\n        this.z = 0;\n        this.tint = Color.White;\n        this.material = null;\n    }\n}\nclass StateStack {\n    constructor() {\n        this._pool = new RentalPool(() => new ContextState(), (s) => {\n            s.opacity = 1;\n            s.z = 0;\n            s.tint = Color.White;\n            s.material = null;\n            return s;\n        }, 100);\n        this.current = this._pool.rent(true);\n        this._states = [];\n    }\n    _cloneState(dest) {\n        var _a;\n        dest.opacity = this.current.opacity;\n        dest.z = this.current.z;\n        if (dest.tint) {\n            (_a = this.current.tint) === null || _a === void 0 ? void 0 : _a.clone(dest.tint);\n        }\n        dest.material = this.current.material; // TODO is this going to cause problems when cloning\n        return dest;\n    }\n    save() {\n        this._states.push(this.current);\n        this.current = this._cloneState(this._pool.rent());\n    }\n    restore() {\n        this._pool.return(this.current);\n        this.current = this._states.pop();\n    }\n}\n\n;// ./Resources/Resource.ts\n\n\nconst ResourceEvents = {\n    Complete: 'complete',\n    Load: 'load',\n    LoadStart: 'loadstart',\n    Progress: 'progress',\n    Error: 'error'\n};\n/**\n * The {@apilink Resource} type allows games built in Excalibur to load generic resources.\n * For any type of remote resource it is recommended to use {@apilink Resource} for preloading.\n */\nclass Resource {\n    /**\n     * @param path          Path to the remote resource\n     * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\n     * @param bustCache     Whether or not to cache-bust requests\n     */\n    constructor(path, responseType, bustCache = false) {\n        this.path = path;\n        this.responseType = responseType;\n        this.bustCache = bustCache;\n        this.data = null;\n        this.logger = Logger.getInstance();\n        this.events = new EventEmitter();\n    }\n    /**\n     * Returns true if the Resource is completely loaded and is ready\n     * to be drawn.\n     */\n    isLoaded() {\n        return this.data !== null;\n    }\n    _cacheBust(uri) {\n        const query = /\\?\\w*=\\w*/;\n        if (query.test(uri)) {\n            uri += '&__=' + Date.now();\n        }\n        else {\n            uri += '?__=' + Date.now();\n        }\n        return uri;\n    }\n    /**\n     * Begin loading the resource and returns a promise to be resolved on completion\n     */\n    load() {\n        return new Promise((resolve, reject) => {\n            // Exit early if we already have data\n            if (this.data !== null) {\n                this.logger.debug('Already have data for resource', this.path);\n                this.events.emit('complete', this.data);\n                resolve(this.data);\n                return;\n            }\n            const request = new XMLHttpRequest();\n            request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\n            request.responseType = this.responseType;\n            request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e));\n            request.addEventListener('progress', (e) => this.events.emit('progress', e));\n            request.addEventListener('error', (e) => this.events.emit('error', e));\n            request.addEventListener('load', (e) => this.events.emit('load', e));\n            request.addEventListener('load', () => {\n                // XHR on file:// success status is 0, such as with PhantomJS\n                if (request.status !== 0 && request.status !== 200) {\n                    this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\n                    this.events.emit('error', request.response);\n                    reject(new Error(request.statusText));\n                    return;\n                }\n                if (request.response instanceof Blob && request.response.type === 'text/html') {\n                    const errorText = `Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!\n\nCheck your server configuration, for example Vite serves static files from the /public folder`;\n                    this.events.emit('error', request.response);\n                    reject(new Error(errorText));\n                    return;\n                }\n                this.data = request.response;\n                this.events.emit('complete', this.data);\n                this.logger.debug('Completed loading resource', this.path);\n                resolve(this.data);\n            });\n            request.send();\n        });\n    }\n}\n\n;// ./Util/Watch.ts\n/**\n * Watch an object with a proxy, only fires if property value is different\n */\nfunction watch(type, change) {\n    if (!type) {\n        return type;\n    }\n    if (type.__isProxy === undefined) {\n        // expando hack to mark a proxy\n        return new Proxy(type, {\n            set: (obj, prop, value) => {\n                // The default behavior to store the value\n                if (obj[prop] !== value) {\n                    obj[prop] = value;\n                    // Avoid watching private junk\n                    if (typeof prop === 'string') {\n                        if (prop[0] !== '_') {\n                            change(obj);\n                        }\n                    }\n                }\n                // Indicate success\n                return true;\n            },\n            get: (obj, prop) => {\n                if (prop !== '__isProxy') {\n                    return obj[prop];\n                }\n                return true;\n            }\n        });\n    }\n    return type;\n}\nconst createHandler = (path = [], change, typeType) => ({\n    get: (target, key) => {\n        if (key === '__isProxy') {\n            return true;\n        }\n        if (typeof target[key] === 'object' && target[key] != null) {\n            return new Proxy(target[key], createHandler([...path, key], change, typeType));\n        }\n        return target[key];\n    },\n    set: (target, key, value) => {\n        if (typeof key === 'string') {\n            if (key[0] !== '_') {\n                change(typeType);\n            }\n        }\n        target[key] = value;\n        return true;\n    }\n});\n/**\n *\n */\nfunction watchDeep(type, change) {\n    if (!type) {\n        return type;\n    }\n    if (type.__isProxy === undefined) {\n        // expando hack to mark a proxy\n        return new Proxy(type, createHandler([], change, type));\n    }\n    return type;\n}\n/**\n * Watch an object with a proxy, fires change on any property value change\n */\nfunction watchAny(type, change) {\n    if (!type) {\n        return type;\n    }\n    if (type.__isProxy === undefined) {\n        // expando hack to mark a proxy\n        return new Proxy(type, {\n            set: (obj, prop, value) => {\n                // The default behavior to store the value\n                obj[prop] = value;\n                // Avoid watching private junk\n                if (typeof prop === 'string') {\n                    if (prop[0] !== '_') {\n                        change(obj);\n                    }\n                }\n                // Indicate success\n                return true;\n            },\n            get: (obj, prop) => {\n                if (prop !== '__isProxy') {\n                    return obj[prop];\n                }\n                return true;\n            }\n        });\n    }\n    return type;\n}\n\n;// ./Graphics/Graphic.ts\n\n\n\n\n/**\n * A Graphic is the base Excalibur primitive for something that can be drawn to the {@apilink ExcaliburGraphicsContext}.\n * {@apilink Sprite}, {@apilink Animation}, {@apilink GraphicsGroup}, {@apilink Canvas}, {@apilink Rectangle}, {@apilink Circle}, and {@apilink Polygon} all derive from the\n * {@apilink Graphic} abstract class.\n *\n * Implementors of a Graphic must override the abstract {@apilink Graphic._drawImage} method to render an image to the graphics context. Graphic\n * handles all the position, rotation, and scale transformations in {@apilink Graphic._preDraw} and {@apilink Graphic._postDraw}\n */\nclass Graphic {\n    isStale() {\n        return this._transformStale;\n    }\n    /**\n     * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\n     */\n    get flipHorizontal() {\n        return this._flipHorizontal;\n    }\n    set flipHorizontal(value) {\n        this._flipHorizontal = value;\n        this._transformStale = true;\n    }\n    /**\n     * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\n     */\n    get flipVertical() {\n        return this._flipVertical;\n    }\n    set flipVertical(value) {\n        this._flipVertical = value;\n        this._transformStale = true;\n    }\n    /**\n     * Gets or sets the rotation of the graphic\n     */\n    get rotation() {\n        return this._rotation;\n    }\n    set rotation(value) {\n        this._rotation = value;\n        this._transformStale = true;\n    }\n    /**\n     * Gets or sets the scale of the graphic, this affects the width and\n     */\n    get scale() {\n        return this._scale;\n    }\n    set scale(value) {\n        this._scale = watch(value, () => {\n            this._transformStale = true;\n        });\n        this._transformStale = true;\n    }\n    /**\n     * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\n     */\n    get origin() {\n        return this._origin;\n    }\n    set origin(value) {\n        if (value) {\n            this._origin = watch(value, () => {\n                this._transformStale = true;\n            });\n        }\n        this._transformStale = true;\n    }\n    constructor(options) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        this.id = Graphic._ID++;\n        this.transform = AffineMatrix.identity();\n        this._transformStale = true;\n        /**\n         * Gets or sets wether to show debug information about the graphic\n         */\n        this.showDebug = false;\n        this._flipHorizontal = false;\n        this._flipVertical = false;\n        this._rotation = 0;\n        /**\n         * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\n         */\n        this.opacity = 1;\n        this._scale = Vector.One;\n        this._width = 0;\n        this._height = 0;\n        if (options) {\n            this.origin = (_a = options.origin) !== null && _a !== void 0 ? _a : this.origin;\n            this.flipHorizontal = (_b = options.flipHorizontal) !== null && _b !== void 0 ? _b : this.flipHorizontal;\n            this.flipVertical = (_c = options.flipVertical) !== null && _c !== void 0 ? _c : this.flipVertical;\n            this.rotation = (_d = options.rotation) !== null && _d !== void 0 ? _d : this.rotation;\n            this.opacity = (_e = options.opacity) !== null && _e !== void 0 ? _e : this.opacity;\n            this.scale = (_f = options.scale) !== null && _f !== void 0 ? _f : this.scale;\n            this.tint = (_g = options.tint) !== null && _g !== void 0 ? _g : this.tint;\n            if (options.width) {\n                this._width = options.width;\n            }\n            if (options.height) {\n                this._height = options.height;\n            }\n        }\n    }\n    cloneGraphicOptions() {\n        return {\n            width: this.width / this.scale.x,\n            height: this.height / this.scale.y,\n            origin: this.origin ? this.origin.clone() : undefined,\n            flipHorizontal: this.flipHorizontal,\n            flipVertical: this.flipVertical,\n            rotation: this.rotation,\n            opacity: this.opacity,\n            scale: this.scale ? this.scale.clone() : undefined,\n            tint: this.tint ? this.tint.clone() : undefined\n        };\n    }\n    /**\n     * Gets or sets the width of the graphic (always positive)\n     */\n    get width() {\n        return Math.abs(this._width * this.scale.x);\n    }\n    /**\n     * Gets or sets the height of the graphic (always positive)\n     */\n    get height() {\n        return Math.abs(this._height * this.scale.y);\n    }\n    set width(value) {\n        this._width = value;\n        this._transformStale = true;\n    }\n    set height(value) {\n        this._height = value;\n        this._transformStale = true;\n    }\n    /**\n     * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\n     */\n    get localBounds() {\n        return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\n    }\n    /**\n     * Draw the whole graphic to the context including transform\n     * @param ex The excalibur graphics context\n     * @param x\n     * @param y\n     */\n    draw(ex, x, y) {\n        this._preDraw(ex, x, y);\n        this._drawImage(ex, 0, 0);\n        this._postDraw(ex);\n    }\n    /**\n     * Apply affine transformations to the graphics context to manipulate the graphic before {@apilink Graphic._drawImage}\n     * @param ex\n     * @param x\n     * @param y\n     */\n    _preDraw(ex, x, y) {\n        ex.save();\n        ex.translate(x, y);\n        if (this._transformStale) {\n            this.transform.reset();\n            this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n            this._rotate(this.transform);\n            this._flip(this.transform);\n            this._transformStale = false;\n        }\n        ex.multiply(this.transform);\n        // it is important to multiply alphas so graphics respect the current context\n        ex.opacity = ex.opacity * this.opacity;\n        if (this.tint) {\n            ex.tint = this.tint;\n        }\n    }\n    _rotate(ex) {\n        var _a;\n        const scaleDirX = this.scale.x > 0 ? 1 : -1;\n        const scaleDirY = this.scale.y > 0 ? 1 : -1;\n        const origin = (_a = this.origin) !== null && _a !== void 0 ? _a : vec(this.width / 2, this.height / 2);\n        ex.translate(origin.x, origin.y);\n        ex.rotate(this.rotation);\n        // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n        ex.scale(scaleDirX, scaleDirY);\n        ex.translate(-origin.x, -origin.y);\n    }\n    _flip(ex) {\n        if (this.flipHorizontal) {\n            ex.translate(this.width / this.scale.x, 0);\n            ex.scale(-1, 1);\n        }\n        if (this.flipVertical) {\n            ex.translate(0, this.height / this.scale.y);\n            ex.scale(1, -1);\n        }\n    }\n    /**\n     * Apply any additional work after {@apilink Graphic._drawImage} and restore the context state.\n     * @param ex\n     */\n    _postDraw(ex) {\n        if (this.showDebug) {\n            ex.debug.drawRect(0, 0, this.width, this.height);\n        }\n        ex.restore();\n    }\n}\nGraphic._ID = 0;\n\n;// ./Graphics/Sprite.ts\n\n\nclass Sprite extends Graphic {\n    static from(image, options) {\n        return new Sprite({\n            image,\n            ...options\n        });\n    }\n    constructor(options) {\n        var _a, _b;\n        super(options);\n        this._logger = Logger.getInstance();\n        this._dirty = true;\n        this.image = options.image;\n        const { width, height } = options;\n        this.sourceView = (_a = options.sourceView) !== null && _a !== void 0 ? _a : { x: 0, y: 0, width: width !== null && width !== void 0 ? width : 0, height: height !== null && height !== void 0 ? height : 0 };\n        this.destSize = (_b = options.destSize) !== null && _b !== void 0 ? _b : { width: width !== null && width !== void 0 ? width : 0, height: height !== null && height !== void 0 ? height : 0 };\n        this._updateSpriteDimensions();\n        // Fire when loaded\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.image.ready.then(() => {\n            this._updateSpriteDimensions();\n        });\n    }\n    get width() {\n        return Math.abs(this.destSize.width * this.scale.x);\n    }\n    get height() {\n        return Math.abs(this.destSize.height * this.scale.y);\n    }\n    set width(newWidth) {\n        newWidth /= Math.abs(this.scale.x);\n        this.destSize.width = newWidth;\n        super.width = Math.ceil(this.destSize.width);\n    }\n    set height(newHeight) {\n        newHeight /= Math.abs(this.scale.y);\n        this.destSize.height = newHeight;\n        super.height = Math.ceil(this.destSize.height);\n    }\n    _updateSpriteDimensions() {\n        var _a, _b, _c, _d, _e, _f;\n        const { width: nativeWidth, height: nativeHeight } = this.image;\n        // This code uses || to avoid 0's\n        // If the source is not specified, use the native dimension\n        this.sourceView.width = ((_a = this.sourceView) === null || _a === void 0 ? void 0 : _a.width) || nativeWidth;\n        this.sourceView.height = ((_b = this.sourceView) === null || _b === void 0 ? void 0 : _b.height) || nativeHeight;\n        // If the destination is not specified, use the source if specified, then native\n        this.destSize.width = ((_c = this.destSize) === null || _c === void 0 ? void 0 : _c.width) || ((_d = this.sourceView) === null || _d === void 0 ? void 0 : _d.width) || nativeWidth;\n        this.destSize.height = ((_e = this.destSize) === null || _e === void 0 ? void 0 : _e.height) || ((_f = this.sourceView) === null || _f === void 0 ? void 0 : _f.height) || nativeHeight;\n        this.width = Math.ceil(this.destSize.width) * this.scale.x;\n        this.height = Math.ceil(this.destSize.height) * this.scale.y;\n    }\n    _preDraw(ex, x, y) {\n        if (this.image.isLoaded() && this._dirty) {\n            this._dirty = false;\n            this._updateSpriteDimensions();\n        }\n        super._preDraw(ex, x, y);\n    }\n    _drawImage(ex, x, y) {\n        if (this.image.isLoaded()) {\n            ex.drawImage(this.image.image, this.sourceView.x, this.sourceView.y, this.sourceView.width, this.sourceView.height, x, y, this.destSize.width, this.destSize.height);\n        }\n        else {\n            this._logger.warnOnce(`ImageSource ${this.image.path}` +\n                ` is not yet loaded and won't be drawn. Please call .load() or include in a Loader.\\n\\n` +\n                `Read https://excaliburjs.com/docs/imagesource for more information.`);\n        }\n    }\n    clone() {\n        return new Sprite({\n            image: this.image,\n            sourceView: { ...this.sourceView },\n            destSize: { ...this.destSize },\n            ...this.cloneGraphicOptions()\n        });\n    }\n}\n\n;// ./Graphics/Filtering.ts\n/**\n * Describes the different image filtering modes\n */\nvar ImageFiltering;\n(function (ImageFiltering) {\n    /**\n     * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\n     *\n     * Useful for Pixel art aesthetics.\n     */\n    ImageFiltering[\"Pixel\"] = \"Pixel\";\n    /**\n     * Blended is useful when you have high resolution artwork and would like it blended and smoothed\n     */\n    ImageFiltering[\"Blended\"] = \"Blended\";\n})(ImageFiltering || (ImageFiltering = {}));\n/**\n * Parse the image filtering attribute value, if it doesn't match returns null\n */\nfunction parseImageFiltering(val) {\n    switch (val) {\n        case ImageFiltering.Pixel:\n            return ImageFiltering.Pixel;\n        case ImageFiltering.Blended:\n            return ImageFiltering.Blended;\n        default:\n            return undefined;\n    }\n}\n\n;// ./Graphics/Wrapping.ts\n/**\n * Describes the different image wrapping modes\n */\nvar ImageWrapping;\n(function (ImageWrapping) {\n    ImageWrapping[\"Clamp\"] = \"Clamp\";\n    ImageWrapping[\"Repeat\"] = \"Repeat\";\n    ImageWrapping[\"Mirror\"] = \"Mirror\";\n})(ImageWrapping || (ImageWrapping = {}));\n/**\n *\n */\nfunction parseImageWrapping(val) {\n    switch (val) {\n        case ImageWrapping.Clamp:\n            return ImageWrapping.Clamp;\n        case ImageWrapping.Repeat:\n            return ImageWrapping.Repeat;\n        case ImageWrapping.Mirror:\n            return ImageWrapping.Mirror;\n        default:\n            return ImageWrapping.Clamp;\n    }\n}\n\n;// ./Graphics/Context/texture-loader.ts\n\n\n\n/**\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\n */\nclass TextureLoader {\n    constructor(gl, _garbageCollector) {\n        var _a;\n        this._garbageCollector = _garbageCollector;\n        this._textureMap = new Map();\n        /**\n         * Looks for textures that haven't been drawn in a while\n         */\n        this._collect = (image) => {\n            var _a;\n            if (this._gl) {\n                const name = (_a = image.dataset.originalSrc) !== null && _a !== void 0 ? _a : image.constructor.name;\n                TextureLoader._LOGGER.debug(`WebGL Texture for ${name} collected`);\n                this.delete(image);\n                return true;\n            }\n            return false;\n        };\n        this._gl = gl;\n        TextureLoader._MAX_TEXTURE_SIZE = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n        if (this._garbageCollector) {\n            TextureLoader._LOGGER.debug('WebGL Texture collection interval:', this._garbageCollector.collectionInterval);\n            (_a = this._garbageCollector.garbageCollector) === null || _a === void 0 ? void 0 : _a.registerCollector('texture', this._garbageCollector.collectionInterval, this._collect);\n        }\n    }\n    dispose() {\n        for (const [image] of this._textureMap) {\n            this.delete(image);\n        }\n        this._textureMap.clear();\n        this._gl = null;\n    }\n    /**\n     * Get the WebGL Texture from a source image\n     * @param image\n     */\n    get(image) {\n        return this._textureMap.get(image);\n    }\n    /**\n     * Returns whether a source image has been loaded as a texture\n     * @param image\n     */\n    has(image) {\n        return this._textureMap.has(image);\n    }\n    /**\n     * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\n     * @param image Source graphic\n     * @param options {ImageSourceOptions} Optionally configure the ImageFiltering and ImageWrapping mode to apply to the loaded texture\n     * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\n     */\n    load(image, options, forceUpdate = false) {\n        var _a, _b;\n        // Ignore loading if webgl is not registered\n        const gl = this._gl;\n        if (!gl) {\n            return null;\n        }\n        const { filtering, wrapping } = { ...options };\n        let tex = null;\n        // If reuse the texture if it's from the same source\n        if (this.has(image)) {\n            tex = this.get(image);\n        }\n        // Update existing webgl texture and return early\n        if (tex) {\n            if (forceUpdate) {\n                gl.bindTexture(gl.TEXTURE_2D, tex);\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n            }\n            (_a = this._garbageCollector) === null || _a === void 0 ? void 0 : _a.garbageCollector.touch(image);\n            return tex;\n        }\n        // No texture exists create a new one\n        tex = gl.createTexture();\n        // TODO implement texture gc with weakmap and timer\n        TextureLoader.checkImageSizeSupportedAndLog(image);\n        gl.bindTexture(gl.TEXTURE_2D, tex);\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n        let wrappingConfig;\n        if (wrapping) {\n            if (typeof wrapping === 'string') {\n                wrappingConfig = {\n                    x: wrapping,\n                    y: wrapping\n                };\n            }\n            else {\n                wrappingConfig = {\n                    x: wrapping.x,\n                    y: wrapping.y\n                };\n            }\n        }\n        const { x: xWrap, y: yWrap } = wrappingConfig !== null && wrappingConfig !== void 0 ? wrappingConfig : TextureLoader.wrapping;\n        switch (xWrap) {\n            case ImageWrapping.Clamp:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n                break;\n            case ImageWrapping.Repeat:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n                break;\n            case ImageWrapping.Mirror:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.MIRRORED_REPEAT);\n                break;\n            default:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        }\n        switch (yWrap) {\n            case ImageWrapping.Clamp:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n                break;\n            case ImageWrapping.Repeat:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n                break;\n            case ImageWrapping.Mirror:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.MIRRORED_REPEAT);\n                break;\n            default:\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        }\n        // NEAREST for pixel art, LINEAR for hi-res\n        const filterMode = filtering !== null && filtering !== void 0 ? filtering : TextureLoader.filtering;\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        this._textureMap.set(image, tex);\n        (_b = this._garbageCollector) === null || _b === void 0 ? void 0 : _b.garbageCollector.addCollectableResource('texture', image);\n        return tex;\n    }\n    delete(image) {\n        // Ignore loading if webgl is not registered\n        const gl = this._gl;\n        if (!gl) {\n            return;\n        }\n        if (this.has(image)) {\n            const texture = this.get(image);\n            if (texture) {\n                this._textureMap.delete(image);\n                gl.deleteTexture(texture);\n            }\n        }\n    }\n    /**\n     * Takes an image and returns if it meets size criteria for hardware\n     * @param image\n     * @returns if the image will be supported at runtime\n     */\n    static checkImageSizeSupportedAndLog(image) {\n        var _a;\n        const originalSrc = (_a = image.dataset.originalSrc) !== null && _a !== void 0 ? _a : 'internal canvas bitmap';\n        if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\n            TextureLoader._LOGGER.error(`The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of ` +\n                `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image ` +\n                `for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n` +\n                `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n            return false;\n        }\n        else if (image.width > 4096 || image.height > 4096) {\n            // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\n            TextureLoader._LOGGER.warn(`The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, ` +\n                `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\n                `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\n                `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n        }\n        return true;\n    }\n}\nTextureLoader._LOGGER = Logger.getInstance();\n/**\n * Sets the default filtering for the Excalibur texture loader, default {@apilink ImageFiltering.Blended}\n */\nTextureLoader.filtering = ImageFiltering.Blended;\nTextureLoader.wrapping = { x: ImageWrapping.Clamp, y: ImageWrapping.Clamp };\nTextureLoader._MAX_TEXTURE_SIZE = 4096;\n\n;// ./Graphics/ImageSource.ts\n\n\n\n\n\n\n\nconst ImageSourceAttributeConstants = {\n    Filtering: 'filtering',\n    WrappingX: 'wrapping-x',\n    WrappingY: 'wrapping-y'\n};\nclass ImageSource {\n    /**\n     * The original size of the source image in pixels\n     */\n    get width() {\n        return this.image.naturalWidth;\n    }\n    /**\n     * The original height of the source image in pixels\n     */\n    get height() {\n        return this.image.naturalHeight;\n    }\n    /**\n     * Returns true if the Texture is completely loaded and is ready\n     * to be drawn.\n     */\n    isLoaded() {\n        if (!this._src) {\n            // this boosts speed of access\n            this._src = this.data.src;\n        }\n        return !!this._src;\n    }\n    get image() {\n        return this.data;\n    }\n    constructor(pathOrBase64, bustCacheOrOptions, filtering) {\n        this._logger = Logger.getInstance();\n        /**\n         * Access to the underlying html image element\n         */\n        this.data = new Image();\n        this._readyFuture = new Future();\n        /**\n         * Promise the resolves when the image is loaded and ready for use, does not initiate loading\n         */\n        this.ready = this._readyFuture.promise;\n        this.path = pathOrBase64;\n        let bustCache = false;\n        let wrapping;\n        if (typeof bustCacheOrOptions === 'boolean') {\n            bustCache = bustCacheOrOptions;\n        }\n        else {\n            ({ filtering, wrapping, bustCache } = { ...bustCacheOrOptions });\n        }\n        this._resource = new Resource(pathOrBase64, 'blob', bustCache);\n        this.filtering = filtering !== null && filtering !== void 0 ? filtering : this.filtering;\n        if (typeof wrapping === 'string') {\n            this.wrapping = {\n                x: wrapping,\n                y: wrapping\n            };\n        }\n        else {\n            this.wrapping = wrapping !== null && wrapping !== void 0 ? wrapping : this.wrapping;\n        }\n        if (pathOrBase64.endsWith('.gif')) {\n            this._logger.warn(`Use the ex.Gif type to load gifs, you may have mixed results with ${pathOrBase64} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`);\n        }\n    }\n    /**\n     * Create an ImageSource from and HTML <image> tag element\n     * @param image\n     */\n    static fromHtmlImageElement(image, options) {\n        const imageSource = new ImageSource('');\n        imageSource._src = 'image-element';\n        imageSource.data = image;\n        imageSource.data.setAttribute('data-original-src', 'image-element');\n        if (options === null || options === void 0 ? void 0 : options.filtering) {\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, options === null || options === void 0 ? void 0 : options.filtering);\n        }\n        else {\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, ImageFiltering.Blended);\n        }\n        if (options === null || options === void 0 ? void 0 : options.wrapping) {\n            let wrapping;\n            if (typeof options.wrapping === 'string') {\n                wrapping = {\n                    x: options.wrapping,\n                    y: options.wrapping\n                };\n            }\n            else {\n                wrapping = {\n                    x: options.wrapping.x,\n                    y: options.wrapping.y\n                };\n            }\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, wrapping.x);\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, wrapping.y);\n        }\n        else {\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, ImageWrapping.Clamp);\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, ImageWrapping.Clamp);\n        }\n        TextureLoader.checkImageSizeSupportedAndLog(image);\n        imageSource._readyFuture.resolve(image);\n        return imageSource;\n    }\n    static fromHtmlCanvasElement(image, options) {\n        const imageSource = new ImageSource('');\n        imageSource._src = 'canvas-element-blob';\n        imageSource.data.setAttribute('data-original-src', 'canvas-element-blob');\n        if (options === null || options === void 0 ? void 0 : options.filtering) {\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, options === null || options === void 0 ? void 0 : options.filtering);\n        }\n        else {\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, ImageFiltering.Blended);\n        }\n        if (options === null || options === void 0 ? void 0 : options.wrapping) {\n            let wrapping;\n            if (typeof options.wrapping === 'string') {\n                wrapping = {\n                    x: options.wrapping,\n                    y: options.wrapping\n                };\n            }\n            else {\n                wrapping = {\n                    x: options.wrapping.x,\n                    y: options.wrapping.y\n                };\n            }\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, wrapping.x);\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, wrapping.y);\n        }\n        else {\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, ImageWrapping.Clamp);\n            imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, ImageWrapping.Clamp);\n        }\n        TextureLoader.checkImageSizeSupportedAndLog(image);\n        image.toBlob((blob) => {\n            // TODO throw? if blob null?\n            const url = URL.createObjectURL(blob);\n            imageSource.image.onload = () => {\n                // no longer need to read the blob so it's revoked\n                URL.revokeObjectURL(url);\n                imageSource.data = imageSource.image;\n                imageSource._readyFuture.resolve(imageSource.image);\n            };\n            imageSource.image.src = url;\n        });\n        return imageSource;\n    }\n    static fromSvgString(svgSource, options) {\n        const blob = new Blob([svgSource], { type: 'image/svg+xml' });\n        const url = URL.createObjectURL(blob);\n        return new ImageSource(url, options);\n    }\n    /**\n     * Should excalibur add a cache busting querystring? By default false.\n     * Must be set before loading\n     */\n    get bustCache() {\n        return this._resource.bustCache;\n    }\n    set bustCache(val) {\n        this._resource.bustCache = val;\n    }\n    /**\n     * Begins loading the image and returns a promise that resolves when the image is loaded\n     */\n    async load() {\n        var _a, _b, _c, _d;\n        if (this.isLoaded()) {\n            return this.data;\n        }\n        try {\n            // Load base64 or blob if needed\n            let url;\n            if (!this.path.includes('data:image/')) {\n                const blob = await this._resource.load();\n                url = URL.createObjectURL(blob);\n            }\n            else {\n                url = this.path;\n            }\n            // Decode the image\n            const image = new Image();\n            // Use Image.onload over Image.decode()\n            // https://bugs.chromium.org/p/chromium/issues/detail?id=1055828#c7\n            // Otherwise chrome will throw still Image.decode() failures for large textures\n            const loadedFuture = new Future();\n            image.onload = () => loadedFuture.resolve();\n            image.src = url;\n            image.setAttribute('data-original-src', this.path);\n            await loadedFuture.promise;\n            // Set results\n            // We defer loading the texture into webgl until the first draw that way we avoid a singleton\n            // and for the multi-engine case the texture needs to be created in EACH webgl context to work\n            // See image-renderer.ts draw()\n            this.data = image;\n            // emit warning if potentially too big\n            TextureLoader.checkImageSizeSupportedAndLog(this.data);\n        }\n        catch (error) {\n            throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\n        }\n        // Do a bad thing to pass the filtering as an attribute\n        this.data.setAttribute(ImageSourceAttributeConstants.Filtering, this.filtering); // TODO fix type\n        this.data.setAttribute(ImageSourceAttributeConstants.WrappingX, (_b = (_a = this.wrapping) === null || _a === void 0 ? void 0 : _a.x) !== null && _b !== void 0 ? _b : ImageWrapping.Clamp);\n        this.data.setAttribute(ImageSourceAttributeConstants.WrappingY, (_d = (_c = this.wrapping) === null || _c === void 0 ? void 0 : _c.y) !== null && _d !== void 0 ? _d : ImageWrapping.Clamp);\n        // todo emit complete\n        this._readyFuture.resolve(this.data);\n        return this.data;\n    }\n    /**\n     * Build a sprite from this ImageSource\n     */\n    toSprite(options) {\n        return Sprite.from(this, options);\n    }\n    /**\n     * Unload images from memory\n     */\n    unload() {\n        this.data = new Image();\n    }\n}\n\n;// ./Graphics/SpriteFont.ts\n\n\n\n\nclass SpriteFont extends Graphic {\n    constructor(options) {\n        super(options);\n        this._text = '';\n        this.alphabet = '';\n        this.shadow = undefined;\n        this.caseInsensitive = false;\n        this.spacing = 0;\n        this.lineHeight = undefined;\n        this._logger = Logger.getInstance();\n        const { alphabet, spriteSheet, caseInsensitive, spacing, shadow, lineHeight } = options;\n        this.alphabet = alphabet;\n        this.spriteSheet = spriteSheet;\n        this.caseInsensitive = caseInsensitive !== null && caseInsensitive !== void 0 ? caseInsensitive : this.caseInsensitive;\n        this.spacing = spacing !== null && spacing !== void 0 ? spacing : this.spacing;\n        this.shadow = shadow !== null && shadow !== void 0 ? shadow : this.shadow;\n        this.lineHeight = lineHeight !== null && lineHeight !== void 0 ? lineHeight : this.lineHeight;\n    }\n    _getCharacterSprites(text) {\n        const results = [];\n        // handle case insensitive\n        const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\n        const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\n        // for each letter in text\n        for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\n            // find the sprite index in alphabet , if there is an error pick the first\n            const letter = textToRender[letterIndex];\n            let spriteIndex = alphabet.indexOf(letter);\n            if (spriteIndex === -1) {\n                spriteIndex = 0;\n                this._logger.warnOnce(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\n                this._logger.warnOnce('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n            }\n            const letterSprite = this.spriteSheet.sprites[spriteIndex];\n            if (letterSprite) {\n                results.push(letterSprite);\n            }\n            else {\n                this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\n                this._logger.warnOnce('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n            }\n        }\n        return results;\n    }\n    measureText(text, maxWidth) {\n        const lines = this._getLinesFromText(text, maxWidth);\n        const maxWidthLine = lines.reduce((a, b) => {\n            return a.length > b.length ? a : b;\n        });\n        const sprites = this._getCharacterSprites(maxWidthLine);\n        let width = 0;\n        let height = 0;\n        for (const sprite of sprites) {\n            width += sprite.width + this.spacing;\n            height = Math.max(height, sprite.height);\n        }\n        return BoundingBox.fromDimension(width * this.scale.x, height * lines.length * this.scale.y, Vector.Zero);\n    }\n    _drawImage(ex, x, y, maxWidth) {\n        var _a;\n        let xCursor = 0;\n        let yCursor = 0;\n        let height = 0;\n        const lines = this._getLinesFromText(this._text, maxWidth);\n        for (const line of lines) {\n            for (const sprite of this._getCharacterSprites(line)) {\n                // draw it in the right spot and increase the cursor by sprite width\n                sprite.draw(ex, x + xCursor, y + yCursor);\n                xCursor += sprite.width + this.spacing;\n                height = Math.max(height, sprite.height);\n            }\n            xCursor = 0;\n            yCursor += (_a = this.lineHeight) !== null && _a !== void 0 ? _a : height;\n        }\n    }\n    render(ex, text, _color, x, y, maxWidth) {\n        // SpriteFont doesn't support _color, yet...\n        this._text = text;\n        const bounds = this.measureText(text, maxWidth);\n        this.width = bounds.width;\n        this.height = bounds.height;\n        if (this.shadow) {\n            ex.save();\n            ex.translate(this.shadow.offset.x, this.shadow.offset.y);\n            this._preDraw(ex, x, y);\n            this._drawImage(ex, 0, 0, maxWidth);\n            this._postDraw(ex);\n            ex.restore();\n        }\n        this._preDraw(ex, x, y);\n        this._drawImage(ex, 0, 0, maxWidth);\n        this._postDraw(ex);\n    }\n    clone() {\n        return new SpriteFont({\n            alphabet: this.alphabet,\n            spriteSheet: this.spriteSheet,\n            spacing: this.spacing\n        });\n    }\n    _getLinesFromText(text, maxWidth) {\n        var _a;\n        if (this._cachedText === text && this._cachedRenderWidth === maxWidth && ((_a = this._cachedLines) === null || _a === void 0 ? void 0 : _a.length)) {\n            return this._cachedLines;\n        }\n        const lines = text.split('\\n');\n        if (maxWidth == null) {\n            return lines;\n        }\n        // If the current line goes past the maxWidth, append a new line without modifying the underlying text.\n        for (let i = 0; i < lines.length; i++) {\n            let line = lines[i];\n            let newLine = '';\n            // Note: we subtract the spacing to counter the initial padding on the left side.\n            if (this.measureText(line).width > maxWidth) {\n                while (this.measureText(line).width > maxWidth) {\n                    newLine = line[line.length - 1] + newLine;\n                    line = line.slice(0, -1); // Remove last character from line\n                }\n                // Update the array with our new values\n                lines[i] = line;\n                lines[i + 1] = newLine;\n            }\n        }\n        this._cachedText = text;\n        this._cachedLines = lines;\n        this._cachedRenderWidth = maxWidth;\n        return lines;\n    }\n}\n\n;// ./Graphics/SpriteSheet.ts\n\n/**\n * Represents a collection of sprites from a source image with some organization in a grid\n */\nclass SpriteSheet {\n    /**\n     * Build a new sprite sheet from a list of sprites\n     *\n     * Use {@apilink SpriteSheet.fromImageSource} to create a SpriteSheet from an {@apilink ImageSource} organized in a grid\n     * @param options\n     */\n    constructor(options) {\n        this.sprites = [];\n        const { sprites, rows, columns } = options;\n        this.sprites = sprites;\n        this.rows = rows !== null && rows !== void 0 ? rows : 1;\n        this.columns = columns !== null && columns !== void 0 ? columns : this.sprites.length;\n    }\n    /**\n     * Find a sprite by their x/y integer coordinates in the SpriteSheet, for example `getSprite(0, 0)` is the {@apilink Sprite} in the top-left\n     * and `getSprite(1, 0)` is the sprite one to the right.\n     * @param x\n     * @param y\n     */\n    getSprite(x, y, options) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        if (x >= this.columns || x < 0) {\n            throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\n        }\n        if (y >= this.rows || y < 0) {\n            throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\n        }\n        const spriteIndex = x + y * this.columns;\n        const sprite = this.sprites[spriteIndex];\n        if (sprite) {\n            if (options) {\n                const spriteWithOptions = sprite.clone();\n                spriteWithOptions.flipHorizontal = (_a = options.flipHorizontal) !== null && _a !== void 0 ? _a : spriteWithOptions.flipHorizontal;\n                spriteWithOptions.flipVertical = (_b = options.flipVertical) !== null && _b !== void 0 ? _b : spriteWithOptions.flipVertical;\n                spriteWithOptions.width = (_c = options.width) !== null && _c !== void 0 ? _c : spriteWithOptions.width;\n                spriteWithOptions.height = (_d = options.height) !== null && _d !== void 0 ? _d : spriteWithOptions.height;\n                spriteWithOptions.rotation = (_e = options.rotation) !== null && _e !== void 0 ? _e : spriteWithOptions.rotation;\n                spriteWithOptions.scale = (_f = options.scale) !== null && _f !== void 0 ? _f : spriteWithOptions.scale;\n                spriteWithOptions.opacity = (_g = options.opacity) !== null && _g !== void 0 ? _g : spriteWithOptions.opacity;\n                spriteWithOptions.tint = (_h = options.tint) !== null && _h !== void 0 ? _h : spriteWithOptions.tint;\n                spriteWithOptions.origin = (_j = options.origin) !== null && _j !== void 0 ? _j : spriteWithOptions.origin;\n                return spriteWithOptions;\n            }\n            return sprite;\n        }\n        throw Error(`Invalid sprite coordinates (${x}, ${y}`);\n    }\n    /**\n     * Create a sprite sheet from a sparse set of {@apilink SourceView} rectangles\n     * @param options\n     */\n    static fromImageSourceWithSourceViews(options) {\n        const sprites = options.sourceViews.map((sourceView) => {\n            return new Sprite({\n                image: options.image,\n                sourceView\n            });\n        });\n        return new SpriteSheet({ sprites });\n    }\n    /**\n     * Create a SpriteSheet from an {@apilink ImageSource} organized in a grid\n     *\n     * Example:\n     * ```\n     * const spriteSheet = SpriteSheet.fromImageSource({\n     *   image: imageSource,\n     *   grid: {\n     *     rows: 5,\n     *     columns: 2,\n     *     spriteWidth: 32, // pixels\n     *     spriteHeight: 32 // pixels\n     *   },\n     *   // Optionally specify spacing\n     *   spacing: {\n     *     // pixels from the top left to start the sprite parsing\n     *     originOffset: {\n     *       x: 5,\n     *       y: 5\n     *     },\n     *     // pixels between each sprite while parsing\n     *     margin: {\n     *       x: 1,\n     *       y: 1\n     *     }\n     *   }\n     * })\n     * ```\n     * @param options\n     */\n    static fromImageSource(options) {\n        var _a;\n        const sprites = [];\n        options.spacing = (_a = options.spacing) !== null && _a !== void 0 ? _a : {};\n        const { image, grid: { rows, columns: cols, spriteWidth, spriteHeight }, spacing: { originOffset, margin } } = options;\n        const offsetDefaults = { x: 0, y: 0, ...originOffset };\n        const marginDefaults = { x: 0, y: 0, ...margin };\n        for (let x = 0; x < cols; x++) {\n            for (let y = 0; y < rows; y++) {\n                sprites[x + y * cols] = new Sprite({\n                    image: image,\n                    sourceView: {\n                        x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\n                        y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\n                        width: spriteWidth,\n                        height: spriteHeight\n                    },\n                    destSize: { height: spriteHeight, width: spriteWidth }\n                });\n            }\n        }\n        return new SpriteSheet({\n            sprites: sprites,\n            rows: rows,\n            columns: cols\n        });\n    }\n    clone() {\n        return new SpriteSheet({\n            sprites: this.sprites.map((sprite) => sprite.clone()),\n            rows: this.rows,\n            columns: this.columns\n        });\n    }\n}\n\n;// ./Graphics/Context/debug-font.png\n/* harmony default export */ const debug_font = (\"data:image/png;base64,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\");\n;// ./Graphics/Context/debug-text.ts\n\n\n\n\n/**\n * Internal debug text helper\n */\nclass DebugText {\n    constructor() {\n        /**\n         * base64 font\n         */\n        this.fontSheet = debug_font;\n        this.size = 16;\n        // We fire and forget, we don't care if it's loaded or not\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.load();\n    }\n    load() {\n        this._imageSource = new ImageSource(this.fontSheet);\n        return this._imageSource.load().then(() => {\n            this._spriteSheet = SpriteSheet.fromImageSource({\n                image: this._imageSource,\n                grid: {\n                    rows: 4,\n                    columns: 16,\n                    spriteWidth: 16,\n                    spriteHeight: 16\n                }\n            });\n            this._spriteFont = new SpriteFont({\n                alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+# ',\n                caseInsensitive: true,\n                spriteSheet: this._spriteSheet,\n                spacing: -6\n            });\n        });\n    }\n    /**\n     * Writes debug text using the built in sprint font\n     * @param ctx\n     * @param text\n     * @param pos\n     */\n    write(ctx, text, pos) {\n        if (this._imageSource.isLoaded()) {\n            this._spriteFont.render(ctx, text, null, pos.x, pos.y);\n        }\n    }\n}\n\n;// ./Graphics/Context/render-source.ts\nclass RenderSource {\n    constructor(_gl, _texture) {\n        this._gl = _gl;\n        this._texture = _texture;\n    }\n    use() {\n        const gl = this._gl;\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\n    }\n    disable() {\n        const gl = this._gl;\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n}\n\n;// ./Graphics/Context/render-target.ts\n\nclass RenderTarget {\n    constructor(options) {\n        var _a, _b;\n        this.antialias = false;\n        this.samples = 1;\n        this._gl = options.gl;\n        this.width = options.width;\n        this.height = options.height;\n        this.transparency = options.transparency;\n        this.antialias = (_a = options.antialias) !== null && _a !== void 0 ? _a : this.antialias;\n        this.samples = (_b = options.samples) !== null && _b !== void 0 ? _b : this._gl.getParameter(this._gl.MAX_SAMPLES);\n        const gl = this._gl;\n        // Determine current context format for blitting later needs to match\n        if (gl.drawingBufferFormat) {\n            this.bufferFormat = gl.drawingBufferFormat;\n        }\n        else {\n            // Documented in webgl spec\n            // https://registry.khronos.org/webgl/specs/latest/1.0/\n            if (this.transparency) {\n                this.bufferFormat = gl.RGBA8;\n            }\n            else {\n                this.bufferFormat = gl.RGB8;\n            }\n        }\n        this._setupRenderBuffer();\n        this._setupFramebuffer();\n    }\n    setResolution(width, height) {\n        const gl = this._gl;\n        this.width = width;\n        this.height = height;\n        // update backing texture size\n        gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        // update render buffer size\n        if (this._renderBuffer) {\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this._renderBuffer);\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, Math.min(this.samples, gl.getParameter(gl.MAX_SAMPLES)), this.bufferFormat, this.width, this.height);\n        }\n    }\n    get renderBuffer() {\n        return this._renderBuffer;\n    }\n    get renderFrameBuffer() {\n        return this._renderFrameBuffer;\n    }\n    get frameBuffer() {\n        return this._frameBuffer;\n    }\n    get frameTexture() {\n        return this._frameTexture;\n    }\n    _setupRenderBuffer() {\n        if (this.antialias) {\n            const gl = this._gl;\n            // Render buffers can be used as an input to a shader\n            this._renderBuffer = gl.createRenderbuffer();\n            this._renderFrameBuffer = gl.createFramebuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this._renderBuffer);\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, Math.min(this.samples, gl.getParameter(gl.MAX_SAMPLES)), this.bufferFormat, this.width, this.height);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this._renderFrameBuffer);\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.RENDERBUFFER, this._renderBuffer);\n        }\n    }\n    _setupFramebuffer() {\n        // Allocates frame buffer\n        const gl = this._gl;\n        this._frameTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        // set the filtering so we don't need mips\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        // attach the texture as the first color attachment\n        const attachmentPoint = gl.COLOR_ATTACHMENT0;\n        // After this bind all draw calls will draw to this framebuffer texture\n        this._frameBuffer = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\n        // Reset after initialized\n        this.disable();\n    }\n    toRenderSource() {\n        if (this.renderBuffer) {\n            this.blitRenderBufferToFrameBuffer();\n        }\n        const source = new RenderSource(this._gl, this._frameTexture);\n        return source;\n    }\n    blitToScreen() {\n        const gl = this._gl;\n        // set to size of canvas's drawingBuffer\n        if (this._renderBuffer) {\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.renderFrameBuffer);\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n            gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\n            gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\n        }\n        else {\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.frameBuffer);\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n            gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\n            gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\n        }\n    }\n    blitRenderBufferToFrameBuffer() {\n        if (this._renderBuffer) {\n            const gl = this._gl;\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.renderFrameBuffer);\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, this.frameBuffer);\n            gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\n            gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\n        }\n    }\n    copyToTexture(texture) {\n        const gl = this._gl;\n        if (this._renderBuffer) {\n            this.blitRenderBufferToFrameBuffer();\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 0, 0, this.width, this.height, 0);\n    }\n    /**\n     * When called, all drawing gets redirected to this render target\n     */\n    use() {\n        const gl = this._gl;\n        if (this.antialias) {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this._renderFrameBuffer);\n        }\n        else {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n        }\n        // very important to set the viewport to the size of the framebuffer texture\n        gl.viewport(0, 0, this.width, this.height);\n    }\n    /**\n     * When called, all drawing is sent back to the canvas\n     */\n    disable() {\n        const gl = this._gl;\n        // passing null switches rendering back to the canvas\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n}\n\n;// ./Graphics/Context/line-renderer/line-vertex.glsl\n/* harmony default export */ const line_vertex = (\"#version 300 es\\nin vec2 a_position;\\nin vec4 a_color;\\n\\nout lowp vec4 v_color;\\n\\nuniform mat4 u_matrix;\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Passthrough the color\\n   v_color = a_color;\\n}\");\n;// ./Graphics/Context/line-renderer/line-fragment.glsl\n/* harmony default export */ const line_fragment = (\"#version 300 es\\nprecision mediump float;\\n\\n// Color\\nin lowp vec4 v_color;\\n\\nout vec4 fragColor;\\n\\nvoid main() {\\n  fragColor = v_color;\\n}\");\n;// ./Graphics/Context/webgl-util.ts\n/**\n * Return the size of the GlType in bytes\n * @param gl\n * @param type\n */\nfunction getGlTypeSizeBytes(gl, type) {\n    switch (type) {\n        case gl.INT:\n        case gl.UNSIGNED_INT:\n        case gl.FLOAT:\n            return 4;\n        case gl.SHORT:\n            return 2;\n        case gl.UNSIGNED_SHORT:\n            return 2;\n        case gl.BYTE:\n            return 1;\n        case gl.UNSIGNED_BYTE:\n            return 1;\n        default:\n            return 1;\n    }\n}\n/**\n * Checks if an attribute is present in vertex source\n */\nfunction isAttributeInSource(source, variable) {\n    const attributeRegexTemplate = `(?<type>[a-z0-9]+)\\\\s+${variable};`;\n    const regex = new RegExp(attributeRegexTemplate, 'g');\n    const matches = regex.exec(source);\n    return (matches === null || matches === void 0 ? void 0 : matches.length) > 0;\n}\n/**\n * Attempt to discern the glType of an attribute from vertex source\n * @param gl\n * @param source\n * @param variable\n */\nfunction getGLTypeFromSource(gl, source, variable) {\n    var _a;\n    const attributeRegexTemplate = `(?<type>[a-z0-9]+)\\\\s+${variable};`;\n    const regex = new RegExp(attributeRegexTemplate, 'g');\n    const matches = regex.exec(source);\n    const type = (_a = matches === null || matches === void 0 ? void 0 : matches.groups) === null || _a === void 0 ? void 0 : _a.type;\n    switch (type) {\n        case 'float':\n        case 'vec2':\n        case 'vec3':\n        case 'vec4':\n            return gl.FLOAT;\n        case 'int':\n        case 'ivec2':\n        case 'ivec3':\n        case 'ivec4':\n            return gl.INT;\n        case 'uint':\n        case 'uvec2':\n        case 'uvec3':\n        case 'uvec4':\n            return gl.UNSIGNED_INT;\n        case 'bool':\n        case 'bvec2':\n        case 'bvec3':\n        case 'bvec4':\n            return gl.BOOL;\n        case 'short':\n            return gl.SHORT;\n        case 'ushort':\n            return gl.UNSIGNED_SHORT;\n        case 'ubyte':\n            return gl.UNSIGNED_BYTE;\n        case 'byte':\n            return gl.BYTE;\n        default:\n            return gl.FLOAT;\n    }\n}\n/**\n * Based on the type return the number of attribute components\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n * @param gl\n * @param type\n */\nfunction getAttributeComponentSize(gl, type) {\n    switch (type) {\n        case gl.LOW_FLOAT:\n        case gl.HIGH_FLOAT:\n        case gl.FLOAT:\n            return 1;\n        case gl.FLOAT_VEC2:\n            return 2;\n        case gl.FLOAT_VEC3:\n            return 3;\n        case gl.FLOAT_VEC4:\n            return 4;\n        case gl.BYTE:\n            return 1;\n        case gl.UNSIGNED_BYTE:\n            return 1;\n        case gl.UNSIGNED_SHORT:\n        case gl.SHORT:\n            return 1;\n        default:\n            return 1;\n    }\n}\n/**\n * Based on the attribute return the corresponding supported attrib pointer type\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n * @param gl\n * @param type\n */\nfunction getAttributePointerType(gl, type) {\n    switch (type) {\n        case gl.LOW_FLOAT:\n        case gl.HIGH_FLOAT:\n        case gl.FLOAT:\n        case gl.FLOAT_VEC2:\n        case gl.FLOAT_VEC3:\n        case gl.FLOAT_VEC4:\n            return gl.FLOAT;\n        case gl.BYTE:\n            return gl.BYTE;\n        case gl.UNSIGNED_BYTE:\n            return gl.UNSIGNED_BYTE;\n        case gl.SHORT:\n            return gl.SHORT;\n        case gl.UNSIGNED_SHORT:\n            return gl.UNSIGNED_SHORT;\n        default:\n            return gl.FLOAT;\n    }\n}\n/**\n *\n */\nfunction getMaxShaderComplexity(gl, numIfs) {\n    const assembleTestShader = (numIfs) => {\n        const testShader = `#version 300 es\n    precision mediump float;\n    out vec4 fragColor;\n    void main() {\n      float index = 1.01;\n      %%complexity%%\n    }`;\n        let testComplexity = '';\n        for (let i = 0; i < numIfs; i++) {\n            if (i === 0) {\n                testComplexity += `if (index <= ${i}.5) {\\n`;\n            }\n            else {\n                testComplexity += `   else if (index <= ${i}.5) {\\n`;\n            }\n            testComplexity += `      fragColor = vec4(1.0);\\n`;\n            testComplexity += `   }\\n`;\n        }\n        return testShader.replace('%%complexity%%', testComplexity);\n    };\n    let canCompile = false;\n    do {\n        const test = assembleTestShader(numIfs);\n        const shader = gl.createShader(gl.FRAGMENT_SHADER);\n        gl.shaderSource(shader, test);\n        gl.compileShader(shader);\n        canCompile = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n        if (!canCompile) {\n            numIfs = (numIfs / 2) | 0;\n        }\n    } while (!canCompile);\n    return numIfs;\n}\n\n;// ./Graphics/Context/shader.ts\n\n\nclass Shader {\n    get compiled() {\n        return this._compiled;\n    }\n    /**\n     * Create a shader program in excalibur\n     * @param options specify shader vertex and fragment source\n     */\n    constructor(options) {\n        this._logger = Logger.getInstance();\n        this.uniforms = {};\n        this.attributes = {};\n        this._compiled = false;\n        const { gl, vertexSource, fragmentSource, onPreLink, onPostCompile } = options;\n        this._gl = gl;\n        this.vertexSource = vertexSource;\n        this.fragmentSource = fragmentSource;\n        this._onPreLink = onPreLink;\n        this._onPostCompile = onPostCompile;\n    }\n    dispose() {\n        const gl = this._gl;\n        gl.deleteProgram(this.program);\n        this._gl = null;\n    }\n    /**\n     * Binds the shader program\n     */\n    use() {\n        const gl = this._gl;\n        gl.useProgram(this.program);\n        Shader._ACTIVE_SHADER_INSTANCE = this;\n    }\n    isCurrentlyBound() {\n        return Shader._ACTIVE_SHADER_INSTANCE === this;\n    }\n    /**\n     * Compile the current shader against a webgl context\n     */\n    compile() {\n        const gl = this._gl;\n        const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\n        const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\n        this.program = this._createProgram(gl, vertexShader, fragmentShader);\n        const attributes = this.getAttributes();\n        for (const attribute of attributes) {\n            this.attributes[attribute.name] = attribute;\n        }\n        const uniforms = this.getUniforms();\n        for (const uniform of uniforms) {\n            this.uniforms[uniform.name] = uniform;\n        }\n        this._compiled = true;\n        if (this._onPostCompile) {\n            this._onPostCompile(this);\n        }\n        return this.program;\n    }\n    getUniforms() {\n        const gl = this._gl;\n        const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n        const uniforms = [];\n        for (let i = 0; i < uniformCount; i++) {\n            const uniform = gl.getActiveUniform(this.program, i);\n            const uniformLocation = gl.getUniformLocation(this.program, uniform.name);\n            uniforms.push({\n                name: uniform.name,\n                glType: uniform.type,\n                location: uniformLocation\n            });\n        }\n        return uniforms;\n    }\n    getAttributes() {\n        const gl = this._gl;\n        const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\n        const attributes = [];\n        for (let i = 0; i < attributeCount; i++) {\n            const attribute = gl.getActiveAttrib(this.program, i);\n            const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\n            attributes.push({\n                name: attribute.name,\n                glType: getAttributePointerType(gl, attribute.type),\n                size: getAttributeComponentSize(gl, attribute.type),\n                location: attributeLocation,\n                normalized: false\n            });\n        }\n        return attributes;\n    }\n    /**\n     * Set a texture in a gpu texture slot\n     * @param slotNumber\n     * @param texture\n     */\n    setTexture(slotNumber, texture) {\n        const gl = this._gl;\n        gl.activeTexture(gl.TEXTURE0 + slotNumber);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n    }\n    /**\n     * Set an integer uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformInt(name, value) {\n        this.setUniform('uniform1i', name, ~~value);\n    }\n    /**\n     * Set an integer uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformInt(name, value) {\n        return this.trySetUniform('uniform1i', name, ~~value);\n    }\n    /**\n     * Set an integer array uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformIntArray(name, value) {\n        this.setUniform('uniform1iv', name, value);\n    }\n    /**\n     * Set an integer array uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformIntArray(name, value) {\n        return this.trySetUniform('uniform1iv', name, value);\n    }\n    /**\n     * Set a boolean uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformBoolean(name, value) {\n        this.setUniform('uniform1i', name, value ? 1 : 0);\n    }\n    /**\n     * Set a boolean uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformBoolean(name, value) {\n        return this.trySetUniform('uniform1i', name, value ? 1 : 0);\n    }\n    /**\n     * Set a float uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformFloat(name, value) {\n        this.setUniform('uniform1f', name, value);\n    }\n    /**\n     * Set a float uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformFloat(name, value) {\n        return this.trySetUniform('uniform1f', name, value);\n    }\n    /**\n     * Set a float array uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformFloatArray(name, value) {\n        this.setUniform('uniform1fv', name, value);\n    }\n    /**\n     * Set a float array uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformFloatArray(name, value) {\n        return this.trySetUniform('uniform1fv', name, value);\n    }\n    /**\n     * Set a {@apilink Vector} uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformFloatVector(name, value) {\n        this.setUniform('uniform2f', name, value.x, value.y);\n    }\n    /**\n     * Set a {@apilink Vector} uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformFloatVector(name, value) {\n        return this.trySetUniform('uniform2f', name, value.x, value.y);\n    }\n    /**\n     * Set a {@apilink Color} uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformFloatColor(name, value) {\n        this.setUniform('uniform4f', name, value.r / 255, value.g / 255, value.b / 255, value.a);\n    }\n    /**\n     * Set a {@apilink Color} uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformFloatColor(name, value) {\n        return this.trySetUniform('uniform4f', name, value.r / 255, value.g / 255, value.b / 255, value.a);\n    }\n    /**\n     * Set an {@apilink Matrix} uniform for the current shader\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    setUniformMatrix(name, value) {\n        this.setUniform('uniformMatrix4fv', name, false, value.data);\n    }\n    setUniformAffineMatrix(name, value) {\n        this.setUniform('uniformMatrix4fv', name, false, [\n            value.data[0],\n            value.data[1],\n            0,\n            0,\n            value.data[2],\n            value.data[3],\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n            value.data[4],\n            value.data[5],\n            0,\n            1\n        ]);\n    }\n    /**\n     * Set an {@apilink Matrix} uniform for the current shader, WILL NOT THROW on error.\n     *\n     * **Important** Must call ex.Shader.use() before setting a uniform!\n     * @param name\n     * @param value\n     */\n    trySetUniformMatrix(name, value) {\n        return this.trySetUniform('uniformMatrix4fv', name, false, value.data);\n    }\n    /**\n     * Set any available uniform type in webgl\n     *\n     * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\n     */\n    setUniform(uniformType, name, ...value) {\n        if (!this._compiled) {\n            throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\n        }\n        if (!this.isCurrentlyBound()) {\n            throw Error('Currently accessed shader instance is not the current active shader in WebGL,' +\n                ' must call `shader.use()` before setting uniforms');\n        }\n        const gl = this._gl;\n        const location = gl.getUniformLocation(this.program, name);\n        if (location) {\n            const args = [location, ...value];\n            this._gl[uniformType].apply(this._gl, args);\n        }\n        else {\n            throw Error(`Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,` +\n                ' unused uniforms are optimized away by most browsers');\n        }\n    }\n    /**\n     * Set any available uniform type in webgl. Will try to set the uniform, will return false if the uniform didn't exist,\n     * true if it was set.\n     *\n     * WILL NOT THROW on error\n     *\n     * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\n     *\n     */\n    trySetUniform(uniformType, name, ...value) {\n        if (!this._compiled) {\n            this._logger.warn(`Must compile shader before setting a uniform ${uniformType}:${name}`);\n            return false;\n        }\n        if (!this.isCurrentlyBound()) {\n            this._logger.warn('Currently accessed shader instance is not the current active shader in WebGL,' +\n                ' must call `shader.use()` before setting uniforms');\n            return false;\n        }\n        const gl = this._gl;\n        const location = gl.getUniformLocation(this.program, name);\n        if (location) {\n            const args = [location, ...value];\n            this._gl[uniformType].apply(this._gl, args);\n        }\n        else {\n            return false;\n        }\n        return true;\n    }\n    _createProgram(gl, vertexShader, fragmentShader) {\n        const program = gl.createProgram();\n        if (program === null) {\n            throw Error('Could not create graphics shader program');\n        }\n        // attach the shaders.\n        gl.attachShader(program, vertexShader);\n        gl.attachShader(program, fragmentShader);\n        if (this._onPreLink) {\n            this._onPreLink(program);\n        }\n        // link the program.\n        gl.linkProgram(program);\n        const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n        if (!success) {\n            throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\n        }\n        return program;\n    }\n    _compileShader(gl, source, type) {\n        const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\n        const shader = gl.createShader(type);\n        if (shader === null) {\n            throw Error(`Could not build shader: [${source}]`);\n        }\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n        const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n        if (!success) {\n            const errorInfo = gl.getShaderInfoLog(shader);\n            throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo)}`);\n        }\n        return shader;\n    }\n    _processSourceForError(source, errorInfo) {\n        if (!source) {\n            return errorInfo;\n        }\n        const lines = source.split('\\n');\n        const errorLineStart = errorInfo.search(/\\d:\\d/);\n        const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\n        const [_, error2] = errorInfo\n            .slice(errorLineStart, errorLineEnd)\n            .split(':')\n            .map((v) => Number(v));\n        for (let i = 0; i < lines.length; i++) {\n            lines[i] = `${i + 1}: ${lines[i]}${error2 === i + 1 ? ' <----- ERROR!' : ''}`;\n        }\n        return '\\n\\nSource:\\n' + lines.join('\\n');\n    }\n}\nShader._ACTIVE_SHADER_INSTANCE = null;\n\n;// ./Graphics/Context/vertex-buffer.ts\n/**\n * Helper around vertex buffer to simplify creating and uploading geometry\n *\n * Under the hood uses Float32Array\n */\nclass VertexBuffer {\n    constructor(options) {\n        /**\n         * If the vertices never change switching 'static' can be more efficient on the gpu\n         *\n         * Default is 'dynamic'\n         */\n        this.type = 'dynamic';\n        const { gl, size, type, data } = options;\n        this._gl = gl;\n        this.buffer = this._gl.createBuffer();\n        if (!data && !size) {\n            throw Error('Must either provide data or a size to the VertexBuffer');\n        }\n        if (!data) {\n            this.bufferData = new Float32Array(size);\n        }\n        else {\n            this.bufferData = data;\n        }\n        this.type = type !== null && type !== void 0 ? type : this.type;\n        // Allocate buffer\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\n    }\n    /**\n     * Bind this vertex buffer\n     */\n    bind() {\n        const gl = this._gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n    }\n    unbind() {\n        const gl = this._gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    }\n    /**\n     * Upload vertex buffer geometry to the GPU\n     */\n    upload(count) {\n        const gl = this._gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n        if (count) {\n            gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.bufferData, 0, count);\n        }\n        else {\n            // TODO always use bufferSubData? need to perf test it\n            gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\n        }\n    }\n    dispose() {\n        const gl = this._gl;\n        gl.deleteBuffer(this.buffer);\n        this._gl = null;\n    }\n}\n\n;// ./Graphics/Context/vertex-layout.ts\n\n\n/**\n * Helper around creating vertex attributes in a given {@apilink VertexBuffer}, this is useful for describing\n * the memory layout for your vertices inside a particular buffer\n *\n * Note: This helper assumes interleaved attributes in one {@apilink VertexBuffer}, not many.\n *\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\n */\nclass VertexLayout {\n    get vertexBuffer() {\n        return this._vertexBuffer;\n    }\n    get attributes() {\n        return this._attributes;\n    }\n    constructor(options) {\n        this._logger = Logger.getInstance();\n        this._suppressWarnings = false;\n        this._layout = [];\n        this._attributes = [];\n        this._vertexTotalSizeBytes = 0;\n        this._initialized = false;\n        const { gl, shader, vertexBuffer, attributes, suppressWarnings } = options;\n        this._gl = gl;\n        this._vertexBuffer = vertexBuffer;\n        this._attributes = attributes;\n        this._shader = shader;\n        this._suppressWarnings = suppressWarnings;\n        if (shader) {\n            this.initialize();\n        }\n    }\n    /**\n     * Total number of bytes that the vertex will take up\n     */\n    get totalVertexSizeBytes() {\n        return this._vertexTotalSizeBytes;\n    }\n    set shader(shader) {\n        if (shader && this._shader !== shader) {\n            this._shader = shader;\n            this.initialize();\n        }\n    }\n    get shader() {\n        return this._shader;\n    }\n    /**\n     * Layouts need shader locations and must be bound to a shader\n     */\n    initialize() {\n        if (this._initialized) {\n            return;\n        }\n        if (!this._shader) {\n            return;\n        }\n        if (!this._shader.compiled) {\n            throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\n        }\n        this._vertexTotalSizeBytes = 0;\n        this._layout.length = 0;\n        const shaderAttributes = this._shader.attributes;\n        for (const attribute of this._attributes) {\n            const attrib = shaderAttributes[attribute[0]];\n            if (!attrib) {\n                if (!isAttributeInSource(this._shader.vertexSource, attribute[0])) {\n                    throw Error(`The attribute named: ${attribute[0]} size ${attribute[1]}` +\n                        ` not found in the shader source code:\\n ${this._shader.vertexSource}`);\n                }\n                if (!this._suppressWarnings) {\n                    this._logger.warn(`The attribute named: ${attribute[0]} size ${attribute[1]}` +\n                        ` not found in the compiled shader. This is possibly a bug:\\n` +\n                        ` 1. Not a bug, but should remove unused code - attribute \"${attribute[0]}\" is unused in` +\n                        ` vertex/fragment and has been automatically removed by glsl compiler.\\n` +\n                        ` 2. Definitely a bug, attribute \"${attribute[0]}\" in layout has been mistyped or is missing` +\n                        ` in shader, check vertex/fragment source.`);\n                }\n                const glType = getGLTypeFromSource(this._gl, this._shader.vertexSource, attribute[0]);\n                // Unused attribute placeholder\n                this._layout.push({\n                    name: attribute[0],\n                    glType,\n                    size: attribute[1],\n                    location: -1,\n                    normalized: false\n                });\n            }\n            if (attrib) {\n                if (attrib.size !== attribute[1]) {\n                    throw Error(`VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],` +\n                        ` doesn\\'t match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`);\n                }\n                this._layout.push(attrib);\n            }\n        }\n        // calc size\n        let componentsPerVertex = 0;\n        for (const vertAttribute of this._layout) {\n            const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\n            this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\n            componentsPerVertex += vertAttribute.size;\n        }\n        if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\n            this._logger.warn(`The vertex component size (${componentsPerVertex})  does NOT divide evenly into the specified vertex buffer` +\n                ` (${this._vertexBuffer.bufferData.length})`);\n        }\n        // create VAO\n        const gl = this._gl;\n        this._vao = gl.createVertexArray();\n        gl.bindVertexArray(this._vao);\n        this._vertexBuffer.bind();\n        let offset = 0;\n        for (const vert of this._layout) {\n            // skip unused attributes\n            if (vert.location !== -1) {\n                if (vert.glType === gl.INT) {\n                    gl.vertexAttribIPointer(vert.location, vert.size, vert.glType, this.totalVertexSizeBytes, offset);\n                }\n                else {\n                    gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\n                }\n                gl.enableVertexAttribArray(vert.location);\n            }\n            offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\n        }\n        gl.bindVertexArray(null);\n        this._vertexBuffer.unbind();\n        this._initialized = true;\n    }\n    /**\n     * Bind this layout with it's associated vertex buffer\n     * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\n     */\n    use(uploadBuffer = false, count) {\n        if (!this._shader) {\n            throw Error('No shader is associated with this vertex layout, a shader must be set');\n        }\n        const gl = this._gl;\n        if (!this._shader.isCurrentlyBound()) {\n            throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\n        }\n        this._vertexBuffer.bind();\n        if (uploadBuffer) {\n            this._vertexBuffer.upload(count);\n        }\n        gl.bindVertexArray(this._vao);\n    }\n}\n\n;// ./Graphics/GraphicsDiagnostics.ts\nclass GraphicsDiagnostics {\n    static clear() {\n        GraphicsDiagnostics.DrawCallCount = 0;\n        GraphicsDiagnostics.DrawnImagesCount = 0;\n    }\n}\nGraphicsDiagnostics.DrawCallCount = 0;\nGraphicsDiagnostics.DrawnImagesCount = 0;\n\n;// ./Graphics/Context/line-renderer/line-renderer.ts\n\n\n\n\n\nclass LineRenderer {\n    constructor() {\n        this.type = 'ex.line';\n        this.priority = 0;\n        this._maxLines = 10922;\n        this._vertexIndex = 0;\n        this._lineCount = 0;\n        this._startScratch = vec(0, 0);\n        this._endScratch = vec(0, 0);\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        this._shader = new Shader({\n            gl,\n            vertexSource: line_vertex,\n            fragmentSource: line_fragment\n        });\n        this._shader.compile();\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        this._vertexBuffer = new VertexBuffer({\n            gl,\n            size: 6 * 2 * this._maxLines,\n            type: 'dynamic'\n        });\n        this._layout = new VertexLayout({\n            gl,\n            vertexBuffer: this._vertexBuffer,\n            shader: this._shader,\n            attributes: [\n                ['a_position', 2],\n                ['a_color', 4]\n            ]\n        });\n    }\n    dispose() {\n        this._vertexBuffer.dispose();\n        this._shader.dispose();\n        this._context = null;\n        this._gl = null;\n    }\n    draw(start, end, color) {\n        // Force a render if the batch is full\n        if (this._isFull()) {\n            this.flush();\n        }\n        this._lineCount++;\n        const transform = this._context.getTransform();\n        const finalStart = transform.multiply(start, this._startScratch);\n        const finalEnd = transform.multiply(end, this._endScratch);\n        const vertexBuffer = this._vertexBuffer.bufferData;\n        // Start\n        vertexBuffer[this._vertexIndex++] = finalStart.x;\n        vertexBuffer[this._vertexIndex++] = finalStart.y;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        // End\n        vertexBuffer[this._vertexIndex++] = finalEnd.x;\n        vertexBuffer[this._vertexIndex++] = finalEnd.y;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n    }\n    _isFull() {\n        if (this._lineCount >= this._maxLines) {\n            return true;\n        }\n        return false;\n    }\n    hasPendingDraws() {\n        return this._lineCount !== 0;\n    }\n    flush() {\n        // nothing to draw early exit\n        if (this._lineCount === 0) {\n            return;\n        }\n        const gl = this._gl;\n        this._shader.use();\n        this._layout.use(true);\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\n        GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\n        GraphicsDiagnostics.DrawCallCount++;\n        // reset\n        this._vertexIndex = 0;\n        this._lineCount = 0;\n    }\n}\n\n;// ./Graphics/Context/point-renderer/point-vertex.glsl\n/* harmony default export */ const point_vertex = (\"#version 300 es\\nin vec2 a_position;\\nin vec4 a_color;\\nin float a_size;\\nout lowp vec4 v_color;\\nuniform mat4 u_matrix;\\n\\nvoid main() {\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n  gl_PointSize = a_size * 2.0;\\n  v_color = a_color;\\n}\");\n;// ./Graphics/Context/point-renderer/point-fragment.glsl\n/* harmony default export */ const point_fragment = (\"#version 300 es\\n\\nprecision mediump float;\\nin lowp vec4 v_color;\\n\\nout vec4 fragColor;\\n\\nvoid main() {\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\n  r = dot(cxy, cxy);\\n\\n  delta = fwidth(r);\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\n  // \\\"premultiply\\\" the color by alpha\\n  vec4 color = v_color;\\n  color.a = color.a * alpha;\\n  color.rgb = color.rgb * color.a;\\n  fragColor = color;\\n}\");\n;// ./Graphics/Context/point-renderer/point-renderer.ts\n\n\n\n\n\n\n\nclass PointRenderer {\n    constructor() {\n        this.type = 'ex.point';\n        this.priority = 0;\n        this._maxPoints = 10922;\n        this._pointCount = 0;\n        this._vertexIndex = 0;\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        this._shader = new Shader({\n            gl,\n            vertexSource: point_vertex,\n            fragmentSource: point_fragment\n        });\n        this._shader.compile();\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        this._buffer = new VertexBuffer({\n            gl,\n            size: 7 * this._maxPoints,\n            type: 'dynamic'\n        });\n        this._layout = new VertexLayout({\n            gl,\n            shader: this._shader,\n            vertexBuffer: this._buffer,\n            attributes: [\n                ['a_position', 2],\n                ['a_color', 4],\n                ['a_size', 1]\n            ]\n        });\n    }\n    dispose() {\n        this._buffer.dispose();\n        this._shader.dispose();\n        this._context = null;\n        this._gl = null;\n    }\n    draw(point, color, size) {\n        // Force a render if the batch is full\n        if (this._isFull()) {\n            this.flush();\n        }\n        this._pointCount++;\n        const transform = this._context.getTransform();\n        const opacity = this._context.opacity;\n        const snapToPixel = this._context.snapToPixel;\n        const finalPoint = transform.multiply(point);\n        if (snapToPixel) {\n            finalPoint.x = ~~(finalPoint.x + pixelSnapEpsilon);\n            finalPoint.y = ~~(finalPoint.y + pixelSnapEpsilon);\n        }\n        const vertexBuffer = this._buffer.bufferData;\n        vertexBuffer[this._vertexIndex++] = finalPoint.x;\n        vertexBuffer[this._vertexIndex++] = finalPoint.y;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a * opacity;\n        vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\n    }\n    _isFull() {\n        if (this._pointCount >= this._maxPoints) {\n            return true;\n        }\n        return false;\n    }\n    hasPendingDraws() {\n        return this._pointCount !== 0;\n    }\n    flush() {\n        // nothing to draw early exit\n        if (this._pointCount === 0) {\n            return;\n        }\n        const gl = this._gl;\n        this._shader.use();\n        this._layout.use(true);\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        gl.drawArrays(gl.POINTS, 0, this._pointCount);\n        GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\n        GraphicsDiagnostics.DrawCallCount++;\n        this._pointCount = 0;\n        this._vertexIndex = 0;\n    }\n}\n\n;// ./Graphics/Context/screen-pass-painter/screen-vertex.glsl\n/* harmony default export */ const screen_vertex = (\"#version 300 es\\nin vec2 a_position;\\n\\nin vec2 a_texcoord;\\nout vec2 v_texcoord;\\n\\nvoid main() {\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\n\\n  // Pass the texcoord to the fragment shader.\\n  v_texcoord = a_texcoord;\\n}\");\n;// ./Graphics/Context/screen-pass-painter/screen-fragment.glsl\n/* harmony default export */ const screen_fragment = (\"#version 300 es\\nprecision mediump float;\\n\\n// Passed in from the vertex shader.\\nin vec2 v_texcoord;\\n\\n// The texture.\\nuniform sampler2D u_texture;\\n\\nout vec4 fragColor;\\n\\nvoid main() {\\n   fragColor = texture(u_texture, v_texcoord);\\n}\");\n;// ./Graphics/Context/screen-pass-painter/screen-pass-painter.ts\n\n\n\n\n\n/**\n * This is responsible for painting the entire screen during the render passes\n */\nclass ScreenPassPainter {\n    constructor(gl) {\n        this._gl = gl;\n        this._shader = new Shader({\n            gl,\n            vertexSource: screen_vertex,\n            fragmentSource: screen_fragment\n        });\n        this._shader.compile();\n        // Setup memory layout\n        this._buffer = new VertexBuffer({\n            gl,\n            type: 'static',\n            // clip space quad + uv since we don't need a camera\n            data: new Float32Array([\n                -1, -1, 0, 0, -1, 1, 0, 1, 1, -1, 1, 0,\n                1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1\n            ])\n        });\n        this._layout = new VertexLayout({\n            gl,\n            shader: this._shader,\n            vertexBuffer: this._buffer,\n            attributes: [\n                ['a_position', 2],\n                ['a_texcoord', 2]\n            ]\n        });\n        this._buffer.upload();\n    }\n    renderWithPostProcessor(postprocessor) {\n        const gl = this._gl;\n        postprocessor.getShader().use();\n        postprocessor.getLayout().use();\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n    renderToScreen() {\n        const gl = this._gl;\n        this._shader.use();\n        this._layout.use();\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n}\n\n;// ./Graphics/Context/quad-index-buffer.ts\n\n/**\n * Helper that defines and index buffer for quad geometry\n *\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\n * it is almost always worth it in terms of performance to use an index buffer.\n */\nclass QuadIndexBuffer {\n    /**\n     * @param gl WebGL2RenderingContext this layout will be attached to, these cannot be reused across contexts.\n     * @param numberOfQuads Specify the max number of quads you want to draw\n     * @param useUint16 Optionally force a uint16 buffer\n     */\n    constructor(gl, numberOfQuads, useUint16) {\n        this._logger = Logger.getInstance();\n        this._gl = gl;\n        this.buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n        const totalVertices = numberOfQuads * 6;\n        if (!useUint16) {\n            this.bufferData = new Uint32Array(totalVertices);\n        }\n        else {\n            // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\n            const maxUint16 = 65535;\n            const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\n            this.bufferGlType = gl.UNSIGNED_SHORT;\n            this.bufferData = new Uint16Array(totalVertices);\n            // TODO Should we error if this happens?? maybe not might crash mid game\n            if (numberOfQuads > maxUint16Index) {\n                this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`);\n            }\n        }\n        let currentQuad = 0;\n        for (let i = 0; i < totalVertices; i += 6) {\n            // first triangle\n            this.bufferData[i + 0] = currentQuad + 0;\n            this.bufferData[i + 1] = currentQuad + 1;\n            this.bufferData[i + 2] = currentQuad + 2;\n            // second triangle\n            this.bufferData[i + 3] = currentQuad + 2;\n            this.bufferData[i + 4] = currentQuad + 1;\n            this.bufferData[i + 5] = currentQuad + 3;\n            currentQuad += 4;\n        }\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n    }\n    get size() {\n        return this.bufferData.length;\n    }\n    /**\n     * Upload data to the GPU\n     */\n    upload() {\n        const gl = this._gl;\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n    }\n    /**\n     * Bind this index buffer\n     */\n    bind() {\n        const gl = this._gl;\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n    }\n    dispose() {\n        const gl = this._gl;\n        gl.deleteBuffer(this.buffer);\n        this._gl = null;\n    }\n}\n\n;// ./Graphics/Context/image-renderer/image-renderer.frag.glsl\n/* harmony default export */ const image_renderer_frag = (\"#version 300 es\\nprecision mediump float;\\n\\n// UV coord\\nin vec2 v_texcoord;\\n\\n// Texture index\\nin lowp float v_textureIndex;\\n\\n// Textures in the current draw\\nuniform sampler2D u_textures[%%count%%];\\n\\nuniform bool u_pixelart;\\n\\n// Opacity\\nin float v_opacity;\\n\\nin vec4 v_tint;\\n\\nin vec2 v_res;\\n\\nout vec4 fragColor;\\n\\n// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\\nvec2 uv_iq(in vec2 uv, in vec2 texture_size) {\\n  vec2 pixel = uv * texture_size;\\n  \\n  vec2 seam=floor(pixel+.5);\\n  vec2 dudv=fwidth(pixel);\\n  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\\n  \\n  return pixel/texture_size;\\n}\\n\\nvoid main(){\\n  // In order to support the most efficient sprite batching, we have multiple\\n  // textures loaded into the gpu (usually 8) this picker logic skips over textures\\n  // that do not apply to a particular sprite.\\n  \\n  vec4 color=vec4(1.,0,0,1.);\\n  \\n  // GLSL is templated out to pick the right texture and set the vec4 color\\n  %%texture_picker%%\\n  \\n  color.rgb=color.rgb*v_opacity;\\n  color.a=color.a*v_opacity;\\n  fragColor=color*v_tint;\\n}\");\n;// ./Graphics/Context/image-renderer/image-renderer.vert.glsl\n/* harmony default export */ const image_renderer_vert = (\"#version 300 es\\nin vec2 a_position;\\n\\n// Opacity\\nin float a_opacity;\\nout float v_opacity;\\n\\n// UV coordinate\\nin vec2 a_texcoord;\\nout vec2 v_texcoord;\\n\\n// Texture res\\nin vec2 a_res;\\nout vec2 v_res;\\n\\n// Texture number\\nin lowp float a_textureIndex;\\nout lowp float v_textureIndex;\\n\\nin vec4 a_tint;\\nout vec4 v_tint;\\n\\nuniform mat4 u_matrix;\\n\\nvoid main(){\\n  // Set the vertex position using the ortho transform matrix\\n  gl_Position=u_matrix*vec4(a_position,0.,1.);\\n  \\n  // Pass through the Opacity to the fragment shader\\n  v_opacity=a_opacity;\\n  // Pass through the UV coord to the fragment shader\\n  v_texcoord=a_texcoord;\\n\\n  v_res = a_res;\\n\\n  // Pass through the texture number to the fragment shader\\n  v_textureIndex=a_textureIndex;\\n  // Pass through the tint\\n  v_tint=a_tint;\\n}\");\n;// ./Graphics/Context/image-renderer/image-renderer.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nclass ImageRenderer {\n    constructor(options) {\n        this.type = 'ex.image';\n        this.priority = 0;\n        this._maxImages = 10922; // max(uint16) / 6 verts\n        this._maxTextures = 0;\n        // Per flush vars\n        this._imageCount = 0;\n        this._textures = [];\n        this._textureIndex = 0;\n        this._textureToIndex = new Map();\n        this._images = new Set();\n        this._vertexIndex = 0;\n        this._imageToWidth = new Map();\n        this._imageToHeight = new Map();\n        this._view = [0, 0, 0, 0];\n        this._dest = [0, 0];\n        this._quad = [0, 0, 0, 0, 0, 0, 0, 0];\n        this._defaultTint = Color.White;\n        this.pixelArtSampler = options.pixelArtSampler;\n        this.uvPadding = options.uvPadding;\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        // Transform shader source\n        // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\n        const maxTexture = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n        const maxComplexity = getMaxShaderComplexity(gl, maxTexture);\n        this._maxTextures = Math.min(maxTexture, maxComplexity);\n        const transformedFrag = this._transformFragmentSource(image_renderer_frag, this._maxTextures);\n        // Compile shader\n        this._shader = new Shader({\n            gl,\n            fragmentSource: transformedFrag,\n            vertexSource: image_renderer_vert\n        });\n        this._shader.compile();\n        // setup uniforms\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', context.ortho);\n        // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\n        this._shader.setUniformIntArray('u_textures', [...Array(this._maxTextures)].map((_, i) => i));\n        // Setup memory layout\n        this._buffer = new VertexBuffer({\n            gl,\n            size: 12 * 4 * this._maxImages, // 12 components * 4 verts\n            type: 'dynamic'\n        });\n        this._layout = new VertexLayout({\n            gl,\n            shader: this._shader,\n            vertexBuffer: this._buffer,\n            attributes: [\n                ['a_position', 2],\n                ['a_opacity', 1],\n                ['a_res', 2],\n                ['a_texcoord', 2],\n                ['a_textureIndex', 1],\n                ['a_tint', 4]\n            ]\n        });\n        // Setup index buffer\n        this._quads = new QuadIndexBuffer(gl, this._maxImages, true);\n    }\n    dispose() {\n        this._buffer.dispose();\n        this._quads.dispose();\n        this._shader.dispose();\n        this._textures.length = 0;\n        this._context = null;\n        this._gl = null;\n    }\n    _transformFragmentSource(source, maxTextures) {\n        let newSource = source.replace('%%count%%', maxTextures.toString());\n        let texturePickerBuilder = '';\n        for (let i = 0; i < maxTextures; i++) {\n            if (i === 0) {\n                texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\n            }\n            else {\n                texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\n            }\n            texturePickerBuilder += `      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;\\n`;\n            texturePickerBuilder += `      color = texture(u_textures[${i}], uv);\\n`;\n            texturePickerBuilder += `   }\\n`;\n        }\n        newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\n        return newSource;\n    }\n    _addImageAsTexture(image) {\n        if (this._images.has(image)) {\n            return;\n        }\n        const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\n        const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\n        const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX));\n        const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY));\n        const force = image.getAttribute('forceUpload') === 'true' ? true : false;\n        const texture = this._context.textureLoader.load(image, {\n            filtering,\n            wrapping: { x: wrapX, y: wrapY }\n        }, force);\n        // remove force attribute after upload\n        image.removeAttribute('forceUpload');\n        if (this._textures.indexOf(texture) === -1) {\n            this._textures.push(texture);\n            this._textureToIndex.set(texture, this._textureIndex++);\n            this._images.add(image);\n        }\n    }\n    _bindTextures(gl) {\n        // Bind textures in the correct order\n        for (let i = 0; i < this._maxTextures; i++) {\n            gl.activeTexture(gl.TEXTURE0 + i);\n            gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\n        }\n    }\n    _getTextureIdForImage(image) {\n        var _a;\n        if (image) {\n            const maybeTexture = this._context.textureLoader.get(image);\n            return (_a = this._textureToIndex.get(maybeTexture)) !== null && _a !== void 0 ? _a : -1; //this._textures.indexOf(maybeTexture);\n        }\n        return -1;\n    }\n    _isFull() {\n        if (this._imageCount >= this._maxImages) {\n            return true;\n        }\n        if (this._textures.length >= this._maxTextures) {\n            return true;\n        }\n        return false;\n    }\n    _getImageWidth(image) {\n        let maybeWidth = this._imageToWidth.get(image);\n        if (maybeWidth === undefined) {\n            maybeWidth = image.width;\n            this._imageToWidth.set(image, maybeWidth);\n        }\n        return maybeWidth;\n    }\n    _getImageHeight(image) {\n        let maybeHeight = this._imageToHeight.get(image);\n        if (maybeHeight === undefined) {\n            maybeHeight = image.height;\n            this._imageToHeight.set(image, maybeHeight);\n        }\n        return maybeHeight;\n    }\n    draw(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight) {\n        var _a, _b, _c, _d;\n        // Force a render if the batch is full\n        if (this._isFull()) {\n            this.flush();\n        }\n        this._imageCount++;\n        // This creates and uploads the texture if not already done\n        this._addImageAsTexture(image);\n        const maybeImageWidth = this._getImageWidth(image);\n        const maybeImageHeight = this._getImageHeight(image);\n        let width = maybeImageWidth || swidth || 0;\n        let height = maybeImageHeight || sheight || 0;\n        this._view[0] = 0;\n        this._view[1] = 0;\n        this._view[2] = (_a = swidth !== null && swidth !== void 0 ? swidth : maybeImageWidth) !== null && _a !== void 0 ? _a : 0;\n        this._view[3] = (_b = sheight !== null && sheight !== void 0 ? sheight : maybeImageHeight) !== null && _b !== void 0 ? _b : 0;\n        this._dest[0] = sx !== null && sx !== void 0 ? sx : 1;\n        this._dest[1] = sy !== null && sy !== void 0 ? sy : 1;\n        // If destination is specified, update view and dest\n        if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\n            this._view[0] = sx !== null && sx !== void 0 ? sx : 1;\n            this._view[1] = sy !== null && sy !== void 0 ? sy : 1;\n            this._view[2] = (_c = swidth !== null && swidth !== void 0 ? swidth : maybeImageWidth) !== null && _c !== void 0 ? _c : 0;\n            this._view[3] = (_d = sheight !== null && sheight !== void 0 ? sheight : maybeImageHeight) !== null && _d !== void 0 ? _d : 0;\n            this._dest[0] = dx;\n            this._dest[1] = dy;\n            width = dwidth;\n            height = dheight;\n        }\n        sx = this._view[0];\n        sy = this._view[1];\n        const sw = this._view[2];\n        const sh = this._view[3];\n        // transform based on current context\n        const transform = this._context.getTransform();\n        const opacity = this._context.opacity;\n        const snapToPixel = this._context.snapToPixel;\n        // top left\n        this._quad[0] = this._dest[0];\n        this._quad[1] = this._dest[1];\n        // top right\n        this._quad[2] = this._dest[0] + width;\n        this._quad[3] = this._dest[1];\n        // bottom left\n        this._quad[4] = this._dest[0];\n        this._quad[5] = this._dest[1] + height;\n        // bottom right\n        this._quad[6] = this._dest[0] + width;\n        this._quad[7] = this._dest[1] + height;\n        transform.multiplyQuadInPlace(this._quad);\n        if (snapToPixel) {\n            this._quad[0] = ~~(this._quad[0] + sign(this._quad[0]) * pixelSnapEpsilon);\n            this._quad[1] = ~~(this._quad[1] + sign(this._quad[1]) * pixelSnapEpsilon);\n            this._quad[2] = ~~(this._quad[2] + sign(this._quad[2]) * pixelSnapEpsilon);\n            this._quad[3] = ~~(this._quad[3] + sign(this._quad[3]) * pixelSnapEpsilon);\n            this._quad[4] = ~~(this._quad[4] + sign(this._quad[4]) * pixelSnapEpsilon);\n            this._quad[5] = ~~(this._quad[5] + sign(this._quad[5]) * pixelSnapEpsilon);\n            this._quad[6] = ~~(this._quad[6] + sign(this._quad[6]) * pixelSnapEpsilon);\n            this._quad[7] = ~~(this._quad[7] + sign(this._quad[7]) * pixelSnapEpsilon);\n        }\n        const tint = this._context.tint || this._defaultTint;\n        const textureId = this._getTextureIdForImage(image);\n        const imageWidth = maybeImageWidth || width;\n        const imageHeight = maybeImageHeight || height;\n        const uvx0 = (sx + this.uvPadding) / imageWidth;\n        const uvy0 = (sy + this.uvPadding) / imageHeight;\n        const uvx1 = (sx + sw - this.uvPadding) / imageWidth;\n        const uvy1 = (sy + sh - this.uvPadding) / imageHeight;\n        const txWidth = maybeImageWidth;\n        const txHeight = maybeImageHeight;\n        // update data\n        const vertexBuffer = this._layout.vertexBuffer.bufferData;\n        // (0, 0) - 0\n        vertexBuffer[this._vertexIndex++] = this._quad[0];\n        vertexBuffer[this._vertexIndex++] = this._quad[1];\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = txWidth;\n        vertexBuffer[this._vertexIndex++] = txHeight;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = textureId;\n        vertexBuffer[this._vertexIndex++] = tint.r / 255;\n        vertexBuffer[this._vertexIndex++] = tint.g / 255;\n        vertexBuffer[this._vertexIndex++] = tint.b / 255;\n        vertexBuffer[this._vertexIndex++] = tint.a;\n        // (0, 1) - 1\n        vertexBuffer[this._vertexIndex++] = this._quad[4];\n        vertexBuffer[this._vertexIndex++] = this._quad[5];\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = txWidth;\n        vertexBuffer[this._vertexIndex++] = txHeight;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = textureId;\n        vertexBuffer[this._vertexIndex++] = tint.r / 255;\n        vertexBuffer[this._vertexIndex++] = tint.g / 255;\n        vertexBuffer[this._vertexIndex++] = tint.b / 255;\n        vertexBuffer[this._vertexIndex++] = tint.a;\n        // (1, 0) - 2\n        vertexBuffer[this._vertexIndex++] = this._quad[2];\n        vertexBuffer[this._vertexIndex++] = this._quad[3];\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = txWidth;\n        vertexBuffer[this._vertexIndex++] = txHeight;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = textureId;\n        vertexBuffer[this._vertexIndex++] = tint.r / 255;\n        vertexBuffer[this._vertexIndex++] = tint.g / 255;\n        vertexBuffer[this._vertexIndex++] = tint.b / 255;\n        vertexBuffer[this._vertexIndex++] = tint.a;\n        // (1, 1) - 3\n        vertexBuffer[this._vertexIndex++] = this._quad[6];\n        vertexBuffer[this._vertexIndex++] = this._quad[7];\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = txWidth;\n        vertexBuffer[this._vertexIndex++] = txHeight;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = textureId;\n        vertexBuffer[this._vertexIndex++] = tint.r / 255;\n        vertexBuffer[this._vertexIndex++] = tint.g / 255;\n        vertexBuffer[this._vertexIndex++] = tint.b / 255;\n        vertexBuffer[this._vertexIndex++] = tint.a;\n    }\n    hasPendingDraws() {\n        return this._imageCount !== 0;\n    }\n    flush() {\n        // nothing to draw early exit\n        if (this._imageCount === 0) {\n            return;\n        }\n        const gl = this._gl;\n        // Bind the shader\n        this._shader.use();\n        // Bind the memory layout and upload data\n        this._layout.use(true, 4 * 12 * this._imageCount); // 4 verts * 12 components\n        // Update ortho matrix uniform\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        // Turn on pixel art aa sampler\n        this._shader.setUniformBoolean('u_pixelart', this.pixelArtSampler);\n        // Bind textures to\n        this._bindTextures(gl);\n        // Bind index buffer\n        this._quads.bind();\n        // Draw all the quads\n        gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\n        GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\n        GraphicsDiagnostics.DrawCallCount++;\n        // Reset\n        this._imageCount = 0;\n        this._vertexIndex = 0;\n        this._textures.length = 0;\n        this._textureIndex = 0;\n        this._textureToIndex.clear();\n        this._images.clear();\n        this._imageToWidth.clear();\n        this._imageToHeight.clear();\n    }\n}\n\n;// ./Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl\n/* harmony default export */ const rectangle_renderer_frag = (\"#version 300 es\\n\\nprecision mediump float;\\n\\n// UV coord\\nin vec2 v_uv;\\n\\nin vec2 v_size; // in pixels\\n\\n// Color coord to blend with image\\nin lowp vec4 v_color;\\n\\n// Stroke color if used\\nin lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nin lowp float v_strokeThickness; // in pixels\\n\\n// Opacity\\nin float v_opacity;\\n\\nout vec4 fragColor;\\n\\nvoid main() {\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\n    vec2 uv = v_uv;\\n    vec2 fragCoord = uv * v_size;\\n    float maxX = v_size.x - v_strokeThickness;\\n    float minX = v_strokeThickness;\\n    float maxY = v_size.y - v_strokeThickness;\\n    float minY = v_strokeThickness;\\n\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\n      fragColor = v_color;\\n    } else {\\n      fragColor = v_strokeColor;\\n    }\\n    fragColor.a *= v_opacity;\\n    fragColor.rgb *= fragColor.a;\\n\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\n\\n    // float fHalfBorderDist      = 0.0;\\n    // float fHalfBorderThickness = 0.0;\\n\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else\\n    // {\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\n        \\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\n            \\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\n    // }\\n\\n    // vec4 v4FromColor = v_strokeColor;\\n    // v4FromColor.rgb *= v4FromColor.a;\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\n    // if (fHalfBorderDist < 0.0) {\\n    //     v4ToColor = v_color;\\n    //     v4ToColor.rgb *= v4ToColor.a;\\n    // }\\n\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\n\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\n    // gl_FragColor = finalColor;\\n}\");\n;// ./Graphics/Context/rectangle-renderer/rectangle-renderer.vert.glsl\n/* harmony default export */ const rectangle_renderer_vert = (\"#version 300 es\\nin vec2 a_position;\\n\\n// UV coordinate\\nin vec2 a_uv;\\nout vec2 v_uv;\\n\\nin vec2 a_size;\\nout vec2 v_size;\\n\\n// Opacity \\nin float a_opacity;\\nout float v_opacity;\\n\\nin vec4 a_color;\\nout vec4 v_color;\\n\\nin vec4 a_strokeColor;\\nout vec4 v_strokeColor;\\n\\nin float a_strokeThickness;\\nout float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through size\\n   v_size = a_size;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\");\n;// ./Graphics/Context/rectangle-renderer/rectangle-renderer.ts\n\n\n\n\n\n\n\n\n\n\nclass RectangleRenderer {\n    constructor() {\n        this.type = 'ex.rectangle';\n        this.priority = 0;\n        this._maxRectangles = 10922; // max(uint16) / 6 verts\n        this._rectangleCount = 0;\n        this._vertexIndex = 0;\n        this._transparent = Color.Transparent;\n        this._scratch1 = vec(0, 0);\n        this._scratch2 = vec(0, 0);\n        this._scratch3 = vec(0, 0);\n        this._scratch4 = vec(0, 0);\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\n        this._shader = new Shader({\n            gl,\n            fragmentSource: rectangle_renderer_frag,\n            vertexSource: rectangle_renderer_vert\n        });\n        this._shader.compile();\n        // setup uniforms\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', context.ortho);\n        this._buffer = new VertexBuffer({\n            gl,\n            size: 16 * 4 * this._maxRectangles,\n            type: 'dynamic'\n        });\n        this._layout = new VertexLayout({\n            gl,\n            shader: this._shader,\n            vertexBuffer: this._buffer,\n            attributes: [\n                ['a_position', 2],\n                ['a_uv', 2],\n                ['a_size', 2],\n                ['a_opacity', 1],\n                ['a_color', 4],\n                ['a_strokeColor', 4],\n                ['a_strokeThickness', 1]\n            ]\n        });\n        this._quads = new QuadIndexBuffer(gl, this._maxRectangles, true);\n    }\n    dispose() {\n        this._buffer.dispose();\n        this._quads.dispose();\n        this._shader.dispose();\n        this._context = null;\n        this._gl = null;\n    }\n    _isFull() {\n        if (this._rectangleCount >= this._maxRectangles) {\n            return true;\n        }\n        return false;\n    }\n    draw(...args) {\n        if (args[0] instanceof Vector && args[1] instanceof Vector) {\n            this.drawLine.apply(this, args);\n        }\n        else {\n            this.drawRectangle.apply(this, args);\n        }\n    }\n    drawLine(start, end, color, thickness = 1) {\n        if (this._isFull()) {\n            this.flush();\n        }\n        this._rectangleCount++;\n        // transform based on current context\n        const transform = this._context.getTransform();\n        const opacity = this._context.opacity;\n        const snapToPixel = this._context.snapToPixel;\n        const dir = end.sub(start);\n        const length = dir.magnitude;\n        const normal = dir.normalize().perpendicular();\n        const halfThick = thickness / 2;\n        /**\n         *    +---------------------^----------------------+\n         *    |                     | (normal)             |\n         *   (startX, startY)------------------>(endX, endY)\n         *    |                                            |\n         *    + -------------------------------------------+\n         */\n        const startTop = transform.multiply(normal.scale(halfThick, this._scratch1).add(start, this._scratch1), this._scratch1);\n        const startBottom = transform.multiply(normal.scale(-halfThick, this._scratch2).add(start, this._scratch2), this._scratch2);\n        const endTop = transform.multiply(normal.scale(halfThick, this._scratch3).add(end, this._scratch3), this._scratch3);\n        const endBottom = transform.multiply(normal.scale(-halfThick, this._scratch4).add(end, this._scratch4), this._scratch4);\n        if (snapToPixel) {\n            startTop.x = ~~(startTop.x + pixelSnapEpsilon);\n            startTop.y = ~~(startTop.y + pixelSnapEpsilon);\n            endTop.x = ~~(endTop.x + pixelSnapEpsilon);\n            endTop.y = ~~(endTop.y + pixelSnapEpsilon);\n            startBottom.x = ~~(startBottom.x + pixelSnapEpsilon);\n            startBottom.y = ~~(startBottom.y + pixelSnapEpsilon);\n            endBottom.x = ~~(endBottom.x + pixelSnapEpsilon);\n            endBottom.y = ~~(endBottom.y + pixelSnapEpsilon);\n        }\n        // TODO uv could be static vertex buffer\n        const uvx0 = 0;\n        const uvy0 = 0;\n        const uvx1 = 1;\n        const uvy1 = 1;\n        const stroke = this._transparent;\n        const strokeThickness = 0;\n        const width = 1;\n        // update data\n        const vertexBuffer = this._layout.vertexBuffer.bufferData;\n        // (0, 0) - 0\n        vertexBuffer[this._vertexIndex++] = startTop.x;\n        vertexBuffer[this._vertexIndex++] = startTop.y;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = length;\n        vertexBuffer[this._vertexIndex++] = thickness;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n        // (0, 1) - 1\n        vertexBuffer[this._vertexIndex++] = startBottom.x;\n        vertexBuffer[this._vertexIndex++] = startBottom.y;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = length;\n        vertexBuffer[this._vertexIndex++] = thickness;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n        // (1, 0) - 2\n        vertexBuffer[this._vertexIndex++] = endTop.x;\n        vertexBuffer[this._vertexIndex++] = endTop.y;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = length;\n        vertexBuffer[this._vertexIndex++] = thickness;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n        // (1, 1) - 3\n        vertexBuffer[this._vertexIndex++] = endBottom.x;\n        vertexBuffer[this._vertexIndex++] = endBottom.y;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = length;\n        vertexBuffer[this._vertexIndex++] = thickness;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n    }\n    drawRectangle(pos, width, height, color, stroke = Color.Transparent, strokeThickness = 0) {\n        if (this._isFull()) {\n            this.flush();\n        }\n        this._rectangleCount++;\n        // transform based on current context\n        const transform = this._context.getTransform();\n        const opacity = this._context.opacity;\n        const snapToPixel = this._context.snapToPixel;\n        const topLeft = transform.multiply(pos.add(vec(0, 0)));\n        const topRight = transform.multiply(pos.add(vec(width, 0)));\n        const bottomRight = transform.multiply(pos.add(vec(width, height)));\n        const bottomLeft = transform.multiply(pos.add(vec(0, height)));\n        if (snapToPixel) {\n            topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\n            topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\n            topRight.x = ~~(topRight.x + pixelSnapEpsilon);\n            topRight.y = ~~(topRight.y + pixelSnapEpsilon);\n            bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\n            bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\n            bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\n            bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\n        }\n        // TODO uv could be static vertex buffer\n        const uvx0 = 0;\n        const uvy0 = 0;\n        const uvx1 = 1;\n        const uvy1 = 1;\n        // update data\n        const vertexBuffer = this._layout.vertexBuffer.bufferData;\n        // (0, 0) - 0\n        vertexBuffer[this._vertexIndex++] = topLeft.x;\n        vertexBuffer[this._vertexIndex++] = topLeft.y;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = width;\n        vertexBuffer[this._vertexIndex++] = height;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness;\n        // (0, 1) - 1\n        vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n        vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = width;\n        vertexBuffer[this._vertexIndex++] = height;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness;\n        // (1, 0) - 2\n        vertexBuffer[this._vertexIndex++] = topRight.x;\n        vertexBuffer[this._vertexIndex++] = topRight.y;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = width;\n        vertexBuffer[this._vertexIndex++] = height;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness;\n        // (1, 1) - 3\n        vertexBuffer[this._vertexIndex++] = bottomRight.x;\n        vertexBuffer[this._vertexIndex++] = bottomRight.y;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = width;\n        vertexBuffer[this._vertexIndex++] = height;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness;\n    }\n    hasPendingDraws() {\n        return this._rectangleCount !== 0;\n    }\n    flush() {\n        // nothing to draw early exit\n        if (this._rectangleCount === 0) {\n            return;\n        }\n        const gl = this._gl;\n        // Bind the shader\n        this._shader.use();\n        // Bind the memory layout and upload data\n        this._layout.use(true);\n        // Update ortho matrix uniform\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        // Bind index buffer\n        this._quads.bind();\n        // Draw all the quads\n        gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\n        GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\n        GraphicsDiagnostics.DrawCallCount++;\n        // Reset\n        this._rectangleCount = 0;\n        this._vertexIndex = 0;\n    }\n}\n\n;// ./Graphics/Context/circle-renderer/circle-renderer.frag.glsl\n/* harmony default export */ const circle_renderer_frag = (\"#version 300 es\\nprecision highp float;\\n\\n// UV coord\\nin vec2 v_uv;\\n\\n// Color coord to blend with image\\nin lowp vec4 v_color;\\n\\n// Stroke color if used\\nin lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nin lowp float v_strokeThickness;\\n\\n// Opacity\\nin float v_opacity;\\n\\nout vec4 fragColor;\\n\\nvoid main() {\\n  // make (0, 0) the center the uv \\n  vec2 uv = v_uv * 2.0 - 1.0;\\n\\n  vec4 color = v_color;\\n  vec4 strokeColor = v_strokeColor;\\n\\n  // circle border is at radius 1.0 \\n  // dist is > 0 when inside the circle \\n  float d = length(uv);\\n  float dist = 1.0 - length(uv);\\n\\n  // Fade based on fwidth\\n  float fade = fwidth(dot(uv, uv));\\n\\n  // if dist is greater than 0 step to 1;\\n  // when we cross this 0 threshold add a smooth fade\\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\\n\\n  // if dist is greater than the stroke thickness step to 1\\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\\n\\n  strokeColor.a *= fill * stroke;\\n  strokeColor.rgb *= strokeColor.a;\\n\\n  color.a *= fill * (1.0 - stroke);\\n  color.rgb *= color.a;\\n\\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\\n  finalColor.rgb = finalColor.rgb * v_opacity;\\n  finalColor.a = finalColor.a * v_opacity;\\n  fragColor = finalColor;\\n}\");\n;// ./Graphics/Context/circle-renderer/circle-renderer.vert.glsl\n/* harmony default export */ const circle_renderer_vert = (\"#version 300 es\\nin vec2 a_position;\\n\\n// UV coordinate\\nin vec2 a_uv;\\nout vec2 v_uv;\\n\\n// Opacity \\nin float a_opacity;\\nout float v_opacity;\\n\\nin vec4 a_color;\\nout vec4 v_color;\\n\\nin vec4 a_strokeColor;\\nout vec4 v_strokeColor;\\n\\nin float a_strokeThickness;\\nout float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\");\n;// ./Graphics/Context/circle-renderer/circle-renderer.ts\n\n\n\n\n\n\n\n\n\n\nclass CircleRenderer {\n    constructor() {\n        this.type = 'ex.circle';\n        this.priority = 0;\n        this._maxCircles = 10922; // max(uint16) / 6 verts\n        this._circleCount = 0;\n        this._vertexIndex = 0;\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        this._shader = new Shader({\n            gl,\n            fragmentSource: circle_renderer_frag,\n            vertexSource: circle_renderer_vert\n        });\n        this._shader.compile();\n        // setup uniforms\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', context.ortho);\n        this._buffer = new VertexBuffer({\n            gl,\n            size: 14 * 4 * this._maxCircles,\n            type: 'dynamic'\n        });\n        this._layout = new VertexLayout({\n            gl,\n            shader: this._shader,\n            vertexBuffer: this._buffer,\n            attributes: [\n                ['a_position', 2],\n                ['a_uv', 2],\n                ['a_opacity', 1],\n                ['a_color', 4],\n                ['a_strokeColor', 4],\n                ['a_strokeThickness', 1]\n            ]\n        });\n        this._quads = new QuadIndexBuffer(gl, this._maxCircles, true);\n    }\n    dispose() {\n        this._buffer.dispose();\n        this._quads.dispose();\n        this._shader.dispose();\n        this._context = null;\n        this._gl = null;\n    }\n    _isFull() {\n        if (this._circleCount >= this._maxCircles) {\n            return true;\n        }\n        return false;\n    }\n    draw(pos, radius, color, stroke = Color.Transparent, strokeThickness = 0) {\n        if (this._isFull()) {\n            this.flush();\n        }\n        this._circleCount++;\n        // transform based on current context\n        const transform = this._context.getTransform();\n        const opacity = this._context.opacity;\n        const snapToPixel = this._context.snapToPixel;\n        const topLeft = transform.multiply(pos.add(vec(-radius, -radius)));\n        const topRight = transform.multiply(pos.add(vec(radius, -radius)));\n        const bottomRight = transform.multiply(pos.add(vec(radius, radius)));\n        const bottomLeft = transform.multiply(pos.add(vec(-radius, radius)));\n        if (snapToPixel) {\n            topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\n            topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\n            topRight.x = ~~(topRight.x + pixelSnapEpsilon);\n            topRight.y = ~~(topRight.y + pixelSnapEpsilon);\n            bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\n            bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\n            bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\n            bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\n        }\n        // TODO UV could be static vertex buffer\n        const uvx0 = 0;\n        const uvy0 = 0;\n        const uvx1 = 1;\n        const uvy1 = 1;\n        // update data\n        const vertexBuffer = this._layout.vertexBuffer.bufferData;\n        // (0, 0) - 0\n        vertexBuffer[this._vertexIndex++] = topLeft.x;\n        vertexBuffer[this._vertexIndex++] = topLeft.y;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n        // (0, 1) - 1\n        vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n        vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n        // (1, 0) - 2\n        vertexBuffer[this._vertexIndex++] = topRight.x;\n        vertexBuffer[this._vertexIndex++] = topRight.y;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n        // (1, 1) - 3\n        vertexBuffer[this._vertexIndex++] = bottomRight.x;\n        vertexBuffer[this._vertexIndex++] = bottomRight.y;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = color.r / 255;\n        vertexBuffer[this._vertexIndex++] = color.g / 255;\n        vertexBuffer[this._vertexIndex++] = color.b / 255;\n        vertexBuffer[this._vertexIndex++] = color.a;\n        vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n        vertexBuffer[this._vertexIndex++] = stroke.a;\n        vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n    }\n    hasPendingDraws() {\n        return this._circleCount !== 0;\n    }\n    flush() {\n        // nothing to draw early exit\n        if (this._circleCount === 0) {\n            return;\n        }\n        const gl = this._gl;\n        // Bind the shader\n        this._shader.use();\n        // Bind the memory layout and upload data\n        this._layout.use(true);\n        // Update ortho matrix uniform\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        // Bind index buffer\n        this._quads.bind();\n        // Draw all the quads\n        gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\n        GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\n        GraphicsDiagnostics.DrawCallCount++;\n        // Reset\n        this._circleCount = 0;\n        this._vertexIndex = 0;\n    }\n}\n\n;// ./Util/Pool.ts\n\nclass Pool {\n    constructor(builder, recycler, maxObjects = 100) {\n        this.builder = builder;\n        this.recycler = recycler;\n        this.maxObjects = maxObjects;\n        this.totalAllocations = 0;\n        this.index = 0;\n        this.objects = [];\n        this.disableWarnings = false;\n        this._logger = Logger.getInstance();\n    }\n    dispose() {\n        this.objects.length = 0;\n    }\n    preallocate() {\n        for (let i = 0; i < this.maxObjects; i++) {\n            this.objects[i] = this.builder();\n        }\n    }\n    /**\n     * Use many instances out of the in the context and return all to the pool.\n     *\n     * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\n     * @param context\n     */\n    using(context) {\n        const result = context(this);\n        if (result) {\n            return this.done(...result);\n        }\n        return this.done();\n    }\n    /**\n     * Use a single instance out of th pool and immediately return it to the pool\n     * @param context\n     */\n    borrow(context) {\n        const object = this.get();\n        context(object);\n        this.index--;\n    }\n    /**\n     * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\n     */\n    get() {\n        if (this.index === this.maxObjects) {\n            if (!this.disableWarnings) {\n                this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\n            }\n            this.maxObjects = this.maxObjects * 2;\n        }\n        if (this.objects[this.index]) {\n            // Pool has an available object already constructed\n            if (this.recycler) {\n                return this.recycler(this.objects[this.index++]);\n            }\n            return this.objects[this.index++];\n        }\n        else {\n            // New allocation\n            this.totalAllocations++;\n            const object = (this.objects[this.index++] = this.builder());\n            return object;\n        }\n    }\n    done(...objects) {\n        // All objects in pool now considered \"free\"\n        this.index = 0;\n        for (const object of objects) {\n            const poolIndex = this.objects.indexOf(object);\n            // Build a new object to take the pool place\n            this.objects[poolIndex] = this.builder();\n            this.totalAllocations++;\n        }\n        return objects;\n    }\n}\n\n;// ./Graphics/Context/draw-call.ts\n\n\nclass DrawCall {\n    constructor() {\n        this.z = 0;\n        this.priority = 0;\n        this.renderer = '';\n        this.transform = AffineMatrix.identity();\n        this.state = {\n            z: 0,\n            opacity: 1,\n            tint: Color.White,\n            material: null\n        };\n        this.args = new Array(10);\n    }\n}\n\n;// ./Graphics/Context/material.ts\n\n\n\n\n\n\nconst defaultVertexSource = `#version 300 es\nin vec2 a_position;\n\nin vec2 a_uv;\nout vec2 v_uv;\n\nin vec2 a_screenuv;\nout vec2 v_screenuv;\n\nuniform mat4 u_matrix;\nuniform mat4 u_transform;\n\nvoid main() {\n  // Set the vertex position using the ortho & transform matrix\n  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);\n\n  // Pass through the UV coord to the fragment shader\n  v_uv = a_uv;\n  v_screenuv = a_screenuv;\n}\n`;\nclass Material {\n    constructor(options) {\n        this._logger = Logger.getInstance();\n        this._color = Color.Transparent;\n        this._initialized = false;\n        this._images = new Map();\n        this._textures = new Map();\n        const { color, name, vertexSource, fragmentSource, graphicsContext, images } = options;\n        this._name = name !== null && name !== void 0 ? name : 'anonymous material';\n        this._vertexSource = vertexSource !== null && vertexSource !== void 0 ? vertexSource : defaultVertexSource;\n        this._fragmentSource = fragmentSource;\n        this._color = color !== null && color !== void 0 ? color : this._color;\n        if (!graphicsContext) {\n            throw Error(`Material ${name} must be provided an excalibur webgl graphics context`);\n        }\n        if (graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n            this._graphicsContext = graphicsContext;\n            this._initialize(graphicsContext);\n        }\n        else {\n            this._logger.warn(`Material ${name} was created in 2D Canvas mode, currently only WebGL is supported`);\n        }\n        if (images) {\n            for (const key in images) {\n                this.addImageSource(key, images[key]);\n            }\n        }\n    }\n    _initialize(graphicsContextWebGL) {\n        if (this._initialized) {\n            return;\n        }\n        const gl = graphicsContextWebGL.__gl;\n        // max texture slots - 2 for the graphic texture and screen texture\n        this._maxTextureSlots = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS) - 2;\n        this._shader = graphicsContextWebGL.createShader({\n            vertexSource: this._vertexSource,\n            fragmentSource: this._fragmentSource\n        });\n        this._shader.compile();\n        this._initialized = true;\n    }\n    get color() {\n        return this._color;\n    }\n    set color(c) {\n        this._color = c;\n    }\n    get name() {\n        var _a;\n        return (_a = this._name) !== null && _a !== void 0 ? _a : 'anonymous material';\n    }\n    get isUsingScreenTexture() {\n        return this._fragmentSource.includes('u_screen_texture');\n    }\n    update(callback) {\n        if (this._shader) {\n            this._shader.use();\n            callback(this._shader);\n        }\n    }\n    getShader() {\n        return this._shader;\n    }\n    addImageSource(textureUniformName, image) {\n        if (this._images.size < this._maxTextureSlots) {\n            this._images.set(textureUniformName, image);\n        }\n        else {\n            this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material \"${this.name}\", ` +\n                `no more textures will be uploaded due to hardware constraints.`);\n        }\n    }\n    removeImageSource(textureName) {\n        const image = this._images.get(textureName);\n        this._graphicsContext.textureLoader.delete(image.image);\n        this._images.delete(textureName);\n    }\n    _loadImageSource(image) {\n        const imageElement = image.image;\n        const maybeFiltering = imageElement.getAttribute(ImageSourceAttributeConstants.Filtering);\n        const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\n        const wrapX = parseImageWrapping(imageElement.getAttribute(ImageSourceAttributeConstants.WrappingX));\n        const wrapY = parseImageWrapping(imageElement.getAttribute(ImageSourceAttributeConstants.WrappingY));\n        const force = imageElement.getAttribute('forceUpload') === 'true' ? true : false;\n        const texture = this._graphicsContext.textureLoader.load(imageElement, {\n            filtering,\n            wrapping: { x: wrapX, y: wrapY }\n        }, force);\n        // remove force attribute after upload\n        imageElement.removeAttribute('forceUpload');\n        if (!this._textures.has(image)) {\n            this._textures.set(image, texture);\n        }\n        return texture;\n    }\n    uploadAndBind(gl, startingTextureSlot = 2) {\n        let textureSlot = startingTextureSlot;\n        for (const [textureName, image] of this._images.entries()) {\n            if (!image.isLoaded()) {\n                this._logger.warnOnce(`Image named ${textureName} in material ${this.name} not loaded, nothing will be uploaded to the shader.` +\n                    ` Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);\n                continue;\n            } // skip unloaded images, maybe warn\n            const texture = this._loadImageSource(image);\n            gl.activeTexture(gl.TEXTURE0 + textureSlot);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            this._shader.trySetUniformInt(textureName, textureSlot);\n            textureSlot++;\n        }\n    }\n    use() {\n        if (this._initialized) {\n            // bind the shader\n            this._shader.use();\n            // Apply standard uniforms\n            this._shader.trySetUniformFloatColor('u_color', this._color);\n        }\n        else {\n            throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`);\n        }\n    }\n}\n\n;// ./Graphics/Context/material-renderer/material-renderer.ts\n\n\n\n\n\n\n\n\nclass MaterialRenderer {\n    constructor() {\n        this.type = 'ex.material';\n        this.priority = 0;\n        this._textures = [];\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        // Setup memory layout\n        this._buffer = new VertexBuffer({\n            gl,\n            size: 6 * 4, // 6 components * 4 verts\n            type: 'dynamic'\n        });\n        // Setup a vertex layout/buffer to the material\n        this._layout = new VertexLayout({\n            gl,\n            vertexBuffer: this._buffer,\n            attributes: [\n                ['a_position', 2],\n                ['a_uv', 2],\n                ['a_screenuv', 2]\n            ],\n            suppressWarnings: true\n        });\n        // Setup index buffer\n        this._quads = new QuadIndexBuffer(gl, 1, true);\n    }\n    dispose() {\n        this._buffer.dispose();\n        this._quads.dispose();\n        this._textures.length = 0;\n        this._context = null;\n        this._gl = null;\n    }\n    draw(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight) {\n        var _a, _b, _c, _d;\n        const gl = this._gl;\n        // Extract context info\n        const material = this._context.material;\n        if (!material) {\n            return;\n        }\n        const transform = this._context.getTransform();\n        const opacity = this._context.opacity;\n        // material shader\n        const shader = material.getShader();\n        // construct geometry, or hold on to it in the material?\n        // geometry primitive for drawing rectangles?\n        // update data\n        const vertexBuffer = this._layout.vertexBuffer.bufferData;\n        let vertexIndex = 0;\n        let width = (image === null || image === void 0 ? void 0 : image.width) || swidth || 0;\n        let height = (image === null || image === void 0 ? void 0 : image.height) || sheight || 0;\n        let view = [0, 0, (_a = swidth !== null && swidth !== void 0 ? swidth : image === null || image === void 0 ? void 0 : image.width) !== null && _a !== void 0 ? _a : 0, (_b = sheight !== null && sheight !== void 0 ? sheight : image === null || image === void 0 ? void 0 : image.height) !== null && _b !== void 0 ? _b : 0];\n        let dest = [sx !== null && sx !== void 0 ? sx : 1, sy !== null && sy !== void 0 ? sy : 1];\n        // If destination is specified, update view and dest\n        if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\n            view = [sx !== null && sx !== void 0 ? sx : 1, sy !== null && sy !== void 0 ? sy : 1, (_c = swidth !== null && swidth !== void 0 ? swidth : image === null || image === void 0 ? void 0 : image.width) !== null && _c !== void 0 ? _c : 0, (_d = sheight !== null && sheight !== void 0 ? sheight : image === null || image === void 0 ? void 0 : image.height) !== null && _d !== void 0 ? _d : 0];\n            dest = [dx, dy];\n            width = dwidth;\n            height = dheight;\n        }\n        sx = view[0];\n        sy = view[1];\n        const sw = view[2];\n        const sh = view[3];\n        const topLeft = vec(dest[0], dest[1]);\n        const topRight = vec(dest[0] + width, dest[1]);\n        const bottomLeft = vec(dest[0], dest[1] + height);\n        const bottomRight = vec(dest[0] + width, dest[1] + height);\n        const imageWidth = image.width || width;\n        const imageHeight = image.height || height;\n        const uvx0 = sx / imageWidth;\n        const uvy0 = sy / imageHeight;\n        const uvx1 = (sx + sw - 0.01) / imageWidth;\n        const uvy1 = (sy + sh - 0.01) / imageHeight;\n        const topLeftScreen = transform.getPosition();\n        const bottomRightScreen = topLeftScreen.add(bottomRight);\n        const screenUVX0 = topLeftScreen.x / this._context.width;\n        const screenUVY0 = topLeftScreen.y / this._context.height;\n        const screenUVX1 = bottomRightScreen.x / this._context.width;\n        const screenUVY1 = bottomRightScreen.y / this._context.height;\n        // (0, 0) - 0\n        vertexBuffer[vertexIndex++] = topLeft.x;\n        vertexBuffer[vertexIndex++] = topLeft.y;\n        vertexBuffer[vertexIndex++] = uvx0;\n        vertexBuffer[vertexIndex++] = uvy0;\n        vertexBuffer[vertexIndex++] = screenUVX0;\n        vertexBuffer[vertexIndex++] = screenUVY0;\n        // (0, 1) - 1\n        vertexBuffer[vertexIndex++] = bottomLeft.x;\n        vertexBuffer[vertexIndex++] = bottomLeft.y;\n        vertexBuffer[vertexIndex++] = uvx0;\n        vertexBuffer[vertexIndex++] = uvy1;\n        vertexBuffer[vertexIndex++] = screenUVX0;\n        vertexBuffer[vertexIndex++] = screenUVY1;\n        // (1, 0) - 2\n        vertexBuffer[vertexIndex++] = topRight.x;\n        vertexBuffer[vertexIndex++] = topRight.y;\n        vertexBuffer[vertexIndex++] = uvx1;\n        vertexBuffer[vertexIndex++] = uvy0;\n        vertexBuffer[vertexIndex++] = screenUVX1;\n        vertexBuffer[vertexIndex++] = screenUVY0;\n        // (1, 1) - 3\n        vertexBuffer[vertexIndex++] = bottomRight.x;\n        vertexBuffer[vertexIndex++] = bottomRight.y;\n        vertexBuffer[vertexIndex++] = uvx1;\n        vertexBuffer[vertexIndex++] = uvy1;\n        vertexBuffer[vertexIndex++] = screenUVX1;\n        vertexBuffer[vertexIndex++] = screenUVY1;\n        // This creates and uploads the texture if not already done\n        const texture = this._addImageAsTexture(image);\n        // apply material\n        material.use();\n        this._layout.shader = shader;\n        // apply layout and geometry\n        this._layout.use(true);\n        // apply time in ms since the page (performance.now())\n        shader.trySetUniformFloat('u_time_ms', performance.now());\n        // apply opacity\n        shader.trySetUniformFloat('u_opacity', opacity);\n        // apply resolution\n        shader.trySetUniformFloatVector('u_resolution', vec(this._context.width, this._context.height));\n        // apply graphic resolution\n        shader.trySetUniformFloatVector('u_graphic_resolution', vec(imageWidth, imageHeight));\n        // apply size\n        shader.trySetUniformFloatVector('u_size', vec(sw, sh));\n        // apply orthographic projection\n        shader.trySetUniformMatrix('u_matrix', this._context.ortho);\n        // apply geometry transform\n        shader.trySetUniformMatrix('u_transform', transform.to4x4());\n        // bind graphic image texture 'uniform sampler2D u_graphic;'\n        gl.activeTexture(gl.TEXTURE0 + 0);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        shader.trySetUniformInt('u_graphic', 0);\n        // bind the screen texture\n        gl.activeTexture(gl.TEXTURE0 + 1);\n        gl.bindTexture(gl.TEXTURE_2D, this._context.materialScreenTexture);\n        shader.trySetUniformInt('u_screen_texture', 1);\n        // bind any additional textures in the material\n        material.uploadAndBind(gl);\n        // bind quad index buffer\n        this._quads.bind();\n        // Draw a single quad\n        gl.drawElements(gl.TRIANGLES, 6, this._quads.bufferGlType, 0);\n        GraphicsDiagnostics.DrawnImagesCount++;\n        GraphicsDiagnostics.DrawCallCount++;\n    }\n    _addImageAsTexture(image) {\n        const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\n        const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\n        const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX));\n        const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY));\n        const force = image.getAttribute('forceUpload') === 'true' ? true : false;\n        const texture = this._context.textureLoader.load(image, {\n            filtering,\n            wrapping: { x: wrapX, y: wrapY }\n        }, force);\n        // remove force attribute after upload\n        image.removeAttribute('forceUpload');\n        if (this._textures.indexOf(texture) === -1) {\n            this._textures.push(texture);\n        }\n        return texture;\n    }\n    hasPendingDraws() {\n        return false;\n    }\n    flush() {\n        // flush does not do anything, material renderer renders immediately per draw\n    }\n}\n\n;// ./Graphics/Context/particle-renderer/particle-vertex.glsl\n/* harmony default export */ const particle_vertex = (\"#version 300 es\\nprecision mediump float;\\n\\nuniform float deltaMs;\\nuniform float maxLifeMs;\\nuniform vec2 gravity;\\nuniform vec2 focus;\\nuniform float focusAccel;\\nuniform mat4 u_matrix;\\nuniform mat4 u_transform;\\nuniform float startSize;\\nuniform float endSize;\\n// uniform sampler2D obstacle;\\n\\nlayout(location=0)in vec2 position;\\nlayout(location=1)in vec2 velocity;\\nlayout(location=2)in float rotation;\\nlayout(location=3)in float angularVelocity;\\nlayout(location=4)in float lifeMs;\\n\\n// TODO z index to handle buffer wrapping?\\n\\n// DO NOT RE-ORDER\\nout vec2 finalPosition;\\nout vec2 finalVelocity;\\nout float finalRotation;\\nout float finalAngularVelocity;\\nout float finalLifeMs;\\nvoid main(){\\n  // Evolve particle\\n  float seconds = deltaMs / 1000.;\\n  // euler integration\\n  // Weird artifact of re-using the same buffer layout for update/draw\\n  // we need differently named variables\\n  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;\\n  finalVelocity = velocity + finalGravity * seconds;\\n  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;\\n  finalRotation = rotation + angularVelocity * seconds;\\n  finalAngularVelocity = angularVelocity;\\n  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);\\n\\n  // Collision mask sampling\\n  // vec2 samplePoint = finalPosition / vec2(width, height);\\n  // vec4 collides = texture(obstacle, samplePoint);\\n  // if (distance(collides,vec4(0.)) > .01) {\\n  //   // non opaque means we collide! recalc final pos/vel\\n  //   vec2 newVelocity = velocity * -.1;// lose energy\\n  //   finalVelocity = newVelocity + gravity * seconds;\\n  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;\\n  // }\\n\\n  float lifePercent = finalLifeMs / maxLifeMs;\\n  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;\\n\\n  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z\\n  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent);\\n}\");\n;// ./Graphics/Context/particle-renderer/particle-fragment.glsl\n/* harmony default export */ const particle_fragment = (\"#version 300 es\\nprecision mediump float;\\n\\nuniform sampler2D graphic;\\nuniform bool useTexture;\\nuniform float maxLifeMs;\\n\\nuniform vec4 beginColor;\\nuniform vec4 endColor;\\nuniform bool fade;\\nuniform float startOpacity;\\n\\nin float finalRotation;\\nin float finalLifeMs;\\nout vec4 fragColor;\\n\\nvoid main(){\\n\\n  float lifePct = finalLifeMs / maxLifeMs;\\n\\n  if (useTexture) {\\n    /** Draw texture */\\n    if (lifePct <= 0.) discard;\\n    float mid = .5;\\n    float cosine = cos(finalRotation);\\n    float sine = sin(finalRotation);\\n    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,\\n                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);\\n    vec4 color = texture(graphic, rotated);\\n    fragColor = color * (fade ? lifePct : 1.0);\\n  } else {\\n    /** Draw circle */\\n    if (lifePct <= 0.) discard;\\n    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;\\n    float dist = 1.0 - length(uv);\\n    float edge = fwidth(dot(uv, uv));\\n    float circle = smoothstep(-edge/2.0, edge/2.0, dist);\\n    vec4 color = mix(beginColor, endColor, 1.0 - lifePct) * startOpacity;\\n    fragColor = color * (fade ? lifePct : 1.0) * circle;\\n  }\\n}\");\n;// ./Math/coord-plane.ts\n/**\n * Enum representing the coordinate plane for the position 2D vector in the {@apilink TransformComponent}\n */\nvar CoordPlane;\n(function (CoordPlane) {\n    /**\n     * The world coordinate plane (default) represents world space, any entities drawn with world\n     * space move when the camera moves.\n     */\n    CoordPlane[\"World\"] = \"world\";\n    /**\n     * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\n     * to screen coordinates ignoring the camera.\n     */\n    CoordPlane[\"Screen\"] = \"screen\";\n})(CoordPlane || (CoordPlane = {}));\n\n;// ./Math/vector-view.ts\n\nclass VectorView extends Vector {\n    constructor(options) {\n        super(0, 0);\n        this._getX = options.getX;\n        this._getY = options.getY;\n        this._setX = options.setX;\n        this._setY = options.setY;\n    }\n    get x() {\n        return (this._x = this._getX());\n    }\n    set x(val) {\n        this._setX(val);\n        this._x = val;\n    }\n    get y() {\n        return (this._y = this._getY());\n    }\n    set y(val) {\n        this._setY(val);\n        this._y = val;\n    }\n}\n\n;// ./Math/watch-vector.ts\n\n/**\n * Wraps a vector and watches for changes in the x/y, modifies the original vector.\n */\nclass WatchVector extends Vector {\n    constructor(original, change) {\n        super(original.x, original.y);\n        this.original = original;\n        this.change = change;\n    }\n    get x() {\n        return (this._x = this.original.x);\n    }\n    set x(newX) {\n        if (newX !== this._x) {\n            this.change(newX, this._y);\n            this._x = this.original.x = newX;\n        }\n    }\n    get y() {\n        return (this._y = this.original.y);\n    }\n    set y(newY) {\n        if (newY !== this._y) {\n            this.change(this._x, newY);\n            this._y = this.original.y = newY;\n        }\n    }\n    setTo(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n}\n\n;// ./Math/transform.ts\n\n\n\n\n\nclass transform_Transform {\n    constructor() {\n        this._parent = null;\n        this._children = [];\n        this._pos = new WatchVector(vec(0, 0), () => {\n            this.flagDirty();\n        });\n        this._globalPos = new VectorView({\n            getX: () => this.matrix.data[4],\n            getY: () => this.matrix.data[5],\n            setX: (x) => {\n                if (this.parent) {\n                    const { x: newX } = this.parent.inverse.multiply(vec(x, this.pos.y));\n                    this.pos.x = newX;\n                }\n                else {\n                    this.pos.x = x;\n                }\n                if (x !== this.matrix.data[4]) {\n                    this.flagDirty();\n                }\n            },\n            setY: (y) => {\n                if (this.parent) {\n                    const { y: newY } = this.parent.inverse.multiply(vec(this.pos.x, y));\n                    this.pos.y = newY;\n                }\n                else {\n                    this.pos.y = y;\n                }\n                if (y !== this.matrix.data[5]) {\n                    this.flagDirty();\n                }\n            }\n        });\n        this._rotation = 0;\n        this._scale = new WatchVector(vec(1, 1), () => {\n            this.flagDirty();\n        });\n        this._globalScale = new VectorView({\n            getX: () => (this.parent ? this.matrix.getScaleX() : this.scale.x),\n            getY: () => (this.parent ? this.matrix.getScaleY() : this.scale.y),\n            setX: (x) => {\n                if (this.parent) {\n                    const globalScaleX = this.parent.globalScale.x;\n                    this.scale.x = x / globalScaleX;\n                }\n                else {\n                    this.scale.x = x;\n                }\n            },\n            setY: (y) => {\n                if (this.parent) {\n                    const globalScaleY = this.parent.globalScale.y;\n                    this.scale.y = y / globalScaleY;\n                }\n                else {\n                    this.scale.y = y;\n                }\n            }\n        });\n        this._z = 0;\n        this._isDirty = false;\n        this._isInverseDirty = false;\n        this._matrix = AffineMatrix.identity();\n        this._inverse = AffineMatrix.identity();\n        this._scratch = AffineMatrix.identity();\n    }\n    get parent() {\n        return this._parent;\n    }\n    set parent(transform) {\n        if (this._parent) {\n            const index = this._parent._children.indexOf(this);\n            if (index > -1) {\n                this._parent._children.splice(index, 1);\n            }\n        }\n        this._parent = transform;\n        if (this._parent) {\n            this._parent._children.push(this);\n        }\n        this.flagDirty();\n    }\n    get children() {\n        return this._children;\n    }\n    set pos(v) {\n        this._pos.x = v.x;\n        this._pos.y = v.y;\n    }\n    get pos() {\n        return this._pos;\n    }\n    set globalPos(v) {\n        let localPos = v.clone();\n        if (this.parent) {\n            localPos = this.parent.inverse.multiply(v);\n        }\n        if (!localPos.equals(this._pos)) {\n            this._pos = localPos;\n            this.flagDirty();\n        }\n    }\n    get globalPos() {\n        return this._globalPos;\n    }\n    set rotation(rotation) {\n        const canonRotation = canonicalizeAngle(rotation);\n        if (canonRotation !== this._rotation) {\n            this.flagDirty();\n        }\n        this._rotation = canonRotation;\n    }\n    get rotation() {\n        return this._rotation;\n    }\n    set globalRotation(rotation) {\n        let inverseRotation = 0;\n        if (this.parent) {\n            inverseRotation = this.parent.globalRotation;\n        }\n        const canonRotation = canonicalizeAngle(rotation + inverseRotation);\n        if (canonRotation !== this._rotation) {\n            this.flagDirty();\n        }\n        this._rotation = canonRotation;\n    }\n    get globalRotation() {\n        if (this.parent) {\n            return this.matrix.getRotation();\n        }\n        return this.rotation;\n    }\n    set scale(v) {\n        this._scale.x = v.x;\n        this._scale.y = v.y;\n    }\n    get scale() {\n        return this._scale;\n    }\n    set globalScale(v) {\n        let inverseScale = vec(1, 1);\n        if (this.parent) {\n            inverseScale = this.parent.globalScale;\n        }\n        this.scale = v.scale(vec(1 / inverseScale.x, 1 / inverseScale.y));\n    }\n    get globalScale() {\n        return this._globalScale;\n    }\n    set z(z) {\n        this._z = z;\n        this.flagDirty();\n    }\n    get z() {\n        return this._z;\n    }\n    set globalZ(z) {\n        if (this.parent) {\n            this.z = z - this.parent.globalZ;\n        }\n        else {\n            this.z = z;\n        }\n    }\n    get globalZ() {\n        if (this.parent) {\n            return this.z + this.parent.globalZ;\n        }\n        return this.z;\n    }\n    /**\n     * Calculates and returns the matrix representation of this transform\n     *\n     * Avoid mutating the matrix to update the transform, it is not the source of truth.\n     * Update the transform pos, rotation, scale.\n     */\n    get matrix() {\n        if (this._isDirty) {\n            if (this.parent === null) {\n                this._calculateMatrix().clone(this._matrix);\n            }\n            else {\n                this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix);\n            }\n            this._isDirty = false;\n        }\n        return this._matrix;\n    }\n    /**\n     * Calculates and returns the inverse matrix representation of this transform\n     */\n    get inverse() {\n        if (this._isInverseDirty) {\n            this.matrix.inverse(this._inverse);\n            this._isInverseDirty = false;\n        }\n        return this._inverse;\n    }\n    _calculateMatrix() {\n        this._scratch.data[0] = Math.cos(this._rotation);\n        this._scratch.data[1] = Math.sin(this._rotation);\n        this._scratch.data[2] = -Math.sin(this._rotation);\n        this._scratch.data[3] = Math.cos(this.rotation);\n        this._scratch.data[4] = this._pos.x;\n        this._scratch.data[5] = this._pos.y;\n        this._scratch.scale(this._scale.x, this._scale.y);\n        return this._scratch;\n    }\n    flagDirty() {\n        this._isDirty = true;\n        this._isInverseDirty = true;\n        for (let i = 0; i < this._children.length; i++) {\n            this._children[i].flagDirty();\n        }\n    }\n    apply(point) {\n        return this.matrix.multiply(point);\n    }\n    applyInverse(point) {\n        return this.inverse.multiply(point);\n    }\n    setTransform(pos, rotation, scale) {\n        this._pos.x = pos.x;\n        this._pos.y = pos.y;\n        this._rotation = canonicalizeAngle(rotation);\n        this._scale.x = scale.x;\n        this._scale.y = scale.y;\n        this.flagDirty();\n    }\n    /**\n     * Returns true if the transform has a negative x scale or y scale, but not both\n     */\n    isMirrored() {\n        const signBitX = sign(this.scale.x) >>> 31;\n        const signBitY = sign(this.scale.y) >>> 31;\n        const mirrored = signBitX ^ signBitY;\n        return !!mirrored;\n    }\n    /**\n     * Clones the current transform\n     * **Warning does not clone the parent**\n     * @param dest\n     */\n    clone(dest) {\n        const target = dest !== null && dest !== void 0 ? dest : new transform_Transform();\n        this._pos.clone(target._pos);\n        target._z = this._z;\n        target._rotation = this._rotation;\n        this._scale.clone(target._scale);\n        target.flagDirty();\n        return target;\n    }\n    /**\n     * Clones but keeps the same parent reference\n     */\n    cloneWithParent(dest) {\n        const target = dest !== null && dest !== void 0 ? dest : new transform_Transform();\n        this._pos.clone(target._pos);\n        target._z = this._z;\n        target._rotation = this._rotation;\n        this._scale.clone(target._scale);\n        target.parent = this.parent;\n        target.flagDirty();\n        return target;\n    }\n    toString() {\n        return this.matrix.toString();\n    }\n}\n\n;// ./EntityComponentSystem/Component.ts\n/**\n *\n */\nfunction isComponentCtor(value) {\n    return !!value && !!value.prototype && !!value.prototype.constructor;\n}\n/**\n * Type guard to check if a component implements clone\n * @param x\n */\nfunction hasClone(x) {\n    return !!(x === null || x === void 0 ? void 0 : x.clone);\n}\n/**\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\n *\n * Implementations of Component must have a zero-arg constructor to support dependencies\n *\n * ```typescript\n * class MyComponent extends ex.Component {\n *   // zero arg support required if you want to use component dependencies\n *   constructor(public optionalPos?: ex.Vector) {}\n * }\n * ```\n */\nclass Component {\n    constructor() {\n        // TODO maybe generate a unique id?\n        /**\n         * Current owning {@apilink Entity}, if any, of this component. Null if not added to any {@apilink Entity}\n         */\n        this.owner = undefined;\n    }\n    /**\n     * Clones any properties on this component, if that property value has a `clone()` method it will be called\n     */\n    clone() {\n        const newComponent = new this.constructor();\n        for (const prop in this) {\n            if (this.hasOwnProperty(prop)) {\n                const val = this[prop];\n                if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\n                    newComponent[prop] = val.clone();\n                }\n                else {\n                    newComponent[prop] = val;\n                }\n            }\n        }\n        return newComponent;\n    }\n}\n\n;// ./Util/Observable.ts\n/**\n * Simple Observable implementation\n * @template T is the typescript Type that defines the data being observed\n */\nclass Observable {\n    constructor() {\n        this.observers = [];\n        this.subscriptions = [];\n    }\n    /**\n     * Register an observer to listen to this observable\n     * @param observer\n     */\n    register(observer) {\n        this.observers.push(observer);\n    }\n    /**\n     * Register a callback to listen to this observable\n     * @param func\n     */\n    subscribe(func) {\n        this.subscriptions.push(func);\n    }\n    /**\n     * Remove an observer from the observable\n     * @param observer\n     */\n    unregister(observer) {\n        const i = this.observers.indexOf(observer);\n        if (i !== -1) {\n            this.observers.splice(i, 1);\n        }\n    }\n    /**\n     * Remove a callback that is listening to this observable\n     * @param func\n     */\n    unsubscribe(func) {\n        const i = this.subscriptions.indexOf(func);\n        if (i !== -1) {\n            this.subscriptions.splice(i, 1);\n        }\n    }\n    /**\n     * Broadcasts a message to all observers and callbacks\n     * @param message\n     */\n    notifyAll(message) {\n        const observersLength = this.observers.length;\n        for (let i = 0; i < observersLength; i++) {\n            this.observers[i].notify(message);\n        }\n        const subscriptionsLength = this.subscriptions.length;\n        for (let i = 0; i < subscriptionsLength; i++) {\n            this.subscriptions[i](message);\n        }\n    }\n    /**\n     * Removes all observers and callbacks\n     */\n    clear() {\n        this.observers.length = 0;\n        this.subscriptions.length = 0;\n    }\n}\n\n;// ./EntityComponentSystem/Components/TransformComponent.ts\n\n\n\n\n\nclass TransformComponent extends Component {\n    constructor() {\n        super(...arguments);\n        this._logger = Logger.getInstance();\n        this._parentComponent = null;\n        this._transform = new transform_Transform();\n        this._addChildTransform = (child) => {\n            const childTxComponent = child.get(TransformComponent);\n            if (childTxComponent) {\n                childTxComponent._transform.parent = this._transform;\n                childTxComponent._parentComponent = this;\n            }\n        };\n        /**\n         * Observable that emits when the z index changes on this component\n         */\n        this.zIndexChanged$ = new Observable();\n        this._coordPlane = CoordPlane.World;\n    }\n    get() {\n        return this._transform;\n    }\n    onAdd(owner) {\n        for (const child of owner.children) {\n            this._addChildTransform(child);\n        }\n        owner.childrenAdded$.subscribe((child) => this._addChildTransform(child));\n        owner.childrenRemoved$.subscribe((child) => {\n            const childTxComponent = child.get(TransformComponent);\n            if (childTxComponent) {\n                childTxComponent._transform.parent = null;\n                childTxComponent._parentComponent = null;\n            }\n        });\n    }\n    onRemove(_previousOwner) {\n        this._transform.parent = null;\n        this._parentComponent = null;\n    }\n    /**\n     * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n     * For example z=99 would be drawn on top of z=0.\n     */\n    get z() {\n        return this._transform.z;\n    }\n    set z(val) {\n        const oldz = this._transform.z;\n        this._transform.z = val;\n        if (oldz !== val) {\n            this.zIndexChanged$.notifyAll(val);\n        }\n    }\n    get globalZ() {\n        return this._transform.globalZ;\n    }\n    set globalZ(z) {\n        this._transform.globalZ = z;\n    }\n    /**\n     * The {@apilink CoordPlane | `coordinate plane`} for this transform for the entity.\n     */\n    get coordPlane() {\n        if (this._parentComponent) {\n            return this._parentComponent.coordPlane;\n        }\n        return this._coordPlane;\n    }\n    set coordPlane(value) {\n        var _a;\n        if (!this._parentComponent) {\n            this._coordPlane = value;\n        }\n        else {\n            this._logger.warn(`Cannot set coordinate plane on child entity ${(_a = this.owner) === null || _a === void 0 ? void 0 : _a.name}, children inherit their coordinate plane from their parents.`);\n        }\n    }\n    get pos() {\n        return this._transform.pos;\n    }\n    set pos(v) {\n        this._transform.pos = v;\n    }\n    get globalPos() {\n        return this._transform.globalPos;\n    }\n    set globalPos(v) {\n        this._transform.globalPos = v;\n    }\n    get rotation() {\n        return this._transform.rotation;\n    }\n    set rotation(rotation) {\n        this._transform.rotation = rotation;\n    }\n    get globalRotation() {\n        return this._transform.globalRotation;\n    }\n    set globalRotation(rotation) {\n        this._transform.globalRotation = rotation;\n    }\n    get scale() {\n        return this._transform.scale;\n    }\n    set scale(v) {\n        this._transform.scale = v;\n    }\n    get globalScale() {\n        return this._transform.globalScale;\n    }\n    set globalScale(v) {\n        this._transform.globalScale = v;\n    }\n    applyInverse(v) {\n        return this._transform.applyInverse(v);\n    }\n    apply(v) {\n        return this._transform.apply(v);\n    }\n    clone() {\n        const component = new TransformComponent();\n        component._transform = this._transform.clone();\n        return component;\n    }\n}\n\n;// ./Graphics/Animation.ts\n\n\n\n\nvar AnimationDirection;\n(function (AnimationDirection) {\n    /**\n     * Animation is playing forwards\n     */\n    AnimationDirection[\"Forward\"] = \"forward\";\n    /**\n     * Animation is playing backwards\n     */\n    AnimationDirection[\"Backward\"] = \"backward\";\n})(AnimationDirection || (AnimationDirection = {}));\nvar AnimationStrategy;\n(function (AnimationStrategy) {\n    /**\n     * Animation ends without displaying anything\n     */\n    AnimationStrategy[\"End\"] = \"end\";\n    /**\n     * Animation loops to the first frame after the last frame\n     */\n    AnimationStrategy[\"Loop\"] = \"loop\";\n    /**\n     * Animation plays to the last frame, then backwards to the first frame, then repeats\n     */\n    AnimationStrategy[\"PingPong\"] = \"pingpong\";\n    /**\n     * Animation ends stopping on the last frame\n     */\n    AnimationStrategy[\"Freeze\"] = \"freeze\";\n})(AnimationStrategy || (AnimationStrategy = {}));\nconst AnimationEvents = {\n    Frame: 'frame',\n    Loop: 'loop',\n    End: 'end'\n};\n/**\n * Create an Animation given a list of {@apilink Frame | `frames`} in {@apilink AnimationOptions}\n *\n * To create an Animation from a {@apilink SpriteSheet}, use {@apilink Animation.fromSpriteSheet}\n */\nclass Animation extends Graphic {\n    constructor(options) {\n        var _a, _b, _c;\n        super(options);\n        this.events = new EventEmitter();\n        this.frames = [];\n        this.strategy = AnimationStrategy.Loop;\n        this.frameDuration = 100;\n        this._idempotencyToken = -1;\n        this._firstTick = true;\n        this._currentFrame = 0;\n        this._timeLeftInFrame = 0;\n        this._pingPongDirection = 1;\n        this._done = false;\n        this._playing = true;\n        this._speed = 1;\n        this._reversed = false;\n        this.frames = options.frames;\n        this.speed = (_a = options.speed) !== null && _a !== void 0 ? _a : this.speed;\n        this.strategy = (_b = options.strategy) !== null && _b !== void 0 ? _b : this.strategy;\n        this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : (_c = options.frameDuration) !== null && _c !== void 0 ? _c : this.frameDuration;\n        if (options.reverse) {\n            this.reverse();\n        }\n        this.goToFrame(0);\n    }\n    clone() {\n        return new Animation({\n            frames: this.frames.map((f) => ({ ...f })),\n            frameDuration: this.frameDuration,\n            speed: this.speed,\n            reverse: this._reversed,\n            strategy: this.strategy,\n            ...this.cloneGraphicOptions()\n        });\n    }\n    get width() {\n        const maybeFrame = this.currentFrame;\n        if (maybeFrame && maybeFrame.graphic) {\n            return Math.abs(maybeFrame.graphic.width * this.scale.x);\n        }\n        return 0;\n    }\n    get height() {\n        const maybeFrame = this.currentFrame;\n        if (maybeFrame && maybeFrame.graphic) {\n            return Math.abs(maybeFrame.graphic.height * this.scale.y);\n        }\n        return 0;\n    }\n    /**\n     * Create an Animation from a {@apilink SpriteSheet}, a list of indices into the sprite sheet, a duration per frame\n     * and optional {@apilink AnimationStrategy}\n     *\n     * Example:\n     * ```typescript\n     * const spriteSheet = SpriteSheet.fromImageSource({...});\n     *\n     * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\n     * ```\n     * @param spriteSheet ex.SpriteSheet\n     * @param spriteSheetIndex 0 based index from left to right, top down (row major order) of the ex.SpriteSheet\n     * @param durationPerFrameMs duration per frame in milliseconds\n     * @param strategy Optional strategy, default AnimationStrategy.Loop\n     */\n    static fromSpriteSheet(spriteSheet, spriteSheetIndex, durationPerFrameMs, strategy = AnimationStrategy.Loop) {\n        const maxIndex = spriteSheet.sprites.length - 1;\n        const invalidIndices = spriteSheetIndex.filter((index) => index < 0 || index > maxIndex);\n        if (invalidIndices.length) {\n            Animation._LOGGER.warn(`Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`);\n        }\n        return new Animation({\n            frames: spriteSheet.sprites\n                .filter((_, index) => spriteSheetIndex.indexOf(index) > -1)\n                .map((f) => ({\n                graphic: f,\n                duration: durationPerFrameMs\n            })),\n            strategy: strategy\n        });\n    }\n    /**\n     * Create an {@apilink Animation} from a {@apilink SpriteSheet} given a list of coordinates\n     *\n     * Example:\n     * ```typescript\n     * const spriteSheet = SpriteSheet.fromImageSource({...});\n     *\n     * const anim = Animation.fromSpriteSheetCoordinates({\n     *  spriteSheet,\n     *  frameCoordinates: [\n     *    {x: 0, y: 5, duration: 100, options { flipHorizontal: true }},\n     *    {x: 1, y: 5, duration: 200},\n     *    {x: 2, y: 5},\n     *    {x: 3, y: 5}\n     *  ],\n     *  strategy: AnimationStrategy.PingPong\n     * });\n     * ```\n     * @param options\n     * @returns Animation\n     */\n    static fromSpriteSheetCoordinates(options) {\n        const { spriteSheet, frameCoordinates, durationPerFrameMs, speed, strategy, reverse } = options;\n        const defaultDuration = durationPerFrameMs !== null && durationPerFrameMs !== void 0 ? durationPerFrameMs : 100;\n        const frames = [];\n        for (const coord of frameCoordinates) {\n            const { x, y, duration, options } = coord;\n            const sprite = spriteSheet.getSprite(x, y, options);\n            if (sprite) {\n                frames.push({\n                    graphic: sprite,\n                    duration: duration !== null && duration !== void 0 ? duration : defaultDuration\n                });\n            }\n            else {\n                Animation._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${x}, ${y}), please check your SpriteSheet to confirm that sprite exists`);\n            }\n        }\n        return new Animation({\n            frames,\n            strategy,\n            speed,\n            reverse\n        });\n    }\n    /**\n     * Current animation speed\n     *\n     * 1 meaning normal 1x speed.\n     * 2 meaning 2x speed and so on.\n     */\n    get speed() {\n        return this._speed;\n    }\n    /**\n     * Current animation speed\n     *\n     * 1 meaning normal 1x speed.\n     * 2 meaning 2x speed and so on.\n     */\n    set speed(val) {\n        this._speed = clamp(Math.abs(val), 0, Infinity);\n    }\n    /**\n     * Returns the current Frame of the animation\n     *\n     * Use {@apilink Animation.currentFrameIndex} to get the frame number and\n     * {@apilink Animation.goToFrame} to set the current frame index\n     */\n    get currentFrame() {\n        if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\n            return this.frames[this._currentFrame];\n        }\n        return null;\n    }\n    /**\n     * Returns the current frame index of the animation\n     *\n     * Use {@apilink Animation.currentFrame} to grab the current {@apilink Frame} object\n     */\n    get currentFrameIndex() {\n        return this._currentFrame;\n    }\n    /**\n     * Returns the amount of time in milliseconds left in the current frame\n     */\n    get currentFrameTimeLeft() {\n        return this._timeLeftInFrame;\n    }\n    /**\n     * Returns `true` if the animation is playing\n     */\n    get isPlaying() {\n        return this._playing;\n    }\n    get isReversed() {\n        return this._reversed;\n    }\n    /**\n     * Reverses the play direction of the Animation, this preserves the current frame\n     */\n    reverse() {\n        // Don't mutate with the original frame list, create a copy\n        this.frames = this.frames.slice().reverse();\n        this._reversed = !this._reversed;\n    }\n    /**\n     * Returns the current play direction of the animation\n     */\n    get direction() {\n        // Keep logically consistent with ping-pong direction\n        // If ping-pong is forward = 1 and reversed is true then we are logically reversed\n        const reversed = this._reversed && this._pingPongDirection === 1 ? true : false;\n        return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\n    }\n    /**\n     * Plays or resumes the animation from the current frame\n     */\n    play() {\n        this._playing = true;\n    }\n    /**\n     * Pauses the animation on the current frame\n     */\n    pause() {\n        this._playing = false;\n        this._firstTick = true; // firstTick must be set to emit the proper frame event\n    }\n    /**\n     * Reset the animation back to the beginning, including if the animation were done\n     */\n    reset() {\n        this._done = false;\n        this._firstTick = true;\n        this._currentFrame = 0;\n        this._timeLeftInFrame = this.frameDuration;\n        const maybeFrame = this.frames[this._currentFrame];\n        if (maybeFrame) {\n            this._timeLeftInFrame = (maybeFrame === null || maybeFrame === void 0 ? void 0 : maybeFrame.duration) || this.frameDuration;\n        }\n    }\n    /**\n     * Returns `true` if the animation can end\n     */\n    get canFinish() {\n        switch (this.strategy) {\n            case AnimationStrategy.End:\n            case AnimationStrategy.Freeze: {\n                return true;\n            }\n            default: {\n                return false;\n            }\n        }\n    }\n    /**\n     * Returns `true` if the animation is done, for looping type animations\n     * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\n     *\n     * See the `ex.Animation.canFinish()` method to know if an animation type can end\n     */\n    get done() {\n        return this._done;\n    }\n    /**\n     * Jump the animation immediately to a specific frame if it exists\n     *\n     * Optionally specify an override for the duration of the frame, useful for\n     * keeping multiple animations in sync with one another.\n     * @param frameNumber\n     * @param duration\n     */\n    goToFrame(frameNumber, duration) {\n        this._currentFrame = frameNumber;\n        this._timeLeftInFrame = duration !== null && duration !== void 0 ? duration : this.frameDuration;\n        const maybeFrame = this.frames[this._currentFrame];\n        if (maybeFrame && !this._done) {\n            this._timeLeftInFrame = duration !== null && duration !== void 0 ? duration : ((maybeFrame === null || maybeFrame === void 0 ? void 0 : maybeFrame.duration) || this.frameDuration);\n            this.events.emit('frame', { ...maybeFrame, frameIndex: this.currentFrameIndex });\n        }\n    }\n    _nextFrame() {\n        const currentFrame = this._currentFrame;\n        if (this._done) {\n            return currentFrame;\n        }\n        let next = -1;\n        switch (this.strategy) {\n            case AnimationStrategy.Loop: {\n                next = (currentFrame + 1) % this.frames.length;\n                if (next === 0) {\n                    this.events.emit('loop', this);\n                }\n                break;\n            }\n            case AnimationStrategy.End: {\n                next = currentFrame + 1;\n                if (next >= this.frames.length) {\n                    this._done = true;\n                    this._currentFrame = this.frames.length;\n                    this.events.emit('end', this);\n                }\n                break;\n            }\n            case AnimationStrategy.Freeze: {\n                next = clamp(currentFrame + 1, 0, this.frames.length - 1);\n                if (next >= this.frames.length - 1) {\n                    this._done = true;\n                    this.events.emit('end', this);\n                }\n                break;\n            }\n            case AnimationStrategy.PingPong: {\n                if (currentFrame + this._pingPongDirection >= this.frames.length) {\n                    this._pingPongDirection = -1;\n                    this.events.emit('loop', this);\n                }\n                if (currentFrame + this._pingPongDirection < 0) {\n                    this._pingPongDirection = 1;\n                    this.events.emit('loop', this);\n                }\n                next = currentFrame + (this._pingPongDirection % this.frames.length);\n                break;\n            }\n        }\n        return next;\n    }\n    /**\n     * Called internally by Excalibur to update the state of the animation potential update the current frame\n     * @param elapsedMilliseconds Milliseconds elapsed\n     * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\n     */\n    tick(elapsedMilliseconds, idempotencyToken = 0) {\n        if (this._idempotencyToken === idempotencyToken) {\n            return;\n        }\n        this._idempotencyToken = idempotencyToken;\n        if (!this._playing) {\n            return;\n        }\n        // if it's the first frame emit frame event\n        if (this._firstTick) {\n            this._firstTick = false;\n            this.events.emit('frame', { ...this.currentFrame, frameIndex: this.currentFrameIndex });\n        }\n        this._timeLeftInFrame -= elapsedMilliseconds * this._speed;\n        if (this._timeLeftInFrame <= 0) {\n            this.goToFrame(this._nextFrame());\n        }\n    }\n    _drawImage(ctx, x, y) {\n        if (this.currentFrame && this.currentFrame.graphic) {\n            this.currentFrame.graphic.draw(ctx, x, y);\n        }\n    }\n}\nAnimation._LOGGER = Logger.getInstance();\n\n;// ./Graphics/GraphicsGroup.ts\n\n\n\n\n\nclass GraphicsGroup extends Graphic {\n    constructor(options) {\n        var _a;\n        super(options);\n        this._logger = Logger.getInstance();\n        this.useAnchor = true;\n        this.members = [];\n        this.members = options.members;\n        this.useAnchor = (_a = options.useAnchor) !== null && _a !== void 0 ? _a : this.useAnchor;\n        this._updateDimensions();\n    }\n    clone() {\n        return new GraphicsGroup({\n            members: [...this.members],\n            ...this.cloneGraphicOptions()\n        });\n    }\n    _updateDimensions() {\n        const bb = this.localBounds;\n        this.width = bb.width;\n        this.height = bb.height;\n        return bb;\n    }\n    get localBounds() {\n        const bb = new BoundingBox();\n        for (const member of this.members) {\n            if (member instanceof Graphic) {\n                member.localBounds.combine(bb, bb);\n            }\n            else {\n                const { graphic, offset: pos, useBounds } = member;\n                const shouldUseBounds = useBounds === undefined ? true : useBounds;\n                if (graphic) {\n                    if (shouldUseBounds) {\n                        graphic.localBounds.translate(pos).combine(bb, bb);\n                    }\n                }\n                else {\n                    this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(member)}.`);\n                }\n            }\n        }\n        return bb;\n    }\n    _isAnimationOrGroup(graphic) {\n        return graphic instanceof Animation || graphic instanceof GraphicsGroup;\n    }\n    tick(elapsedMilliseconds, idempotencyToken) {\n        for (const member of this.members) {\n            let graphic;\n            if (member instanceof Graphic) {\n                graphic = member;\n            }\n            else {\n                graphic = member.graphic;\n            }\n            if (this._isAnimationOrGroup(graphic)) {\n                graphic.tick(elapsedMilliseconds, idempotencyToken);\n            }\n        }\n    }\n    reset() {\n        for (const member of this.members) {\n            let graphic;\n            if (member instanceof Graphic) {\n                graphic = member;\n            }\n            else {\n                graphic = member.graphic;\n            }\n            if (this._isAnimationOrGroup(graphic)) {\n                graphic.reset();\n            }\n        }\n    }\n    _preDraw(ex, x, y) {\n        this._updateDimensions();\n        super._preDraw(ex, this.useAnchor ? x : 0, this.useAnchor ? y : 0);\n    }\n    _drawImage(ex, x, y) {\n        const pos = Vector.Zero;\n        for (const member of this.members) {\n            let graphic;\n            if (member instanceof Graphic) {\n                graphic = member;\n            }\n            else {\n                graphic = member.graphic;\n                member.offset.clone(pos);\n            }\n            if (!graphic) {\n                continue;\n            }\n            ex.save();\n            ex.translate(x, y);\n            graphic.draw(ex, pos.x, pos.y);\n            if (this.showDebug) {\n                /* istanbul ignore next */\n                ex.debug.drawRect(0, 0, this.width, this.height);\n            }\n            ex.restore();\n        }\n    }\n}\n\n;// ./Graphics/Raster.ts\n\n\n\n\n\n\n/**\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\n * {@apilink ExcaliburGraphicsContext}. This is useful for generating custom images using the 2D canvas api.\n *\n * Implementors must implement the {@apilink Raster.execute} method to rasterize their drawing.\n */\nclass Raster extends Graphic {\n    constructor(options) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n        super(omit({ ...options }, ['width', 'height'])); // rasters do some special sauce with width/height\n        this.lineCap = 'butt';\n        this.quality = 1;\n        this._dirty = true;\n        this._smoothing = false;\n        this._color = watch(Color.Black, () => this.flagDirty());\n        this._lineWidth = 1;\n        this._lineDash = [];\n        this._padding = 0;\n        if (options) {\n            this.quality = (_a = options.quality) !== null && _a !== void 0 ? _a : this.quality;\n            this.color = (_b = options.color) !== null && _b !== void 0 ? _b : Color.Black;\n            this.strokeColor = options === null || options === void 0 ? void 0 : options.strokeColor;\n            this.smoothing = (_c = options.smoothing) !== null && _c !== void 0 ? _c : this.smoothing;\n            this.lineWidth = (_d = options.lineWidth) !== null && _d !== void 0 ? _d : this.lineWidth;\n            this.lineDash = (_e = options.lineDash) !== null && _e !== void 0 ? _e : this.lineDash;\n            this.lineCap = (_f = options.lineCap) !== null && _f !== void 0 ? _f : this.lineCap;\n            this.padding = (_g = options.padding) !== null && _g !== void 0 ? _g : this.padding;\n            this.filtering = (_h = options.filtering) !== null && _h !== void 0 ? _h : this.filtering;\n        }\n        this._bitmap = document.createElement('canvas');\n        // get the default canvas width/height as a fallback\n        const bitmapWidth = (_j = options === null || options === void 0 ? void 0 : options.width) !== null && _j !== void 0 ? _j : this._bitmap.width;\n        const bitmapHeight = (_k = options === null || options === void 0 ? void 0 : options.height) !== null && _k !== void 0 ? _k : this._bitmap.height;\n        this.width = bitmapWidth;\n        this.height = bitmapHeight;\n        const maybeCtx = this._bitmap.getContext('2d');\n        if (!maybeCtx) {\n            /* istanbul ignore next */\n            throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\n        }\n        else {\n            this._ctx = maybeCtx;\n        }\n    }\n    cloneRasterOptions() {\n        return {\n            color: this.color ? this.color.clone() : undefined,\n            strokeColor: this.strokeColor ? this.strokeColor.clone() : undefined,\n            smoothing: this.smoothing,\n            lineWidth: this.lineWidth,\n            lineDash: this.lineDash,\n            lineCap: this.lineCap,\n            quality: this.quality,\n            padding: this.padding\n        };\n    }\n    /**\n     * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\n     */\n    get dirty() {\n        return this._dirty;\n    }\n    /**\n     * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\n     * This should be called any time the graphics state changes such that it affects the outputted drawing\n     */\n    flagDirty() {\n        this._dirty = true;\n    }\n    /**\n     * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\n     * to be flagged dirty causing a re-raster on the next draw.\n     *\n     * Any `padding`s or `quality` set will be factored into the width\n     */\n    get width() {\n        return Math.abs(this._getTotalWidth() * this.scale.x);\n    }\n    set width(value) {\n        value /= Math.abs(this.scale.x);\n        this._bitmap.width = value;\n        this._originalWidth = value;\n        this.flagDirty();\n    }\n    /**\n     * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\n     * to be flagged dirty causing a re-raster on the next draw.\n     *\n     * Any `padding` or `quality` set will be factored into the height\n     */\n    get height() {\n        return Math.abs(this._getTotalHeight() * this.scale.y);\n    }\n    set height(value) {\n        value /= Math.abs(this.scale.y);\n        this._bitmap.height = value;\n        this._originalHeight = value;\n        this.flagDirty();\n    }\n    _getTotalWidth() {\n        var _a;\n        return (((_a = this._originalWidth) !== null && _a !== void 0 ? _a : this._bitmap.width) + this.padding * 2) * 1;\n    }\n    _getTotalHeight() {\n        var _a;\n        return (((_a = this._originalHeight) !== null && _a !== void 0 ? _a : this._bitmap.height) + this.padding * 2) * 1;\n    }\n    /**\n     * Returns the local bounds of the Raster including the padding\n     */\n    get localBounds() {\n        return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\n    }\n    /**\n     * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\n     * to be flagged dirty causing a re-raster on the next draw.\n     */\n    get smoothing() {\n        return this._smoothing;\n    }\n    set smoothing(value) {\n        this._smoothing = value;\n        this.flagDirty();\n    }\n    /**\n     * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\n     * flagged dirty causing a re-raster on the next draw.\n     */\n    get color() {\n        return this._color;\n    }\n    set color(value) {\n        this.flagDirty();\n        this._color = watch(value, () => this.flagDirty());\n    }\n    /**\n     * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\n     * flagged dirty causing a re-raster on the next draw.\n     */\n    get strokeColor() {\n        return this._strokeColor;\n    }\n    set strokeColor(value) {\n        this.flagDirty();\n        if (value) {\n            this._strokeColor = watch(value, () => this.flagDirty());\n        }\n    }\n    /**\n     * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\n     * flagged dirty causing a re-raster on the next draw.\n     */\n    get lineWidth() {\n        return this._lineWidth;\n    }\n    set lineWidth(value) {\n        this._lineWidth = value;\n        this.flagDirty();\n    }\n    get lineDash() {\n        return this._lineDash;\n    }\n    set lineDash(value) {\n        this._lineDash = value;\n        this.flagDirty();\n    }\n    get padding() {\n        return this._padding;\n    }\n    set padding(value) {\n        this._padding = value;\n        this.flagDirty();\n    }\n    /**\n     * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\n     * the graphic is {@apilink Raster.dirty} on the next {@apilink Graphic.draw} call\n     */\n    rasterize() {\n        this._dirty = false;\n        this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\n        this._ctx.save();\n        this._applyRasterProperties(this._ctx);\n        this.execute(this._ctx);\n        this._ctx.restore();\n    }\n    _applyRasterProperties(ctx) {\n        var _a, _b, _c, _d;\n        this._bitmap.width = this._getTotalWidth() * this.quality;\n        this._bitmap.height = this._getTotalHeight() * this.quality;\n        // Do a bad thing to pass the filtering as an attribute\n        this._bitmap.setAttribute('filtering', this.filtering);\n        this._bitmap.setAttribute('forceUpload', 'true');\n        ctx.scale(this.quality, this.quality);\n        ctx.translate(this.padding, this.padding);\n        ctx.imageSmoothingEnabled = this.smoothing;\n        ctx.lineWidth = this.lineWidth;\n        ctx.setLineDash((_a = this.lineDash) !== null && _a !== void 0 ? _a : ctx.getLineDash());\n        ctx.lineCap = this.lineCap;\n        ctx.strokeStyle = (_c = (_b = this.strokeColor) === null || _b === void 0 ? void 0 : _b.toString()) !== null && _c !== void 0 ? _c : '';\n        ctx.fillStyle = (_d = this.color) === null || _d === void 0 ? void 0 : _d.toString();\n    }\n    _drawImage(ex, x, y) {\n        if (this._dirty) {\n            this.rasterize();\n        }\n        ex.scale(1 / this.quality, 1 / this.quality);\n        ex.drawImage(this._bitmap, x, y);\n    }\n}\n\n;// ./Graphics/FontCommon.ts\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nvar FontUnit;\n(function (FontUnit) {\n    /**\n     * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n     */\n    FontUnit[\"Em\"] = \"em\";\n    /**\n     * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n     */\n    FontUnit[\"Rem\"] = \"rem\";\n    /**\n     * Pixel is a unit of length in screen pixels\n     */\n    FontUnit[\"Px\"] = \"px\";\n    /**\n     * Point is a physical unit length (1/72 of an inch)\n     */\n    FontUnit[\"Pt\"] = \"pt\";\n    /**\n     * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n     */\n    FontUnit[\"Percent\"] = \"%\";\n})(FontUnit || (FontUnit = {}));\n/**\n * Enum representing the different horizontal text alignments\n */\nvar TextAlign;\n(function (TextAlign) {\n    /**\n     * The text is left-aligned.\n     */\n    TextAlign[\"Left\"] = \"left\";\n    /**\n     * The text is right-aligned.\n     */\n    TextAlign[\"Right\"] = \"right\";\n    /**\n     * The text is centered.\n     */\n    TextAlign[\"Center\"] = \"center\";\n    /**\n     * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n     * right-aligned for right-to-left locales).\n     */\n    TextAlign[\"Start\"] = \"start\";\n    /**\n     * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n     * left-aligned for right-to-left locales).\n     */\n    TextAlign[\"End\"] = \"end\";\n})(TextAlign || (TextAlign = {}));\n/**\n * Enum representing the different baseline text alignments\n */\nvar BaseAlign;\n(function (BaseAlign) {\n    /**\n     * The text baseline is the top of the em square.\n     */\n    BaseAlign[\"Top\"] = \"top\";\n    /**\n     * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n     * alphabetic.\n     */\n    BaseAlign[\"Hanging\"] = \"hanging\";\n    /**\n     * The text baseline is the middle of the em square.\n     */\n    BaseAlign[\"Middle\"] = \"middle\";\n    /**\n     * The text baseline is the normal alphabetic baseline.\n     */\n    BaseAlign[\"Alphabetic\"] = \"alphabetic\";\n    /**\n     * The text baseline is the ideographic baseline; this is the bottom of\n     * the body of the characters, if the main body of characters protrudes\n     * beneath the alphabetic baseline.  Currently unsupported; this will\n     * act like alphabetic.\n     */\n    BaseAlign[\"Ideographic\"] = \"ideographic\";\n    /**\n     * The text baseline is the bottom of the bounding box.  This differs\n     * from the ideographic baseline in that the ideographic baseline\n     * doesn't consider descenders.\n     */\n    BaseAlign[\"Bottom\"] = \"bottom\";\n})(BaseAlign || (BaseAlign = {}));\n/**\n * Enum representing the different possible font styles\n */\nvar FontStyle;\n(function (FontStyle) {\n    FontStyle[\"Normal\"] = \"normal\";\n    FontStyle[\"Italic\"] = \"italic\";\n    FontStyle[\"Oblique\"] = \"oblique\";\n})(FontStyle || (FontStyle = {}));\n/**\n * Enum representing the text direction, useful for other languages, or writing text in reverse\n */\nvar Direction;\n(function (Direction) {\n    Direction[\"LeftToRight\"] = \"ltr\";\n    Direction[\"RightToLeft\"] = \"rtl\";\n})(Direction || (Direction = {}));\n\n;// ./Util/DrawUtil.ts\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The {@apilink LineCapStyle} (butt, round, or square)\n */\nfunction line(ctx, color = Color.Red, x1, y1, x2, y2, thickness = 1, cap = 'butt') {\n    ctx.save();\n    ctx.beginPath();\n    ctx.lineWidth = thickness;\n    ctx.lineCap = cap;\n    ctx.strokeStyle = color.toString();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.restore();\n}\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nfunction point(ctx, color = Color.Red, point) {\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n}\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nfunction vector(ctx, color, origin, vector, scale = 1.0) {\n    const c = color ? color.toString() : 'blue';\n    const v = vector.scale(scale);\n    ctx.beginPath();\n    ctx.strokeStyle = c;\n    ctx.moveTo(origin.x, origin.y);\n    ctx.lineTo(origin.x + v.x, origin.y + v.y);\n    ctx.closePath();\n    ctx.stroke();\n}\n/**\n * Draw a round rectangle on a canvas context\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The {@apilink Color} to stroke rectangle with\n * @param fill The {@apilink Color} to fill rectangle with\n */\nfunction roundRect(ctx, x, y, width, height, radius = 5, stroke = Color.White, fill = null) {\n    let br;\n    if (typeof radius === 'number') {\n        br = { tl: radius, tr: radius, br: radius, bl: radius };\n    }\n    else {\n        const defaultRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n        for (const prop in defaultRadius) {\n            if (defaultRadius.hasOwnProperty(prop)) {\n                const side = prop;\n                br[side] = radius[side] || defaultRadius[side];\n            }\n        }\n    }\n    ctx.beginPath();\n    ctx.moveTo(x + br.tl, y);\n    ctx.lineTo(x + width - br.tr, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n    ctx.lineTo(x + width, y + height - br.br);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n    ctx.lineTo(x + br.bl, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n    ctx.lineTo(x, y + br.tl);\n    ctx.quadraticCurveTo(x, y, x + br.tl, y);\n    ctx.closePath();\n    if (fill) {\n        ctx.fillStyle = fill.toString();\n        ctx.fill();\n    }\n    if (stroke) {\n        ctx.strokeStyle = stroke.toString();\n        ctx.stroke();\n    }\n}\n/**\n *\n */\nfunction circle(ctx, x, y, radius, stroke = Color.White, fill = null) {\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, Math.PI * 2);\n    ctx.closePath();\n    if (fill) {\n        ctx.fillStyle = fill.toString();\n        ctx.fill();\n    }\n    if (stroke) {\n        ctx.strokeStyle = stroke.toString();\n        ctx.stroke();\n    }\n}\n\n;// ./Graphics/FontTextInstance.ts\n\n\n\n\nclass FontTextInstance {\n    constructor(font, text, color, maxWidth) {\n        this.font = font;\n        this.text = text;\n        this.color = color;\n        this.maxWidth = maxWidth;\n        this._textFragments = [];\n        this.disposed = false;\n        this._dirty = true;\n        this.canvas = document.createElement('canvas');\n        const ctx = this.canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('Unable to create FontTextInstance, internal canvas failed to create');\n        }\n        this.ctx = ctx;\n        this.dimensions = this.measureText(text);\n        this._setDimension(this.dimensions, this.ctx);\n        this._lastHashCode = this.getHashCode();\n    }\n    measureText(text, maxWidth) {\n        if (this.disposed) {\n            throw Error('Accessing disposed text instance! ' + this.text);\n        }\n        let lines = null;\n        if (maxWidth != null) {\n            lines = this._getLinesFromText(text, maxWidth);\n        }\n        else {\n            lines = text.split('\\n');\n        }\n        const maxWidthLine = lines.reduce((a, b) => {\n            return a.length > b.length ? a : b;\n        });\n        this._applyFont(this.ctx); // font must be applied to the context to measure it\n        const metrics = this.ctx.measureText(maxWidthLine);\n        let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\n        // TODO line height makes the text bounds wonky\n        const lineAdjustedHeight = textHeight * lines.length;\n        textHeight = lineAdjustedHeight;\n        const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\n        const x = 0;\n        const y = 0;\n        const measurement = new BoundingBox({\n            left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.font.padding,\n            top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.font.padding,\n            bottom: y + bottomBounds + this.font.padding,\n            right: x + Math.abs(metrics.actualBoundingBoxRight) + this.font.padding\n        });\n        return measurement;\n    }\n    _setDimension(textBounds, bitmap) {\n        let lineHeightRatio = 1;\n        if (this.font.lineHeight) {\n            lineHeightRatio = this.font.lineHeight / this.font.size;\n        }\n        // Changing the width and height clears the context properties\n        // We double the bitmap width to account for all possible alignment\n        // We scale by \"quality\" so we render text without jaggies\n        bitmap.canvas.width = (textBounds.width + this.font.padding * 2) * 2 * this.font.quality;\n        bitmap.canvas.height = (textBounds.height + this.font.padding * 2) * 2 * this.font.quality * lineHeightRatio;\n    }\n    static getHashCode(font, text, color) {\n        var _a;\n        const hash = text +\n            '__hashcode__' +\n            font.fontString +\n            font.showDebug +\n            font.textAlign +\n            font.baseAlign +\n            font.direction +\n            font.lineHeight +\n            JSON.stringify(font.shadow) +\n            (font.padding.toString() +\n                font.smoothing.toString() +\n                font.lineWidth.toString() +\n                font.lineDash.toString() +\n                ((_a = font.strokeColor) === null || _a === void 0 ? void 0 : _a.toString()) +\n                (color ? color.toString() : font.color.toString()));\n        return hash;\n    }\n    getHashCode(includeColor = true) {\n        return FontTextInstance.getHashCode(this.font, this.text, includeColor ? this.color : undefined);\n    }\n    _applyRasterProperties(ctx) {\n        var _a, _b, _c;\n        ctx.translate(this.font.padding, this.font.padding);\n        ctx.imageSmoothingEnabled = this.font.smoothing;\n        ctx.lineWidth = this.font.lineWidth;\n        ctx.setLineDash((_a = this.font.lineDash) !== null && _a !== void 0 ? _a : ctx.getLineDash());\n        ctx.strokeStyle = (_c = (_b = this.font.strokeColor) === null || _b === void 0 ? void 0 : _b.toString()) !== null && _c !== void 0 ? _c : '';\n        ctx.fillStyle = this.color.toString();\n    }\n    _applyFont(ctx) {\n        ctx.resetTransform();\n        ctx.translate(this.font.padding + ctx.canvas.width / 2, this.font.padding + ctx.canvas.height / 2);\n        ctx.scale(this.font.quality, this.font.quality);\n        ctx.textAlign = this.font.textAlign;\n        ctx.textBaseline = this.font.baseAlign;\n        ctx.font = this.font.fontString;\n        ctx.direction = this.font.direction;\n        if (this.font.shadow) {\n            if (this.font.shadow.color) {\n                ctx.shadowColor = this.font.shadow.color.toString();\n            }\n            if (this.font.shadow.blur) {\n                ctx.shadowBlur = this.font.shadow.blur;\n            }\n            if (this.font.shadow.offset) {\n                ctx.shadowOffsetX = this.font.shadow.offset.x;\n                ctx.shadowOffsetY = this.font.shadow.offset.y;\n            }\n        }\n    }\n    _drawText(ctx, lines, lineHeight) {\n        this._applyRasterProperties(ctx);\n        this._applyFont(ctx);\n        for (let i = 0; i < lines.length; i++) {\n            const line = lines[i];\n            if (this.color) {\n                ctx.fillText(line, 0, i * lineHeight);\n            }\n            if (this.font.strokeColor) {\n                ctx.strokeText(line, 0, i * lineHeight);\n            }\n        }\n        if (this.font.showDebug) {\n            // Horizontal line\n            /* istanbul ignore next */\n            line(ctx, Color.Green, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\n            // Vertical line\n            /* istanbul ignore next */\n            line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\n        }\n    }\n    _splitTextBitmap(bitmap) {\n        const textImages = [];\n        let currentX = 0;\n        let currentY = 0;\n        // 4k is the max for mobile devices\n        const width = Math.min(4096, bitmap.canvas.width);\n        const height = Math.min(4096, bitmap.canvas.height);\n        // Splits the original bitmap into 4k max chunks\n        while (currentX < bitmap.canvas.width) {\n            while (currentY < bitmap.canvas.height) {\n                // create new bitmap\n                const canvas = document.createElement('canvas');\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext('2d');\n                if (!ctx) {\n                    throw new Error('Unable to split internal FontTextInstance bitmap, failed to create internal canvas');\n                }\n                // draw current slice to new bitmap in < 4k chunks\n                ctx.drawImage(bitmap.canvas, currentX, currentY, width, height, 0, 0, width, height);\n                textImages.push({ x: currentX, y: currentY, canvas });\n                currentY += height;\n            }\n            currentX += width;\n            currentY = 0;\n        }\n        return textImages;\n    }\n    flagDirty() {\n        this._dirty = true;\n    }\n    render(ex, x, y, maxWidth) {\n        var _a;\n        if (this.disposed) {\n            throw Error('Accessing disposed text instance! ' + this.text);\n        }\n        this._ex = ex;\n        const hashCode = this.getHashCode();\n        if (this._lastHashCode !== hashCode) {\n            this._dirty = true;\n        }\n        // Calculate image chunks\n        if (this._dirty) {\n            this.dimensions = this.measureText(this.text, maxWidth);\n            this._setDimension(this.dimensions, this.ctx);\n            const lines = this._getLinesFromText(this.text, maxWidth);\n            const lineHeight = (_a = this.font.lineHeight) !== null && _a !== void 0 ? _a : this.dimensions.height / lines.length;\n            // draws the text to the main bitmap\n            this._drawText(this.ctx, lines, lineHeight);\n            // clear any out old fragments\n            if (ex instanceof ExcaliburGraphicsContextWebGL) {\n                for (const frag of this._textFragments) {\n                    ex.textureLoader.delete(frag.canvas);\n                }\n            }\n            // splits to < 4k fragments for large text\n            this._textFragments = this._splitTextBitmap(this.ctx);\n            if (ex instanceof ExcaliburGraphicsContextWebGL) {\n                for (const frag of this._textFragments) {\n                    ex.textureLoader.load(frag.canvas, { filtering: this.font.filtering }, true);\n                }\n            }\n            this._lastHashCode = hashCode;\n            this._dirty = false;\n        }\n        // draws the bitmap fragments to excalibur graphics context\n        for (const frag of this._textFragments) {\n            ex.drawImage(frag.canvas, 0, 0, frag.canvas.width, frag.canvas.height, frag.x / this.font.quality + x - this.ctx.canvas.width / this.font.quality / 2, frag.y / this.font.quality + y - this.ctx.canvas.height / this.font.quality / 2, frag.canvas.width / this.font.quality, frag.canvas.height / this.font.quality);\n        }\n    }\n    dispose() {\n        this.disposed = true;\n        this.dimensions = undefined;\n        this.canvas = undefined;\n        this.ctx = undefined;\n        if (this._ex instanceof ExcaliburGraphicsContextWebGL) {\n            for (const frag of this._textFragments) {\n                this._ex.textureLoader.delete(frag.canvas);\n            }\n        }\n        this._textFragments.length = 0;\n    }\n    _getLinesFromText(text, maxWidth) {\n        var _a;\n        if (this._cachedText === text && this._cachedRenderWidth === maxWidth && ((_a = this._cachedLines) === null || _a === void 0 ? void 0 : _a.length)) {\n            return this._cachedLines;\n        }\n        const lines = text.split('\\n');\n        if (maxWidth == null) {\n            return lines;\n        }\n        // If the current line goes past the maxWidth, append a new line without modifying the underlying text.\n        for (let i = 0; i < lines.length; i++) {\n            let line = lines[i];\n            let newLine = '';\n            if (this.measureText(line).width > maxWidth) {\n                while (this.measureText(line).width > maxWidth) {\n                    newLine = line[line.length - 1] + newLine;\n                    line = line.slice(0, -1); // Remove last character from line\n                }\n                // Update the array with our new values\n                lines[i] = line;\n                lines[i + 1] = newLine;\n            }\n        }\n        this._cachedText = text;\n        this._cachedLines = lines;\n        this._cachedRenderWidth = maxWidth;\n        return lines;\n    }\n}\n\n;// ./Graphics/FontCache.ts\n\n\nclass FontCache {\n    static measureText(text, font, maxWidth) {\n        const hash = FontTextInstance.getHashCode(font, text);\n        if (FontCache._MEASURE_CACHE.has(hash)) {\n            return FontCache._MEASURE_CACHE.get(hash);\n        }\n        FontCache._LOGGER.debug('Font text measurement cache miss');\n        const measurement = font.measureTextWithoutCache(text, maxWidth);\n        FontCache._MEASURE_CACHE.set(hash, measurement);\n        return measurement;\n    }\n    static getTextInstance(text, font, color) {\n        const hash = FontTextInstance.getHashCode(font, text, color);\n        let textInstance = FontCache._TEXT_CACHE.get(hash);\n        if (!textInstance) {\n            textInstance = new FontTextInstance(font, text, color);\n            FontCache._TEXT_CACHE.set(hash, textInstance);\n            FontCache._LOGGER.debug('Font text instance cache miss');\n        }\n        // Cache the bitmap for certain amount of time\n        FontCache._TEXT_USAGE.set(textInstance, performance.now());\n        return textInstance;\n    }\n    static checkAndClearCache() {\n        const deferred = [];\n        const currentHashCodes = new Set();\n        for (const [textInstance, time] of FontCache._TEXT_USAGE.entries()) {\n            // if bitmap hasn't been used in 100 ms clear it\n            if (time + FontCache.FONT_TIMEOUT < performance.now()) {\n                FontCache._LOGGER.debug(`Text cache entry timed out ${textInstance.text}`);\n                deferred.push(textInstance);\n                textInstance.dispose();\n            }\n            else {\n                const hash = textInstance.getHashCode(false);\n                currentHashCodes.add(hash);\n            }\n        }\n        // Deferred removal of text instances\n        deferred.forEach((t) => {\n            FontCache._TEXT_USAGE.delete(t);\n        });\n        // Regenerate text instance cache\n        this._TEXT_CACHE.clear();\n        for (const [textInstance] of this._TEXT_USAGE.entries()) {\n            this._TEXT_CACHE.set(textInstance.getHashCode(), textInstance);\n        }\n        // Regenerated measurement cache\n        const newTextMeasurementCache = new Map();\n        for (const current of currentHashCodes) {\n            if (FontCache._MEASURE_CACHE.has(current)) {\n                newTextMeasurementCache.set(current, FontCache._MEASURE_CACHE.get(current));\n            }\n        }\n        this._MEASURE_CACHE.clear();\n        this._MEASURE_CACHE = newTextMeasurementCache;\n    }\n    static get cacheSize() {\n        return FontCache._TEXT_USAGE.size;\n    }\n    /**\n     * Force clear all cached text bitmaps\n     */\n    static clearCache() {\n        for (const [textInstance] of FontCache._TEXT_USAGE.entries()) {\n            textInstance.dispose();\n        }\n        FontCache._TEXT_USAGE.clear();\n        FontCache._TEXT_CACHE.clear();\n        FontCache._MEASURE_CACHE.clear();\n    }\n}\nFontCache.FONT_TIMEOUT = 500;\nFontCache._LOGGER = Logger.getInstance();\nFontCache._TEXT_USAGE = new Map();\nFontCache._TEXT_CACHE = new Map();\nFontCache._MEASURE_CACHE = new Map();\n\n;// ./Graphics/Font.ts\n\n\n\n\n\n\n\n/**\n * Represents a system or web font in Excalibur\n *\n * If no options specified, the system sans-serif 10 pixel is used\n *\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\n */\nclass Font extends Graphic {\n    constructor(options = {}) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;\n        super(options); // <- Graphics properties\n        /**\n         * Set the font filtering mode, by default set to {@apilink ImageFiltering.Blended} regardless of the engine default smoothing\n         *\n         * If you have a pixel style font that may be a reason to switch this to {@apilink ImageFiltering.Pixel}\n         */\n        this.filtering = ImageFiltering.Blended;\n        /**\n         * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\n         * If quality is set to 1, then just enough raster bitmap is generated to render the text.\n         *\n         * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\n         *\n         * (Default 2)\n         */\n        this.quality = 2;\n        // Raster properties for fonts\n        this.padding = 2;\n        this.smoothing = false;\n        this.lineWidth = 1;\n        this.lineDash = [];\n        this.color = Color.Black;\n        this.family = 'sans-serif';\n        this.style = FontStyle.Normal;\n        this.bold = false;\n        this.unit = FontUnit.Px;\n        this.textAlign = TextAlign.Left;\n        this.baseAlign = BaseAlign.Top;\n        this.direction = Direction.LeftToRight;\n        /**\n         * Font line height in pixels, default line height if unset\n         */\n        this.lineHeight = undefined;\n        this.size = 10;\n        this._textBounds = new BoundingBox();\n        this._textMeasurement = new FontTextInstance(this, '', Color.Black);\n        // Raster properties\n        this.smoothing = (_a = options === null || options === void 0 ? void 0 : options.smoothing) !== null && _a !== void 0 ? _a : this.smoothing;\n        this.padding = (_b = options === null || options === void 0 ? void 0 : options.padding) !== null && _b !== void 0 ? _b : this.padding;\n        this.color = (_c = options === null || options === void 0 ? void 0 : options.color) !== null && _c !== void 0 ? _c : this.color;\n        this.strokeColor = (_d = options === null || options === void 0 ? void 0 : options.strokeColor) !== null && _d !== void 0 ? _d : this.strokeColor;\n        this.lineDash = (_e = options === null || options === void 0 ? void 0 : options.lineDash) !== null && _e !== void 0 ? _e : this.lineDash;\n        this.lineWidth = (_f = options === null || options === void 0 ? void 0 : options.lineWidth) !== null && _f !== void 0 ? _f : this.lineWidth;\n        this.filtering = (_g = options === null || options === void 0 ? void 0 : options.filtering) !== null && _g !== void 0 ? _g : this.filtering;\n        // Font specific properties\n        this.family = (_h = options === null || options === void 0 ? void 0 : options.family) !== null && _h !== void 0 ? _h : this.family;\n        this.style = (_j = options === null || options === void 0 ? void 0 : options.style) !== null && _j !== void 0 ? _j : this.style;\n        this.bold = (_k = options === null || options === void 0 ? void 0 : options.bold) !== null && _k !== void 0 ? _k : this.bold;\n        this.size = (_l = options === null || options === void 0 ? void 0 : options.size) !== null && _l !== void 0 ? _l : this.size;\n        this.unit = (_m = options === null || options === void 0 ? void 0 : options.unit) !== null && _m !== void 0 ? _m : this.unit;\n        this.textAlign = (_o = options === null || options === void 0 ? void 0 : options.textAlign) !== null && _o !== void 0 ? _o : this.textAlign;\n        this.baseAlign = (_p = options === null || options === void 0 ? void 0 : options.baseAlign) !== null && _p !== void 0 ? _p : this.baseAlign;\n        this.direction = (_q = options === null || options === void 0 ? void 0 : options.direction) !== null && _q !== void 0 ? _q : this.direction;\n        this.lineHeight = (_r = options === null || options === void 0 ? void 0 : options.lineHeight) !== null && _r !== void 0 ? _r : this.lineHeight;\n        this.quality = (_s = options === null || options === void 0 ? void 0 : options.quality) !== null && _s !== void 0 ? _s : this.quality;\n        if (options === null || options === void 0 ? void 0 : options.shadow) {\n            this.shadow = {};\n            this.shadow.blur = (_t = options.shadow.blur) !== null && _t !== void 0 ? _t : this.shadow.blur;\n            this.shadow.offset = (_u = options.shadow.offset) !== null && _u !== void 0 ? _u : this.shadow.offset;\n            this.shadow.color = (_v = options.shadow.color) !== null && _v !== void 0 ? _v : this.shadow.color;\n        }\n    }\n    clone() {\n        return new Font({\n            ...this.cloneGraphicOptions(),\n            size: this.size,\n            unit: this.unit,\n            family: this.family,\n            style: this.style,\n            bold: this.bold,\n            textAlign: this.textAlign,\n            baseAlign: this.baseAlign,\n            direction: this.direction,\n            shadow: this.shadow\n                ? {\n                    blur: this.shadow.blur,\n                    offset: this.shadow.offset,\n                    color: this.shadow.color\n                }\n                : undefined\n        });\n    }\n    get fontString() {\n        return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\n    }\n    get localBounds() {\n        return this._textBounds;\n    }\n    _drawImage(_ex, _x, _y) {\n        // TODO weird vestigial drawimage\n    }\n    _rotate(ex) {\n        var _a;\n        // TODO this needs to change depending on the bounding box...\n        const origin = (_a = this.origin) !== null && _a !== void 0 ? _a : this._textBounds.center;\n        ex.translate(origin.x, origin.y);\n        ex.rotate(this.rotation);\n        ex.translate(-origin.x, -origin.y);\n    }\n    _flip(ex) {\n        if (this.flipHorizontal) {\n            ex.translate(this._textBounds.width / this.scale.x, 0);\n            ex.scale(-1, 1);\n        }\n        if (this.flipVertical) {\n            ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\n            ex.scale(1, -1);\n        }\n    }\n    measureTextWithoutCache(text, maxWidth) {\n        return this._textMeasurement.measureText(text, maxWidth);\n    }\n    /**\n     * Returns a BoundingBox that is the total size of the text including multiple lines\n     *\n     * Does not include any padding or adjustment\n     * @param text\n     * @returns BoundingBox\n     */\n    measureText(text, maxWidth) {\n        return FontCache.measureText(text, this, maxWidth);\n    }\n    _postDraw(ex) {\n        ex.restore();\n    }\n    render(ex, text, colorOverride, x, y, maxWidth) {\n        const textInstance = FontCache.getTextInstance(text, this, colorOverride);\n        // Apply affine transformations\n        this._textBounds = textInstance.dimensions;\n        this._preDraw(ex, x, y);\n        textInstance.render(ex, x, y, maxWidth);\n        this._postDraw(ex);\n    }\n}\n\n;// ./Graphics/Text.ts\n\n\n\n/**\n * Represent Text graphics in excalibur\n *\n * Useful for in game labels, ui, or overlays\n */\nclass Text extends Graphic {\n    constructor(options) {\n        var _a, _b;\n        super(options);\n        this._text = '';\n        this._textWidth = 0;\n        this._textHeight = 0;\n        // This order is important font, color, then text\n        this.font = (_a = options.font) !== null && _a !== void 0 ? _a : new Font();\n        this.color = (_b = options.color) !== null && _b !== void 0 ? _b : this.color;\n        this.text = options.text;\n        this.maxWidth = options.maxWidth;\n    }\n    clone() {\n        var _a, _b;\n        return new Text({\n            text: this.text.slice(),\n            color: (_b = (_a = this.color) === null || _a === void 0 ? void 0 : _a.clone()) !== null && _b !== void 0 ? _b : Color.Black,\n            font: this.font.clone(),\n            maxWidth: this.maxWidth\n        });\n    }\n    get text() {\n        return this._text;\n    }\n    set text(value) {\n        this._text = value;\n        this._calculateDimension();\n    }\n    get font() {\n        return this._font;\n    }\n    set font(font) {\n        this._font = font;\n    }\n    get width() {\n        if (this._textWidth === 0) {\n            this._calculateDimension();\n        }\n        return this._textWidth * this.scale.x;\n    }\n    get height() {\n        if (this._textHeight === 0) {\n            this._calculateDimension();\n        }\n        return this._textHeight * this.scale.y;\n    }\n    _calculateDimension() {\n        const { width, height } = this.font.measureText(this._text, this.maxWidth);\n        this._textWidth = width;\n        this._textHeight = height;\n    }\n    get localBounds() {\n        return this.font.measureText(this._text, this.maxWidth).scale(this.scale);\n    }\n    _rotate(_ex) {\n        // None this is delegated to font\n        // This override erases the default behavior\n    }\n    _flip(_ex) {\n        // None this is delegated to font\n        // This override erases the default behavior\n    }\n    _preDraw(ex, x, y) {\n        if (this.isStale() || this.font.isStale()) {\n            this.font.flipHorizontal = this.flipHorizontal;\n            this.font.flipVertical = this.flipVertical;\n            this.font.rotation = this.rotation;\n            this.font.origin = this.origin;\n            this.font.opacity = this.opacity;\n        }\n        this.font.tint = this.tint;\n        super._preDraw(ex, x, y);\n    }\n    _drawImage(ex, x, y) {\n        var _a;\n        let color = Color.Black;\n        if (this.font instanceof Font) {\n            color = (_a = this.color) !== null && _a !== void 0 ? _a : this.font.color;\n        }\n        const { width, height } = this.font.measureText(this._text, this.maxWidth);\n        this._textWidth = width;\n        this._textHeight = height;\n        this.font.render(ex, this._text, color, x, y, this.maxWidth);\n        if (this.font.showDebug) {\n            ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\n            if (this.maxWidth != null) {\n                ex.debug.drawRect(x, y, this.maxWidth, this.height, {\n                    color: Color.Yellow\n                });\n            }\n        }\n    }\n}\n\n;// ./Graphics/GraphicsComponent.ts\n\n\n\n\n\n\n\n\n\n\n/**\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\n * @param graphic\n */\nfunction hasGraphicsTick(graphic) {\n    return !!graphic.tick;\n}\n/**\n * Component to manage drawings, using with the position component\n */\nclass GraphicsComponent extends Component {\n    /**\n     * Sets or gets wether any drawing should be visible in this component\n     * @deprecated use isVisible\n     */\n    get visible() {\n        return this.isVisible;\n    }\n    /**\n     * Sets or gets wether any drawing should be visible in this component\n     * @deprecated use isVisible\n     */\n    set visible(val) {\n        this.isVisible = val;\n    }\n    /**\n     * Offset to apply to graphics by default\n     */\n    get offset() {\n        return this._offset;\n    }\n    set offset(value) {\n        this._offset = new WatchVector(value, () => this.recalculateBounds());\n        this.recalculateBounds();\n    }\n    /**\n     * Anchor to apply to graphics by default\n     */\n    get anchor() {\n        return this._anchor;\n    }\n    set anchor(value) {\n        this._anchor = new WatchVector(value, () => this.recalculateBounds());\n        this.recalculateBounds();\n    }\n    /**\n     * Sets the color of the actor's current graphic\n     */\n    get color() {\n        return this._color;\n    }\n    set color(v) {\n        if (v) {\n            this._color = v.clone();\n            const currentGraphic = this.graphics.current;\n            if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\n                currentGraphic.color = this._color;\n            }\n        }\n    }\n    constructor(options) {\n        super();\n        this._logger = Logger.getInstance();\n        this._current = 'default';\n        this._graphics = {};\n        this._options = {};\n        this.material = null;\n        /**\n         * Sets or gets wether any drawing should be visible in this component\n         */\n        this.isVisible = true;\n        /**\n         * Optionally force the graphic onscreen, default false. Not recommend to use for perf reasons, only if you known what you're doing.\n         */\n        this.forceOnScreen = false;\n        /**\n         * Sets or gets wither all drawings should have an opacity applied\n         */\n        this.opacity = 1;\n        this._offset = new WatchVector(Vector.Zero, () => this.recalculateBounds());\n        this._anchor = new WatchVector(Vector.Half, () => this.recalculateBounds());\n        /**\n         * Flip all graphics horizontally along the y-axis\n         */\n        this.flipHorizontal = false;\n        /**\n         * Flip all graphics vertically along the x-axis\n         */\n        this.flipVertical = false;\n        /**\n         * If set to true graphics added to the component will be copied. This can effect performance, but is useful if you don't want\n         * changes to a graphic to effect all the places it is used.\n         */\n        this.copyGraphics = false;\n        // Defaults\n        options = {\n            visible: this.isVisible,\n            graphics: {},\n            ...options\n        };\n        const { current, anchor, color, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw, onPreTransformDraw, onPostTransformDraw } = options;\n        for (const [key, graphicOrOptions] of Object.entries(graphics)) {\n            if (graphicOrOptions instanceof Graphic) {\n                this._graphics[key] = graphicOrOptions;\n            }\n            else {\n                this._graphics[key] = graphicOrOptions.graphic;\n                this._options[key] = graphicOrOptions.options;\n            }\n        }\n        this.offset = offset !== null && offset !== void 0 ? offset : this.offset;\n        this.opacity = opacity !== null && opacity !== void 0 ? opacity : this.opacity;\n        this.anchor = anchor !== null && anchor !== void 0 ? anchor : this.anchor;\n        this.color = color !== null && color !== void 0 ? color : this.color;\n        this.copyGraphics = copyGraphics !== null && copyGraphics !== void 0 ? copyGraphics : this.copyGraphics;\n        this.onPreDraw = onPreDraw !== null && onPreDraw !== void 0 ? onPreDraw : this.onPreDraw;\n        this.onPostDraw = onPostDraw !== null && onPostDraw !== void 0 ? onPostDraw : this.onPostDraw;\n        this.onPreDraw = onPreTransformDraw !== null && onPreTransformDraw !== void 0 ? onPreTransformDraw : this.onPreTransformDraw;\n        this.onPostTransformDraw = onPostTransformDraw !== null && onPostTransformDraw !== void 0 ? onPostTransformDraw : this.onPostTransformDraw;\n        this.isVisible = !!visible;\n        this._current = current !== null && current !== void 0 ? current : this._current;\n        if (current && this._graphics[current]) {\n            this.use(current);\n        }\n    }\n    getGraphic(name) {\n        return this._graphics[name];\n    }\n    getOptions(name) {\n        return this._options[name];\n    }\n    /**\n     * Get registered graphics names\n     */\n    getNames() {\n        return Object.keys(this._graphics);\n    }\n    /**\n     * Returns the currently displayed graphic\n     */\n    get current() {\n        return this._graphics[this._current];\n    }\n    /**\n     * Returns the currently displayed graphic offsets\n     */\n    get currentOptions() {\n        return this._options[this._current];\n    }\n    /**\n     * Returns all graphics associated with this component\n     */\n    get graphics() {\n        return this._graphics;\n    }\n    /**\n     * Returns all graphics options associated with this component\n     */\n    get options() {\n        return this._options;\n    }\n    add(nameOrGraphic, graphicOrOptions, options) {\n        let name = 'default';\n        let graphicToSet = null;\n        let optionsToSet = undefined;\n        if (typeof nameOrGraphic === 'string' && graphicOrOptions instanceof Graphic) {\n            name = nameOrGraphic;\n            graphicToSet = graphicOrOptions;\n            optionsToSet = options;\n        }\n        if (nameOrGraphic instanceof Graphic && !(graphicOrOptions instanceof Graphic)) {\n            graphicToSet = nameOrGraphic;\n            optionsToSet = graphicOrOptions;\n        }\n        if (!graphicToSet) {\n            throw new Error('Need to provide a graphic or valid graphic string');\n        }\n        this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\n        this._options[name] = this.copyGraphics ? { ...optionsToSet } : optionsToSet;\n        if (name === 'default') {\n            this.use('default');\n        }\n        return graphicToSet;\n    }\n    /**\n     * Removes a registered graphic, if the removed graphic is the current it will switch to the default\n     * @param name\n     */\n    remove(name) {\n        delete this._graphics[name];\n        delete this._options[name];\n        if (this._current === name) {\n            this._current = 'default';\n            this.recalculateBounds();\n        }\n    }\n    /**\n     * Use a graphic only, will set the default graphic. Returns the new {@apilink Graphic}\n     *\n     * Optionally override the stored options\n     * @param nameOrGraphic\n     * @param options\n     */\n    use(nameOrGraphic, options) {\n        var _a;\n        if (nameOrGraphic instanceof Graphic) {\n            let graphic = nameOrGraphic;\n            if (this.copyGraphics) {\n                graphic = nameOrGraphic.clone();\n            }\n            this._current = 'default';\n            this._graphics[this._current] = graphic;\n            this._options[this._current] = options;\n        }\n        else {\n            this._current = nameOrGraphic;\n            this._options[this._current] = options;\n            if (!(this._current in this._graphics)) {\n                this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(_a = this.owner) === null || _a === void 0 ? void 0 : _a.name}. Nothing will be drawn.`);\n            }\n        }\n        this.recalculateBounds();\n        return this.current;\n    }\n    /**\n     * Hide currently shown graphic\n     */\n    hide() {\n        this._current = 'ex.none';\n    }\n    set localBounds(bounds) {\n        this._localBounds = bounds;\n    }\n    recalculateBounds() {\n        let bb = new BoundingBox();\n        const graphic = this._graphics[this._current];\n        const options = this._options[this._current];\n        if (!graphic) {\n            this._localBounds = bb;\n            return;\n        }\n        let anchor = this.anchor;\n        let offset = this.offset;\n        if (options === null || options === void 0 ? void 0 : options.anchor) {\n            anchor = options.anchor;\n        }\n        if (options === null || options === void 0 ? void 0 : options.offset) {\n            offset = options.offset;\n        }\n        const bounds = graphic.localBounds;\n        const offsetX = -bounds.width * anchor.x + offset.x;\n        const offsetY = -bounds.height * anchor.y + offset.y;\n        if (graphic instanceof GraphicsGroup && !graphic.useAnchor) {\n            bb = graphic === null || graphic === void 0 ? void 0 : graphic.localBounds.combine(bb);\n        }\n        else {\n            bb = graphic === null || graphic === void 0 ? void 0 : graphic.localBounds.translate(vec(offsetX, offsetY)).combine(bb);\n        }\n        this._localBounds = bb;\n    }\n    /**\n     * Get local bounds of graphics component\n     */\n    get localBounds() {\n        if (!this._localBounds || this._localBounds.hasZeroDimensions()) {\n            this.recalculateBounds();\n        }\n        return this._localBounds; // recalc guarantees type\n    }\n    /**\n     * Get world bounds of graphics component\n     */\n    get bounds() {\n        let bounds = this.localBounds;\n        if (this.owner) {\n            const tx = this.owner.get(TransformComponent);\n            if (tx) {\n                bounds = bounds.transform(tx.get().matrix);\n            }\n        }\n        return bounds;\n    }\n    /**\n     * Update underlying graphics if necessary, called internally\n     * @param elapsed\n     * @internal\n     */\n    update(elapsed, idempotencyToken = 0) {\n        const graphic = this.current;\n        if (graphic && hasGraphicsTick(graphic)) {\n            graphic.tick(elapsed, idempotencyToken);\n        }\n    }\n    clone() {\n        const graphics = new GraphicsComponent();\n        graphics._graphics = { ...this._graphics };\n        graphics._options = { ...this._options };\n        graphics.offset = this.offset.clone();\n        if (this.color) {\n            graphics.color = this.color.clone();\n        }\n        graphics.opacity = this.opacity;\n        graphics.anchor = this.anchor.clone();\n        graphics.copyGraphics = this.copyGraphics;\n        graphics.onPreDraw = this.onPreDraw;\n        graphics.onPostDraw = this.onPostDraw;\n        graphics.isVisible = this.isVisible;\n        return graphics;\n    }\n}\n\n;// ./Events.ts\nvar EventTypes;\n(function (EventTypes) {\n    EventTypes[\"Kill\"] = \"kill\";\n    EventTypes[\"PreKill\"] = \"prekill\";\n    EventTypes[\"PostKill\"] = \"postkill\";\n    EventTypes[\"PreDraw\"] = \"predraw\";\n    EventTypes[\"PostDraw\"] = \"postdraw\";\n    EventTypes[\"PreDebugDraw\"] = \"predebugdraw\";\n    EventTypes[\"PostDebugDraw\"] = \"postdebugdraw\";\n    EventTypes[\"PreUpdate\"] = \"preupdate\";\n    EventTypes[\"PostUpdate\"] = \"postupdate\";\n    EventTypes[\"PreFrame\"] = \"preframe\";\n    EventTypes[\"PostFrame\"] = \"postframe\";\n    EventTypes[\"PreCollision\"] = \"precollision\";\n    EventTypes[\"CollisionStart\"] = \"collisionstart\";\n    EventTypes[\"CollisionEnd\"] = \"collisionend\";\n    EventTypes[\"PostCollision\"] = \"postcollision\";\n    EventTypes[\"Initialize\"] = \"initialize\";\n    EventTypes[\"Activate\"] = \"activate\";\n    EventTypes[\"Deactivate\"] = \"deactivate\";\n    EventTypes[\"ExitViewport\"] = \"exitviewport\";\n    EventTypes[\"EnterViewport\"] = \"enterviewport\";\n    EventTypes[\"ExitTrigger\"] = \"exit\";\n    EventTypes[\"EnterTrigger\"] = \"enter\";\n    EventTypes[\"Connect\"] = \"connect\";\n    EventTypes[\"Disconnect\"] = \"disconnect\";\n    EventTypes[\"Button\"] = \"button\";\n    EventTypes[\"Axis\"] = \"axis\";\n    EventTypes[\"Visible\"] = \"visible\";\n    EventTypes[\"Hidden\"] = \"hidden\";\n    EventTypes[\"Start\"] = \"start\";\n    EventTypes[\"Stop\"] = \"stop\";\n    EventTypes[\"PointerUp\"] = \"pointerup\";\n    EventTypes[\"PointerDown\"] = \"pointerdown\";\n    EventTypes[\"PointerMove\"] = \"pointermove\";\n    EventTypes[\"PointerEnter\"] = \"pointerenter\";\n    EventTypes[\"PointerLeave\"] = \"pointerleave\";\n    EventTypes[\"PointerCancel\"] = \"pointercancel\";\n    EventTypes[\"PointerWheel\"] = \"pointerwheel\";\n    EventTypes[\"Up\"] = \"up\";\n    EventTypes[\"Down\"] = \"down\";\n    EventTypes[\"Move\"] = \"move\";\n    EventTypes[\"Enter\"] = \"enter\";\n    EventTypes[\"Leave\"] = \"leave\";\n    EventTypes[\"Cancel\"] = \"cancel\";\n    EventTypes[\"Wheel\"] = \"wheel\";\n    EventTypes[\"Press\"] = \"press\";\n    EventTypes[\"Release\"] = \"release\";\n    EventTypes[\"Hold\"] = \"hold\";\n    EventTypes[\"PointerDragStart\"] = \"pointerdragstart\";\n    EventTypes[\"PointerDragEnd\"] = \"pointerdragend\";\n    EventTypes[\"PointerDragEnter\"] = \"pointerdragenter\";\n    EventTypes[\"PointerDragLeave\"] = \"pointerdragleave\";\n    EventTypes[\"PointerDragMove\"] = \"pointerdragmove\";\n    EventTypes[\"ActionStart\"] = \"actionstart\";\n    EventTypes[\"ActionComplete\"] = \"actioncomplete\";\n    EventTypes[\"Add\"] = \"add\";\n    EventTypes[\"Remove\"] = \"remove\";\n})(EventTypes || (EventTypes = {}));\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nclass GameEvent {\n    constructor() {\n        /**\n         * Other target object for this event\n         */\n        this.other = null;\n        this._bubbles = true;\n    }\n    /**\n     * If set to false, prevents event from propagating to other actors. If true it will be propagated\n     * to all actors that apply.\n     */\n    get bubbles() {\n        return this._bubbles;\n    }\n    set bubbles(value) {\n        this._bubbles = value;\n    }\n    /**\n     * Prevents event from bubbling\n     */\n    stopPropagation() {\n        this.bubbles = false;\n    }\n}\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nclass KillEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nclass PreKillEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nclass PostKillEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nclass GameStartEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nclass GameStopEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nclass PreDrawEvent extends GameEvent {\n    constructor(ctx, elapsedMs, self) {\n        super();\n        this.ctx = ctx;\n        this.elapsedMs = elapsedMs;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nclass PostDrawEvent extends GameEvent {\n    constructor(ctx, elapsedMs, self) {\n        super();\n        this.ctx = ctx;\n        this.elapsedMs = elapsedMs;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'pretransformdraw' event is emitted on actors/entities before any graphics transforms have taken place.\n * Useful if you need to completely customize the draw or modify the transform before drawing in the draw step (for example needing\n * latest camera positions)\n *\n */\nclass PreTransformDrawEvent extends GameEvent {\n    constructor(ctx, elapsedMs, self) {\n        super();\n        this.ctx = ctx;\n        this.elapsedMs = elapsedMs;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'posttransformdraw' event is emitted on actors/entities after all graphics have been draw and transforms reset.\n * Useful if you need to completely custom the draw after everything is done.\n *\n */\nclass PostTransformDrawEvent extends GameEvent {\n    constructor(ctx, elapsedMs, self) {\n        super();\n        this.ctx = ctx;\n        this.elapsedMs = elapsedMs;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nclass PreDebugDrawEvent extends GameEvent {\n    constructor(ctx, self) {\n        super();\n        this.ctx = ctx;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nclass PostDebugDrawEvent extends GameEvent {\n    constructor(ctx, self) {\n        super();\n        this.ctx = ctx;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nclass PreUpdateEvent extends GameEvent {\n    constructor(engine, elapsedMs, self) {\n        super();\n        this.engine = engine;\n        this.elapsedMs = elapsedMs;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nclass PostUpdateEvent extends GameEvent {\n    constructor(engine, elapsedMs, self) {\n        super();\n        this.engine = engine;\n        this.elapsedMs = elapsedMs;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nclass PreFrameEvent extends GameEvent {\n    constructor(engine, prevStats) {\n        super();\n        this.engine = engine;\n        this.prevStats = prevStats;\n        this.target = engine;\n    }\n}\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nclass PostFrameEvent extends GameEvent {\n    constructor(engine, stats) {\n        super();\n        this.engine = engine;\n        this.stats = stats;\n        this.target = engine;\n    }\n}\n/**\n * Event received when a gamepad is connected to Excalibur. {@apilink Gamepads} receives this event.\n */\nclass GamepadConnectEvent extends GameEvent {\n    constructor(index, gamepad) {\n        super();\n        this.index = index;\n        this.gamepad = gamepad;\n        this.target = gamepad;\n    }\n}\n/**\n * Event received when a gamepad is disconnected from Excalibur. {@apilink Gamepads} receives this event.\n */\nclass GamepadDisconnectEvent extends GameEvent {\n    constructor(index, gamepad) {\n        super();\n        this.index = index;\n        this.gamepad = gamepad;\n        this.target = gamepad;\n    }\n}\n/**\n * Gamepad button event. See {@apilink Gamepads} for information on responding to controller input. {@apilink Gamepad} instances receive this event;\n */\nclass GamepadButtonEvent extends GameEvent {\n    /**\n     * @param button  The Gamepad button\n     * @param value   A numeric value between 0 and 1\n     */\n    constructor(button, value, self) {\n        super();\n        this.button = button;\n        this.value = value;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Gamepad axis event. See {@apilink Gamepads} for information on responding to controller input. {@apilink Gamepad} instances receive this event;\n */\nclass GamepadAxisEvent extends GameEvent {\n    /**\n     * @param axis  The Gamepad axis\n     * @param value A numeric value between -1 and 1\n     */\n    constructor(axis, value, self) {\n        super();\n        this.axis = axis;\n        this.value = value;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event received by the {@apilink Engine} when the browser window is visible on a screen.\n */\nclass VisibleEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event received by the {@apilink Engine} when the browser window is hidden from all screens.\n */\nclass HiddenEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an {@apilink Actor | `actor`} when a collision will occur this frame if it resolves\n */\nclass PreCollisionEvent extends GameEvent {\n    /**\n     * @param self          The actor the event was thrown on\n     * @param other         The actor that will collided with the current actor\n     * @param side          The side that will be collided with the current actor\n     * @param intersection  Intersection vector\n     */\n    constructor(self, other, side, intersection, contact) {\n        super();\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.intersection = intersection;\n        this.contact = contact;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an {@apilink Actor | `actor`} when a collision has been resolved (body reacted) this frame\n */\nclass PostCollisionEvent extends GameEvent {\n    /**\n     * @param self          The actor the event was thrown on\n     * @param other         The actor that did collide with the current actor\n     * @param side          The side that did collide with the current actor\n     * @param intersection  Intersection vector\n     */\n    constructor(self, other, side, intersection, contact) {\n        super();\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.intersection = intersection;\n        this.contact = contact;\n        this.target = self;\n    }\n}\nclass ContactStartEvent {\n    constructor(self, other, side, contact) {\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.contact = contact;\n    }\n}\nclass ContactEndEvent {\n    constructor(self, other, side, lastContact) {\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.lastContact = lastContact;\n    }\n}\nclass CollisionPreSolveEvent {\n    constructor(self, other, side, intersection, contact) {\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.intersection = intersection;\n        this.contact = contact;\n    }\n}\nclass CollisionPostSolveEvent {\n    constructor(self, other, side, intersection, contact) {\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.intersection = intersection;\n        this.contact = contact;\n    }\n}\n/**\n * Event thrown the first time an {@apilink Actor | `actor`} collides with another, after an actor is in contact normal collision events are fired.\n */\nclass CollisionStartEvent extends GameEvent {\n    /**\n     *\n     * @param self\n     * @param other\n     * @param side\n     * @param contact\n     */\n    constructor(self, other, side, contact) {\n        super();\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.contact = contact;\n        this.target = self;\n    }\n}\n/**\n * Event thrown when the {@apilink Actor | `actor`} is no longer colliding with another\n */\nclass CollisionEndEvent extends GameEvent {\n    /**\n     *\n     */\n    constructor(self, other, side, lastContact) {\n        super();\n        this.self = self;\n        this.other = other;\n        this.side = side;\n        this.lastContact = lastContact;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an {@apilink Actor}, {@apilink Scene}, and {@apilink Engine} only once before the first update call\n */\nclass InitializeEvent extends GameEvent {\n    /**\n     * @param engine  The reference to the current engine\n     */\n    constructor(engine, self) {\n        super();\n        this.engine = engine;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on a {@apilink Scene} on activation\n */\nclass ActivateEvent extends GameEvent {\n    /**\n     * @param context  The context for the scene activation\n     */\n    constructor(context, self) {\n        super();\n        this.context = context;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on a {@apilink Scene} on deactivation\n */\nclass DeactivateEvent extends GameEvent {\n    /**\n     * @param context  The context for the scene deactivation\n     */\n    constructor(context, self) {\n        super();\n        this.context = context;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an {@apilink Actor} when the graphics bounds completely leaves the screen.\n */\nclass ExitViewPortEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an {@apilink Actor} when any part of the graphics bounds are on screen.\n */\nclass EnterViewPortEvent extends GameEvent {\n    constructor(self) {\n        super();\n        this.self = self;\n        this.target = self;\n    }\n}\nclass EnterTriggerEvent extends GameEvent {\n    constructor(self, entity) {\n        super();\n        this.self = self;\n        this.entity = entity;\n        this.target = self;\n    }\n}\nclass ExitTriggerEvent extends GameEvent {\n    constructor(self, entity) {\n        super();\n        this.self = self;\n        this.entity = entity;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an {@apilink Actor} when an action starts.\n */\nclass ActionStartEvent extends GameEvent {\n    constructor(action, self) {\n        super();\n        this.action = action;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an {@apilink Actor} when an action completes.\n */\nclass ActionCompleteEvent extends GameEvent {\n    constructor(action, self) {\n        super();\n        this.action = action;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an [[Actor]] when an Actor added to scene.\n */\nclass AddEvent extends GameEvent {\n    constructor(engine, self) {\n        super();\n        this.engine = engine;\n        this.self = self;\n        this.target = self;\n    }\n}\n/**\n * Event thrown on an [[Actor]] when an Actor removed from scene.\n */\nclass RemoveEvent extends GameEvent {\n    constructor(engine, self) {\n        super();\n        this.engine = engine;\n        this.self = self;\n        this.target = self;\n    }\n}\n\n;// ./EntityComponentSystem/Entity.ts\n\n\n\n\n\n\n\n/**\n * AddedComponent message\n */\nclass AddedComponent {\n    constructor(data) {\n        this.data = data;\n        this.type = 'Component Added';\n    }\n}\n/**\n * Type guard to know if message is f an Added Component\n */\nfunction isAddedComponent(x) {\n    return !!x && x.type === 'Component Added';\n}\n/**\n * RemovedComponent message\n */\nclass RemovedComponent {\n    constructor(data) {\n        this.data = data;\n        this.type = 'Component Removed';\n    }\n}\n/**\n * Type guard to know if message is for a Removed Component\n */\nfunction isRemovedComponent(x) {\n    return !!x && x.type === 'Component Removed';\n}\nconst EntityEvents = {\n    Add: 'add',\n    Remove: 'remove',\n    Initialize: 'initialize',\n    PreUpdate: 'preupdate',\n    PostUpdate: 'postupdate',\n    Kill: 'kill'\n};\n/**\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\n *\n * Entities can be strongly typed with the components they contain\n *\n * ```typescript\n * const entity = new Entity<ComponentA | ComponentB>();\n * entity.components.a; // Type ComponentA\n * entity.components.b; // Type ComponentB\n * ```\n */\nclass Entity {\n    constructor(componentsOrOptions, name) {\n        /**\n         * The unique identifier for the entity\n         */\n        this.id = Entity._ID++;\n        this.name = `Entity#${this.id}`;\n        /**\n         * Listen to or emit events for an entity\n         */\n        this.events = new EventEmitter();\n        this._tags = new Set();\n        this.componentAdded$ = new Observable();\n        this.componentRemoved$ = new Observable();\n        this.tagAdded$ = new Observable();\n        this.tagRemoved$ = new Observable();\n        /**\n         * Current components on the entity\n         *\n         * **Do not modify**\n         *\n         * Use addComponent/removeComponent otherwise the ECS will not be notified of changes.\n         */\n        this.components = new Map();\n        this.componentValues = [];\n        this._componentsToRemove = [];\n        /**\n         * The current scene that the entity is in, if any\n         */\n        this.scene = null;\n        /**\n         * Whether this entity is active, if set to false it will be reclaimed\n         */\n        this.isActive = true;\n        this._parent = null;\n        this.childrenAdded$ = new Observable();\n        this.childrenRemoved$ = new Observable();\n        this._children = [];\n        this._isInitialized = false;\n        this._isAdded = false;\n        let componentsToAdd;\n        let nameToAdd;\n        let silence = false;\n        if (Array.isArray(componentsOrOptions)) {\n            componentsToAdd = componentsOrOptions;\n            nameToAdd = name;\n        }\n        else if (componentsOrOptions && typeof componentsOrOptions === 'object') {\n            const { components, name, silenceWarnings } = componentsOrOptions;\n            componentsToAdd = components !== null && components !== void 0 ? components : [];\n            nameToAdd = name;\n            silence = !!silenceWarnings;\n        }\n        if (nameToAdd) {\n            this.name = nameToAdd;\n        }\n        if (componentsToAdd) {\n            for (const component of componentsToAdd) {\n                this.addComponent(component);\n            }\n        }\n        if (false) {}\n    }\n    /**\n     * Whether this entity is active, if set to false it will be reclaimed\n     * @deprecated use isActive\n     */\n    get active() {\n        return this.isActive;\n    }\n    /**\n     * Whether this entity is active, if set to false it will be reclaimed\n     * @deprecated use isActive\n     */\n    set active(val) {\n        this.isActive = val;\n    }\n    /**\n     * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\n     * If parented it will be removed from the parent when killed.\n     */\n    kill() {\n        if (this.isActive) {\n            this.isActive = false;\n            this.unparent();\n        }\n        this.emit('kill', new KillEvent(this));\n    }\n    isKilled() {\n        return !this.isActive;\n    }\n    /**\n     * Specifically get the tags on the entity from {@apilink TagsComponent}\n     */\n    get tags() {\n        return this._tags;\n    }\n    /**\n     * Check if a tag exists on the entity\n     * @param tag name to check for\n     */\n    hasTag(tag) {\n        return this._tags.has(tag);\n    }\n    /**\n     * Adds a tag to an entity\n     * @param tag\n     */\n    addTag(tag) {\n        this._tags.add(tag);\n        this.tagAdded$.notifyAll(tag);\n        return this;\n    }\n    /**\n     * Removes a tag on the entity\n     *\n     * Removals are deferred until the end of update\n     * @param tag\n     */\n    removeTag(tag) {\n        this._tags.delete(tag);\n        this.tagRemoved$.notifyAll(tag);\n        return this;\n    }\n    /**\n     * The types of the components on the Entity\n     */\n    get types() {\n        return Array.from(this.components.keys());\n    }\n    /**\n     * Returns all component instances on entity\n     */\n    getComponents() {\n        return Array.from(this.components.values());\n    }\n    /**\n     * Verifies that an entity has all the required types\n     * @param requiredTypes\n     */\n    hasAll(requiredTypes) {\n        for (let i = 0; i < requiredTypes.length; i++) {\n            if (!this.components.has(requiredTypes[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\n     * Verifies that an entity has all the required tags\n     * @param requiredTags\n     */\n    hasAllTags(requiredTags) {\n        for (let i = 0; i < requiredTags.length; i++) {\n            if (!this.tags.has(requiredTags[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n    get(type) {\n        return this.components.get(type);\n    }\n    get parent() {\n        return this._parent;\n    }\n    /**\n     * Get the direct children of this entity\n     */\n    get children() {\n        return this._children;\n    }\n    /**\n     * Unparents this entity, if there is a parent. Otherwise it does nothing.\n     */\n    unparent() {\n        if (this._parent) {\n            this._parent.removeChild(this);\n            this._parent = null;\n        }\n    }\n    /**\n     * Adds an entity to be a child of this entity\n     * @param entity\n     */\n    addChild(entity) {\n        if (entity.parent === null) {\n            if (this.getAncestors().includes(entity)) {\n                throw new Error('Cycle detected, cannot add entity');\n            }\n            this._children.push(entity);\n            entity._parent = this;\n            this.childrenAdded$.notifyAll(entity);\n        }\n        else {\n            throw new Error('Entity already has a parent, cannot add without unparenting');\n        }\n        return this;\n    }\n    /**\n     * Remove an entity from children if it exists\n     * @param entity\n     */\n    removeChild(entity) {\n        if (entity.parent === this) {\n            removeItemFromArray(entity, this._children);\n            entity._parent = null;\n            this.childrenRemoved$.notifyAll(entity);\n        }\n        return this;\n    }\n    /**\n     * Removes all children from this entity\n     */\n    removeAllChildren() {\n        // Avoid modifying the array issue by walking backwards\n        for (let i = this.children.length - 1; i >= 0; i--) {\n            this.removeChild(this.children[i]);\n        }\n        return this;\n    }\n    /**\n     * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\n     */\n    getAncestors() {\n        const result = [this];\n        let current = this.parent;\n        while (current) {\n            result.push(current);\n            current = current.parent;\n        }\n        return result.reverse();\n    }\n    /**\n     * Returns a list of all the entities that descend from this entity. Includes the current entity.\n     */\n    getDescendants() {\n        let result = [this];\n        let queue = [this];\n        while (queue.length > 0) {\n            const curr = queue.pop();\n            if (curr) {\n                queue = queue.concat(curr.children);\n                result = result.concat(curr.children);\n            }\n        }\n        return result;\n    }\n    /**\n     * Creates a deep copy of the entity and a copy of all its components\n     */\n    clone() {\n        const newEntity = new Entity();\n        for (const c of this.types) {\n            const componentInstance = this.get(c);\n            if (componentInstance) {\n                newEntity.addComponent(componentInstance.clone());\n            }\n        }\n        for (const child of this.children) {\n            newEntity.addChild(child.clone());\n        }\n        return newEntity;\n    }\n    /**\n     * Adds a copy of all the components from another template entity as a \"prefab\"\n     * @param templateEntity Entity to use as a template\n     * @param force Force component replacement if it already exists on the target entity\n     */\n    addTemplate(templateEntity, force = false) {\n        for (const c of templateEntity.getComponents()) {\n            this.addComponent(c.clone(), force);\n        }\n        for (const child of templateEntity.children) {\n            this.addChild(child.clone().addTemplate(child));\n        }\n        return this;\n    }\n    _getClassHierarchyRoot(componentType) {\n        var _a, _b;\n        let current = componentType;\n        let parent = (_a = Object.getPrototypeOf(current.prototype)) === null || _a === void 0 ? void 0 : _a.constructor;\n        while (parent && parent !== Object && parent !== Component) {\n            current = parent;\n            parent = (_b = Object.getPrototypeOf(current.prototype)) === null || _b === void 0 ? void 0 : _b.constructor;\n        }\n        return current;\n    }\n    /**\n     * Adds a component to the entity\n     * @param component Component or Entity to add copy of components from\n     * @param force Optionally overwrite any existing components of the same type\n     */\n    addComponent(component, force = false) {\n        // if component already exists, skip if not forced\n        if (this.has(component.constructor)) {\n            if (force) {\n                // Remove existing component type if exists when forced\n                this.removeComponent(component.constructor, true);\n            }\n            else {\n                // early exit component exits\n                return this;\n            }\n        }\n        // TODO circular dependencies will be a problem\n        if (component.dependencies && component.dependencies.length) {\n            for (const ctor of component.dependencies) {\n                this.addComponent(new ctor());\n            }\n        }\n        component.owner = this;\n        const rootComponent = this._getClassHierarchyRoot(component.constructor);\n        this.components.set(rootComponent, component);\n        this.components.set(component.constructor, component);\n        this.componentValues.push(component);\n        if (component.onAdd) {\n            component.onAdd(this);\n        }\n        this.componentAdded$.notifyAll(component);\n        return this;\n    }\n    /**\n     * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\n     *\n     * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\n     * @param typeOrInstance\n     * @param force\n     */\n    removeComponent(typeOrInstance, force = false) {\n        let type;\n        if (isComponentCtor(typeOrInstance)) {\n            type = typeOrInstance;\n        }\n        else {\n            type = typeOrInstance.constructor;\n        }\n        if (force) {\n            const componentToRemove = this.components.get(type);\n            if (componentToRemove) {\n                this.componentRemoved$.notifyAll(componentToRemove);\n                componentToRemove.owner = undefined;\n                if (componentToRemove.onRemove) {\n                    componentToRemove.onRemove(this);\n                }\n                const componentIndex = this.componentValues.indexOf(componentToRemove);\n                if (componentIndex > -1) {\n                    this.componentValues.splice(componentIndex, 1);\n                }\n            }\n            const rootComponent = this._getClassHierarchyRoot(type);\n            this.components.delete(rootComponent);\n            this.components.delete(type); // remove after the notify to preserve typing\n        }\n        else {\n            this._componentsToRemove.push(type);\n        }\n        return this;\n    }\n    clearComponents() {\n        const components = this.types;\n        for (const c of components) {\n            this.removeComponent(c);\n        }\n    }\n    /**\n     * @hidden\n     * @internal\n     */\n    processComponentRemoval() {\n        for (const type of this._componentsToRemove) {\n            this.removeComponent(type, true);\n        }\n        this._componentsToRemove.length = 0;\n    }\n    /**\n     * Check if a component type exists\n     * @param type\n     */\n    has(type) {\n        return this.components.has(type);\n    }\n    /**\n     * Gets whether the actor is Initialized\n     */\n    get isInitialized() {\n        return this._isInitialized;\n    }\n    get isAdded() {\n        return this._isAdded;\n    }\n    /**\n     * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\n     *\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     * @internal\n     */\n    _initialize(engine) {\n        if (!this.isInitialized) {\n            this.onInitialize(engine);\n            this.events.emit('initialize', new InitializeEvent(engine, this));\n            this._isInitialized = true;\n        }\n    }\n    /**\n     * Adds this Actor, meant to be called by the Scene when Actor is added.\n     *\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     * @internal\n     */\n    _add(engine) {\n        if (!this.isAdded && this.isActive) {\n            this.onAdd(engine);\n            this.events.emit('add', new AddEvent(engine, this));\n            this._isAdded = true;\n        }\n    }\n    /**\n     * Removes Actor, meant to be called by the Scene when Actor is added.\n     *\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     * @internal\n     */\n    _remove(engine) {\n        if (this.isAdded && !this.isActive) {\n            this.onRemove(engine);\n            this.events.emit('remove', new RemoveEvent(engine, this));\n            this._isAdded = false;\n        }\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\n     * @internal\n     */\n    _preupdate(engine, elapsedMs) {\n        this.events.emit('preupdate', new PreUpdateEvent(engine, elapsedMs, this));\n        this.onPreUpdate(engine, elapsedMs);\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\n     * @internal\n     */\n    _postupdate(engine, elapsedMs) {\n        this.events.emit('postupdate', new PostUpdateEvent(engine, elapsedMs, this));\n        this.onPostUpdate(engine, elapsedMs);\n    }\n    /**\n     * `onInitialize` is called before the first update of the entity. This method is meant to be\n     * overridden.\n     *\n     * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n     */\n    onInitialize(engine) {\n        // Override me\n    }\n    /**\n     * `onAdd` is called when Actor is added to scene. This method is meant to be\n     * overridden.\n     *\n     * Synonymous with the event handler `.on('add', (evt) => {...})`\n     */\n    onAdd(engine) {\n        // Override me\n    }\n    /**\n     * `onRemove` is called when Actor is added to scene. This method is meant to be\n     * overridden.\n     *\n     * Synonymous with the event handler `.on('remove', (evt) => {...})`\n     */\n    onRemove(engine) {\n        // Override me\n    }\n    /**\n     * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPreUpdate` is called directly before an entity is updated.\n     */\n    onPreUpdate(engine, elapsedMs) {\n        // Override me\n    }\n    /**\n     * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n     *\n     * `onPostUpdate` is called directly after an entity is updated.\n     */\n    onPostUpdate(engine, elapsedMs) {\n        // Override me\n    }\n    /**\n     *\n     * Entity update lifecycle, called internally\n     * @internal\n     * @param engine\n     * @param elapsedMs\n     */\n    update(engine, elapsedMs) {\n        this._initialize(engine);\n        this._add(engine);\n        this._preupdate(engine, elapsedMs);\n        for (const child of this.children) {\n            child.update(engine, elapsedMs);\n        }\n        this._postupdate(engine, elapsedMs);\n        this._remove(engine);\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        if (handler) {\n            this.events.off(eventName, handler);\n        }\n        else {\n            this.events.off(eventName);\n        }\n    }\n}\nEntity._ID = 0;\n\n;// ./EntityComponentSystem/Components/MotionComponent.ts\n\n\nclass MotionComponent extends Component {\n    constructor() {\n        super(...arguments);\n        /**\n         * The velocity of an entity in pixels per second\n         */\n        this.vel = Vector.Zero;\n        /**\n         * The acceleration of entity in pixels per second^2\n         */\n        this.acc = Vector.Zero;\n        /**\n         * The scale rate of change in scale units per second\n         */\n        this.scaleFactor = Vector.Zero;\n        /**\n         * The angular velocity which is how quickly the entity is rotating in radians per second\n         */\n        this.angularVelocity = 0;\n        /**\n         * The amount of torque applied to the entity, angular acceleration is torque * inertia\n         */\n        this.torque = 0;\n        /**\n         * Inertia can be thought of as the resistance to motion\n         */\n        this.inertia = 1;\n    }\n}\n\n;// ./Collision/Integrator.ts\n\nclass EulerIntegrator {\n    static integrate(transform, motion, totalAcc, elapsedMs) {\n        const seconds = elapsedMs / 1000;\n        // This code looks a little wild, but it's to avoid creating any new Vector instances\n        // integration is done in a tight loop so this is key to avoid GC'ing\n        motion.vel.addEqual(totalAcc.scale(seconds, EulerIntegrator._ACC));\n        transform.pos\n            .add(motion.vel.scale(seconds, EulerIntegrator._VEL), EulerIntegrator._POS)\n            .addEqual(totalAcc.scale(0.5 * seconds * seconds, EulerIntegrator._VEL_ACC));\n        motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n        const rotation = transform.rotation + motion.angularVelocity * seconds;\n        transform.scale.add(motion.scaleFactor.scale(seconds, this._SCALE_FACTOR), EulerIntegrator._SCALE);\n        const tx = transform.get();\n        tx.setTransform(EulerIntegrator._POS, rotation, EulerIntegrator._SCALE);\n    }\n}\n// Scratch vectors to avoid allocation\nEulerIntegrator._POS = new Vector(0, 0);\nEulerIntegrator._SCALE = new Vector(1, 1);\nEulerIntegrator._ACC = new Vector(0, 0);\nEulerIntegrator._VEL = new Vector(0, 0);\nEulerIntegrator._VEL_ACC = new Vector(0, 0);\nEulerIntegrator._SCALE_FACTOR = new Vector(0, 0);\n\n;// ./Particles/Particles.ts\n\n\n\n\n\n\n\n\n\n/**\n/**\n * CPU Particle is used in a {@apilink ParticleEmitter}\n */\nclass Particle extends Entity {\n    constructor(options) {\n        super({ silenceWarnings: true });\n        this.beginColor = Color.White;\n        this.endColor = Color.White;\n        // Life is counted in ms\n        this.life = 300;\n        this.fade = false;\n        // Color transitions\n        this._rRate = 1;\n        this._gRate = 1;\n        this._bRate = 1;\n        this._aRate = 0;\n        this._currentColor = Color.White;\n        this.size = 5;\n        this.sizeRate = 0;\n        this.visible = true;\n        this.isOffscreen = false;\n        this.particleTransform = ParticleTransform.Global;\n        this.name = `Particle#${this.id}`;\n        this.addComponent((this.transform = new TransformComponent()));\n        this.addComponent((this.motion = new MotionComponent()));\n        this.addComponent((this.graphics = new GraphicsComponent()));\n        this.configure(options);\n    }\n    registerEmitter(emitter) {\n        this._emitter = emitter;\n        if (this.particleTransform === ParticleTransform.Global) {\n            const globalPos = this._emitter.transform.globalPos;\n            this.transform.pos = this.transform.pos.add(globalPos);\n            this.motion.vel = this.motion.vel.rotate(this._emitter.transform.globalRotation);\n        }\n    }\n    configure(options) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;\n        this.particleTransform = (_a = options.transform) !== null && _a !== void 0 ? _a : this.particleTransform;\n        this.life = (_b = options.life) !== null && _b !== void 0 ? _b : this.life;\n        this.fade = (_c = options.fade) !== null && _c !== void 0 ? _c : this.fade;\n        this.size = (_d = options.size) !== null && _d !== void 0 ? _d : this.size;\n        this.endColor = (_e = options.endColor) !== null && _e !== void 0 ? _e : this.endColor.clone();\n        this.beginColor = (_f = options.beginColor) !== null && _f !== void 0 ? _f : this.beginColor.clone();\n        this._currentColor = this.beginColor.clone();\n        this.graphic = options.graphic;\n        this.graphics.opacity = (_g = options.opacity) !== null && _g !== void 0 ? _g : this.graphics.opacity;\n        this.transform.pos = (_h = options.pos) !== null && _h !== void 0 ? _h : this.transform.pos;\n        this.transform.rotation = (_j = options.rotation) !== null && _j !== void 0 ? _j : 0;\n        this.transform.scale = vec(1, 1);\n        this.motion.vel = (_k = options.vel) !== null && _k !== void 0 ? _k : this.motion.vel;\n        this.motion.angularVelocity = (_l = options.angularVelocity) !== null && _l !== void 0 ? _l : 0;\n        this.motion.acc = (_m = options.acc) !== null && _m !== void 0 ? _m : this.motion.acc;\n        this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n        this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n        this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n        this._aRate = this.graphics.opacity / this.life;\n        this.startSize = (_o = options.startSize) !== null && _o !== void 0 ? _o : 0;\n        this.endSize = (_p = options.endSize) !== null && _p !== void 0 ? _p : 0;\n        if (this.endSize > 0 && this.startSize > 0) {\n            this.sizeRate = (this.endSize - this.startSize) / this.life;\n            this.size = this.startSize;\n        }\n        if (this.graphic) {\n            this.graphics.use(this.graphic);\n            this.graphics.onPostDraw = undefined;\n        }\n        else {\n            this.graphics.localBounds = BoundingBox.fromDimension(this.size, this.size, Vector.Half);\n            this.graphics.onPostDraw = (ctx) => {\n                ctx.save();\n                ctx.debug.drawPoint(vec(0, 0), { color: this._currentColor, size: this.size });\n                ctx.restore();\n            };\n        }\n    }\n    kill() {\n        var _a;\n        if ((_a = this._emitter) === null || _a === void 0 ? void 0 : _a.isActive) {\n            this._emitter.removeParticle(this);\n        }\n        else {\n            super.kill();\n        }\n    }\n    update(engine, elapsedMs) {\n        this.life = this.life - elapsedMs;\n        if (this.life < 0) {\n            this.kill();\n        }\n        if (this.fade) {\n            this.graphics.opacity = clamp(this._aRate * this.life, 0.0001, 1);\n        }\n        if (this.startSize && this.endSize && this.startSize > 0 && this.endSize > 0) {\n            this.size = clamp(this.sizeRate * elapsedMs + this.size, Math.min(this.startSize, this.endSize), Math.max(this.startSize, this.endSize));\n        }\n        this._currentColor.r = clamp(this._currentColor.r + this._rRate * elapsedMs, 0, 255);\n        this._currentColor.g = clamp(this._currentColor.g + this._gRate * elapsedMs, 0, 255);\n        this._currentColor.b = clamp(this._currentColor.b + this._bRate * elapsedMs, 0, 255);\n        this._currentColor.a = this.graphics.opacity;\n        let accel = this.motion.acc;\n        if (this.focus) {\n            accel = this.focus\n                .sub(this.transform.pos)\n                .normalize()\n                .scale(this.focusAccel || 0)\n                .scale(elapsedMs / 1000);\n        }\n        // Update transform and motion based on Euler linear algebra\n        EulerIntegrator.integrate(this.transform, this.motion, accel, elapsedMs);\n    }\n}\nParticle.DefaultConfig = {\n    beginColor: Color.White,\n    endColor: Color.White,\n    life: 300,\n    fade: false,\n    size: 5,\n    graphic: undefined,\n    startSize: undefined,\n    endSize: undefined\n};\nvar ParticleTransform;\n(function (ParticleTransform) {\n    /**\n     * {@apilink ParticleTransform.Global} is the default and emits particles as if\n     * they were world space objects, useful for most effects.\n     */\n    ParticleTransform[\"Global\"] = \"global\";\n    /**\n     * {@apilink ParticleTransform.Local} particles are children of the emitter and move relative to the emitter\n     * as they would in a parent/child actor relationship.\n     */\n    ParticleTransform[\"Local\"] = \"local\";\n})(ParticleTransform || (ParticleTransform = {}));\n\n;// ./Graphics/Context/particle-renderer/particle-renderer.ts\n\n\n\n\n\n\n\n\n\n\nclass ParticleRenderer {\n    constructor() {\n        this.type = 'ex.particle';\n        this.priority = 0;\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        this._shader = new Shader({\n            gl,\n            vertexSource: particle_vertex,\n            fragmentSource: particle_fragment,\n            onPreLink: (program) => {\n                gl.transformFeedbackVaryings(program, ['finalPosition', 'finalVelocity', 'finalRotation', 'finalAngularVelocity', 'finalLifeMs'], gl.INTERLEAVED_ATTRIBS);\n            }\n        });\n        this._shader.compile();\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n    }\n    _getTexture(image) {\n        const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\n        const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\n        const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX));\n        const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY));\n        const force = image.getAttribute('forceUpload') === 'true' ? true : false;\n        const texture = this._context.textureLoader.load(image, {\n            filtering,\n            wrapping: { x: wrapX, y: wrapY }\n        }, force);\n        // remove force attribute after upload\n        image.removeAttribute('forceUpload');\n        return texture;\n    }\n    draw(renderer, elapsedMs) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        const gl = this._gl;\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        const transform = renderer.particle.transform === ParticleTransform.Local ? this._context.getTransform() : AffineMatrix.identity();\n        this._shader.setUniformAffineMatrix('u_transform', transform);\n        this._shader.setUniformBoolean('fade', renderer.particle.fade ? true : false);\n        this._shader.setUniformBoolean('useTexture', renderer.particle.graphic ? true : false);\n        this._shader.setUniformFloat('maxLifeMs', (_a = renderer.particle.life) !== null && _a !== void 0 ? _a : 2000);\n        this._shader.setUniformFloat('deltaMs', elapsedMs);\n        this._shader.setUniformFloatVector('gravity', (_b = renderer.particle.acc) !== null && _b !== void 0 ? _b : vec(0, 0));\n        this._shader.setUniformFloatColor('beginColor', (_c = renderer.particle.beginColor) !== null && _c !== void 0 ? _c : Color.Transparent);\n        this._shader.setUniformFloatColor('endColor', (_d = renderer.particle.endColor) !== null && _d !== void 0 ? _d : Color.Transparent);\n        let startSize = (_e = renderer.particle.startSize) !== null && _e !== void 0 ? _e : 0;\n        let endSize = (_f = renderer.particle.endSize) !== null && _f !== void 0 ? _f : 0;\n        const size = (_g = renderer.particle.size) !== null && _g !== void 0 ? _g : 0;\n        if (size > 0) {\n            startSize = size;\n            endSize = size;\n        }\n        this._shader.setUniformFloat('startSize', startSize !== null && startSize !== void 0 ? startSize : 10);\n        this._shader.setUniformFloat('endSize', endSize !== null && endSize !== void 0 ? endSize : 10);\n        this._shader.setUniformFloat('startOpacity', (_h = renderer.particle.opacity) !== null && _h !== void 0 ? _h : 1);\n        if (renderer.particle.focus) {\n            this._shader.setUniformFloatVector('focus', renderer.particle.focus);\n            this._shader.setUniformFloat('focusAccel', (_j = renderer.particle.focusAccel) !== null && _j !== void 0 ? _j : 0);\n        }\n        // Particle Graphic (only Sprites right now)\n        if (renderer.particle.graphic) {\n            const graphic = renderer.particle.graphic;\n            const texture = this._getTexture(graphic.image.image);\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            this._shader.setUniformInt('graphic', 0);\n        }\n        // Collision Mask\n        // gl.activeTexture(gl.TEXTURE0 + 1);\n        // gl.bindTexture(gl.TEXTURE_2D, obstacleTex);\n        // gl.uniform1i(u_obstacle, 1);\n        // Blending wont work because ex doesn't have a depth attachment\n        // gl.enable(gl.DEPTH_TEST);\n        // gl.enable(gl.BLEND);\n        // gl.blendEquation(gl.FUNC_ADD);\n        // gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        renderer.draw(gl);\n    }\n    hasPendingDraws() {\n        return false;\n    }\n    flush() {\n        // pass\n    }\n    dispose() {\n        // pass\n    }\n}\n\n;// ./Graphics/Context/image-renderer-v2/image-renderer-v2.frag.glsl\n/* harmony default export */ const image_renderer_v2_frag = (\"#version 300 es\\nprecision mediump float;\\n\\n// UV coord\\nin vec2 v_texcoord;\\n\\n// Textures in the current draw\\nuniform sampler2D u_textures[%%count%%];\\n\\nuniform bool u_pixelart;\\n\\nin float v_texture_index;\\n\\nin float v_opacity;\\n\\nin vec4 v_tint;\\n\\n// texture resolution\\nin vec2 v_res;\\n\\nin vec2 v_uv_min;\\nin vec2 v_uv_max;\\n\\nout vec4 fragColor;\\n\\n// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\\nvec2 uv_iq(in vec2 uv, in vec2 texture_size) {\\n  vec2 pixel = uv * texture_size;\\n\\n  vec2 seam=floor(pixel+.5);\\n  vec2 dudv=fwidth(pixel);\\n  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\\n\\n  return pixel/texture_size;\\n}\\n\\nfloat lerp(float from, float to, float rel){\\n  return ((1. - rel) * from) + (rel * to);\\n}\\n\\nfloat invLerp(float from, float to, float value){\\n  return (value - from) / (to - from);\\n}\\n\\nfloat remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){\\n  float rel = invLerp(origFrom, origTo, value);\\n  return lerp(targetFrom, targetTo, rel);\\n}\\n\\nvoid main(){\\n  // In order to support the most efficient sprite batching, we have multiple\\n  // textures loaded into the gpu (usually 8) this picker logic skips over textures\\n  // that do not apply to a particular sprite.\\n\\n  vec4 color=vec4(1.,0,0,1.);\\n\\n  // GLSL is templated out to pick the right texture and set the vec4 color\\n  vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;\\n  uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, uv.x);\\n  uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, uv.y);\\n\\n  %%texture_picker%%\\n\\n  color.rgb = color.rgb * v_opacity;\\n  color.a = color.a * v_opacity;\\n  fragColor = color * v_tint;\\n}\");\n;// ./Graphics/Context/image-renderer-v2/image-renderer-v2.vert.glsl\n/* harmony default export */ const image_renderer_v2_vert = (\"#version 300 es\\nlayout(location=0) in vec2 pos;\\nlayout(location=1) in vec2 a_texcoord;\\nout vec2 v_texcoord;\\n\\nlayout(location=2) in vec2 a_offset;\\nlayout(location=3) in vec2 a_mat_column1;\\nlayout(location=4) in vec2 a_mat_column2;\\nlayout(location=5) in vec2 a_mat_column3;\\n\\nlayout(location=6) in float a_opacity;\\nout float v_opacity;\\n\\n// Texture resolution (could be bigger than a_siz)\\nlayout(location=7) in vec2 a_res;\\nout vec2 v_res;\\n\\n// Final size of graphic\\nlayout(location=8) in vec2 a_size;\\n\\nlayout(location=9) in lowp float a_texture_index;\\nout lowp float v_texture_index;\\n\\nlayout(location=10) in vec2 a_uv_min;\\nout vec2 v_uv_min;\\n\\nlayout(location=11) in vec2 a_uv_max;\\nout vec2 v_uv_max;\\n\\nlayout(location=12) in vec4 a_tint;\\nout vec4 v_tint;\\n\\nuniform mat4 u_matrix;\\n\\nvoid main(){\\n  mat4 world_mat = mat4(\\n    a_mat_column1.x, a_mat_column1.y, 0., 0.,\\n    a_mat_column2.x, a_mat_column2.y, 0., 0.,\\n    0.             , 0.             , 1., 0.,\\n    a_mat_column3.x, a_mat_column3.y, 0., 1.\\n  );\\n\\n  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);\\n  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);\\n\\n  v_opacity = a_opacity;\\n  v_texcoord = a_texcoord;\\n  v_uv_min = a_uv_min;\\n  v_uv_max = a_uv_max;\\n  v_res = a_res;\\n  v_texture_index = a_texture_index;\\n  v_tint = a_tint;\\n}\");\n;// ./Graphics/Context/image-renderer-v2/image-renderer-v2.ts\n// import { Color } from '../../../Color';\n// import { parseImageFiltering } from '../../Filtering';\n\n\n\n\n\n\n\n\n\n\n\nclass ImageRendererV2 {\n    constructor(options) {\n        this.type = 'ex.image-v2';\n        this.priority = 0;\n        // TODO this could be bigger probably\n        this._maxImages = 20000; // max(uint16) / 6 verts\n        this._maxTextures = 0;\n        this._components = 2 + 2 + 2 + 2 + 1 + 2 + 2 + 1 + 2 + 2 + 4;\n        // Per flush vars\n        this._imageCount = 0;\n        this._textures = [];\n        this._textureIndex = 0;\n        this._textureToIndex = new Map();\n        this._images = new Set();\n        this._vertexIndex = 0;\n        this._imageToWidth = new Map();\n        this._imageToHeight = new Map();\n        this._view = [0, 0, 0, 0];\n        this._dest = [0, 0];\n        this._defaultTint = Color.White;\n        this.pixelArtSampler = options.pixelArtSampler;\n        this.uvPadding = options.uvPadding;\n    }\n    initialize(gl, context) {\n        this._gl = gl;\n        this._context = context;\n        // Transform shader source\n        const maxTexture = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n        const maxComplexity = getMaxShaderComplexity(gl, maxTexture);\n        this._maxTextures = Math.min(maxTexture, maxComplexity);\n        const transformedFrag = this._transformFragmentSource(image_renderer_v2_frag, this._maxTextures);\n        // Compile shader\n        this._shader = new Shader({\n            gl,\n            fragmentSource: transformedFrag,\n            vertexSource: image_renderer_v2_vert\n        });\n        this._shader.compile();\n        // setup uniforms\n        this._shader.use();\n        this._shader.setUniformMatrix('u_matrix', context.ortho);\n        // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\n        this._shader.setUniformIntArray('u_textures', [...Array(this._maxTextures)].map((_, i) => i));\n        this._vao = gl.createVertexArray();\n        gl.bindVertexArray(this._vao);\n        this._quadMesh = new Float32Array([\n            // pos       uv\n            0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0,\n            1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1\n        ]);\n        this._meshBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._meshBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this._quadMesh, gl.STATIC_DRAW);\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 16, 0);\n        gl.enableVertexAttribArray(0);\n        gl.vertexAttribPointer(1, 2, gl.FLOAT, false, 16, 8);\n        gl.enableVertexAttribArray(1);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        // Setup memory layout\n        const components = this._components;\n        this._transformData = new VertexBuffer({\n            gl,\n            size: components * this._maxImages, // components * images\n            type: 'dynamic'\n        });\n        this._transformData.bind();\n        // attributes\n        let offset = 0;\n        let start = 2;\n        const bytesPerFloat = 4;\n        const totalSize = components * 4;\n        // a_offset vec2 - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(2);\n        offset += 2 * bytesPerFloat;\n        // a_mat_column1 vec2 - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(3);\n        offset += 2 * bytesPerFloat;\n        // a_mat_column2 vec2 - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(4);\n        offset += 2 * bytesPerFloat;\n        // a_mat_column3 vec2 - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(5);\n        offset += 2 * bytesPerFloat;\n        // a_opacity float - 1\n        gl.vertexAttribPointer(start++, 1, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(6);\n        offset += 1 * bytesPerFloat;\n        // a_res vec2 - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(7);\n        offset += 2 * bytesPerFloat;\n        // a_size vec2 - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(8);\n        offset += 2 * bytesPerFloat;\n        // a_texture_index - 1\n        gl.vertexAttribPointer(start++, 1, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(9);\n        offset += 1 * bytesPerFloat;\n        // a_uv_min - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(10);\n        offset += 2 * bytesPerFloat;\n        // a_uv_max - 2\n        gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(11);\n        offset += 2 * bytesPerFloat;\n        // a_tint - 4\n        gl.vertexAttribPointer(start++, 4, gl.FLOAT, false, totalSize, offset);\n        gl.enableVertexAttribArray(12);\n        offset += 4 * bytesPerFloat;\n        gl.vertexAttribDivisor(2, 1);\n        gl.vertexAttribDivisor(3, 1);\n        gl.vertexAttribDivisor(4, 1);\n        gl.vertexAttribDivisor(5, 1);\n        gl.vertexAttribDivisor(6, 1);\n        gl.vertexAttribDivisor(7, 1);\n        gl.vertexAttribDivisor(8, 1);\n        gl.vertexAttribDivisor(9, 1);\n        gl.vertexAttribDivisor(10, 1);\n        gl.vertexAttribDivisor(11, 1);\n        gl.vertexAttribDivisor(12, 1);\n        gl.bindVertexArray(null);\n    }\n    _bindData(gl) {\n        // Setup memory layout\n        const components = this._components;\n        this._transformData.bind();\n        this._transformData.upload(components * this._imageCount);\n        gl.bindVertexArray(this._vao);\n    }\n    dispose() {\n        this._transformData.dispose();\n        this._shader.dispose();\n        this._textures.length = 0;\n        this._context = null;\n        this._gl = null;\n    }\n    _transformFragmentSource(source, maxTextures) {\n        let newSource = source.replace('%%count%%', maxTextures.toString());\n        let texturePickerBuilder = '';\n        for (let i = 0; i < maxTextures; i++) {\n            if (i === 0) {\n                texturePickerBuilder += `if (v_texture_index <= ${i}.5) {\\n`;\n            }\n            else {\n                texturePickerBuilder += `   else if (v_texture_index <= ${i}.5) {\\n`;\n            }\n            texturePickerBuilder += `      color = texture(u_textures[${i}], uv);\\n`;\n            texturePickerBuilder += `   }\\n`;\n        }\n        newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\n        return newSource;\n    }\n    _addImageAsTexture(image) {\n        if (this._images.has(image)) {\n            return;\n        }\n        const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\n        const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\n        const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX));\n        const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY));\n        const force = image.getAttribute('forceUpload') === 'true' ? true : false;\n        const texture = this._context.textureLoader.load(image, {\n            filtering,\n            wrapping: { x: wrapX, y: wrapY }\n        }, force);\n        // remove force attribute after upload\n        image.removeAttribute('forceUpload');\n        if (this._textures.indexOf(texture) === -1) {\n            this._textures.push(texture);\n            this._textureToIndex.set(texture, this._textureIndex++);\n            this._images.add(image);\n        }\n    }\n    _bindTextures(gl) {\n        // Bind textures in the correct order\n        const max = Math.min(this._textureIndex, this._maxTextures);\n        for (let i = 0; i < max; i++) {\n            gl.activeTexture(gl.TEXTURE0 + i);\n            gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\n        }\n    }\n    _getTextureIdForImage(image) {\n        var _a;\n        if (image) {\n            const maybeTexture = this._context.textureLoader.get(image);\n            return (_a = this._textureToIndex.get(maybeTexture)) !== null && _a !== void 0 ? _a : -1; //this._textures.indexOf(maybeTexture);\n        }\n        return -1;\n    }\n    _isFull() {\n        if (this._imageCount >= this._maxImages) {\n            return true;\n        }\n        if (this._textures.length >= this._maxTextures) {\n            return true;\n        }\n        return false;\n    }\n    _getImageWidth(image) {\n        let maybeWidth = this._imageToWidth.get(image);\n        if (maybeWidth === undefined) {\n            maybeWidth = image.width;\n            this._imageToWidth.set(image, maybeWidth);\n        }\n        return maybeWidth;\n    }\n    _getImageHeight(image) {\n        let maybeHeight = this._imageToHeight.get(image);\n        if (maybeHeight === undefined) {\n            maybeHeight = image.height;\n            this._imageToHeight.set(image, maybeHeight);\n        }\n        return maybeHeight;\n    }\n    draw(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight) {\n        var _a, _b, _c, _d;\n        // Force a render if the batch is full\n        if (this._isFull()) {\n            this.flush();\n        }\n        this._imageCount++;\n        // This creates and uploads the texture if not already done\n        this._addImageAsTexture(image);\n        const maybeImageWidth = this._getImageWidth(image);\n        const maybeImageHeight = this._getImageHeight(image);\n        let width = maybeImageWidth || swidth || 0;\n        let height = maybeImageHeight || sheight || 0;\n        this._view[0] = 0;\n        this._view[1] = 0;\n        this._view[2] = (_a = swidth !== null && swidth !== void 0 ? swidth : maybeImageWidth) !== null && _a !== void 0 ? _a : 0;\n        this._view[3] = (_b = sheight !== null && sheight !== void 0 ? sheight : maybeImageHeight) !== null && _b !== void 0 ? _b : 0;\n        this._dest[0] = sx !== null && sx !== void 0 ? sx : 1;\n        this._dest[1] = sy !== null && sy !== void 0 ? sy : 1;\n        // If destination is specified, update view and dest\n        if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\n            this._view[0] = sx !== null && sx !== void 0 ? sx : 1;\n            this._view[1] = sy !== null && sy !== void 0 ? sy : 1;\n            this._view[2] = (_c = swidth !== null && swidth !== void 0 ? swidth : maybeImageWidth) !== null && _c !== void 0 ? _c : 0;\n            this._view[3] = (_d = sheight !== null && sheight !== void 0 ? sheight : maybeImageHeight) !== null && _d !== void 0 ? _d : 0;\n            this._dest[0] = dx;\n            this._dest[1] = dy;\n            width = dwidth;\n            height = dheight;\n        }\n        sx = this._view[0];\n        sy = this._view[1];\n        const sw = this._view[2];\n        const sh = this._view[3];\n        // transform based on current context\n        const transform = this._context.getTransform();\n        const opacity = this._context.opacity;\n        const snapToPixel = this._context.snapToPixel;\n        if (snapToPixel) {\n            this._dest[0] = ~~(this._dest[0] + pixelSnapEpsilon);\n            this._dest[1] = ~~(this._dest[1] + pixelSnapEpsilon);\n        }\n        const tint = this._context.tint || this._defaultTint;\n        const textureId = this._getTextureIdForImage(image);\n        const imageWidth = maybeImageWidth || width;\n        const imageHeight = maybeImageHeight || height;\n        const uvx0 = (sx + this.uvPadding) / imageWidth;\n        const uvy0 = (sy + this.uvPadding) / imageHeight;\n        const uvx1 = (sx + sw - this.uvPadding) / imageWidth;\n        const uvy1 = (sy + sh - this.uvPadding) / imageHeight;\n        const txWidth = maybeImageWidth;\n        const txHeight = maybeImageHeight;\n        // update data\n        const vertexBuffer = this._transformData.bufferData;\n        vertexBuffer[this._vertexIndex++] = this._dest[0];\n        vertexBuffer[this._vertexIndex++] = this._dest[1];\n        vertexBuffer[this._vertexIndex++] = transform.data[0];\n        vertexBuffer[this._vertexIndex++] = transform.data[1];\n        vertexBuffer[this._vertexIndex++] = transform.data[2];\n        vertexBuffer[this._vertexIndex++] = transform.data[3];\n        vertexBuffer[this._vertexIndex++] = transform.data[4];\n        vertexBuffer[this._vertexIndex++] = transform.data[5];\n        vertexBuffer[this._vertexIndex++] = opacity;\n        vertexBuffer[this._vertexIndex++] = width;\n        vertexBuffer[this._vertexIndex++] = height;\n        vertexBuffer[this._vertexIndex++] = txWidth;\n        vertexBuffer[this._vertexIndex++] = txHeight;\n        vertexBuffer[this._vertexIndex++] = textureId;\n        vertexBuffer[this._vertexIndex++] = uvx0;\n        vertexBuffer[this._vertexIndex++] = uvy0;\n        vertexBuffer[this._vertexIndex++] = uvx1;\n        vertexBuffer[this._vertexIndex++] = uvy1;\n        vertexBuffer[this._vertexIndex++] = tint.r / 255;\n        vertexBuffer[this._vertexIndex++] = tint.g / 255;\n        vertexBuffer[this._vertexIndex++] = tint.b / 255;\n        vertexBuffer[this._vertexIndex++] = tint.a;\n    }\n    hasPendingDraws() {\n        return this._imageCount !== 0;\n    }\n    flush() {\n        // nothing to draw early exit\n        if (this._imageCount === 0) {\n            return;\n        }\n        const gl = this._gl;\n        // Bind the shader\n        this._shader.use();\n        // Bind the memory layout and upload data\n        this._bindData(gl);\n        // Update ortho matrix uniform\n        this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n        // Turn on pixel art aa sampler\n        this._shader.setUniformBoolean('u_pixelart', this.pixelArtSampler);\n        // Bind textures to\n        this._bindTextures(gl);\n        // Draw all the quads\n        gl.drawArraysInstanced(gl.TRIANGLES, 0, 6, this._imageCount);\n        GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\n        GraphicsDiagnostics.DrawCallCount++;\n        gl.bindVertexArray(null);\n        // Reset\n        this._imageCount = 0;\n        this._vertexIndex = 0;\n        this._textures.length = 0;\n        this._textureIndex = 0;\n        this._textureToIndex.clear();\n        this._images.clear();\n        this._imageToWidth.clear();\n        this._imageToHeight.clear();\n    }\n}\n\n;// ./Graphics/Context/ExcaliburGraphicsContextWebGL.ts\n\n\n\n\n\n\n\n\n\n// renderers\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst pixelSnapEpsilon = 0.0001;\nclass ExcaliburGraphicsContextWebGLDebug {\n    constructor(_webglCtx) {\n        this._webglCtx = _webglCtx;\n        this._debugText = new DebugText();\n    }\n    /**\n     * Draw a debugging rectangle to the context\n     * @param x\n     * @param y\n     * @param width\n     * @param height\n     */\n    drawRect(x, y, width, height, rectOptions = { color: Color.Black }) {\n        this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\n        this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\n        this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\n        this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\n    }\n    /**\n     * Draw a debugging line to the context\n     * @param start\n     * @param end\n     * @param lineOptions\n     */\n    drawLine(start, end, lineOptions) {\n        var _a;\n        this._webglCtx.draw('ex.line', start, end, (_a = lineOptions === null || lineOptions === void 0 ? void 0 : lineOptions.color) !== null && _a !== void 0 ? _a : Color.Black);\n    }\n    /**\n     * Draw a debugging point to the context\n     * @param point\n     * @param pointOptions\n     */\n    drawPoint(point, pointOptions = { color: Color.Black, size: 5 }) {\n        this._webglCtx.draw('ex.point', point, pointOptions.color, pointOptions.size);\n    }\n    drawText(text, pos) {\n        this._debugText.write(this._webglCtx, text, pos);\n    }\n}\nclass ExcaliburGraphicsContextWebGL {\n    get z() {\n        return this._state.current.z;\n    }\n    set z(value) {\n        this._state.current.z = value;\n    }\n    get opacity() {\n        return this._state.current.opacity;\n    }\n    set opacity(value) {\n        this._state.current.opacity = value;\n    }\n    get tint() {\n        return this._state.current.tint;\n    }\n    set tint(color) {\n        this._state.current.tint = color;\n    }\n    get width() {\n        return this.__gl.canvas.width;\n    }\n    get height() {\n        return this.__gl.canvas.height;\n    }\n    get ortho() {\n        return this._ortho;\n    }\n    /**\n     * Checks the underlying webgl implementation if the requested internal resolution is supported\n     * @param dim\n     */\n    checkIfResolutionSupported(dim) {\n        // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\n        let supported = true;\n        if (dim.width > 4096 || dim.height > 4096) {\n            supported = false;\n        }\n        return supported;\n    }\n    constructor(options) {\n        this._logger = Logger.getInstance();\n        this._renderers = new Map();\n        this.imageRenderer = Flags.isEnabled('use-legacy-image-renderer') ? 'ex.image' : 'ex.image-v2';\n        this._isDrawLifecycle = false;\n        this.useDrawSorting = true;\n        this._drawCallPool = new Pool(() => new DrawCall(), undefined, 4000);\n        this._drawCallIndex = 0;\n        this._drawCalls = new Array(4000).fill(null);\n        // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\n        this._postProcessTargets = [];\n        this._postprocessors = [];\n        this._transform = new TransformStack();\n        this._state = new StateStack();\n        /**\n         * Snaps the drawing x/y coordinate to the nearest whole pixel\n         */\n        this.snapToPixel = false;\n        /**\n         * Native context smoothing\n         */\n        this.smoothing = false;\n        /**\n         * Whether the pixel art sampler is enabled for smooth sub pixel anti-aliasing\n         */\n        this.pixelArtSampler = false;\n        /**\n         * UV padding in pixels to use in internal image rendering to prevent texture bleed\n         *\n         */\n        this.uvPadding = 0.01;\n        this.backgroundColor = Color.ExcaliburBlue;\n        this.multiSampleAntialiasing = true;\n        this.transparency = true;\n        this._isContextLost = false;\n        this._disposed = false;\n        this._imageToWidth = new Map();\n        this._imageToHeight = new Map();\n        this.debug = new ExcaliburGraphicsContextWebGLDebug(this);\n        this._totalPostProcessorTime = 0;\n        const { canvasElement, context, enableTransparency, antialiasing, uvPadding, multiSampleAntialiasing, pixelArtSampler, powerPreference, snapToPixel, backgroundColor, useDrawSorting, garbageCollector, handleContextLost, handleContextRestored } = options;\n        this.__gl =\n            context !== null && context !== void 0 ? context : canvasElement.getContext('webgl2', {\n                antialias: antialiasing !== null && antialiasing !== void 0 ? antialiasing : this.smoothing,\n                premultipliedAlpha: false,\n                alpha: enableTransparency !== null && enableTransparency !== void 0 ? enableTransparency : this.transparency,\n                depth: false,\n                powerPreference: powerPreference !== null && powerPreference !== void 0 ? powerPreference : 'high-performance'\n            });\n        if (!this.__gl) {\n            throw Error('Failed to retrieve webgl context from browser');\n        }\n        if (handleContextLost) {\n            this.__gl.canvas.addEventListener('webglcontextlost', handleContextLost, false);\n        }\n        if (handleContextRestored) {\n            this.__gl.canvas.addEventListener('webglcontextrestored', handleContextRestored, false);\n        }\n        this.__gl.canvas.addEventListener('webglcontextlost', () => {\n            this._isContextLost = true;\n        });\n        this.__gl.canvas.addEventListener('webglcontextrestored', () => {\n            this._isContextLost = false;\n        });\n        this.textureLoader = new TextureLoader(this.__gl, garbageCollector);\n        this.snapToPixel = snapToPixel !== null && snapToPixel !== void 0 ? snapToPixel : this.snapToPixel;\n        this.smoothing = antialiasing !== null && antialiasing !== void 0 ? antialiasing : this.smoothing;\n        this.transparency = enableTransparency !== null && enableTransparency !== void 0 ? enableTransparency : this.transparency;\n        this.pixelArtSampler = pixelArtSampler !== null && pixelArtSampler !== void 0 ? pixelArtSampler : this.pixelArtSampler;\n        this.uvPadding = uvPadding !== null && uvPadding !== void 0 ? uvPadding : this.uvPadding;\n        this.multiSampleAntialiasing = typeof multiSampleAntialiasing === 'boolean' ? multiSampleAntialiasing : this.multiSampleAntialiasing;\n        this.samples = typeof multiSampleAntialiasing === 'object' ? multiSampleAntialiasing.samples : undefined;\n        this.backgroundColor = backgroundColor !== null && backgroundColor !== void 0 ? backgroundColor : this.backgroundColor;\n        this.useDrawSorting = useDrawSorting !== null && useDrawSorting !== void 0 ? useDrawSorting : this.useDrawSorting;\n        this._drawCallPool.disableWarnings = true;\n        this._drawCallPool.preallocate();\n        this._init();\n    }\n    dispose() {\n        if (!this._disposed) {\n            this._disposed = true;\n            this.textureLoader.dispose();\n            for (const renderer of this._renderers.values()) {\n                renderer.dispose();\n            }\n            this._renderers.clear();\n            this._drawCallPool.dispose();\n            this._drawCalls.length = 0;\n            this.__gl = null;\n        }\n    }\n    _init() {\n        const gl = this.__gl;\n        // Setup viewport and view matrix\n        this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n        // Clear background\n        gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        // Enable alpha blending\n        // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\n        gl.enable(gl.BLEND);\n        gl.blendEquation(gl.FUNC_ADD);\n        gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n        gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n        gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n        gl.depthMask(false);\n        // Setup builtin renderers\n        this.register(new ImageRenderer({\n            uvPadding: this.uvPadding,\n            pixelArtSampler: this.pixelArtSampler\n        }));\n        this.register(new MaterialRenderer());\n        this.register(new RectangleRenderer());\n        this.register(new CircleRenderer());\n        this.register(new PointRenderer());\n        this.register(new LineRenderer());\n        this.register(new ParticleRenderer());\n        this.register(new ImageRendererV2({\n            uvPadding: this.uvPadding,\n            pixelArtSampler: this.pixelArtSampler\n        }));\n        this.materialScreenTexture = gl.createTexture();\n        if (!this.materialScreenTexture) {\n            throw new Error('Could not create screen texture!');\n        }\n        gl.bindTexture(gl.TEXTURE_2D, this.materialScreenTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        this._screenRenderer = new ScreenPassPainter(gl);\n        this._renderTarget = new RenderTarget({\n            gl,\n            transparency: this.transparency,\n            width: gl.canvas.width,\n            height: gl.canvas.height\n        });\n        this._postProcessTargets = [\n            new RenderTarget({\n                gl,\n                transparency: this.transparency,\n                width: gl.canvas.width,\n                height: gl.canvas.height\n            }),\n            new RenderTarget({\n                gl,\n                transparency: this.transparency,\n                width: gl.canvas.width,\n                height: gl.canvas.height\n            })\n        ];\n        this._msaaTarget = new RenderTarget({\n            gl,\n            transparency: this.transparency,\n            width: gl.canvas.width,\n            height: gl.canvas.height,\n            antialias: this.multiSampleAntialiasing,\n            samples: this.samples\n        });\n    }\n    register(renderer) {\n        this._renderers.set(renderer.type, renderer);\n        renderer.initialize(this.__gl, this);\n    }\n    get(rendererName) {\n        return this._renderers.get(rendererName);\n    }\n    _isCurrentRenderer(renderer) {\n        if (!this._currentRenderer || this._currentRenderer === renderer) {\n            return true;\n        }\n        return false;\n    }\n    beginDrawLifecycle() {\n        this._isDrawLifecycle = true;\n    }\n    endDrawLifecycle() {\n        this._isDrawLifecycle = false;\n    }\n    draw(rendererName, ...args) {\n        if (false) {}\n        if (!this._isDrawLifecycle) {\n            this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\n                `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`);\n        }\n        if (this._isContextLost) {\n            this._logger.errorOnce(`Unable to draw ${rendererName}, the webgl context is lost`);\n            return;\n        }\n        const renderer = this._renderers.get(rendererName);\n        if (renderer) {\n            if (this.useDrawSorting) {\n                const drawCall = this._drawCallPool.get();\n                drawCall.z = this._state.current.z;\n                drawCall.priority = renderer.priority;\n                drawCall.renderer = rendererName;\n                this.getTransform().clone(drawCall.transform);\n                drawCall.state.z = this._state.current.z;\n                drawCall.state.opacity = this._state.current.opacity;\n                drawCall.state.tint = this._state.current.tint;\n                drawCall.state.material = this._state.current.material;\n                drawCall.args[0] = args[0];\n                drawCall.args[1] = args[1];\n                drawCall.args[2] = args[2];\n                drawCall.args[3] = args[3];\n                drawCall.args[4] = args[4];\n                drawCall.args[5] = args[5];\n                drawCall.args[6] = args[6];\n                drawCall.args[7] = args[7];\n                drawCall.args[8] = args[8];\n                drawCall.args[9] = args[9];\n                this._drawCalls[this._drawCallIndex++] = drawCall;\n            }\n            else {\n                // Set the current renderer if not defined\n                if (!this._currentRenderer) {\n                    this._currentRenderer = renderer;\n                }\n                if (!this._isCurrentRenderer(renderer)) {\n                    // switching graphics means we must flush the previous\n                    this._currentRenderer.flush();\n                }\n                // If we are still using the same renderer we can add to the current batch\n                renderer.draw(args[0], args[1], args[2], args[3], args[4], args[5], args[6], args[7], args[8], args[9]);\n                this._currentRenderer = renderer;\n            }\n        }\n        else {\n            throw Error(`No renderer with name ${rendererName} has been registered`);\n        }\n    }\n    resetTransform() {\n        this._transform.reset();\n    }\n    updateViewport(resolution) {\n        const gl = this.__gl;\n        this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\n        this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\n        this._msaaTarget.setResolution(gl.canvas.width, gl.canvas.height);\n        this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\n        this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\n    }\n    _getImageWidth(image) {\n        let maybeWidth = this._imageToWidth.get(image);\n        if (maybeWidth === undefined) {\n            maybeWidth = image.width;\n            this._imageToWidth.set(image, maybeWidth);\n        }\n        return maybeWidth;\n    }\n    _getImageHeight(image) {\n        let maybeHeight = this._imageToHeight.get(image);\n        if (maybeHeight === undefined) {\n            maybeHeight = image.height;\n            this._imageToHeight.set(image, maybeHeight);\n        }\n        return maybeHeight;\n    }\n    drawImage(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight) {\n        if (swidth === 0 || sheight === 0) {\n            return; // zero dimension dest exit early\n        }\n        else if (dwidth === 0 || dheight === 0) {\n            return; // zero dimension dest exit early\n        }\n        else if (this._getImageWidth(image) === 0 || this._getImageHeight(image) === 0) {\n            return; // zero dimension source exit early\n        }\n        if (!image) {\n            Logger.getInstance().warn('Cannot draw a null or undefined image');\n            // tslint:disable-next-line: no-console\n            if (console.trace) {\n                // tslint:disable-next-line: no-console\n                console.trace();\n            }\n            return;\n        }\n        if (this._state.current.material) {\n            this.draw('ex.material', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\n        }\n        else {\n            if (this.imageRenderer === 'ex.image') {\n                this.draw(this.imageRenderer, image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\n            }\n            else {\n                this.draw(this.imageRenderer, image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\n            }\n        }\n    }\n    drawLine(start, end, color, thickness = 1) {\n        this.draw('ex.rectangle', start, end, color, thickness);\n    }\n    drawRectangle(pos, width, height, color, stroke, strokeThickness) {\n        this.draw('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\n    }\n    drawCircle(pos, radius, color, stroke, thickness) {\n        this.draw('ex.circle', pos, radius, color, stroke, thickness);\n    }\n    save() {\n        this._transform.save();\n        this._state.save();\n    }\n    restore() {\n        this._transform.restore();\n        this._state.restore();\n    }\n    translate(x, y) {\n        this._transform.translate(this.snapToPixel ? ~~(x + pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + pixelSnapEpsilon) : y);\n    }\n    rotate(angle) {\n        this._transform.rotate(angle);\n    }\n    scale(x, y) {\n        this._transform.scale(x, y);\n    }\n    transform(matrix) {\n        this._transform.current = matrix;\n    }\n    getTransform() {\n        return this._transform.current;\n    }\n    multiply(m) {\n        this._transform.current.multiply(m, this._transform.current);\n    }\n    addPostProcessor(postprocessor) {\n        this._postprocessors.push(postprocessor);\n        postprocessor.initialize(this.__gl);\n    }\n    removePostProcessor(postprocessor) {\n        const index = this._postprocessors.indexOf(postprocessor);\n        if (index !== -1) {\n            this._postprocessors.splice(index, 1);\n        }\n    }\n    clearPostProcessors() {\n        this._postprocessors.length = 0;\n    }\n    updatePostProcessors(elapsedMs) {\n        for (const postprocessor of this._postprocessors) {\n            const shader = postprocessor.getShader();\n            shader.use();\n            const uniforms = shader.getUniforms();\n            this._totalPostProcessorTime += elapsedMs;\n            if (uniforms.find((u) => u.name === 'u_time_ms')) {\n                shader.setUniformFloat('u_time_ms', this._totalPostProcessorTime);\n            }\n            if (uniforms.find((u) => u.name === 'u_elapsed_ms')) {\n                shader.setUniformFloat('u_elapsed_ms', elapsedMs);\n            }\n            if (uniforms.find((u) => u.name === 'u_resolution')) {\n                shader.setUniformFloatVector('u_resolution', vec(this.width, this.height));\n            }\n            if (postprocessor.onUpdate) {\n                postprocessor.onUpdate(elapsedMs);\n            }\n        }\n    }\n    set material(material) {\n        this._state.current.material = material;\n    }\n    get material() {\n        return this._state.current.material;\n    }\n    /**\n     * Creates and initializes the material which compiles the internal shader\n     * @param options\n     * @returns Material\n     */\n    createMaterial(options) {\n        const material = new Material({ ...options, graphicsContext: this });\n        return material;\n    }\n    createShader(options) {\n        const gl = this.__gl;\n        const { vertexSource, fragmentSource } = options;\n        const shader = new Shader({\n            gl,\n            vertexSource,\n            fragmentSource\n        });\n        shader.compile();\n        return shader;\n    }\n    clear() {\n        const gl = this.__gl;\n        const currentTarget = this.multiSampleAntialiasing ? this._msaaTarget : this._renderTarget;\n        currentTarget.use();\n        gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n        // Clear the context with the newly set color. This is\n        // the function call that actually does the drawing.\n        gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n    /**\n     * Flushes all batched rendering to the screen\n     */\n    flush() {\n        var _a;\n        if (this._isContextLost) {\n            this._logger.errorOnce(`Unable to flush the webgl context is lost`);\n            return;\n        }\n        // render target captures all draws and redirects to the render target\n        let currentTarget = this.multiSampleAntialiasing ? this._msaaTarget : this._renderTarget;\n        currentTarget.use();\n        if (this.useDrawSorting) {\n            // null out unused draw calls\n            for (let i = this._drawCallIndex; i < this._drawCalls.length; i++) {\n                this._drawCalls[i] = null;\n            }\n            // sort draw calls\n            // Find the original order of the first instance of the draw call\n            const originalSort = new Map();\n            for (const [name] of this._renderers) {\n                let firstIndex = 0;\n                for (firstIndex = 0; firstIndex < this._drawCallIndex; firstIndex++) {\n                    if (this._drawCalls[firstIndex].renderer === name) {\n                        break;\n                    }\n                }\n                originalSort.set(name, firstIndex);\n            }\n            this._drawCalls.sort((a, b) => {\n                if (a === null || b === null) {\n                    return 0;\n                }\n                const zIndex = a.z - b.z;\n                const originalSortOrder = originalSort.get(a.renderer) - originalSort.get(b.renderer);\n                const priority = a.priority - b.priority;\n                if (zIndex === 0) {\n                    // sort by z first\n                    if (priority === 0) {\n                        // sort by priority\n                        return originalSortOrder; // use the original order to inform draw call packing to maximally preserve painter order\n                    }\n                    return priority;\n                }\n                return zIndex;\n            });\n            const oldTransform = this._transform.current;\n            const oldState = this._state.current;\n            if (this._drawCalls.length && this._drawCallIndex) {\n                let currentRendererName = this._drawCalls[0].renderer;\n                let currentRenderer = this._renderers.get(currentRendererName);\n                for (let i = 0; i < this._drawCallIndex; i++) {\n                    // hydrate the state for renderers\n                    this._transform.current = this._drawCalls[i].transform;\n                    this._state.current = this._drawCalls[i].state;\n                    if (this._drawCalls[i].renderer !== currentRendererName) {\n                        // switching graphics renderer means we must flush the previous\n                        currentRenderer.flush();\n                        currentRendererName = this._drawCalls[i].renderer;\n                        currentRenderer = this._renderers.get(currentRendererName);\n                    }\n                    // ! hack to grab screen texture before materials run because they might want it\n                    if (currentRenderer instanceof MaterialRenderer && ((_a = this.material) === null || _a === void 0 ? void 0 : _a.isUsingScreenTexture)) {\n                        currentTarget.copyToTexture(this.materialScreenTexture);\n                        currentTarget.use();\n                    }\n                    // If we are still using the same renderer we can add to the current batch\n                    currentRenderer.draw(...this._drawCalls[i].args);\n                }\n                if (currentRenderer.hasPendingDraws()) {\n                    currentRenderer.flush();\n                }\n            }\n            // reset state\n            this._transform.current = oldTransform;\n            this._state.current = oldState;\n            // reclaim draw calls\n            this._drawCallPool.done();\n            this._drawCallIndex = 0;\n            this._imageToHeight.clear();\n            this._imageToWidth.clear();\n        }\n        else {\n            // This is the final flush at the moment to draw any leftover pending draw\n            for (const renderer of this._renderers.values()) {\n                if (renderer.hasPendingDraws()) {\n                    renderer.flush();\n                }\n            }\n        }\n        currentTarget.disable();\n        // post process step\n        if (this._postprocessors.length > 0) {\n            const source = currentTarget.toRenderSource();\n            source.use();\n        }\n        // flip flop render targets for post processing\n        for (let i = 0; i < this._postprocessors.length; i++) {\n            currentTarget = this._postProcessTargets[i % 2];\n            this._postProcessTargets[i % 2].use();\n            this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\n            this._postProcessTargets[i % 2].toRenderSource().use();\n        }\n        // Final blit to the screen\n        currentTarget.blitToScreen();\n    }\n}\n\n;// ./Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts\n\n\n\n\nconst ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon = 0.0001;\nclass ExcaliburGraphicsContext2DCanvasDebug {\n    constructor(_ex) {\n        this._ex = _ex;\n        this._debugText = new DebugText();\n    }\n    /**\n     * Draw a debug rectangle to the context\n     * @param x\n     * @param y\n     * @param width\n     * @param height\n     */\n    drawRect(x, y, width, height) {\n        this._ex.__ctx.save();\n        this._ex.__ctx.strokeStyle = 'red';\n        this._ex.__ctx.strokeRect(this._ex.snapToPixel ? ~~(x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : x, this._ex.snapToPixel ? ~~(y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : y, this._ex.snapToPixel ? ~~(width + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : width, this._ex.snapToPixel ? ~~(height + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : height);\n        this._ex.__ctx.restore();\n    }\n    drawLine(start, end, lineOptions = { color: Color.Black }) {\n        var _a, _b;\n        this._ex.__ctx.save();\n        this._ex.__ctx.beginPath();\n        this._ex.__ctx.strokeStyle = (_b = (_a = lineOptions.color) === null || _a === void 0 ? void 0 : _a.toString()) !== null && _b !== void 0 ? _b : '';\n        this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~(start.x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : start.x, this._ex.snapToPixel ? ~~(start.y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : start.y);\n        this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~(end.x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : end.x, this._ex.snapToPixel ? ~~(end.y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : end.y);\n        this._ex.__ctx.lineWidth = 2;\n        this._ex.__ctx.stroke();\n        this._ex.__ctx.closePath();\n        this._ex.__ctx.restore();\n    }\n    drawPoint(point, pointOptions = { color: Color.Black, size: 5 }) {\n        this._ex.__ctx.save();\n        this._ex.__ctx.beginPath();\n        this._ex.__ctx.fillStyle = pointOptions.color.toString();\n        this._ex.__ctx.arc(this._ex.snapToPixel ? ~~(point.x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : point.x, this._ex.snapToPixel ? ~~(point.y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : point.y, pointOptions.size, 0, Math.PI * 2);\n        this._ex.__ctx.fill();\n        this._ex.__ctx.closePath();\n        this._ex.__ctx.restore();\n    }\n    drawText(text, pos) {\n        this._debugText.write(this._ex, text, pos);\n    }\n}\nclass ExcaliburGraphicsContext2DCanvas {\n    get width() {\n        return this.__ctx.canvas.width;\n    }\n    get height() {\n        return this.__ctx.canvas.height;\n    }\n    get opacity() {\n        return this._state.current.opacity;\n    }\n    set opacity(value) {\n        this._state.current.opacity = value;\n    }\n    get tint() {\n        return this._state.current.tint;\n    }\n    set tint(color) {\n        this._state.current.tint = color;\n    }\n    get smoothing() {\n        return this.__ctx.imageSmoothingEnabled;\n    }\n    set smoothing(value) {\n        this.__ctx.imageSmoothingEnabled = value;\n    }\n    constructor(options) {\n        /**\n         * Unused in Canvas implementation\n         */\n        this.useDrawSorting = false;\n        /**\n         * Unused in Canvas implementation\n         */\n        this.z = 0;\n        this.backgroundColor = Color.ExcaliburBlue;\n        this._state = new StateStack();\n        this.snapToPixel = false;\n        this.debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\n        const { canvasElement, context, enableTransparency, snapToPixel, antialiasing: smoothing, backgroundColor } = options;\n        this.__ctx =\n            context !== null && context !== void 0 ? context : canvasElement.getContext('2d', {\n                alpha: enableTransparency !== null && enableTransparency !== void 0 ? enableTransparency : true\n            });\n        if (!this.__ctx) {\n            throw new Error('Cannot build new ExcaliburGraphicsContext2D for some reason!');\n        }\n        this.backgroundColor = backgroundColor !== null && backgroundColor !== void 0 ? backgroundColor : this.backgroundColor;\n        this.snapToPixel = snapToPixel !== null && snapToPixel !== void 0 ? snapToPixel : this.snapToPixel;\n        this.smoothing = smoothing !== null && smoothing !== void 0 ? smoothing : this.smoothing;\n    }\n    resetTransform() {\n        this.__ctx.resetTransform();\n    }\n    updateViewport(_resolution) {\n        // pass\n    }\n    drawImage(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight) {\n        if (swidth === 0 || sheight === 0) {\n            return; // zero dimension dest exit early\n        }\n        else if (dwidth === 0 || dheight === 0) {\n            return; // zero dimension dest exit early\n        }\n        else if (image.width === 0 || image.height === 0) {\n            return; // zero dimension source exit early\n        }\n        this.__ctx.globalAlpha = this.opacity;\n        const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\n            .filter((a) => a !== undefined)\n            .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\n        this.__ctx.drawImage.apply(this.__ctx, args);\n        GraphicsDiagnostics.DrawCallCount++;\n        GraphicsDiagnostics.DrawnImagesCount = 1;\n    }\n    drawLine(start, end, color, thickness = 1) {\n        this.__ctx.save();\n        this.__ctx.beginPath();\n        this.__ctx.strokeStyle = color.toString();\n        this.__ctx.moveTo(this.snapToPixel ? ~~(start.x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : start.x, this.snapToPixel ? ~~(start.y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : start.y);\n        this.__ctx.lineTo(this.snapToPixel ? ~~(end.x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : end.x, this.snapToPixel ? ~~(end.y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : end.y);\n        this.__ctx.lineWidth = thickness;\n        this.__ctx.stroke();\n        this.__ctx.closePath();\n        this.__ctx.restore();\n    }\n    drawRectangle(pos, width, height, color) {\n        this.__ctx.save();\n        this.__ctx.fillStyle = color.toString();\n        this.__ctx.fillRect(this.snapToPixel ? ~~(pos.x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : pos.x, this.snapToPixel ? ~~(pos.y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : pos.y, this.snapToPixel ? ~~(width + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : width, this.snapToPixel ? ~~(height + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : height);\n        this.__ctx.restore();\n    }\n    drawCircle(pos, radius, color, stroke, thickness) {\n        this.__ctx.save();\n        this.__ctx.beginPath();\n        if (stroke) {\n            this.__ctx.strokeStyle = stroke.toString();\n        }\n        if (thickness) {\n            this.__ctx.lineWidth = thickness;\n        }\n        this.__ctx.fillStyle = color.toString();\n        this.__ctx.arc(this.snapToPixel ? ~~(pos.x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : pos.x, this.snapToPixel ? ~~(pos.y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : pos.y, radius, 0, Math.PI * 2);\n        this.__ctx.fill();\n        if (stroke) {\n            this.__ctx.stroke();\n        }\n        this.__ctx.closePath();\n        this.__ctx.restore();\n    }\n    /**\n     * Save the current state of the canvas to the stack (transforms and opacity)\n     */\n    save() {\n        this.__ctx.save();\n        this._state.save();\n    }\n    /**\n     * Restore the state of the canvas from the stack\n     */\n    restore() {\n        this.__ctx.restore();\n        this._state.restore();\n    }\n    /**\n     * Translate the origin of the context by an x and y\n     * @param x\n     * @param y\n     */\n    translate(x, y) {\n        this.__ctx.translate(this.snapToPixel ? ~~(x + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon) : y);\n    }\n    /**\n     * Rotate the context about the current origin\n     */\n    rotate(angle) {\n        this.__ctx.rotate(angle);\n    }\n    /**\n     * Scale the context by an x and y factor\n     * @param x\n     * @param y\n     */\n    scale(x, y) {\n        this.__ctx.scale(x, y);\n    }\n    getTransform() {\n        throw new Error('Not implemented');\n    }\n    multiply(_m) {\n        this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\n    }\n    addPostProcessor(_postprocessor) {\n        // pass\n    }\n    removePostProcessor(_postprocessor) {\n        // pass\n    }\n    clearPostProcessors() {\n        // pass\n    }\n    updatePostProcessors(elapsedMs) {\n        // pass\n    }\n    beginDrawLifecycle() {\n        // pass\n    }\n    endDrawLifecycle() {\n        // pass\n    }\n    set material(material) {\n        this._state.current.material = material;\n    }\n    get material() {\n        return this._state.current.material;\n    }\n    createMaterial(options) {\n        // pass\n        return null;\n    }\n    clear() {\n        // Clear frame\n        this.__ctx.clearRect(0, 0, this.width, this.height);\n        this.__ctx.fillStyle = this.backgroundColor.toString();\n        this.__ctx.fillRect(0, 0, this.width, this.height);\n        GraphicsDiagnostics.clear();\n    }\n    /**\n     * Flushes the batched draw calls to the screen\n     */\n    flush() {\n        // pass\n    }\n    dispose() {\n        this.__ctx = undefined;\n    }\n}\n\n;// ./Screen.ts\n\n\n\n\n\n\n\n/**\n * Enum representing the different display modes available to Excalibur.\n */\nvar DisplayMode;\n(function (DisplayMode) {\n    /**\n     * Default, use a specified resolution for the game. Like 800x600 pixels for example.\n     */\n    DisplayMode[\"Fixed\"] = \"Fixed\";\n    /**\n     * Fit the aspect ratio given by the game resolution within the container at all times will fill any gaps with canvas.\n     * The displayed area outside the aspect ratio is not guaranteed to be on the screen, only the {@apilink Screen.contentArea}\n     * is guaranteed to be on screen.\n     */\n    DisplayMode[\"FitContainerAndFill\"] = \"FitContainerAndFill\";\n    /**\n     * Fit the aspect ratio given by the game resolution the screen at all times will fill the screen.\n     * This displayed area outside the aspect ratio is not guaranteed to be on the screen, only the {@apilink Screen.contentArea}\n     * is guaranteed to be on screen.\n     */\n    DisplayMode[\"FitScreenAndFill\"] = \"FitScreenAndFill\";\n    /**\n     * Fit the viewport to the parent element maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\n     * (letterbox) that would otherwise be present in {@apilink FitContainer}.\n     *\n     * **warning** This will clip some drawable area from the user because of the zoom,\n     * use {@apilink Screen.contentArea} to know the safe to draw area.\n     */\n    DisplayMode[\"FitContainerAndZoom\"] = \"FitContainerAndZoom\";\n    /**\n     * Fit the viewport to the device screen maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\n     * (letterbox) that would otherwise be present in {@apilink FitScreen}.\n     *\n     * **warning** This will clip some drawable area from the user because of the zoom,\n     * use {@apilink Screen.contentArea} to know the safe to draw area.\n     */\n    DisplayMode[\"FitScreenAndZoom\"] = \"FitScreenAndZoom\";\n    /**\n     * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\n     * This is not the same as {@apilink Screen.goFullScreen} but behaves in a similar way maintaining aspect ratio.\n     *\n     * You may want to center your game here is an example\n     * ```html\n     * <!-- html -->\n     * <body>\n     * <main>\n     *   <canvas id=\"game\"></canvas>\n     * </main>\n     * </body>\n     * ```\n     *\n     * ```css\n     * // css\n     * main {\n     *   display: flex;\n     *   align-items: center;\n     *   justify-content: center;\n     *   height: 100%;\n     *   width: 100%;\n     * }\n     * ```\n     */\n    DisplayMode[\"FitScreen\"] = \"FitScreen\";\n    /**\n     * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\n     * change dynamically as the window is resized. This is not the same as {@apilink Screen.goFullScreen}\n     */\n    DisplayMode[\"FillScreen\"] = \"FillScreen\";\n    /**\n     * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\n     */\n    DisplayMode[\"FitContainer\"] = \"FitContainer\";\n    /**\n     * Use the parent DOM container's css width/height for the game resolution dynamically\n     */\n    DisplayMode[\"FillContainer\"] = \"FillContainer\";\n})(DisplayMode || (DisplayMode = {}));\n/**\n * Convenience class for quick resolutions\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\n */\nclass Resolution {\n    /* istanbul ignore next */\n    static get SVGA() {\n        return { width: 800, height: 600 };\n    }\n    /* istanbul ignore next */\n    static get Standard() {\n        return { width: 1920, height: 1080 };\n    }\n    /* istanbul ignore next */\n    static get Atari2600() {\n        return { width: 160, height: 192 };\n    }\n    /* istanbul ignore next */\n    static get GameBoy() {\n        return { width: 160, height: 144 };\n    }\n    /* istanbul ignore next */\n    static get GameBoyAdvance() {\n        return { width: 240, height: 160 };\n    }\n    /* istanbul ignore next */\n    static get NintendoDS() {\n        return { width: 256, height: 192 };\n    }\n    /* istanbul ignore next */\n    static get NES() {\n        return { width: 256, height: 224 };\n    }\n    /* istanbul ignore next */\n    static get SNES() {\n        return { width: 256, height: 244 };\n    }\n}\nconst ScreenEvents = {\n    ScreenResize: 'resize',\n    PixelRatioChange: 'pixelratio',\n    FullScreenChange: 'fullscreen'\n};\n/**\n * The Screen handles all aspects of interacting with the screen for Excalibur.\n */\nclass Screen {\n    constructor(options) {\n        var _a, _b, _c, _d;\n        /**\n         * Listen to screen events {@apilink ScreenEvents}\n         */\n        this.events = new EventEmitter();\n        this._antialiasing = true;\n        this._canvasImageRendering = 'auto';\n        this._resolutionStack = [];\n        this._viewportStack = [];\n        this._pixelRatioOverride = null;\n        this._isFullscreen = false;\n        this._isDisposed = false;\n        this._logger = Logger.getInstance();\n        this._fullscreenChangeHandler = () => {\n            if (this._isDisposed) {\n                return;\n            }\n            this._isFullscreen = !this._isFullscreen;\n            this._logger.debug('Fullscreen Change', this._isFullscreen);\n            this.events.emit('fullscreen', {\n                fullscreen: this.isFullScreen\n            });\n        };\n        this._pixelRatioChangeHandler = () => {\n            if (this._isDisposed) {\n                return;\n            }\n            this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\n            this._listenForPixelRatio();\n            this._devicePixelRatio = this._calculateDevicePixelRatio();\n            this.applyResolutionAndViewport();\n            this.events.emit('pixelratio', {\n                pixelRatio: this.pixelRatio\n            });\n        };\n        this._resizeHandler = () => {\n            if (this._isDisposed) {\n                return;\n            }\n            const parent = this.parent;\n            this._logger.debug('View port resized');\n            this._setResolutionAndViewportByDisplayMode(parent);\n            this.applyResolutionAndViewport();\n            // Emit resize event\n            this.events.emit('resize', {\n                resolution: this.resolution,\n                viewport: this.viewport\n            });\n        };\n        // Asking the window.devicePixelRatio is expensive we do it once\n        this._devicePixelRatio = this._calculateDevicePixelRatio();\n        this._contentArea = new BoundingBox();\n        this._unsafeArea = new BoundingBox();\n        this.viewport = options.viewport;\n        this.resolution = (_a = options.resolution) !== null && _a !== void 0 ? _a : { ...this.viewport };\n        this._contentResolution = this.resolution;\n        this._displayMode = (_b = options.displayMode) !== null && _b !== void 0 ? _b : DisplayMode.Fixed;\n        this._canvas = options.canvas;\n        this.graphicsContext = options.context;\n        this._antialiasing = (_c = options.antialiasing) !== null && _c !== void 0 ? _c : this._antialiasing;\n        this._canvasImageRendering = (_d = options.canvasImageRendering) !== null && _d !== void 0 ? _d : this._canvasImageRendering;\n        this._browser = options.browser;\n        this._pixelRatioOverride = options.pixelRatio;\n        this._applyDisplayMode();\n        this._listenForPixelRatio();\n        this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\n        this.applyResolutionAndViewport();\n    }\n    _listenForPixelRatio() {\n        if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\n            // Safari <=13.1 workaround, remove any existing handlers\n            this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n        }\n        this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\n        // Safari <=13.1 workaround\n        if (this._mediaQueryList.addEventListener) {\n            this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\n        }\n        else {\n            this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\n        }\n    }\n    dispose() {\n        if (!this._isDisposed) {\n            // Clean up handlers\n            this._isDisposed = true;\n            this.events.clear();\n            this._browser.window.off('resize', this._resizeHandler);\n            this._browser.window.clear();\n            if (this._resizeObserver) {\n                this._resizeObserver.disconnect();\n            }\n            this.parent.removeEventListener('resize', this._resizeHandler);\n            // Safari <=13.1 workaround\n            if (this._mediaQueryList.removeEventListener) {\n                this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\n            }\n            else {\n                this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n            }\n            this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\n            this._canvas = null;\n        }\n    }\n    _calculateDevicePixelRatio() {\n        if (window.devicePixelRatio < 1) {\n            return 1;\n        }\n        const devicePixelRatio = window.devicePixelRatio || 1;\n        return devicePixelRatio;\n    }\n    /**\n     * Returns the computed pixel ratio, first using any override, then the device pixel ratio\n     */\n    get pixelRatio() {\n        if (this._pixelRatioOverride) {\n            return this._pixelRatioOverride;\n        }\n        return this._devicePixelRatio;\n    }\n    /**\n     * This calculates the ratio between excalibur pixels and the HTML pixels.\n     *\n     * This is useful for scaling HTML UI so that it matches your game.\n     */\n    get worldToPagePixelRatio() {\n        if (this._canvas) {\n            const pageOrigin = this.worldToPageCoordinates(Vector.Zero);\n            const pageDistance = this.worldToPageCoordinates(vec(1, 0)).sub(pageOrigin);\n            const pixelConversion = pageDistance.x;\n            return pixelConversion;\n        }\n        else {\n            return 1;\n        }\n    }\n    /**\n     * Get or set the pixel ratio override\n     *\n     * You will need to call applyResolutionAndViewport() affect change on the screen\n     */\n    get pixelRatioOverride() {\n        return this._pixelRatioOverride;\n    }\n    set pixelRatioOverride(value) {\n        this._pixelRatioOverride = value;\n    }\n    get isHiDpi() {\n        return this.pixelRatio !== 1;\n    }\n    get displayMode() {\n        return this._displayMode;\n    }\n    get canvas() {\n        return this._canvas;\n    }\n    get parent() {\n        switch (this.displayMode) {\n            case DisplayMode.FillContainer:\n            case DisplayMode.FitContainer:\n            case DisplayMode.FitContainerAndFill:\n            case DisplayMode.FitContainerAndZoom:\n                return this.canvas.parentElement || document.body;\n            default:\n                return window;\n        }\n    }\n    get resolution() {\n        return this._resolution;\n    }\n    set resolution(resolution) {\n        this._resolution = resolution;\n    }\n    /**\n     * Returns screen dimensions in pixels or percentage\n     */\n    get viewport() {\n        if (this._viewport) {\n            return this._viewport;\n        }\n        return this._resolution;\n    }\n    set viewport(viewport) {\n        this._viewport = viewport;\n    }\n    get aspectRatio() {\n        return this._resolution.width / this._resolution.height;\n    }\n    get scaledWidth() {\n        return this._resolution.width * this.pixelRatio;\n    }\n    get scaledHeight() {\n        return this._resolution.height * this.pixelRatio;\n    }\n    setCurrentCamera(camera) {\n        this._camera = camera;\n    }\n    pushResolutionAndViewport() {\n        this._resolutionStack.push(this.resolution);\n        this._viewportStack.push(this.viewport);\n        this.resolution = { ...this.resolution };\n        this.viewport = { ...this.viewport };\n    }\n    peekViewport() {\n        return this._viewportStack[this._viewportStack.length - 1];\n    }\n    peekResolution() {\n        return this._resolutionStack[this._resolutionStack.length - 1];\n    }\n    popResolutionAndViewport() {\n        if (this._resolutionStack.length && this._viewportStack.length) {\n            this.resolution = this._resolutionStack.pop();\n            this.viewport = this._viewportStack.pop();\n        }\n    }\n    applyResolutionAndViewport() {\n        if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n            const scaledResolutionSupported = this.graphicsContext.checkIfResolutionSupported({\n                width: this.scaledWidth,\n                height: this.scaledHeight\n            });\n            if (!scaledResolutionSupported) {\n                this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio})` +\n                    ' are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\n                    ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\n                    ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\n                // Attempt to recover if the user hasn't configured a specific ratio for up scaling\n                if (!this.pixelRatioOverride) {\n                    let currentPixelRatio = Math.max(1, this.pixelRatio - 0.5);\n                    let newResolutionSupported = false;\n                    while (currentPixelRatio > 1 && !newResolutionSupported) {\n                        currentPixelRatio = Math.max(1, currentPixelRatio - 0.5);\n                        const width = this._resolution.width * currentPixelRatio;\n                        const height = this._resolution.height * currentPixelRatio;\n                        newResolutionSupported = this.graphicsContext.checkIfResolutionSupported({ width, height });\n                    }\n                    this.pixelRatioOverride = currentPixelRatio;\n                    this._logger.warnOnce('Scaled resolution too big attempted recovery!' +\n                        ` Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit.` +\n                        ' Setting `ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.` ' +\n                        ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\n                }\n            }\n        }\n        this._canvas.width = this.scaledWidth;\n        this._canvas.height = this.scaledHeight;\n        if (this._canvasImageRendering === 'auto') {\n            this._canvas.style.imageRendering = 'auto';\n        }\n        else {\n            this._canvas.style.imageRendering = 'pixelated';\n            // Fall back to 'crisp-edges' if 'pixelated' is not supported\n            // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\n            if (this._canvas.style.imageRendering === '') {\n                this._canvas.style.imageRendering = 'crisp-edges';\n            }\n        }\n        const widthUnit = this.viewport.widthUnit === 'percent' ? '%' : 'px';\n        const heightUnit = this.viewport.heightUnit === 'percent' ? '%' : 'px';\n        this._canvas.style.width = this.viewport.width + widthUnit;\n        this._canvas.style.height = this.viewport.height + heightUnit;\n        // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\n        this.graphicsContext.updateViewport(this.resolution);\n        this.graphicsContext.resetTransform();\n        this.graphicsContext.smoothing = this._antialiasing;\n        if (this.graphicsContext instanceof ExcaliburGraphicsContext2DCanvas) {\n            this.graphicsContext.scale(this.pixelRatio, this.pixelRatio);\n        }\n        // Add the excalibur world pixel to page pixel\n        document.documentElement.style.setProperty('--ex-pixel-ratio', this.worldToPagePixelRatio.toString());\n    }\n    /**\n     * Get or set screen antialiasing,\n     *\n     * If true smoothing is applied\n     */\n    get antialiasing() {\n        return this._antialiasing;\n    }\n    /**\n     * Get or set screen antialiasing\n     */\n    set antialiasing(isSmooth) {\n        this._antialiasing = isSmooth;\n        this.graphicsContext.smoothing = this._antialiasing;\n    }\n    /**\n     * Returns true if excalibur is fullscreen using the browser fullscreen api\n     * @deprecated use isFullscreen()\n     */\n    get isFullScreen() {\n        return this._isFullscreen;\n    }\n    /**\n     * Returns true if excalibur is fullscreen using the browser fullscreen api\n     */\n    get isFullscreen() {\n        return this._isFullscreen;\n    }\n    /**\n     * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\n     * For example, wire this to a user click handler.\n     *\n     * Optionally specify a target element id to go fullscreen, by default the game canvas is used\n     * @param elementId\n     * @deprecated use enterFullscreen(...)\n     */\n    goFullScreen(elementId) {\n        return this.enterFullscreen(elementId);\n    }\n    /**\n     * Requests to enter fullscreen using the browser fullscreen api, requires user interaction to be successful.\n     * For example, wire this to a user click handler.\n     *\n     * Optionally specify a target element id to go fullscreen, by default the game canvas is used\n     * @param elementId\n     */\n    enterFullscreen(elementId) {\n        if (elementId) {\n            const maybeElement = document.getElementById(elementId);\n            if (maybeElement) {\n                if (!maybeElement.getAttribute('ex-fullscreen-listener')) {\n                    maybeElement.setAttribute('ex-fullscreen-listener', 'true');\n                    maybeElement.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\n                }\n                const fullscreenPromise = maybeElement.requestFullscreen();\n                return fullscreenPromise;\n            }\n        }\n        return this._canvas.requestFullscreen();\n    }\n    /**\n     * Requests to exit fullscreen using the browser fullscreen api\n     * @deprecated use exitFullscreen()\n     */\n    exitFullScreen() {\n        return this.exitFullscreen();\n    }\n    exitFullscreen() {\n        return document.exitFullscreen();\n    }\n    _viewportToPixels(viewport) {\n        return {\n            width: viewport.widthUnit === 'percent' ? this.canvas.offsetWidth : viewport.width,\n            height: viewport.heightUnit === 'percent' ? this.canvas.offsetHeight : viewport.height\n        };\n    }\n    /**\n     * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\n     * Excalibur screen space.\n     *\n     * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n     * bottom right corner (resolutionX, resolutionY). When using *AndFill suffixed display modes screen space\n     * (0, 0) is the top left of the safe content area bounding box not the viewport.\n     * @param point\n     */\n    pageToScreenCoordinates(point) {\n        let newX = point.x;\n        let newY = point.y;\n        if (!this._isFullscreen) {\n            newX -= getPosition(this._canvas).x;\n            newY -= getPosition(this._canvas).y;\n        }\n        const viewport = this._viewportToPixels(this.viewport);\n        // if fullscreen api on it centers with black bars\n        // we need to adjust the screen to world coordinates in this case\n        if (this._isFullscreen) {\n            if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n                const screenHeight = window.innerWidth / this.aspectRatio;\n                const screenMarginY = (window.innerHeight - screenHeight) / 2;\n                newY = ((newY - screenMarginY) / screenHeight) * viewport.height;\n                newX = (newX / window.innerWidth) * viewport.width;\n            }\n            else {\n                const screenWidth = window.innerHeight * this.aspectRatio;\n                const screenMarginX = (window.innerWidth - screenWidth) / 2;\n                newX = ((newX - screenMarginX) / screenWidth) * viewport.width;\n                newY = (newY / window.innerHeight) * viewport.height;\n            }\n        }\n        newX = (newX / viewport.width) * this.resolution.width;\n        newY = (newY / viewport.height) * this.resolution.height;\n        // offset by content area\n        newX = newX - this.contentArea.left;\n        newY = newY - this.contentArea.top;\n        return new Vector(newX, newY);\n    }\n    /**\n     * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\n     * this is where html elements might live if you want to position them relative to Excalibur.\n     *\n     * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n     * bottom right corner (resolutionX, resolutionY)\n     * @param point\n     */\n    screenToPageCoordinates(point) {\n        let newX = point.x;\n        let newY = point.y;\n        // no need to offset by content area, drawing is already offset by this\n        const viewport = this._viewportToPixels(this.viewport);\n        newX = (newX / this.resolution.width) * viewport.width;\n        newY = (newY / this.resolution.height) * viewport.height;\n        if (this._isFullscreen) {\n            if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n                const screenHeight = window.innerWidth / this.aspectRatio;\n                const screenMarginY = (window.innerHeight - screenHeight) / 2;\n                newY = (newY / viewport.height) * screenHeight + screenMarginY;\n                newX = (newX / viewport.width) * window.innerWidth;\n            }\n            else {\n                const screenWidth = window.innerHeight * this.aspectRatio;\n                const screenMarginX = (window.innerWidth - screenWidth) / 2;\n                newX = (newX / viewport.width) * screenWidth + screenMarginX;\n                newY = (newY / viewport.height) * window.innerHeight;\n            }\n        }\n        if (!this._isFullscreen) {\n            newX += getPosition(this._canvas).x;\n            newY += getPosition(this._canvas).y;\n        }\n        return new Vector(newX, newY);\n    }\n    /**\n     * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\n     *\n     * World space is where {@apilink Entity | `entities`} in Excalibur live by default {@apilink CoordPlane.World}\n     * and extends infinitely out relative from the {@apilink Camera}.\n     * @param point  Screen coordinate to convert\n     */\n    screenToWorldCoordinates(point) {\n        // offset by content area\n        point = point.add(vec(this.contentArea.left, this.contentArea.top));\n        // the only difference between screen & world is the camera transform\n        if (this._camera) {\n            return this._camera.inverse.multiply(point);\n        }\n        return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\n    }\n    /**\n     * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\n     *\n     * Screen space is where {@apilink ScreenElement | `screen elements`} and {@apilink Entity | `entities`} with {@apilink CoordPlane.Screen} live.\n     * @param point  World coordinate to convert\n     */\n    worldToScreenCoordinates(point) {\n        if (this._camera) {\n            return this._camera.transform.multiply(point);\n        }\n        return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\n    }\n    pageToWorldCoordinates(point) {\n        const screen = this.pageToScreenCoordinates(point);\n        return this.screenToWorldCoordinates(screen);\n    }\n    worldToPageCoordinates(point) {\n        const screen = this.worldToScreenCoordinates(point);\n        return this.screenToPageCoordinates(screen);\n    }\n    /**\n     * Returns a BoundingBox of the top left corner of the screen\n     * and the bottom right corner of the screen.\n     *\n     * World bounds are in world coordinates, useful for culling objects offscreen that are in world space\n     */\n    getWorldBounds() {\n        const bounds = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Half)\n            .scale(vec(1 / this._camera.zoom, 1 / this._camera.zoom))\n            .rotate(this._camera.rotation)\n            .translate(this._camera.drawPos);\n        return bounds;\n    }\n    /**\n     * Returns a BoundingBox of the top left corner of the screen and the bottom right corner of the screen.\n     *\n     * Screen bounds are in screen coordinates, useful for culling objects offscreen that are in screen space\n     */\n    getScreenBounds() {\n        const bounds = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero, Vector.Zero);\n        return bounds;\n    }\n    /**\n     * The width of the game canvas in pixels (physical width component of the\n     * resolution of the canvas element)\n     */\n    get canvasWidth() {\n        return this.canvas.width;\n    }\n    /**\n     * Returns half width of the game canvas in pixels (half physical width component)\n     */\n    get halfCanvasWidth() {\n        return this.canvas.width / 2;\n    }\n    /**\n     * The height of the game canvas in pixels, (physical height component of\n     * the resolution of the canvas element)\n     */\n    get canvasHeight() {\n        return this.canvas.height;\n    }\n    /**\n     * Returns half height of the game canvas in pixels (half physical height component)\n     */\n    get halfCanvasHeight() {\n        return this.canvas.height / 2;\n    }\n    /**\n     * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get drawWidth() {\n        if (this._camera) {\n            return this.resolution.width / this._camera.zoom;\n        }\n        return this.resolution.width;\n    }\n    /**\n     * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get width() {\n        if (this._camera) {\n            return this.resolution.width / this._camera.zoom;\n        }\n        return this.resolution.width;\n    }\n    /**\n     * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get halfDrawWidth() {\n        return this.drawWidth / 2;\n    }\n    /**\n     * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get drawHeight() {\n        if (this._camera) {\n            return this.resolution.height / this._camera.zoom;\n        }\n        return this.resolution.height;\n    }\n    get height() {\n        if (this._camera) {\n            return this.resolution.height / this._camera.zoom;\n        }\n        return this.resolution.height;\n    }\n    /**\n     * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get halfDrawHeight() {\n        return this.drawHeight / 2;\n    }\n    /**\n     * Returns screen center coordinates including zoom and device pixel ratio.\n     */\n    get center() {\n        return vec(this.halfDrawWidth, this.halfDrawHeight);\n    }\n    /**\n     * Returns the content area in screen space where it is safe to place content\n     */\n    get contentArea() {\n        return this._contentArea;\n    }\n    /**\n     * Returns the unsafe area in screen space, this is the full screen and some space may not be onscreen.\n     */\n    get unsafeArea() {\n        return this._unsafeArea;\n    }\n    _computeFit() {\n        document.body.style.margin = '0px';\n        document.body.style.overflow = 'hidden';\n        const aspect = this.aspectRatio;\n        let adjustedWidth = 0;\n        let adjustedHeight = 0;\n        if (window.innerWidth / aspect < window.innerHeight) {\n            adjustedWidth = window.innerWidth;\n            adjustedHeight = window.innerWidth / aspect;\n        }\n        else {\n            adjustedWidth = window.innerHeight * aspect;\n            adjustedHeight = window.innerHeight;\n        }\n        this.viewport = {\n            width: adjustedWidth,\n            height: adjustedHeight\n        };\n        this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\n        this._unsafeArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\n        this.events.emit('resize', {\n            resolution: this.resolution,\n            viewport: this.viewport\n        });\n    }\n    _computeFitScreenAndFill() {\n        document.body.style.margin = '0px';\n        document.body.style.overflow = 'hidden';\n        const vw = window.innerWidth;\n        const vh = window.innerHeight;\n        this._computeFitAndFill(vw, vh);\n        this.events.emit('resize', {\n            resolution: this.resolution,\n            viewport: this.viewport\n        });\n    }\n    _computeFitContainerAndFill() {\n        this.canvas.style.width = '100%';\n        this.canvas.style.height = '100%';\n        this._computeFitAndFill(this.canvas.offsetWidth, this.canvas.offsetHeight, {\n            width: 100,\n            widthUnit: 'percent',\n            height: 100,\n            heightUnit: 'percent'\n        });\n        this.events.emit('resize', {\n            resolution: this.resolution,\n            viewport: this.viewport\n        });\n    }\n    _computeFitAndFill(vw, vh, viewport) {\n        this.viewport = viewport !== null && viewport !== void 0 ? viewport : {\n            width: vw,\n            height: vh\n        };\n        // if the current screen aspectRatio is less than the original aspectRatio\n        if (vw / vh <= this._contentResolution.width / this._contentResolution.height) {\n            // compute new resolution to match the original aspect ratio\n            this.resolution = {\n                width: (vw * this._contentResolution.width) / vw,\n                height: (((vw * this._contentResolution.width) / vw) * vh) / vw\n            };\n            const clip = (this.resolution.height - this._contentResolution.height) / 2;\n            this._contentArea = new BoundingBox({\n                top: clip,\n                left: 0,\n                right: this._contentResolution.width,\n                bottom: this.resolution.height - clip\n            });\n            this._unsafeArea = new BoundingBox({\n                top: -clip,\n                left: 0,\n                right: this._contentResolution.width,\n                bottom: this.resolution.height + clip\n            });\n        }\n        else {\n            this.resolution = {\n                width: (((vh * this._contentResolution.height) / vh) * vw) / vh,\n                height: (vh * this._contentResolution.height) / vh\n            };\n            const clip = (this.resolution.width - this._contentResolution.width) / 2;\n            this._contentArea = new BoundingBox({\n                top: 0,\n                left: clip,\n                right: this.resolution.width - clip,\n                bottom: this._contentResolution.height\n            });\n            this._unsafeArea = new BoundingBox({\n                top: 0,\n                left: -clip,\n                right: this.resolution.width + clip,\n                bottom: this._contentResolution.height\n            });\n        }\n    }\n    _computeFitScreenAndZoom() {\n        document.body.style.margin = '0px';\n        document.body.style.overflow = 'hidden';\n        this.canvas.style.position = 'absolute';\n        const vw = window.innerWidth;\n        const vh = window.innerHeight;\n        this._computeFitAndZoom(vw, vh);\n        this.events.emit('resize', {\n            resolution: this.resolution,\n            viewport: this.viewport\n        });\n    }\n    _computeFitContainerAndZoom() {\n        this.canvas.style.width = '100%';\n        this.canvas.style.height = '100%';\n        this.canvas.style.position = 'relative';\n        const parent = this.canvas.parentElement;\n        parent.style.overflow = 'hidden';\n        const { offsetWidth: vw, offsetHeight: vh } = this.canvas;\n        this._computeFitAndZoom(vw, vh);\n        this.events.emit('resize', {\n            resolution: this.resolution,\n            viewport: this.viewport\n        });\n    }\n    _computeFitAndZoom(vw, vh) {\n        const aspect = this.aspectRatio;\n        let adjustedWidth = 0;\n        let adjustedHeight = 0;\n        if (vw / aspect < vh) {\n            adjustedWidth = vw;\n            adjustedHeight = vw / aspect;\n        }\n        else {\n            adjustedWidth = vh * aspect;\n            adjustedHeight = vh;\n        }\n        const scaleX = vw / adjustedWidth;\n        const scaleY = vh / adjustedHeight;\n        const maxScaleFactor = Math.max(scaleX, scaleY);\n        const zoomedWidth = adjustedWidth * maxScaleFactor;\n        const zoomedHeight = adjustedHeight * maxScaleFactor;\n        // Center zoomed dimension if bigger than the screen\n        if (zoomedWidth > vw) {\n            this.canvas.style.left = -(zoomedWidth - vw) / 2 + 'px';\n        }\n        else {\n            this.canvas.style.left = '';\n        }\n        if (zoomedHeight > vh) {\n            this.canvas.style.top = -(zoomedHeight - vh) / 2 + 'px';\n        }\n        else {\n            this.canvas.style.top = '';\n        }\n        this.viewport = {\n            width: zoomedWidth,\n            height: zoomedHeight\n        };\n        const bounds = BoundingBox.fromDimension(this.viewport.width, this.viewport.height, Vector.Zero);\n        // return safe area\n        if (this.viewport.width > vw) {\n            const clip = ((this.viewport.width - vw) / this.viewport.width) * this.resolution.width;\n            bounds.top = 0;\n            bounds.left = clip / 2;\n            bounds.right = this.resolution.width - clip / 2;\n            bounds.bottom = this.resolution.height;\n        }\n        if (this.viewport.height > vh) {\n            const clip = ((this.viewport.height - vh) / this.viewport.height) * this.resolution.height;\n            bounds.top = clip / 2;\n            bounds.left = 0;\n            bounds.bottom = this.resolution.height - clip / 2;\n            bounds.right = this.resolution.width;\n        }\n        this._contentArea = bounds;\n    }\n    _computeFitContainer() {\n        const aspect = this.aspectRatio;\n        let adjustedWidth = 0;\n        let adjustedHeight = 0;\n        let widthUnit = 'pixel';\n        let heightUnit = 'pixel';\n        const parent = this.canvas.parentElement;\n        if (parent.clientWidth / aspect < parent.clientHeight) {\n            this.canvas.style.width = '100%';\n            adjustedWidth = 100;\n            widthUnit = 'percent';\n            adjustedHeight = this.canvas.offsetWidth / aspect;\n        }\n        else {\n            this.canvas.style.height = '100%';\n            adjustedHeight = 100;\n            heightUnit = 'percent';\n            adjustedWidth = this.canvas.offsetHeight * aspect;\n        }\n        this.viewport = {\n            width: adjustedWidth,\n            widthUnit,\n            height: adjustedHeight,\n            heightUnit\n        };\n        this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\n        this.events.emit('resize', {\n            resolution: this.resolution,\n            viewport: this.viewport\n        });\n    }\n    _applyDisplayMode() {\n        this._setResolutionAndViewportByDisplayMode(this.parent);\n        // watch resizing\n        if (this.parent instanceof Window) {\n            this._browser.window.on('resize', this._resizeHandler);\n        }\n        else {\n            this._resizeObserver = new ResizeObserver(() => {\n                this._resizeHandler();\n            });\n            this._resizeObserver.observe(this.parent);\n        }\n        this.parent.addEventListener('resize', this._resizeHandler);\n    }\n    /**\n     * Sets the resolution and viewport based on the selected display mode.\n     */\n    _setResolutionAndViewportByDisplayMode(parent) {\n        if (this.displayMode === DisplayMode.FillContainer) {\n            this.canvas.style.width = '100%';\n            this.canvas.style.height = '100%';\n            this.viewport = {\n                width: 100,\n                widthUnit: 'percent',\n                height: 100,\n                heightUnit: 'percent'\n            };\n            this.resolution = {\n                width: this.canvas.offsetWidth,\n                height: this.canvas.offsetHeight\n            };\n        }\n        if (this.displayMode === DisplayMode.FillScreen) {\n            document.body.style.margin = '0px';\n            document.body.style.overflow = 'hidden';\n            this.resolution = {\n                width: parent.innerWidth,\n                height: parent.innerHeight\n            };\n            this.viewport = this.resolution;\n        }\n        this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\n        if (this.displayMode === DisplayMode.FitScreen) {\n            this._computeFit();\n        }\n        if (this.displayMode === DisplayMode.FitContainer) {\n            this._computeFitContainer();\n        }\n        if (this.displayMode === DisplayMode.FitScreenAndFill) {\n            this._computeFitScreenAndFill();\n        }\n        if (this.displayMode === DisplayMode.FitContainerAndFill) {\n            this._computeFitContainerAndFill();\n        }\n        if (this.displayMode === DisplayMode.FitScreenAndZoom) {\n            this._computeFitScreenAndZoom();\n        }\n        if (this.displayMode === DisplayMode.FitContainerAndZoom) {\n            this._computeFitContainerAndZoom();\n        }\n    }\n}\n\n;// ./Resources/Sound/AudioContext.ts\n/**\n * Internal class used to build instances of AudioContext\n */\n/* istanbul ignore next */\nclass AudioContextFactory {\n    static create() {\n        if (!this._INSTANCE) {\n            if (window.AudioContext || window.webkitAudioContext) {\n                this._INSTANCE = new AudioContext();\n            }\n        }\n        return this._INSTANCE;\n    }\n}\n\n;// ./Util/WebAudio.ts\n\n\n/**\n * Patch for detecting legacy web audio in browsers\n * @internal\n * @param source\n */\nfunction isLegacyWebAudioSource(source) {\n    return !!source.playbackState;\n}\nclass WebAudio {\n    /**\n     * Play an empty sound to unlock Safari WebAudio context. Call this function\n     * right after a user interaction event.\n     * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n     */\n    static unlock() {\n        const promise = new Promise((resolve, reject) => {\n            if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\n                return resolve(true);\n            }\n            const unlockTimeoutTimer = setTimeout(() => {\n                Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n                resolve(false);\n            }, 200);\n            const audioContext = AudioContextFactory.create();\n            audioContext.resume().then(() => {\n                // create empty buffer and play it\n                const buffer = audioContext.createBuffer(1, 1, 22050);\n                const source = audioContext.createBufferSource();\n                let ended = false;\n                source.buffer = buffer;\n                source.connect(audioContext.destination);\n                source.onended = () => (ended = true);\n                source.start(0);\n                // by checking the play state after some time, we know if we're really unlocked\n                setTimeout(() => {\n                    if (isLegacyWebAudioSource(source)) {\n                        if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n                            WebAudio._UNLOCKED = true;\n                        }\n                    }\n                    else {\n                        if (audioContext.currentTime > 0 || ended) {\n                            WebAudio._UNLOCKED = true;\n                        }\n                    }\n                }, 0);\n                clearTimeout(unlockTimeoutTimer);\n                resolve(true);\n            }, () => {\n                reject();\n            });\n        });\n        return promise;\n    }\n    static isUnlocked() {\n        return this._UNLOCKED;\n    }\n}\nWebAudio._UNLOCKED = false;\n\n;// ./Graphics/Canvas.ts\n\n/**\n * A canvas {@apilink Graphic} to provide an adapter between the 2D Canvas API and the {@apilink ExcaliburGraphicsContext}.\n *\n * The {@apilink Canvas} works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\n * to the {@apilink ExcaliburGraphicsContext} implementation as a rendered image.\n *\n * **Low performance API**\n */\nclass Canvas extends Raster {\n    /**\n     * Return the 2D graphics context of this canvas\n     */\n    get ctx() {\n        return this._ctx;\n    }\n    constructor(_options = {}) {\n        super(_options);\n        this._options = _options;\n    }\n    clone() {\n        return new Canvas({\n            ...this._options,\n            ...this.cloneGraphicOptions(),\n            ...this.cloneRasterOptions()\n        });\n    }\n    execute(ctx) {\n        var _a, _b;\n        if ((_a = this._options) === null || _a === void 0 ? void 0 : _a.draw) {\n            (_b = this._options) === null || _b === void 0 ? void 0 : _b.draw(ctx);\n        }\n        if (!this._options.cache) {\n            this.flagDirty();\n        }\n    }\n}\n\n;// ./Interfaces/AudioImplementation.ts\nclass ExResponse {\n}\nExResponse.type = {\n    any: '',\n    blob: 'blob',\n    json: 'json',\n    text: 'text',\n    document: 'document',\n    arraybuffer: 'arraybuffer'\n};\n\n;// ./Util/StateMachine.ts\nclass StateMachine {\n    constructor() {\n        this.states = new Map();\n    }\n    get currentState() {\n        return this._currentState;\n    }\n    set currentState(state) {\n        this._currentState = state;\n    }\n    static create(machineDescription, data) {\n        const machine = new StateMachine();\n        machine.data = data;\n        for (const stateName in machineDescription.states) {\n            machine.states.set(stateName, {\n                name: stateName,\n                ...machineDescription.states[stateName]\n            });\n        }\n        // validate transitions are states\n        for (const state of machine.states.values()) {\n            for (const transitionState of state.transitions) {\n                if (transitionState === '*') {\n                    continue;\n                }\n                if (!machine.states.has(transitionState)) {\n                    throw Error(`Invalid state machine, state [${state.name}] has a transition to another state that doesn't exist [${transitionState}]`);\n                }\n            }\n        }\n        machine.currentState = machine.startState = machine.states.get(machineDescription.start);\n        return machine;\n    }\n    in(state) {\n        return this.currentState.name === state;\n    }\n    go(stateName, eventData) {\n        var _a, _b;\n        if (this.currentState.transitions.includes(stateName) || this.currentState.transitions.includes('*')) {\n            const potentialNewState = this.states.get(stateName);\n            if (this.currentState.onExit) {\n                const canExit = (_a = this.currentState) === null || _a === void 0 ? void 0 : _a.onExit({ to: potentialNewState.name, data: this.data });\n                if (canExit === false) {\n                    return false;\n                }\n            }\n            if (potentialNewState === null || potentialNewState === void 0 ? void 0 : potentialNewState.onEnter) {\n                const canEnter = potentialNewState === null || potentialNewState === void 0 ? void 0 : potentialNewState.onEnter({ from: this.currentState.name, eventData, data: this.data });\n                if (canEnter === false) {\n                    return false;\n                }\n            }\n            this.currentState = potentialNewState;\n            if ((_b = this.currentState) === null || _b === void 0 ? void 0 : _b.onState) {\n                this.currentState.onState();\n            }\n            return true;\n        }\n        return false;\n    }\n    update(elapsedMs) {\n        if (this.currentState.onUpdate) {\n            this.currentState.onUpdate(this.data, elapsedMs);\n        }\n    }\n    save(saveKey) {\n        localStorage.setItem(saveKey, JSON.stringify({\n            currentState: this.currentState.name,\n            data: this.data\n        }));\n    }\n    restore(saveKey) {\n        const state = JSON.parse(localStorage.getItem(saveKey));\n        this.currentState = this.states.get(state.currentState);\n        this.data = state.data;\n    }\n}\n\n;// ./Resources/Sound/WebAudioInstance.ts\n\n\n\n\n/**\n * Internal class representing a Web Audio AudioBufferSourceNode instance\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\n */\nclass WebAudioInstance {\n    _createNewBufferSource() {\n        this._instance = this._audioContext.createBufferSource();\n        this._instance.buffer = this._src;\n        this._instance.loop = this.loop;\n        this._instance.playbackRate.value = this._playbackRate;\n        this._instance.connect(this._volumeNode);\n        this._volumeNode.connect(this._audioContext.destination);\n    }\n    _handleEnd() {\n        if (!this.loop) {\n            this._instance.onended = () => {\n                this._playingFuture.resolve(true);\n            };\n        }\n    }\n    set loop(value) {\n        this._loop = value;\n        if (this._instance) {\n            this._instance.loop = value;\n            if (!this.loop) {\n                this._instance.onended = () => {\n                    this._playingFuture.resolve(true);\n                };\n            }\n        }\n    }\n    get loop() {\n        return this._loop;\n    }\n    set volume(value) {\n        value = clamp(value, 0, 1.0);\n        this._volume = value;\n        if (this._stateMachine.in('PLAYING') && this._volumeNode.gain.setTargetAtTime) {\n            // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\n            // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\n            // This exponential ramp provides a more pleasant transition in gain\n            this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\n        }\n        else {\n            this._volumeNode.gain.value = value;\n        }\n    }\n    get volume() {\n        return this._volume;\n    }\n    /**\n     * Returns the set duration to play, otherwise returns the total duration if unset\n     */\n    get duration() {\n        var _a;\n        return (_a = this._duration) !== null && _a !== void 0 ? _a : this.getTotalPlaybackDuration();\n    }\n    /**\n     * Set the duration that this audio should play.\n     *\n     * Note: if you seek to a specific point the duration will start from that point, for example\n     *\n     * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\n     */\n    set duration(duration) {\n        this._duration = duration;\n    }\n    constructor(_src) {\n        this._src = _src;\n        this._audioContext = AudioContextFactory.create();\n        this._volumeNode = this._audioContext.createGain();\n        this._playingFuture = new Future();\n        this._stateMachine = StateMachine.create({\n            start: 'STOPPED',\n            states: {\n                PLAYING: {\n                    onEnter: ({ data }) => {\n                        // Buffer nodes are single use\n                        this._createNewBufferSource();\n                        this._handleEnd();\n                        if (this.loop) {\n                            // when looping don't set a duration\n                            this._instance.start(0, data.pausedAt * this._playbackRate);\n                        }\n                        else {\n                            this._instance.start(0, data.pausedAt * this._playbackRate, this.duration);\n                        }\n                        data.startedAt = this._audioContext.currentTime - data.pausedAt;\n                        data.pausedAt = 0;\n                    },\n                    onState: () => this._playStarted(),\n                    onExit: ({ to }) => {\n                        // If you've exited early only resolve if explicitly STOPPED\n                        if (to === 'STOPPED') {\n                            this._playingFuture.resolve(true);\n                        }\n                        // Whenever you're not playing... you stop!\n                        this._instance.onended = null; // disconnect the wired on-end handler\n                        this._instance.disconnect();\n                        this._instance.stop(0);\n                        this._instance = null;\n                    },\n                    transitions: ['STOPPED', 'PAUSED', 'SEEK']\n                },\n                SEEK: {\n                    onEnter: ({ eventData: position, data }) => {\n                        data.pausedAt = (position !== null && position !== void 0 ? position : 0) / this._playbackRate;\n                        data.startedAt = 0;\n                    },\n                    transitions: ['*']\n                },\n                STOPPED: {\n                    onEnter: ({ data }) => {\n                        data.pausedAt = 0;\n                        data.startedAt = 0;\n                        this._playingFuture.resolve(true);\n                    },\n                    transitions: ['PLAYING', 'PAUSED', 'SEEK']\n                },\n                PAUSED: {\n                    onEnter: ({ data }) => {\n                        // Playback rate will be a scale factor of how fast/slow the audio is being played\n                        // default is 1.0\n                        // we need to invert it to get the time scale\n                        data.pausedAt = this._audioContext.currentTime - data.startedAt;\n                    },\n                    transitions: ['PLAYING', 'STOPPED', 'SEEK']\n                }\n            }\n        }, {\n            startedAt: 0,\n            pausedAt: 0\n        });\n        this._volume = 1;\n        this._loop = false;\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        this._playStarted = () => { };\n        this._playbackRate = 1.0;\n        this._createNewBufferSource();\n    }\n    isPlaying() {\n        return this._stateMachine.in('PLAYING');\n    }\n    isPaused() {\n        return this._stateMachine.in('PAUSED') || this._stateMachine.in('SEEK');\n    }\n    isStopped() {\n        return this._stateMachine.in('STOPPED');\n    }\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    play(playStarted = () => { }) {\n        this._playStarted = playStarted;\n        this._stateMachine.go('PLAYING');\n        return this._playingFuture.promise;\n    }\n    pause() {\n        this._stateMachine.go('PAUSED');\n    }\n    stop() {\n        this._stateMachine.go('STOPPED');\n    }\n    seek(position) {\n        this._stateMachine.go('PAUSED');\n        this._stateMachine.go('SEEK', position);\n    }\n    getTotalPlaybackDuration() {\n        return this._src.duration;\n    }\n    getPlaybackPosition() {\n        const { pausedAt, startedAt } = this._stateMachine.data;\n        if (pausedAt) {\n            return pausedAt * this._playbackRate;\n        }\n        if (startedAt) {\n            return (this._audioContext.currentTime - startedAt) * this._playbackRate;\n        }\n        return 0;\n    }\n    set playbackRate(playbackRate) {\n        this._instance.playbackRate.value = this._playbackRate = playbackRate;\n    }\n    get playbackRate() {\n        return this._instance.playbackRate.value;\n    }\n}\n\n;// ./Events/MediaEvents.ts\n\nclass MediaEvent extends GameEvent {\n    /**\n     * Media event cannot bubble\n     */\n    set bubbles(_value) {\n        // stubbed\n    }\n    /**\n     * Media event cannot bubble\n     */\n    get bubbles() {\n        return false;\n    }\n    /**\n     * Media event cannot bubble, so they have no path\n     */\n    get _path() {\n        return null;\n    }\n    /**\n     * Media event cannot bubble, so they have no path\n     */\n    set _path(_val) {\n        // stubbed\n    }\n    constructor(target, _name = 'MediaEvent') {\n        super();\n        this.target = target;\n        this._name = _name;\n    }\n    /**\n     * Prevents event from bubbling\n     */\n    stopPropagation() {\n        /**\n         * Stub\n         */\n    }\n    /**\n     * Action, that calls when event happens\n     */\n    action() {\n        /**\n         * Stub\n         */\n    }\n    /**\n     * Propagate event further through event path\n     */\n    propagate() {\n        /**\n         * Stub\n         */\n    }\n    layPath(_actor) {\n        /**\n         * Stub\n         */\n    }\n}\nclass NativeSoundEvent extends MediaEvent {\n    constructor(target, track) {\n        super(target, 'NativeSoundEvent');\n        this.track = track;\n    }\n}\nclass NativeSoundProcessedEvent extends MediaEvent {\n    constructor(target, _processedData) {\n        super(target, 'NativeSoundProcessedEvent');\n        this._processedData = _processedData;\n        this.data = this._processedData;\n    }\n}\n\n;// ./Util/Sound.ts\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nfunction canPlayFile(file) {\n    try {\n        const a = new Audio();\n        const filetype = /.*\\.([A-Za-z0-9]+)(?:(?:\\?|\\#).*)*$/;\n        const type = file.match(filetype)[1];\n        if (a.canPlayType('audio/' + type)) {\n            return true;\n        }\n        else {\n            return false;\n        }\n    }\n    catch (e) {\n        Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n        return false;\n    }\n}\n\n;// ./Resources/Sound/Sound.ts\n\n\n\n\n\n\n\n\nconst SoundEvents = {\n    VolumeChange: 'volumechange',\n    Processed: 'processed',\n    Pause: 'pause',\n    Stop: 'stop',\n    PlaybackEnd: 'playbackend',\n    Resume: 'resume',\n    PlaybackStart: 'playbackstart'\n};\n/**\n * The {@apilink Sound} object allows games built in Excalibur to load audio\n * components, from soundtracks to sound effects. {@apilink Sound} is an {@apilink Loadable}\n * which means it can be passed to a {@apilink Loader} to pre-load before a game or level.\n */\nclass Sound {\n    /**\n     * Indicates whether the clip should loop when complete\n     * @param value  Set the looping flag\n     */\n    set loop(value) {\n        this._loop = value;\n        for (const track of this._tracks) {\n            track.loop = this._loop;\n        }\n        this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\n    }\n    get loop() {\n        return this._loop;\n    }\n    set volume(value) {\n        this._volume = value;\n        for (const track of this._tracks) {\n            track.volume = this._volume;\n        }\n        this.events.emit('volumechange', new NativeSoundEvent(this));\n        this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\n    }\n    get volume() {\n        return this._volume;\n    }\n    /**\n     * Get the duration that this audio should play. If unset the total natural playback duration will be used.\n     */\n    get duration() {\n        return this._duration;\n    }\n    /**\n     * Set the duration that this audio should play. If unset the total natural playback duration will be used.\n     *\n     * Note: if you seek to a specific point the duration will start from that point, for example\n     *\n     * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\n     */\n    set duration(duration) {\n        this._duration = duration;\n    }\n    /**\n     * Return array of Current AudioInstances playing or being paused\n     */\n    get instances() {\n        return this._tracks;\n    }\n    get path() {\n        return this._resource.path;\n    }\n    set path(val) {\n        this._resource.path = val;\n    }\n    /**\n     * Should excalibur add a cache busting querystring? By default false.\n     * Must be set before loading\n     */\n    get bustCache() {\n        return this._resource.bustCache;\n    }\n    set bustCache(val) {\n        this._resource.bustCache = val;\n    }\n    /**\n     * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\n     */\n    constructor(...paths) {\n        this.events = new EventEmitter();\n        this.logger = Logger.getInstance();\n        this._loop = false;\n        this._volume = 1;\n        this._isStopped = false;\n        // private _isPaused = false;\n        this._tracks = [];\n        this._wasPlayingOnHidden = false;\n        this._playbackRate = 1.0;\n        this._audioContext = AudioContextFactory.create();\n        this._resource = new Resource('', ExResponse.type.arraybuffer);\n        /**\n         * Chrome : MP3, WAV, Ogg\n         * Firefox : WAV, Ogg,\n         * IE : MP3, WAV coming soon\n         * Safari MP3, WAV, Ogg\n         */\n        for (const path of paths) {\n            if (canPlayFile(path)) {\n                this.path = path;\n                break;\n            }\n        }\n        if (!this.path) {\n            this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\n            this.logger.warn('Attempting to use', paths[0]);\n            this.path = paths[0]; // select the first specified\n        }\n    }\n    isLoaded() {\n        return !!this.data;\n    }\n    async load() {\n        var _a, _b;\n        if (this.data) {\n            return this.data;\n        }\n        const arraybuffer = await this._resource.load();\n        const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\n        this._duration = (_b = (_a = this._duration) !== null && _a !== void 0 ? _a : audiobuffer === null || audiobuffer === void 0 ? void 0 : audiobuffer.duration) !== null && _b !== void 0 ? _b : undefined;\n        this.events.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\n        return (this.data = audiobuffer);\n    }\n    async decodeAudio(data) {\n        try {\n            return await this._audioContext.decodeAudioData(data.slice(0));\n        }\n        catch (e) {\n            this.logger.error('Unable to decode ' +\n                ' this browser may not fully support this format, or the file may be corrupt, ' +\n                'if this is an mp3 try removing id3 tags and album art from the file.');\n            return await Promise.reject();\n        }\n    }\n    wireEngine(engine) {\n        if (engine) {\n            this._engine = engine;\n            this._engine.on('hidden', () => {\n                if (engine.pauseAudioWhenHidden && this.isPlaying()) {\n                    this._wasPlayingOnHidden = true;\n                    this.pause();\n                }\n            });\n            this._engine.on('visible', () => {\n                if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    this.play();\n                    this._wasPlayingOnHidden = false;\n                }\n            });\n            this._engine.on('start', () => {\n                this._isStopped = false;\n            });\n            this._engine.on('stop', () => {\n                this.stop();\n                this._isStopped = true;\n            });\n        }\n    }\n    /**\n     * Returns how many instances of the sound are currently playing\n     */\n    instanceCount() {\n        return this._tracks.length;\n    }\n    /**\n     * Whether or not the sound is playing right now\n     */\n    isPlaying() {\n        return this._tracks.some((t) => t.isPlaying());\n    }\n    isPaused() {\n        return this._tracks.some((t) => t.isPaused());\n    }\n    isStopped() {\n        return this._tracks.some((t) => t.isStopped());\n    }\n    /**\n     * Play the sound, returns a promise that resolves when the sound is done playing\n     * An optional volume argument can be passed in to play the sound. Max volume is 1.0\n     */\n    play(volume) {\n        if (!this.isLoaded()) {\n            this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\n            return Promise.resolve(true);\n        }\n        if (this._isStopped) {\n            this.logger.warn('Cannot start playing. Engine is in a stopped state.');\n            return Promise.resolve(false);\n        }\n        this.volume = volume || this.volume;\n        if (this.isPaused()) {\n            return this._resumePlayback();\n        }\n        else {\n            return this._startPlayback();\n        }\n    }\n    /**\n     * Stop the sound, and do not rewind\n     */\n    pause() {\n        if (!this.isPlaying()) {\n            return;\n        }\n        for (const track of this._tracks) {\n            track.pause();\n        }\n        this.events.emit('pause', new NativeSoundEvent(this));\n        this.logger.debug('Paused all instances of sound', this.path);\n    }\n    /**\n     * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\n     */\n    stop() {\n        for (const track of this._tracks) {\n            track.stop();\n        }\n        this.events.emit('stop', new NativeSoundEvent(this));\n        this._tracks.length = 0;\n        this.logger.debug('Stopped all instances of sound', this.path);\n    }\n    get playbackRate() {\n        return this._playbackRate;\n    }\n    set playbackRate(playbackRate) {\n        this._playbackRate = playbackRate;\n        this._tracks.forEach((t) => {\n            t.playbackRate = this._playbackRate;\n        });\n    }\n    seek(position, trackId = 0) {\n        if (this._tracks.length === 0) {\n            this._getTrackInstance(this.data);\n        }\n        this._tracks[trackId].seek(position);\n    }\n    getTotalPlaybackDuration() {\n        if (!this.isLoaded()) {\n            this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.` +\n                `Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`);\n            return 0;\n        }\n        return this.data.duration;\n    }\n    /**\n     * Return the current playback time of the playing track in seconds from the start.\n     *\n     * Optionally specify the track to query if multiple are playing at once.\n     * @param trackId\n     */\n    getPlaybackPosition(trackId = 0) {\n        if (this._tracks.length) {\n            return this._tracks[trackId].getPlaybackPosition();\n        }\n        return 0;\n    }\n    /**\n     * Get Id of provided AudioInstance in current trackList\n     * @param track {@apilink Audio} which Id is to be given\n     */\n    getTrackId(track) {\n        return this._tracks.indexOf(track);\n    }\n    async _resumePlayback() {\n        if (this.isPaused()) {\n            const resumed = [];\n            // ensure we resume *current* tracks (if paused)\n            for (const track of this._tracks) {\n                resumed.push(track.play().then(() => {\n                    this._tracks.splice(this.getTrackId(track), 1);\n                    return true;\n                }));\n            }\n            this.events.emit('resume', new NativeSoundEvent(this));\n            this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\n            // resolve when resumed tracks are done\n            await Promise.all(resumed);\n        }\n        return true;\n    }\n    /**\n     * Starts playback, returns a promise that resolves when playback is complete\n     */\n    async _startPlayback() {\n        const track = this._getTrackInstance(this.data);\n        const complete = await track.play(() => {\n            this.events.emit('playbackstart', new NativeSoundEvent(this, track));\n            this.logger.debug('Playing new instance for sound', this.path);\n        });\n        this.events.emit('playbackend', new NativeSoundEvent(this, track));\n        // cleanup any done tracks\n        const trackId = this.getTrackId(track);\n        if (trackId !== -1) {\n            this._tracks.splice(trackId, 1);\n        }\n        return complete;\n    }\n    _getTrackInstance(data) {\n        var _a;\n        const newTrack = new WebAudioInstance(data);\n        newTrack.loop = this.loop;\n        newTrack.volume = this.volume;\n        newTrack.duration = (_a = this.duration) !== null && _a !== void 0 ? _a : 0;\n        newTrack.playbackRate = this._playbackRate;\n        this._tracks.push(newTrack);\n        return newTrack;\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n}\n\n;// ./Director/DefaultLoader.ts\n\n\n\n\n\n\n\n\n\nconst LoaderEvents = {\n    // Add event types here\n    BeforeLoad: 'beforeload',\n    AfterLoad: 'afterload',\n    UserAction: 'useraction',\n    LoadResourceStart: 'loadresourcestart',\n    LoadResourceEnd: 'loadresourceend'\n};\n/**\n * Returns true if the constructor is for an Excalibur Loader\n */\nfunction isLoaderConstructor(x) {\n    var _a, _b;\n    return !!(x === null || x === void 0 ? void 0 : x.prototype) && !!((_b = (_a = x === null || x === void 0 ? void 0 : x.prototype) === null || _a === void 0 ? void 0 : _a.constructor) === null || _b === void 0 ? void 0 : _b.name);\n}\nclass DefaultLoader {\n    get resources() {\n        return this._resources;\n    }\n    /**\n     * @param options Optionally provide the list of resources you want to load at constructor time\n     */\n    constructor(options) {\n        var _a;\n        this.events = new EventEmitter();\n        this.canvas = new Canvas({\n            filtering: ImageFiltering.Blended,\n            smoothing: true,\n            cache: false,\n            draw: this.onDraw.bind(this)\n        });\n        this._resources = [];\n        this._numLoaded = 0;\n        this._totalTimeMs = 0;\n        this._loadingFuture = new Future();\n        if (options && ((_a = options.loadables) === null || _a === void 0 ? void 0 : _a.length)) {\n            this.addResources(options.loadables);\n        }\n    }\n    /**\n     * Called by the engine before loading\n     * @param engine\n     */\n    onInitialize(engine) {\n        this.engine = engine;\n        this.canvas.width = this.engine.screen.resolution.width;\n        this.canvas.height = this.engine.screen.resolution.height;\n    }\n    /**\n     * Return a promise that resolves when the user interacts with the loading screen in some way, usually a click.\n     *\n     * It's important to implement this in order to unlock the audio context in the browser. Browsers automatically prevent\n     * audio from playing until the user performs an action.\n     *\n     */\n    async onUserAction() {\n        return await Promise.resolve();\n    }\n    /**\n     * Overridable lifecycle method, called directly before loading starts\n     */\n    async onBeforeLoad() {\n        // override me\n    }\n    /**\n     * Overridable lifecycle method, called after loading has completed\n     */\n    async onAfterLoad() {\n        // override me\n        await delay(500, this.engine.clock); // avoid a flicker\n    }\n    /**\n     * Add a resource to the loader to load\n     * @param loadable  Resource to add\n     */\n    addResource(loadable) {\n        this._resources.push(loadable);\n    }\n    /**\n     * Add a list of resources to the loader to load\n     * @param loadables  The list of resources to load\n     */\n    addResources(loadables) {\n        let i = 0;\n        const len = loadables.length;\n        for (i; i < len; i++) {\n            this.addResource(loadables[i]);\n        }\n    }\n    markResourceComplete() {\n        this._numLoaded++;\n    }\n    /**\n     * Returns the progress of the loader as a number between [0, 1] inclusive.\n     */\n    get progress() {\n        const total = this._resources.length;\n        return total > 0 ? clamp(this._numLoaded, 0, total) / total : 1;\n    }\n    /**\n     * Returns true if the loader has completely loaded all resources\n     */\n    isLoaded() {\n        return this._numLoaded === this._resources.length;\n    }\n    /**\n     * Optionally override the onUpdate\n     * @param engine\n     * @param elapsedMilliseconds\n     */\n    onUpdate(engine, elapsedMilliseconds) {\n        this._totalTimeMs += elapsedMilliseconds;\n        // override me\n    }\n    /**\n     * Optionally override the onDraw\n     */\n    onDraw(ctx) {\n        const seconds = this._totalTimeMs / 1000;\n        ctx.fillStyle = Color.Black.toRGBA();\n        ctx.fillRect(0, 0, this.engine.screen.resolution.width, this.engine.screen.resolution.height);\n        ctx.save();\n        ctx.translate(this.engine.screen.resolution.width / 2, this.engine.screen.resolution.height / 2);\n        const speed = seconds * 10;\n        ctx.strokeStyle = 'white';\n        ctx.lineWidth = 10;\n        ctx.lineCap = 'round';\n        ctx.arc(0, 0, 40, speed, speed + (Math.PI * 3) / 2);\n        ctx.stroke();\n        ctx.fillStyle = 'white';\n        ctx.font = '16px sans-serif';\n        const text = (this.progress * 100).toFixed(0) + '%';\n        const textbox = ctx.measureText(text);\n        const width = Math.abs(textbox.actualBoundingBoxLeft) + Math.abs(textbox.actualBoundingBoxRight);\n        const height = Math.abs(textbox.actualBoundingBoxAscent) + Math.abs(textbox.actualBoundingBoxDescent);\n        ctx.fillText(text, -width / 2, height / 2); // center\n        ctx.restore();\n    }\n    areResourcesLoaded() {\n        if (this._resources.length === 0) {\n            // special case no resources mean loaded;\n            return Promise.resolve();\n        }\n        return this._loadingFuture.promise;\n    }\n    /**\n     * Not meant to be overridden\n     *\n     * Begin loading all of the supplied resources, returning a promise\n     * that resolves when loading of all is complete AND the user has interacted with the loading screen\n     */\n    async load() {\n        await this.onBeforeLoad();\n        this.events.emit('beforeload');\n        this.canvas.flagDirty();\n        await Promise.all(this._resources.map(async (r) => {\n            this.events.emit('loadresourcestart', r);\n            await r.load().finally(() => {\n                // capture progress\n                this._numLoaded++;\n                this.canvas.flagDirty();\n                this.events.emit('loadresourceend', r);\n            });\n        }));\n        // Wire all sound to the engine\n        for (const resource of this._resources) {\n            if (resource instanceof Sound) {\n                resource.wireEngine(this.engine);\n            }\n        }\n        this._loadingFuture.resolve();\n        this.canvas.flagDirty();\n        // Unlock browser AudioContext in after user gesture\n        // See: https://github.com/excaliburjs/Excalibur/issues/262\n        // See: https://github.com/excaliburjs/Excalibur/issues/1031\n        await this.onUserAction();\n        this.events.emit('useraction');\n        await WebAudio.unlock();\n        await this.onAfterLoad();\n        this.events.emit('afterload');\n        return (this.data = this._resources);\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n}\n\n;// ./Director/Loader.logo.png\n/* harmony default export */ const Loader_logo = (\"data:image/png;base64,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\");\n// EXTERNAL MODULE: ./Director/Loader.css\nvar Director_Loader = __webpack_require__(851);\n;// ./Director/Loader.ts\n\n\n\n\n\n\n\n\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The {@apilink Loader} itself implements {@apilink Loadable} so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nclass Loader extends DefaultLoader {\n    get _image() {\n        if (!this._imageElement) {\n            this._imageElement = new Image();\n            this._imageElement.onload = () => this._imageLoaded.resolve();\n            this._imageElement.src = this.logo;\n        }\n        return this._imageElement;\n    }\n    get playButtonRootElement() {\n        return this._playButtonRootElement;\n    }\n    get playButtonElement() {\n        return this._playButtonElement;\n    }\n    get _playButton() {\n        const existingRoot = document.getElementById('excalibur-play-root');\n        if (existingRoot) {\n            this._playButtonRootElement = existingRoot;\n        }\n        if (!this._playButtonRootElement) {\n            this._playButtonRootElement = document.createElement('div');\n            this._playButtonRootElement.id = 'excalibur-play-root';\n            this._playButtonRootElement.style.position = 'absolute';\n            document.body.appendChild(this._playButtonRootElement);\n        }\n        if (!this._styleBlock) {\n            this._styleBlock = document.createElement('style');\n            this._styleBlock.textContent = this._playButtonStyles;\n            document.head.appendChild(this._styleBlock);\n        }\n        if (!this._playButtonElement) {\n            this._playButtonElement = this.startButtonFactory();\n            this._playButtonRootElement.appendChild(this._playButtonElement);\n        }\n        return this._playButtonElement;\n    }\n    constructor(loadablesOrOptions) {\n        const options = Array.isArray(loadablesOrOptions)\n            ? {\n                loadables: loadablesOrOptions\n            }\n            : loadablesOrOptions;\n        super(options);\n        this._logger = Logger.getInstance();\n        this._originalOptions = { loadables: [] };\n        this.events = new EventEmitter();\n        this._playButtonShown = false;\n        // logo drawing stuff\n        // base64 string encoding of the excalibur logo (logo-white.png)\n        this.logo = Loader_logo;\n        this.logoWidth = 468;\n        this.logoHeight = 118;\n        /**\n         * Gets or sets the color of the loading bar, default is {@apilink Color.White}\n         */\n        this.loadingBarColor = Color.White;\n        /**\n         * Gets or sets the background color of the loader as a hex string\n         */\n        this.backgroundColor = '#176BAA';\n        this._imageLoaded = new Future();\n        this.suppressPlayButton = false;\n        /** Loads the css from Loader.css */\n        this._playButtonStyles = Director_Loader/* default */.A.toString();\n        /**\n         * Get/set play button text\n         */\n        this.playButtonText = 'Play game';\n        /**\n         * Return a html button element for excalibur to use as a play button\n         */\n        this.startButtonFactory = () => {\n            let buttonElement = document.getElementById('excalibur-play');\n            if (!buttonElement) {\n                buttonElement = document.createElement('button');\n            }\n            buttonElement.id = 'excalibur-play';\n            buttonElement.textContent = this.playButtonText;\n            buttonElement.style.display = 'none';\n            return buttonElement;\n        };\n        this._originalOptions = { ...Loader._DEFAULT_LOADER_OPTIONS, ...options };\n    }\n    onInitialize(engine) {\n        this.engine = engine;\n        this.screen = engine.screen;\n        this.canvas.width = this.engine.canvas.width;\n        this.canvas.height = this.engine.canvas.height;\n        this.screen.events.on('resize', () => {\n            this.canvas.width = this.engine.canvas.width;\n            this.canvas.height = this.engine.canvas.height;\n        });\n    }\n    /**\n     * Shows the play button and returns a promise that resolves when clicked\n     */\n    async showPlayButton() {\n        var _a, _b;\n        if (this.suppressPlayButton) {\n            this.hidePlayButton();\n            // Delay is to give the logo a chance to show, otherwise don't delay\n            await delay(500, (_a = this.engine) === null || _a === void 0 ? void 0 : _a.clock);\n        }\n        else {\n            const resizeHandler = () => {\n                try {\n                    this._positionPlayButton();\n                }\n                catch (_a) {\n                    // swallow if can't position\n                }\n            };\n            if ((_b = this.engine) === null || _b === void 0 ? void 0 : _b.browser) {\n                this.engine.browser.window.on('resize', resizeHandler);\n            }\n            this._playButtonShown = true;\n            this._playButton.style.display = 'block';\n            document.body.addEventListener('keyup', (evt) => {\n                if (evt.key === 'Enter') {\n                    this._playButton.click();\n                }\n            });\n            this._positionPlayButton();\n            const playButtonClicked = new Promise((resolve) => {\n                const startButtonHandler = (e) => {\n                    var _a;\n                    // We want to stop propagation to keep bubbling to the engine pointer handlers\n                    e.stopPropagation();\n                    // Hide Button after click\n                    this.hidePlayButton();\n                    if ((_a = this.engine) === null || _a === void 0 ? void 0 : _a.browser) {\n                        this.engine.browser.window.off('resize', resizeHandler);\n                    }\n                    if (this._originalOptions.fullscreenAfterLoad) {\n                        try {\n                            this._logger.info('requesting fullscreen');\n                            if (this._originalOptions.fullscreenContainer instanceof HTMLElement) {\n                                this._originalOptions.fullscreenContainer.requestFullscreen();\n                            }\n                            else {\n                                this.engine.screen.goFullScreen(this._originalOptions.fullscreenContainer);\n                            }\n                        }\n                        catch (error) {\n                            this._logger.error('could not go fullscreen', error);\n                        }\n                    }\n                    resolve();\n                };\n                this._playButton.addEventListener('click', startButtonHandler);\n                this._playButton.addEventListener('touchend', startButtonHandler);\n                this._playButton.addEventListener('pointerup', startButtonHandler);\n            });\n            return await playButtonClicked;\n        }\n    }\n    hidePlayButton() {\n        this._playButtonShown = false;\n        this._playButton.style.display = 'none';\n    }\n    /**\n     * Clean up generated elements for the loader\n     */\n    dispose() {\n        if (this._playButtonRootElement.parentElement) {\n            this._playButtonRootElement.removeChild(this._playButtonElement);\n            document.body.removeChild(this._playButtonRootElement);\n            document.head.removeChild(this._styleBlock);\n            this._playButtonRootElement = null;\n            this._playButtonElement = null;\n            this._styleBlock = null;\n        }\n    }\n    async onUserAction() {\n        var _a;\n        // short delay in showing the button for aesthetics\n        await delay(200, (_a = this.engine) === null || _a === void 0 ? void 0 : _a.clock);\n        this.canvas.flagDirty();\n        // show play button\n        await this.showPlayButton();\n    }\n    async onBeforeLoad() {\n        this.screen.pushResolutionAndViewport();\n        this.screen.resolution = { width: this.canvas.width, height: this.canvas.height };\n        this.screen.applyResolutionAndViewport();\n        const image = this._image;\n        await this._imageLoaded.promise;\n        await (image === null || image === void 0 ? void 0 : image.decode()); // decode logo if it exists\n    }\n    // eslint-disable-next-line require-await\n    async onAfterLoad() {\n        this.screen.popResolutionAndViewport();\n        this.screen.applyResolutionAndViewport();\n        this.dispose();\n    }\n    _positionPlayButton() {\n        if (this.engine) {\n            const { x: left, y: top, width: screenWidth, height: screenHeight } = this.engine.canvas.getBoundingClientRect();\n            if (this._playButtonRootElement) {\n                const buttonWidth = this._playButton.clientWidth;\n                const buttonHeight = this._playButton.clientHeight;\n                if (this.playButtonPosition) {\n                    this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\n                    this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\n                }\n                else {\n                    this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\n                    this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\n                }\n            }\n        }\n    }\n    /**\n     * Loader draw function. Draws the default Excalibur loading screen.\n     * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n     * to customize the drawing, or just override entire method.\n     */\n    onDraw(ctx) {\n        const canvasHeight = this.engine.canvasHeight / this.engine.pixelRatio;\n        const canvasWidth = this.engine.canvasWidth / this.engine.pixelRatio;\n        this._positionPlayButton();\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n        let logoY = canvasHeight / 2;\n        const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n        let logoX = canvasWidth / 2 - width / 2;\n        if (this.logoPosition) {\n            logoX = this.logoPosition.x;\n            logoY = this.logoPosition.y;\n        }\n        const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n        const oldAntialias = this.engine.screen.antialiasing;\n        this.engine.screen.antialiasing = true;\n        if (!this.logoPosition) {\n            ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\n        }\n        else {\n            ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\n        }\n        // loading box\n        if (!this.suppressPlayButton && this._playButtonShown) {\n            this.engine.screen.antialiasing = oldAntialias;\n            return;\n        }\n        let loadingX = logoX;\n        let loadingY = logoY;\n        if (this.loadingBarPosition) {\n            loadingX = this.loadingBarPosition.x;\n            loadingY = this.loadingBarPosition.y;\n        }\n        ctx.lineWidth = 2;\n        roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\n        const progress = width * this.progress;\n        const margin = 5;\n        const progressWidth = progress - margin * 2;\n        const height = 20 - margin * 2;\n        roundRect(ctx, loadingX + margin, loadingY + margin, progressWidth > 10 ? progressWidth : 10, height, 5, null, this.loadingBarColor);\n        this.engine.screen.antialiasing = oldAntialias;\n    }\n}\nLoader._DEFAULT_LOADER_OPTIONS = {\n    loadables: [],\n    fullscreenAfterLoad: false,\n    fullscreenContainer: undefined\n};\n\n;// ./Util/Detector.ts\n\n/**\n * This is the list of features that will be used to log the supported\n * features to the console when Detector.logBrowserFeatures() is called.\n */\nconst REPORTED_FEATURES = {\n    webgl: 'WebGL',\n    webaudio: 'WebAudio',\n    gamepadapi: 'Gamepad API'\n};\n/**\n * Excalibur internal feature detection helper class\n */\nclass Detector {\n    constructor() {\n        this._features = null;\n        this.failedTests = [];\n        // critical browser features required for ex to run\n        this._criticalTests = {\n            // Test canvas/2d context support\n            canvasSupport: function () {\n                const elem = document.createElement('canvas');\n                return !!(elem.getContext && elem.getContext('2d'));\n            },\n            // Test array buffer support ex uses for downloading binary data\n            arrayBufferSupport: function () {\n                const xhr = new XMLHttpRequest();\n                xhr.open('GET', '/');\n                try {\n                    xhr.responseType = 'arraybuffer';\n                }\n                catch (e) {\n                    return false;\n                }\n                return xhr.responseType === 'arraybuffer';\n            },\n            // Test data urls ex uses for sprites\n            dataUrlSupport: function () {\n                const canvas = document.createElement('canvas');\n                return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n            },\n            // Test object url support for loading\n            objectUrlSupport: function () {\n                return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\n            },\n            // RGBA support for colors\n            rgbaSupport: function () {\n                const style = document.createElement('a').style;\n                style.cssText = 'background-color:rgba(150,255,150,.5)';\n                return ('' + style.backgroundColor).indexOf('rgba') > -1;\n            }\n        };\n        // warnings excalibur performance will be degraded\n        this._warningTest = {\n            webAudioSupport: function () {\n                return !!(window.AudioContext ||\n                    window.webkitAudioContext ||\n                    window.mozAudioContext ||\n                    window.msAudioContext ||\n                    window.oAudioContext);\n            },\n            webglSupport: function () {\n                const elem = document.createElement('canvas');\n                return !!(elem.getContext && elem.getContext('webgl'));\n            }\n        };\n        this._features = this._loadBrowserFeatures();\n    }\n    /**\n     * Returns a map of currently supported browser features. This method\n     * treats the features as a singleton and will only calculate feature\n     * support if it has not previously been done.\n     */\n    getBrowserFeatures() {\n        if (this._features === null) {\n            this._features = this._loadBrowserFeatures();\n        }\n        return this._features;\n    }\n    /**\n     * Report on non-critical browser support for debugging purposes.\n     * Use native browser console colors for visibility.\n     */\n    logBrowserFeatures() {\n        let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\n        const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\n        const supported = this.getBrowserFeatures();\n        for (const feature of Object.keys(REPORTED_FEATURES)) {\n            if (supported[feature]) {\n                msg += '(%c\\u2713%c)'; // ()\n                args.push('font-weight: bold; color: green');\n                args.push('font-weight: normal; color: inherit');\n            }\n            else {\n                msg += '(%c\\u2717%c)'; // ()\n                args.push('font-weight: bold; color: red');\n                args.push('font-weight: normal; color: inherit');\n            }\n            msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\n        }\n        args.unshift(msg);\n        // eslint-disable-next-line no-console\n        console.log.apply(console, args);\n    }\n    /**\n     * Executes several IIFE's to get a constant reference to supported\n     * features within the current execution context.\n     */\n    _loadBrowserFeatures() {\n        return {\n            // IIFE to check canvas support\n            canvas: (() => {\n                return this._criticalTests.canvasSupport();\n            })(),\n            // IIFE to check arraybuffer support\n            arraybuffer: (() => {\n                return this._criticalTests.arrayBufferSupport();\n            })(),\n            // IIFE to check dataurl support\n            dataurl: (() => {\n                return this._criticalTests.dataUrlSupport();\n            })(),\n            // IIFE to check objecturl support\n            objecturl: (() => {\n                return this._criticalTests.objectUrlSupport();\n            })(),\n            // IIFE to check rgba support\n            rgba: (() => {\n                return this._criticalTests.rgbaSupport();\n            })(),\n            // IIFE to check webaudio support\n            webaudio: (() => {\n                return this._warningTest.webAudioSupport();\n            })(),\n            // IIFE to check webgl support\n            webgl: (() => {\n                return this._warningTest.webglSupport();\n            })(),\n            // IIFE to check gamepadapi support\n            gamepadapi: (() => {\n                return !!navigator.getGamepads;\n            })()\n        };\n    }\n    test() {\n        // Critical test will for ex not to run\n        let failedCritical = false;\n        for (const test in this._criticalTests) {\n            if (!this._criticalTests[test].call(this)) {\n                this.failedTests.push(test);\n                Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\n                failedCritical = true;\n            }\n        }\n        if (failedCritical) {\n            return false;\n        }\n        // Warning tests do not for ex to return false to compatibility\n        for (const warning in this._warningTest) {\n            if (!this._warningTest[warning]()) {\n                Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\n            }\n        }\n        return true;\n    }\n}\n\n;// ./Collision/CollisionType.ts\n/**\n * An enum that describes the types of collisions bodies can participate in\n */\nvar CollisionType;\n(function (CollisionType) {\n    /**\n     * Bodies with the `PreventCollision` setting do not participate in any\n     * collisions and do not raise collision events.\n     */\n    CollisionType[\"PreventCollision\"] = \"PreventCollision\";\n    /**\n     * Bodies with the `Passive` setting only raise collision events, but are not\n     * influenced or moved by other bodies and do not influence or move other bodies.\n     * This is useful for use in trigger type behavior.\n     */\n    CollisionType[\"Passive\"] = \"Passive\";\n    /**\n     * Bodies with the `Active` setting raise collision events and participate\n     * in collisions with other bodies and will be push or moved by bodies sharing\n     * the `Active` or `Fixed` setting.\n     */\n    CollisionType[\"Active\"] = \"Active\";\n    /**\n     * Bodies with the `Fixed` setting raise collision events and participate in\n     * collisions with other bodies. Actors with the `Fixed` setting will not be\n     * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\n     * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\n     * not be pushed or moved by each other, they will not interact except to throw\n     * collision events.\n     */\n    CollisionType[\"Fixed\"] = \"Fixed\";\n})(CollisionType || (CollisionType = {}));\n\n;// ./Collision/Group/CollisionGroupManager.ts\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nclass CollisionGroupManager {\n    /**\n     * Create a new named collision group up to a max of 32.\n     * @param name Name for the collision group\n     * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n     */\n    static create(name, mask) {\n        if (this._CURRENT_GROUP > this._MAX_GROUPS) {\n            throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n        }\n        if (this._GROUPS.get(name)) {\n            const existingGroup = this._GROUPS.get(name);\n            if (existingGroup.mask === mask) {\n                return existingGroup;\n            }\n            throw new Error(`Collision group ${name} already exists with a different mask!`);\n        }\n        const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\n        this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\n        this._CURRENT_GROUP++;\n        this._GROUPS.set(name, group);\n        return group;\n    }\n    /**\n     * Get all collision groups currently tracked by excalibur\n     */\n    static get groups() {\n        return Array.from(this._GROUPS.values());\n    }\n    /**\n     * Get a collision group by it's name\n     * @param name\n     */\n    static groupByName(name) {\n        return this._GROUPS.get(name);\n    }\n    /**\n     * Resets the managers internal group management state\n     */\n    static reset() {\n        this._GROUPS = new Map();\n        this._CURRENT_BIT = this._STARTING_BIT;\n        this._CURRENT_GROUP = 1;\n    }\n}\n// using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\nCollisionGroupManager._STARTING_BIT = 0b1 | 0;\nCollisionGroupManager._MAX_GROUPS = 32;\nCollisionGroupManager._CURRENT_GROUP = 1;\nCollisionGroupManager._CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\nCollisionGroupManager._GROUPS = new Map();\n\n;// ./Collision/Group/CollisionGroup.ts\n\n/**\n * CollisionGroups indicate like members that do not collide with each other. Use {@apilink CollisionGroupManager} to create {@apilink CollisionGroup}s\n *\n * For example:\n *\n * Players have collision group \"player\"\n *\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\n *\n * Enemies have collision group \"enemy\"\n *\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\n *\n * Blocks have collision group \"ground\"\n *\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\n *\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\n * with players and blocks.\n *\n * This is done with bitmasking, see the following pseudo-code\n *\n * PlayerGroup = `0b001`\n * PlayerGroupMask = `0b110`\n *\n * EnemyGroup = `0b010`\n * EnemyGroupMask = `0b101`\n *\n * BlockGroup = `0b100`\n * BlockGroupMask = `0b011`\n *\n * Should Players collide? No because the bitwise mask evaluates to 0\n * `(player1.group & player2.mask) === 0`\n * `(0b001 & 0b110) === 0`\n *\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\n * `(player1.group & enemy1.mask) === 1`\n * `(0b001 & 0b101) === 1`\n *\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\n * `(player1.group & blocks1.mask) === 1`\n * `(0b001 & 0b011) === 1`\n */\nclass CollisionGroup {\n    /**\n     * STOP!!** It is preferred that {@apilink CollisionGroupManager.create} is used to create collision groups\n     *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\n     * @param name Name of the collision group\n     * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\n     * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\n     */\n    constructor(name, category, mask) {\n        this._name = name;\n        this._category = category;\n        this._mask = mask;\n    }\n    /**\n     * Get the name of the collision group\n     */\n    get name() {\n        return this._name;\n    }\n    /**\n     * Get the category of the collision group, a 32 bit number which should be a unique power of 2\n     */\n    get category() {\n        return this._category;\n    }\n    /**\n     * Get the mask for this collision group\n     */\n    get mask() {\n        return this._mask;\n    }\n    /**\n     * Evaluates whether 2 collision groups can collide\n     *\n     * This means the mask has the same bit set the other category and vice versa\n     * @param other  CollisionGroup\n     */\n    canCollide(other) {\n        const overlap1 = this.category & other.mask;\n        const overlap2 = this.mask & other.category;\n        return overlap1 !== 0 && overlap2 !== 0;\n    }\n    /**\n     * Inverts the collision group. For example, if before the group specified \"players\",\n     * inverting would specify all groups except players\n     * @returns CollisionGroup\n     */\n    invert() {\n        const group = CollisionGroupManager.create('~(' + this.name + ')', ~this.mask | 0);\n        group._category = ~this.category;\n        return group;\n    }\n    /**\n     * Combine collision groups with each other. The new group includes all of the previous groups.\n     * @param collisionGroups\n     */\n    static combine(collisionGroups) {\n        const combinedName = collisionGroups.map((c) => c.name).join('+');\n        const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\n        const combinedMask = ~combinedCategory;\n        return CollisionGroupManager.create(combinedName, combinedMask);\n    }\n    /**\n     * Creates a collision group that collides with the listed groups\n     * @param collisionGroups\n     */\n    static collidesWith(collisionGroups) {\n        const combinedName = `collidesWith(${collisionGroups.map((c) => c.name).join('+')})`;\n        const combinedMask = collisionGroups.reduce((current, g) => g.category | current, 0b0);\n        return CollisionGroupManager.create(combinedName, combinedMask);\n    }\n    toString() {\n        return `\ncategory: ${this.category.toString(2).padStart(32, '0')}\nmask:     ${(this.mask >>> 0).toString(2).padStart(32, '0')}\n    `;\n    }\n}\n/**\n * The `All` {@apilink CollisionGroup} is a special group that collides with all other groups including itself,\n * it is the default collision group on colliders.\n */\nCollisionGroup.All = new CollisionGroup('Collide with all groups', -1, -1);\n\n;// ./Collision/Detection/Pair.ts\n\n\n/**\n * Models a potential collision between 2 colliders\n */\nclass Pair {\n    constructor(colliderA, colliderB) {\n        this.colliderA = colliderA;\n        this.colliderB = colliderB;\n        this.id = null;\n        this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n    }\n    /**\n     * Returns whether a it is allowed for 2 colliders in a Pair to collide\n     * @param colliderA\n     * @param colliderB\n     */\n    static canCollide(colliderA, colliderB) {\n        var _a, _b;\n        // Prevent self collision\n        if (colliderA.id === colliderB.id) {\n            return false;\n        }\n        // Colliders with the same owner do not collide (composite colliders)\n        if (colliderA.owner && colliderB.owner && colliderA.owner.id === colliderB.owner.id) {\n            return false;\n        }\n        // if the pair has a member with zero dimension don't collide\n        if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\n            return false;\n        }\n        const bodyA = (_a = colliderA === null || colliderA === void 0 ? void 0 : colliderA.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n        const bodyB = (_b = colliderB === null || colliderB === void 0 ? void 0 : colliderB.owner) === null || _b === void 0 ? void 0 : _b.get(BodyComponent);\n        // Body's needed for collision in the current state\n        // TODO can we collide without a body?\n        if (!bodyA || !bodyB) {\n            return false;\n        }\n        // If both are in the same collision group short circuit\n        if (!bodyA.group.canCollide(bodyB.group)) {\n            return false;\n        }\n        // if both are fixed short circuit\n        if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\n            return false;\n        }\n        // if the either is prevent collision short circuit\n        if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\n            return false;\n        }\n        // if either is dead short circuit\n        if (!bodyA.isActive || !bodyB.isActive) {\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Returns whether or not it is possible for the pairs to collide\n     */\n    get canCollide() {\n        const colliderA = this.colliderA;\n        const colliderB = this.colliderB;\n        return Pair.canCollide(colliderA, colliderB);\n    }\n    /**\n     * Runs the collision intersection logic on the members of this pair\n     */\n    collide() {\n        return this.colliderA.collide(this.colliderB);\n    }\n    /**\n     * Check if the collider is part of the pair\n     * @param collider\n     */\n    hasCollider(collider) {\n        return collider === this.colliderA || collider === this.colliderB;\n    }\n    /**\n     * Calculates the unique pair hash id for this collision pair (owning id)\n     */\n    static calculatePairHash(idA, idB) {\n        if (idA.value < idB.value) {\n            return `#${idA.value}+${idB.value}`;\n        }\n        else {\n            return `#${idB.value}+${idA.value}`;\n        }\n    }\n}\n\n;// ./Math/projection.ts\n/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\nclass Projection {\n    constructor(min, max) {\n        this.min = min;\n        this.max = max;\n    }\n    overlaps(projection) {\n        return this.max > projection.min && projection.max > this.min;\n    }\n    getOverlap(projection) {\n        if (this.overlaps(projection)) {\n            if (this.max > projection.max) {\n                return projection.max - this.min;\n            }\n            else {\n                return this.max - projection.min;\n            }\n        }\n        return 0;\n    }\n}\n\n;// ./Collision/Detection/DynamicTree.ts\n\n\n\n\n/**\n * Dynamic Tree Node used for tracking bounds within the tree\n */\nclass TreeNode {\n    constructor(parent) {\n        this.parent = parent;\n        this.parent = parent || null;\n        this.data = null;\n        this.bounds = new BoundingBox();\n        this.left = null;\n        this.right = null;\n        this.height = 0;\n    }\n    isLeaf() {\n        return !this.left && !this.right;\n    }\n}\n/**\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\n *\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\n * Every non-leaf node is a bounding box that contains child bounding boxes.\n */\nclass DynamicTree {\n    constructor(_config, worldBounds = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\n        this._config = _config;\n        this.worldBounds = worldBounds;\n        this.root = null;\n        this.nodes = {};\n    }\n    /**\n     * Inserts a node into the dynamic tree\n     */\n    _insert(leaf) {\n        // If there are no nodes in the tree, make this the root leaf\n        if (this.root === null) {\n            this.root = leaf;\n            this.root.parent = null;\n            return;\n        }\n        // Search the tree for a node that is not a leaf and find the best place to insert\n        const leafAABB = leaf.bounds;\n        let currentRoot = this.root;\n        while (!currentRoot.isLeaf()) {\n            const left = currentRoot.left;\n            const right = currentRoot.right;\n            const area = currentRoot.bounds.getPerimeter();\n            const combinedAABB = currentRoot.bounds.combine(leafAABB);\n            const combinedArea = combinedAABB.getPerimeter();\n            // Calculate cost heuristic for creating a new parent and leaf\n            const cost = 2 * combinedArea;\n            // Minimum cost of pushing the leaf down the tree\n            const inheritanceCost = 2 * (combinedArea - area);\n            // Cost of descending\n            let leftCost = 0;\n            const leftCombined = leafAABB.combine(left.bounds);\n            let newArea;\n            let oldArea;\n            if (left.isLeaf()) {\n                leftCost = leftCombined.getPerimeter() + inheritanceCost;\n            }\n            else {\n                oldArea = left.bounds.getPerimeter();\n                newArea = leftCombined.getPerimeter();\n                leftCost = newArea - oldArea + inheritanceCost;\n            }\n            let rightCost = 0;\n            const rightCombined = leafAABB.combine(right.bounds);\n            if (right.isLeaf()) {\n                rightCost = rightCombined.getPerimeter() + inheritanceCost;\n            }\n            else {\n                oldArea = right.bounds.getPerimeter();\n                newArea = rightCombined.getPerimeter();\n                rightCost = newArea - oldArea + inheritanceCost;\n            }\n            // cost is acceptable\n            if (cost < leftCost && cost < rightCost) {\n                break;\n            }\n            // Descend to the depths\n            if (leftCost < rightCost) {\n                currentRoot = left;\n            }\n            else {\n                currentRoot = right;\n            }\n        }\n        // Create the new parent node and insert into the tree\n        const oldParent = currentRoot.parent;\n        const newParent = new TreeNode(oldParent);\n        newParent.bounds = leafAABB.combine(currentRoot.bounds);\n        newParent.height = currentRoot.height + 1;\n        if (oldParent !== null) {\n            // The sibling node was not the root\n            if (oldParent.left === currentRoot) {\n                oldParent.left = newParent;\n            }\n            else {\n                oldParent.right = newParent;\n            }\n            newParent.left = currentRoot;\n            newParent.right = leaf;\n            currentRoot.parent = newParent;\n            leaf.parent = newParent;\n        }\n        else {\n            // The sibling node was the root\n            newParent.left = currentRoot;\n            newParent.right = leaf;\n            currentRoot.parent = newParent;\n            leaf.parent = newParent;\n            this.root = newParent;\n        }\n        // Walk up the tree fixing heights and AABBs\n        let currentNode = leaf.parent;\n        while (currentNode) {\n            currentNode = this._balance(currentNode);\n            if (!currentNode.left) {\n                throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\n            }\n            if (!currentNode.right) {\n                throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\n            }\n            currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n            currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n            currentNode = currentNode.parent;\n        }\n    }\n    /**\n     * Removes a node from the dynamic tree\n     */\n    _remove(leaf) {\n        if (leaf === this.root) {\n            this.root = null;\n            return;\n        }\n        const parent = leaf.parent;\n        const grandParent = parent.parent;\n        let sibling;\n        if (parent.left === leaf) {\n            sibling = parent.right;\n        }\n        else {\n            sibling = parent.left;\n        }\n        if (grandParent) {\n            if (grandParent.left === parent) {\n                grandParent.left = sibling;\n            }\n            else {\n                grandParent.right = sibling;\n            }\n            sibling.parent = grandParent;\n            let currentNode = grandParent;\n            while (currentNode) {\n                currentNode = this._balance(currentNode);\n                currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n                currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n                currentNode = currentNode.parent;\n            }\n        }\n        else {\n            this.root = sibling;\n            sibling.parent = null;\n        }\n    }\n    /**\n     * Tracks a body in the dynamic tree\n     */\n    trackCollider(collider) {\n        const node = new TreeNode();\n        node.data = collider;\n        node.bounds = collider.bounds;\n        node.bounds.left -= 2;\n        node.bounds.top -= 2;\n        node.bounds.right += 2;\n        node.bounds.bottom += 2;\n        this.nodes[collider.id.value] = node;\n        this._insert(node);\n    }\n    /**\n     * Updates the dynamic tree given the current bounds of each body being tracked\n     */\n    updateCollider(collider) {\n        var _a;\n        const node = this.nodes[collider.id.value];\n        if (!node) {\n            return false;\n        }\n        const b = collider.bounds;\n        // if the body is outside the world no longer update it\n        if (!this.worldBounds.contains(b)) {\n            Logger.getInstance().warn('Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics');\n            this.untrackCollider(collider);\n            return false;\n        }\n        if (node.bounds.contains(b)) {\n            return false;\n        }\n        this._remove(node);\n        b.left -= this._config.boundsPadding;\n        b.top -= this._config.boundsPadding;\n        b.right += this._config.boundsPadding;\n        b.bottom += this._config.boundsPadding;\n        // THIS IS CAUSING UNNECESSARY CHECKS\n        if (collider.owner) {\n            const body = (_a = collider.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n            if (body) {\n                const multdx = ((body.vel.x * 32) / 1000) * this._config.velocityMultiplier;\n                const multdy = ((body.vel.y * 32) / 1000) * this._config.velocityMultiplier;\n                if (multdx < 0) {\n                    b.left += multdx;\n                }\n                else {\n                    b.right += multdx;\n                }\n                if (multdy < 0) {\n                    b.top += multdy;\n                }\n                else {\n                    b.bottom += multdy;\n                }\n            }\n        }\n        node.bounds = b;\n        this._insert(node);\n        return true;\n    }\n    /**\n     * Untracks a body from the dynamic tree\n     */\n    untrackCollider(collider) {\n        const node = this.nodes[collider.id.value];\n        if (!node) {\n            return;\n        }\n        this._remove(node);\n        this.nodes[collider.id.value] = null;\n        delete this.nodes[collider.id.value];\n    }\n    /**\n     * Balances the tree about a node\n     */\n    _balance(node) {\n        if (node === null) {\n            throw new Error('Cannot balance at null node');\n        }\n        if (node.isLeaf() || node.height < 2) {\n            return node;\n        }\n        const left = node.left;\n        const right = node.right;\n        const a = node;\n        const b = left;\n        const c = right;\n        const d = left.left;\n        const e = left.right;\n        const f = right.left;\n        const g = right.right;\n        const balance = c.height - b.height;\n        // Rotate c node up\n        if (balance > 1) {\n            // Swap the right node with it's parent\n            c.left = a;\n            c.parent = a.parent;\n            a.parent = c;\n            // The original node's old parent should point to the right node\n            // this is mega confusing\n            if (c.parent) {\n                if (c.parent.left === a) {\n                    c.parent.left = c;\n                }\n                else {\n                    c.parent.right = c;\n                }\n            }\n            else {\n                this.root = c;\n            }\n            // Rotate\n            if (f.height > g.height) {\n                c.right = f;\n                a.right = g;\n                g.parent = a;\n                a.bounds = b.bounds.combine(g.bounds);\n                c.bounds = a.bounds.combine(f.bounds);\n                a.height = 1 + Math.max(b.height, g.height);\n                c.height = 1 + Math.max(a.height, f.height);\n            }\n            else {\n                c.right = g;\n                a.right = f;\n                f.parent = a;\n                a.bounds = b.bounds.combine(f.bounds);\n                c.bounds = a.bounds.combine(g.bounds);\n                a.height = 1 + Math.max(b.height, f.height);\n                c.height = 1 + Math.max(a.height, g.height);\n            }\n            return c;\n        }\n        // Rotate left node up\n        if (balance < -1) {\n            // swap\n            b.left = a;\n            b.parent = a.parent;\n            a.parent = b;\n            // node's old parent should point to b\n            if (b.parent) {\n                if (b.parent.left === a) {\n                    b.parent.left = b;\n                }\n                else {\n                    if (b.parent.right !== a) {\n                        throw 'Error rotating Dynamic Tree';\n                    }\n                    b.parent.right = b;\n                }\n            }\n            else {\n                this.root = b;\n            }\n            // rotate\n            if (d.height > e.height) {\n                b.right = d;\n                a.left = e;\n                e.parent = a;\n                a.bounds = c.bounds.combine(e.bounds);\n                b.bounds = a.bounds.combine(d.bounds);\n                a.height = 1 + Math.max(c.height, e.height);\n                b.height = 1 + Math.max(a.height, d.height);\n            }\n            else {\n                b.right = e;\n                a.left = d;\n                d.parent = a;\n                a.bounds = c.bounds.combine(d.bounds);\n                b.bounds = a.bounds.combine(e.bounds);\n                a.height = 1 + Math.max(c.height, d.height);\n                b.height = 1 + Math.max(a.height, e.height);\n            }\n            return b;\n        }\n        return node;\n    }\n    /**\n     * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\n     */\n    getHeight() {\n        if (this.root === null) {\n            return 0;\n        }\n        return this.root.height;\n    }\n    /**\n     * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\n     *\n     * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\n     * that you are complete with your query and you do not want to continue. Returning false will continue searching\n     * the tree until all possible colliders have been returned.\n     */\n    query(collider, callback) {\n        const bounds = collider.bounds;\n        const helper = (currentNode) => {\n            if (currentNode && currentNode.bounds.overlaps(bounds)) {\n                if (currentNode.isLeaf() && currentNode.data !== collider) {\n                    if (callback.call(collider, currentNode.data)) {\n                        return true;\n                    }\n                }\n                else {\n                    return helper(currentNode.left) || helper(currentNode.right);\n                }\n            }\n            return false;\n        };\n        helper(this.root);\n    }\n    /**\n     * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\n     * long ray to test the tree specified by `max`.\n     *\n     * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\n     * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\n     * the tree until all possible bodies that would intersect with the ray have been returned.\n     */\n    rayCastQuery(ray, max = Infinity, callback) {\n        const helper = (currentNode) => {\n            if (currentNode && currentNode.bounds.rayCast(ray, max)) {\n                if (currentNode.isLeaf()) {\n                    if (callback.call(ray, currentNode.data)) {\n                        // ray hit a leaf! return the body\n                        return true;\n                    }\n                }\n                else {\n                    // ray hit but not at a leaf, recurse deeper\n                    return helper(currentNode.left) || helper(currentNode.right);\n                }\n            }\n            return false; // ray missed\n        };\n        helper(this.root);\n    }\n    getNodes() {\n        const helper = (currentNode) => {\n            if (currentNode) {\n                return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\n            }\n            else {\n                return [];\n            }\n        };\n        return helper(this.root);\n    }\n    debug(ex) {\n        // draw all the nodes in the Dynamic Tree\n        const helper = (currentNode) => {\n            if (currentNode) {\n                if (currentNode.isLeaf()) {\n                    currentNode.bounds.draw(ex, Color.Green);\n                }\n                else {\n                    currentNode.bounds.draw(ex, Color.White);\n                }\n                if (currentNode.left) {\n                    helper(currentNode.left);\n                }\n                if (currentNode.right) {\n                    helper(currentNode.right);\n                }\n            }\n        };\n        helper(this.root);\n    }\n}\n\n;// ./Math/ray.ts\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\nclass Ray {\n    /**\n     * @param pos The starting position for the ray\n     * @param dir The vector indicating the direction of the ray\n     */\n    constructor(pos, dir) {\n        this.pos = pos;\n        this.dir = dir.normalize();\n    }\n    /**\n     * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n     * This number indicates the mathematical intersection time.\n     * @param line  The line to test\n     */\n    intersect(line) {\n        const numerator = line.begin.sub(this.pos);\n        // Test is line and ray are parallel and non intersecting\n        if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n            return -1;\n        }\n        // Lines are parallel\n        const divisor = this.dir.cross(line.getSlope());\n        if (divisor === 0) {\n            return -1;\n        }\n        const t = numerator.cross(line.getSlope()) / divisor;\n        if (t >= 0) {\n            const u = numerator.cross(this.dir) / divisor / line.getLength();\n            if (u >= 0 && u <= 1) {\n                return t;\n            }\n        }\n        return -1;\n    }\n    intersectPoint(line) {\n        const time = this.intersect(line);\n        if (time < 0) {\n            return null;\n        }\n        return this.getPoint(time);\n    }\n    /**\n     * Returns the point of intersection given the intersection time\n     */\n    getPoint(time) {\n        return this.pos.add(this.dir.scale(time));\n    }\n}\n\n;// ./Collision/Detection/DynamicTreeCollisionProcessor.ts\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Responsible for performing the collision broadphase (locating potential collisions) and\n * the narrowphase (actual collision contacts)\n */\nclass DynamicTreeCollisionProcessor {\n    constructor(_config) {\n        this._config = _config;\n        this._pairs = new Set();\n        this._collisionPairCache = [];\n        this._colliders = [];\n        this._dynamicCollisionTree = new DynamicTree(_config.dynamicTree);\n    }\n    getColliders() {\n        return this._colliders;\n    }\n    query(pointOrBounds) {\n        const results = [];\n        if (pointOrBounds instanceof BoundingBox) {\n            this._dynamicCollisionTree.query({\n                id: createId('collider', -1),\n                owner: null,\n                bounds: pointOrBounds\n            }, (other) => {\n                results.push(other);\n                return false;\n            });\n        }\n        else {\n            this._dynamicCollisionTree.query({\n                id: createId('collider', -1),\n                owner: null,\n                bounds: new BoundingBox(pointOrBounds.x, pointOrBounds.y, pointOrBounds.x, pointOrBounds.y)\n            }, (other) => {\n                results.push(other);\n                return false;\n            });\n        }\n        return results;\n    }\n    rayCast(ray, options) {\n        var _a, _b, _c;\n        const results = [];\n        const maxDistance = (_a = options === null || options === void 0 ? void 0 : options.maxDistance) !== null && _a !== void 0 ? _a : Infinity;\n        const collisionGroup = options === null || options === void 0 ? void 0 : options.collisionGroup;\n        const collisionMask = !collisionGroup ? (_b = options === null || options === void 0 ? void 0 : options.collisionMask) !== null && _b !== void 0 ? _b : CollisionGroup.All.category : collisionGroup.category;\n        const searchAllColliders = (_c = options === null || options === void 0 ? void 0 : options.searchAllColliders) !== null && _c !== void 0 ? _c : false;\n        this._dynamicCollisionTree.rayCastQuery(ray, maxDistance, (collider) => {\n            const owner = collider.owner;\n            const maybeBody = owner.get(BodyComponent);\n            if ((options === null || options === void 0 ? void 0 : options.ignoreCollisionGroupAll) && maybeBody.group === CollisionGroup.All) {\n                return false;\n            }\n            const canCollide = (collisionMask & maybeBody.group.category) !== 0;\n            // Early exit if not the right group\n            if ((maybeBody === null || maybeBody === void 0 ? void 0 : maybeBody.group) && !canCollide) {\n                return false;\n            }\n            const hit = collider.rayCast(ray, maxDistance);\n            if (hit) {\n                if (options === null || options === void 0 ? void 0 : options.filter) {\n                    if (options.filter(hit)) {\n                        results.push(hit);\n                        if (!searchAllColliders) {\n                            // returning true exits the search\n                            return true;\n                        }\n                    }\n                }\n                else {\n                    results.push(hit);\n                    if (!searchAllColliders) {\n                        // returning true exits the search\n                        return true;\n                    }\n                }\n            }\n            return false;\n        });\n        return results;\n    }\n    /**\n     * Tracks a physics body for collisions\n     */\n    track(target) {\n        if (!target) {\n            Logger.getInstance().warn('Cannot track null collider');\n            return;\n        }\n        if (target instanceof CompositeCollider) {\n            const colliders = target.getColliders();\n            for (const c of colliders) {\n                c.owner = target.owner;\n                this._colliders.push(c);\n                this._dynamicCollisionTree.trackCollider(c);\n            }\n        }\n        else {\n            this._colliders.push(target);\n            this._dynamicCollisionTree.trackCollider(target);\n        }\n    }\n    /**\n     * Untracks a physics body\n     */\n    untrack(target) {\n        if (!target) {\n            Logger.getInstance().warn('Cannot untrack a null collider');\n            return;\n        }\n        if (target instanceof CompositeCollider) {\n            const colliders = target.getColliders();\n            for (const c of colliders) {\n                const index = this._colliders.indexOf(c);\n                if (index !== -1) {\n                    this._colliders.splice(index, 1);\n                }\n                this._dynamicCollisionTree.untrackCollider(c);\n            }\n        }\n        else {\n            const index = this._colliders.indexOf(target);\n            if (index !== -1) {\n                this._colliders.splice(index, 1);\n            }\n            this._dynamicCollisionTree.untrackCollider(target);\n        }\n    }\n    _pairExists(colliderA, colliderB) {\n        // if the collision pair has been calculated already short circuit\n        const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\n        return this._pairs.has(hash);\n    }\n    /**\n     * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\n     */\n    broadphase(targets, elapsedMs, stats) {\n        const seconds = elapsedMs / 1000;\n        // Retrieve the list of potential colliders, exclude killed, prevented, and self\n        const potentialColliders = targets.filter((other) => {\n            var _a, _b;\n            const body = (_a = other.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n            return ((_b = other.owner) === null || _b === void 0 ? void 0 : _b.isActive) && body.collisionType !== CollisionType.PreventCollision;\n        });\n        // clear old list of collision pairs\n        this._collisionPairCache = [];\n        this._pairs.clear();\n        // check for normal collision pairs\n        let collider;\n        for (let j = 0, l = potentialColliders.length; j < l; j++) {\n            collider = potentialColliders[j];\n            // Query the collision tree for potential colliders\n            this._dynamicCollisionTree.query(collider, (other) => {\n                if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n                    const pair = new Pair(collider, other);\n                    this._pairs.add(pair.id);\n                    this._collisionPairCache.push(pair);\n                }\n                // Always return false, to query whole tree. Returning true in the query method stops searching\n                return false;\n            });\n        }\n        if (stats) {\n            stats.physics.pairs = this._collisionPairCache.length;\n        }\n        // Check dynamic tree for fast moving objects\n        // Fast moving objects are those moving at least there smallest bound per frame\n        if (this._config.continuous.checkForFastBodies) {\n            for (const collider of potentialColliders) {\n                const body = collider.owner.get(BodyComponent);\n                // Skip non-active objects. Does not make sense on other collision types\n                if (body.collisionType !== CollisionType.Active) {\n                    continue;\n                }\n                // Maximum travel distance next frame\n                const updateDistance = body.vel.magnitude * seconds + // velocity term\n                    body.acc.magnitude * 0.5 * seconds * seconds; // acc term\n                // Find the minimum dimension\n                const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\n                if (this._config.continuous.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\n                    if (stats) {\n                        stats.physics.fastBodies++;\n                    }\n                    // start with the oldPos because the integration for actors has already happened\n                    // objects resting on a surface may be slightly penetrating in the current position\n                    const updateVec = body.globalPos.sub(body.oldPos);\n                    const centerPoint = collider.center;\n                    const furthestPoint = collider.getFurthestPoint(body.vel);\n                    const origin = furthestPoint.sub(updateVec);\n                    const ray = new Ray(origin, body.vel);\n                    // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\n                    ray.pos = ray.pos.add(ray.dir.scale(-2 * this._config.continuous.surfaceEpsilon));\n                    let minCollider;\n                    let minTranslate = new Vector(Infinity, Infinity);\n                    this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + this._config.continuous.surfaceEpsilon * 2, (other) => {\n                        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n                            const hit = other.rayCast(ray, updateDistance + this._config.continuous.surfaceEpsilon * 10);\n                            if (hit) {\n                                const translate = hit.point.sub(origin);\n                                if (translate.magnitude < minTranslate.magnitude) {\n                                    minTranslate = translate;\n                                    minCollider = other;\n                                }\n                            }\n                        }\n                        return false;\n                    });\n                    if (minCollider && Vector.isValid(minTranslate)) {\n                        const pair = new Pair(collider, minCollider);\n                        if (!this._pairs.has(pair.id)) {\n                            this._pairs.add(pair.id);\n                            this._collisionPairCache.push(pair);\n                        }\n                        // move the fast moving object to the other body\n                        // need to push into the surface by ex.Physics.surfaceEpsilon\n                        const shift = centerPoint.sub(furthestPoint);\n                        body.globalPos = origin\n                            .add(shift)\n                            .add(minTranslate)\n                            .add(ray.dir.scale(10 * this._config.continuous.surfaceEpsilon)); // needed to push the shape slightly into contact\n                        collider.update(body.transform.get());\n                        if (stats) {\n                            stats.physics.fastBodyCollisions++;\n                        }\n                    }\n                }\n            }\n        }\n        // return cache\n        return this._collisionPairCache;\n    }\n    /**\n     * Applies narrow phase on collision pairs to find actual area intersections\n     * Adds actual colliding pairs to stats' Frame data\n     */\n    narrowphase(pairs, stats) {\n        let contacts = [];\n        for (let i = 0; i < pairs.length; i++) {\n            const newContacts = pairs[i].collide();\n            contacts = contacts.concat(newContacts);\n            if (stats && newContacts.length > 0) {\n                for (const c of newContacts) {\n                    stats.physics.contacts.set(c.id, c);\n                }\n            }\n        }\n        if (stats) {\n            stats.physics.collisions += contacts.length;\n        }\n        return contacts;\n    }\n    /**\n     * Update the dynamic tree positions\n     */\n    update(targets) {\n        let updated = 0;\n        const len = targets.length;\n        for (let i = 0; i < len; i++) {\n            if (this._dynamicCollisionTree.updateCollider(targets[i])) {\n                updated++;\n            }\n        }\n        return updated;\n    }\n    debug(ex) {\n        this._dynamicCollisionTree.debug(ex);\n    }\n}\n\n;// ./Collision/Colliders/Collider.ts\n\n\n\n/**\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\n * for the purposes of colliding 2 objects in excalibur.\n */\nclass Collider {\n    constructor() {\n        this.id = createId('collider', Collider._ID++);\n        /**\n         * Composite collider if any this collider is attached to\n         *\n         * **WARNING** do not tamper with this property\n         */\n        this.composite = null;\n        this.events = new EventEmitter();\n        /**\n         * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\n         * on top of the collider.\n         */\n        this.offset = Vector.Zero;\n    }\n    /**\n     * Returns a boolean indicating whether this body collided with\n     * or was in stationary contact with\n     * the body of the other {@apilink Collider}\n     */\n    touching(other) {\n        const contact = this.collide(other);\n        if (contact) {\n            return true;\n        }\n        return false;\n    }\n}\nCollider._ID = 0;\n\n;// ./Collision/SolverStrategy.ts\n/**\n * Possible collision resolution strategies\n *\n * The default is {@apilink SolverStrategy.Arcade} which performs simple axis aligned arcade style physics. This is useful for things\n * like platformers or top down games.\n *\n * More advanced rigid body physics are enabled by setting {@apilink SolverStrategy.Realistic} which allows for complicated\n * simulated physical interactions.\n */\nvar SolverStrategy;\n(function (SolverStrategy) {\n    SolverStrategy[\"Arcade\"] = \"arcade\";\n    SolverStrategy[\"Realistic\"] = \"realistic\";\n})(SolverStrategy || (SolverStrategy = {}));\n\n;// ./Collision/Solver/ContactBias.ts\n/**\n * Tells the Arcade collision solver to prefer certain contacts over others\n */\nvar ContactSolveBias;\n(function (ContactSolveBias) {\n    ContactSolveBias[\"None\"] = \"none\";\n    ContactSolveBias[\"VerticalFirst\"] = \"vertical-first\";\n    ContactSolveBias[\"HorizontalFirst\"] = \"horizontal-first\";\n})(ContactSolveBias || (ContactSolveBias = {}));\n/**\n * Vertical First contact solve bias Used by the {@apilink ArcadeSolver} to sort contacts\n */\nconst VerticalFirst = {\n    vertical: 1,\n    horizontal: 2\n};\n/**\n * Horizontal First contact solve bias Used by the {@apilink ArcadeSolver} to sort contacts\n */\nconst HorizontalFirst = {\n    horizontal: 1,\n    vertical: 2\n};\n/**\n * None value, {@apilink ArcadeSolver} sorts contacts using distance by default\n */\nconst None = {\n    horizontal: 0,\n    vertical: 0\n};\n\n;// ./Collision/Detection/SpatialPartitionStrategy.ts\n/**\n * Possible collision resolution strategies\n *\n * The default is {@apilink SolverStrategy.Arcade} which performs simple axis aligned arcade style physics. This is useful for things\n * like platformers or top down games.\n *\n * More advanced rigid body physics are enabled by setting {@apilink SolverStrategy.Realistic} which allows for complicated\n * simulated physical interactions.\n */\nvar SpatialPartitionStrategy;\n(function (SpatialPartitionStrategy) {\n    SpatialPartitionStrategy[\"DynamicTree\"] = \"dynamic-tree\";\n    SpatialPartitionStrategy[\"SparseHashGrid\"] = \"sparse-hash-grid\";\n})(SpatialPartitionStrategy || (SpatialPartitionStrategy = {}));\n\n;// ./Collision/PhysicsConfig.ts\n\n\n\n\nconst DefaultPhysicsConfig = {\n    enabled: true,\n    gravity: vec(0, 0),\n    solver: SolverStrategy.Arcade,\n    substep: 1,\n    colliders: {\n        compositeStrategy: 'together'\n    },\n    continuous: {\n        checkForFastBodies: true,\n        disableMinimumSpeedForFastBody: false,\n        surfaceEpsilon: 0.1\n    },\n    bodies: {\n        canSleepByDefault: false,\n        sleepEpsilon: 0.07,\n        wakeThreshold: 0.07 * 3,\n        sleepBias: 0.9,\n        defaultMass: 10\n    },\n    spatialPartition: SpatialPartitionStrategy.SparseHashGrid,\n    sparseHashGrid: {\n        size: 100\n    },\n    dynamicTree: {\n        boundsPadding: 5,\n        velocityMultiplier: 2\n    },\n    arcade: {\n        contactSolveBias: ContactSolveBias.None\n    },\n    realistic: {\n        positionIterations: 3,\n        velocityIterations: 8,\n        slop: 1,\n        steeringFactor: 0.2,\n        warmStart: true\n    }\n};\n\n;// ./Collision/Colliders/CompositeCollider.ts\n\n\n\n\n\n\n\n\n\nclass CompositeCollider extends Collider {\n    /**\n     * Treat composite collider's member colliders as either separate colliders for the purposes of onCollisionStart/onCollision\n     * or as a single collider together.\n     *\n     * This property can be overridden on individual {@apilink CompositeColliders}.\n     *\n     * For composites without gaps or small groups of colliders, you probably want 'together'\n     *\n     * For composites with deliberate gaps, like a platforming level layout, you probably want 'separate'\n     *\n     * Default is 'together' if unset\n     */\n    set compositeStrategy(value) {\n        this._compositeStrategy = value;\n    }\n    get compositeStrategy() {\n        return this._compositeStrategy;\n    }\n    constructor(colliders) {\n        super();\n        this._collisionProcessor = new DynamicTreeCollisionProcessor({\n            ...DefaultPhysicsConfig\n        });\n        this._dynamicAABBTree = new DynamicTree({\n            boundsPadding: 5,\n            velocityMultiplier: 2\n        });\n        this._colliders = [];\n        for (const c of colliders) {\n            this.addCollider(c);\n        }\n    }\n    clearColliders() {\n        this._colliders = [];\n    }\n    addCollider(collider) {\n        let colliders;\n        if (collider instanceof CompositeCollider) {\n            colliders = collider.getColliders();\n            colliders.forEach((c) => c.offset.addEqual(collider.offset));\n        }\n        else {\n            colliders = [collider];\n        }\n        // Flatten composites\n        for (const c of colliders) {\n            c.events.pipe(this.events);\n            c.composite = this;\n            this._colliders.push(c);\n            this._collisionProcessor.track(c);\n            this._dynamicAABBTree.trackCollider(c);\n        }\n    }\n    removeCollider(collider) {\n        collider.events.pipe(this.events);\n        collider.composite = null;\n        removeItemFromArray(collider, this._colliders);\n        this._collisionProcessor.untrack(collider);\n        this._dynamicAABBTree.untrackCollider(collider);\n    }\n    getColliders() {\n        return this._colliders;\n    }\n    get worldPos() {\n        var _a, _b;\n        return ((_b = (_a = this._transform) === null || _a === void 0 ? void 0 : _a.pos) !== null && _b !== void 0 ? _b : Vector.Zero).add(this.offset);\n    }\n    get center() {\n        var _a, _b;\n        return ((_b = (_a = this._transform) === null || _a === void 0 ? void 0 : _a.pos) !== null && _b !== void 0 ? _b : Vector.Zero).add(this.offset);\n    }\n    get bounds() {\n        var _a, _b;\n        // TODO cache this\n        const colliders = this.getColliders();\n        const results = colliders.reduce((acc, collider) => acc.combine(collider.bounds), (_b = (_a = colliders[0]) === null || _a === void 0 ? void 0 : _a.bounds) !== null && _b !== void 0 ? _b : new BoundingBox().translate(this.worldPos));\n        return results.translate(this.offset);\n    }\n    get localBounds() {\n        var _a, _b;\n        // TODO cache this\n        const colliders = this.getColliders();\n        const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), (_b = (_a = colliders[0]) === null || _a === void 0 ? void 0 : _a.localBounds) !== null && _b !== void 0 ? _b : new BoundingBox());\n        return results;\n    }\n    get axes() {\n        // TODO cache this\n        const colliders = this.getColliders();\n        let axes = [];\n        for (const collider of colliders) {\n            axes = axes.concat(collider.axes);\n        }\n        return axes;\n    }\n    getFurthestPoint(direction) {\n        const colliders = this.getColliders();\n        const furthestPoints = [];\n        for (const collider of colliders) {\n            furthestPoints.push(collider.getFurthestPoint(direction));\n        }\n        // Pick best point from all colliders\n        let bestPoint = furthestPoints[0];\n        let maxDistance = -Number.MAX_VALUE;\n        for (const point of furthestPoints) {\n            const distance = point.dot(direction);\n            if (distance > maxDistance) {\n                bestPoint = point;\n                maxDistance = distance;\n            }\n        }\n        return bestPoint;\n    }\n    getInertia(mass) {\n        const colliders = this.getColliders();\n        let totalInertia = 0;\n        for (const collider of colliders) {\n            totalInertia += collider.getInertia(mass);\n        }\n        return totalInertia;\n    }\n    collide(other) {\n        let otherColliders = [other];\n        if (other instanceof CompositeCollider) {\n            otherColliders = other.getColliders();\n        }\n        const pairs = [];\n        for (const c of otherColliders) {\n            this._dynamicAABBTree.query(c, (potentialCollider) => {\n                pairs.push(new Pair(c, potentialCollider));\n                return false;\n            });\n        }\n        let contacts = [];\n        for (const p of pairs) {\n            contacts = contacts.concat(p.collide());\n        }\n        return contacts;\n    }\n    getClosestLineBetween(other) {\n        const colliders = this.getColliders();\n        const lines = [];\n        if (other instanceof CompositeCollider) {\n            const otherColliders = other.getColliders();\n            for (const colliderA of colliders) {\n                for (const colliderB of otherColliders) {\n                    const maybeLine = colliderA.getClosestLineBetween(colliderB);\n                    if (maybeLine) {\n                        lines.push(maybeLine);\n                    }\n                }\n            }\n        }\n        else {\n            for (const collider of colliders) {\n                const maybeLine = other.getClosestLineBetween(collider);\n                if (maybeLine) {\n                    lines.push(maybeLine);\n                }\n            }\n        }\n        if (lines.length) {\n            let minLength = lines[0].getLength();\n            let minLine = lines[0];\n            for (const line of lines) {\n                const length = line.getLength();\n                if (length < minLength) {\n                    minLength = length;\n                    minLine = line;\n                }\n            }\n            return minLine;\n        }\n        return null;\n    }\n    contains(point) {\n        const colliders = this.getColliders();\n        for (const collider of colliders) {\n            if (collider.contains(point)) {\n                return true;\n            }\n        }\n        return false;\n    }\n    rayCast(ray, max) {\n        const colliders = this.getColliders();\n        const hits = [];\n        for (const collider of colliders) {\n            const hit = collider.rayCast(ray, max);\n            if (hit) {\n                hits.push(hit);\n            }\n        }\n        if (hits.length) {\n            let minHit = hits[0];\n            let minDistance = minHit.point.dot(ray.dir);\n            for (const hit of hits) {\n                const distance = ray.dir.dot(hit.point);\n                if (distance < minDistance) {\n                    minHit = hit;\n                    minDistance = distance;\n                }\n            }\n            return minHit;\n        }\n        return null;\n    }\n    project(axis) {\n        const colliders = this.getColliders();\n        const projections = [];\n        for (const collider of colliders) {\n            const proj = collider.project(axis);\n            if (proj) {\n                projections.push(proj);\n            }\n        }\n        // Merge all proj's on the same axis\n        if (projections.length) {\n            const newProjection = new Projection(projections[0].min, projections[0].max);\n            for (const proj of projections) {\n                newProjection.min = Math.min(proj.min, newProjection.min);\n                newProjection.max = Math.max(proj.max, newProjection.max);\n            }\n            return newProjection;\n        }\n        return null;\n    }\n    update(transform) {\n        if (transform) {\n            const colliders = this.getColliders();\n            for (const collider of colliders) {\n                collider.owner = this.owner;\n                collider.update(transform);\n            }\n        }\n    }\n    debug(ex, color, options) {\n        const colliders = this.getColliders();\n        ex.save();\n        ex.translate(this.offset.x, this.offset.y);\n        for (const collider of colliders) {\n            collider.debug(ex, color, options);\n        }\n        ex.restore();\n    }\n    clone() {\n        const result = new CompositeCollider(this._colliders.map((c) => c.clone()));\n        result.offset = this.offset.clone();\n        return result;\n    }\n}\n\n;// ./Math/line-segment.ts\n\n/**\n * A 2D line segment\n */\nclass LineSegment {\n    /**\n     * @param begin  The starting point of the line segment\n     * @param end  The ending point of the line segment\n     */\n    constructor(begin, end) {\n        this.begin = begin;\n        this.end = end;\n    }\n    clone(dest) {\n        const result = dest || new LineSegment(this.begin.clone(), this.end.clone());\n        result.begin = this.begin.clone(result.begin);\n        result.end = this.end.clone(result.end);\n        return result;\n    }\n    transform(matrix, dest) {\n        const result = dest || new LineSegment(Vector.Zero, Vector.Zero);\n        result.begin = matrix.multiply(this.begin, result.begin);\n        result.end = matrix.multiply(this.end, result.end);\n        return result;\n    }\n    /**\n     * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n     */\n    get slope() {\n        return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n    }\n    /**\n     * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n     */\n    get intercept() {\n        return this.begin.y - this.slope * this.begin.x;\n    }\n    /**\n     * Gets the normal of the line\n     */\n    normal() {\n        if (this._normal) {\n            return this._normal;\n        }\n        return (this._normal = this.end.sub(this.begin).normal());\n    }\n    dir() {\n        if (this._dir) {\n            return this._dir;\n        }\n        return (this._dir = this.end.sub(this.begin));\n    }\n    getPoints() {\n        return [this.begin, this.end];\n    }\n    /**\n     * Returns the slope of the line in the form of a vector of length 1\n     */\n    getSlope() {\n        if (this._slope) {\n            return this._slope;\n        }\n        const begin = this.begin;\n        const end = this.end;\n        const distance = begin.distance(end);\n        return (this._slope = end.sub(begin).scale(1 / distance));\n    }\n    /**\n     * Returns the edge of the line as vector, the length of the vector is the length of the edge\n     */\n    getEdge() {\n        const begin = this.begin;\n        const end = this.end;\n        return end.sub(begin);\n    }\n    /**\n     * Returns the length of the line segment in pixels\n     */\n    getLength() {\n        const begin = this.begin;\n        const end = this.end;\n        const distance = begin.distance(end);\n        return distance;\n    }\n    /**\n     * Returns the midpoint of the edge\n     */\n    get midpoint() {\n        return this.begin.add(this.end).scale(0.5);\n    }\n    /**\n     * Flips the direction of the line segment\n     */\n    flip() {\n        return new LineSegment(this.end, this.begin);\n    }\n    /**\n     * Tests if a given point is below the line, points in the normal direction above the line are considered above.\n     * @param point\n     */\n    below(point) {\n        const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\n        return above2 >= 0;\n    }\n    /**\n     * Returns the clip point\n     * @param sideVector Vector that traces the line\n     * @param length Length to clip along side\n     */\n    clip(sideVector, length, normalize = true) {\n        let dir = sideVector;\n        if (normalize) {\n            dir = dir.normalize();\n        }\n        const near = dir.dot(this.begin) - length;\n        const far = dir.dot(this.end) - length;\n        const results = [];\n        if (near <= 0) {\n            results.push(this.begin);\n        }\n        if (far <= 0) {\n            results.push(this.end);\n        }\n        if (near * far < 0) {\n            const clipTime = near / (near - far);\n            results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\n        }\n        if (results.length !== 2) {\n            return null;\n        }\n        return new LineSegment(results[0], results[1]);\n    }\n    /**\n     * Find the perpendicular distance from the line to a point\n     * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n     * @param point\n     */\n    distanceToPoint(point, signed = false) {\n        const x0 = point.x;\n        const y0 = point.y;\n        const l = this.getLength();\n        const dy = this.end.y - this.begin.y;\n        const dx = this.end.x - this.begin.x;\n        const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n        return signed ? distance : Math.abs(distance);\n    }\n    /**\n     * Find the perpendicular line from the line to a point\n     * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n     * (a - p) - ((a - p) * n)n\n     * a is a point on the line\n     * p is the arbitrary point above the line\n     * n is a unit vector in direction of the line\n     * @param point\n     */\n    findVectorToPoint(point) {\n        const aMinusP = this.begin.sub(point);\n        const n = this.getSlope();\n        return aMinusP.sub(n.scale(aMinusP.dot(n)));\n    }\n    /**\n     * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n     * a new point with the calculated Y value and vice-versa.\n     * @param x The known X value of the target point\n     * @param y The known Y value of the target point\n     * @returns A new point with the other calculated axis value\n     */\n    findPoint(x = null, y = null) {\n        const m = this.slope;\n        const b = this.intercept;\n        if (x !== null) {\n            return new Vector(x, m * x + b);\n        }\n        else if (y !== null) {\n            return new Vector((y - b) / m, y);\n        }\n        else {\n            throw new Error('You must provide an X or a Y value');\n        }\n    }\n    /**\n     * @see http://stackoverflow.com/a/11908158/109458\n     */\n    hasPoint() {\n        let currPoint;\n        let threshold = 0;\n        if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n            currPoint = new Vector(arguments[0], arguments[1]);\n            threshold = arguments[2] || 0;\n        }\n        else if (arguments[0] instanceof Vector) {\n            currPoint = arguments[0];\n            threshold = arguments[1] || 0;\n        }\n        else {\n            throw 'Could not determine the arguments for Vector.hasPoint';\n        }\n        const dxc = currPoint.x - this.begin.x;\n        const dyc = currPoint.y - this.begin.y;\n        const dx1 = this.end.x - this.begin.x;\n        const dy1 = this.end.y - this.begin.y;\n        const cross = dxc * dy1 - dyc * dx1;\n        // check whether point lines on the line\n        if (Math.abs(cross) > threshold) {\n            return false;\n        }\n        // check whether point lies in-between start and end\n        if (Math.abs(dx1) >= Math.abs(dy1)) {\n            return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n        }\n        else {\n            return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n        }\n    }\n}\n\n;// ./Collision/Colliders/ClosestLineJumpTable.ts\n\n\n\n\n/**\n * Finds the closest line segment between two given line segments.\n */\nfunction ClosestLine(line1, line2) {\n    // https://math.stackexchange.com/questions/1993953/closest-points-between-2-lines-in-2d\n    const EPSILON = 1e-9;\n    const line1Dir = line1.dir();\n    const line2Dir = line2.dir();\n    const d1Squared = line1Dir.dot(line1Dir);\n    const d2Squared = line2Dir.dot(line2Dir);\n    if (d1Squared < EPSILON && d2Squared < EPSILON) {\n        return new LineSegment(line1.begin, line2.begin);\n    }\n    if (d1Squared < EPSILON) {\n        const t = clamp(line2Dir.dot(line1.begin.sub(line2.begin)) / d2Squared, 0, 1);\n        const closestPoint = line2.begin.add(line2Dir.scale(t));\n        return new LineSegment(line1.begin, closestPoint);\n    }\n    if (d2Squared < EPSILON) {\n        const t = clamp(line1Dir.dot(line2.begin.sub(line1.begin)) / d1Squared, 0, 1);\n        const closestPoint = line1.begin.add(line1Dir.scale(t));\n        return new LineSegment(closestPoint, line2.begin);\n    }\n    const r = line1.begin.sub(line2.begin);\n    const a = d1Squared;\n    const e = d2Squared;\n    const f = line2Dir.dot(r);\n    const denom = a * e - Math.pow(line1Dir.dot(line2Dir), 2);\n    let s = 0;\n    let t = 0;\n    if (Math.abs(denom) > EPSILON) {\n        s = clamp((line1Dir.dot(line2Dir) * f - e * line1Dir.dot(r)) / denom, 0, 1);\n    }\n    else {\n        // lines are parallel\n        s = clamp(line1Dir.dot(r) / a, 0, 1);\n    }\n    if (Math.abs(e) > EPSILON) {\n        t = clamp((line1Dir.dot(line2Dir) * s + f) / e, 0, 1);\n    }\n    else {\n        // line2 is a degenerate point\n        t = 0;\n    }\n    const closestPointOnLine1 = line1.begin.add(line1Dir.scale(s));\n    const closestPointOnLine2 = line2.begin.add(line2Dir.scale(t));\n    return new LineSegment(closestPointOnLine1, closestPointOnLine2);\n}\nconst ClosestLineJumpTable = {\n    PolygonPolygonClosestLine(polygonA, polygonB) {\n        const aSides = polygonA.getSides();\n        const bSides = polygonB.getSides();\n        let minDistance = Number.MAX_VALUE;\n        let closestLine = null;\n        for (let i = 0; i < aSides.length; i++) {\n            for (let j = 0; j < bSides.length; j++) {\n                const line = ClosestLine(aSides[i], bSides[j]);\n                const distance = line.getLength();\n                if (distance < minDistance) {\n                    minDistance = distance;\n                    closestLine = line;\n                }\n            }\n        }\n        return closestLine;\n    },\n    PolygonEdgeClosestLine(polygon, edge) {\n        // Find the 2 closest faces on each polygon\n        const otherWorldPos = edge.worldPos;\n        const otherDirection = otherWorldPos.sub(polygon.worldPos);\n        const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n        const thisPoint = polygon.rayCast(rayTowardsOther).point.add(rayTowardsOther.dir.scale(0.1));\n        const thisFace = polygon.getClosestFace(thisPoint);\n        // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n        // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n        const edgeLine = edge.asLine();\n        return ClosestLine(thisFace.face, edgeLine);\n    },\n    PolygonCircleClosestLine(polygon, circle) {\n        // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n        // Find the 2 closest faces on each polygon\n        const otherWorldPos = circle.worldPos;\n        const otherDirection = otherWorldPos.sub(polygon.worldPos);\n        const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n        const thisPoint = polygon.rayCast(rayTowardsOther).point.add(rayTowardsOther.dir.scale(0.1));\n        const thisFace = polygon.getClosestFace(thisPoint);\n        // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n        const p0 = thisFace.face.begin;\n        const u = thisFace.face.getEdge();\n        // Time of minimum distance\n        let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n        // If time of minimum is past the edge clamp\n        if (t > 1) {\n            t = 1;\n        }\n        else if (t < 0) {\n            t = 0;\n        }\n        // Minimum distance\n        const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n        const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n        const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n        return new LineSegment(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n    },\n    CircleCircleClosestLine(circleA, circleB) {\n        // Find the 2 closest faces on each polygon\n        const otherWorldPos = circleB.worldPos;\n        const otherDirection = otherWorldPos.sub(circleA.worldPos);\n        const thisWorldPos = circleA.worldPos;\n        const thisDirection = thisWorldPos.sub(circleB.worldPos);\n        const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n        const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n        const thisPoint = circleA.rayCast(rayTowardsOther);\n        const otherPoint = circleB.rayCast(rayTowardsThis);\n        return new LineSegment(thisPoint.point, otherPoint.point);\n    },\n    CircleEdgeClosestLine(circle, edge) {\n        // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n        const circleWorldPos = circle.worldPos;\n        // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n        const edgeLine = edge.asLine();\n        const edgeStart = edgeLine.begin;\n        const edgeVector = edgeLine.getEdge();\n        const p0 = edgeStart;\n        const u = edgeVector;\n        // Time of minimum distance\n        let t = (u.x * (circleWorldPos.x - p0.x) + u.y * (circleWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n        // If time of minimum is past the edge clamp to edge\n        if (t > 1) {\n            t = 1;\n        }\n        else if (t < 0) {\n            t = 0;\n        }\n        // Minimum distance\n        const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorldPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorldPos.y, 2)) - circle.radius;\n        const circlex = ((p0.x + u.x * t - circleWorldPos.x) * circle.radius) / (circle.radius + d);\n        const circley = ((p0.y + u.y * t - circleWorldPos.y) * circle.radius) / (circle.radius + d);\n        return new LineSegment(u.scale(t).add(p0), new Vector(circleWorldPos.x + circlex, circleWorldPos.y + circley));\n    },\n    EdgeEdgeClosestLine(edgeA, edgeB) {\n        // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n        const edgeLineA = edgeA.asLine();\n        // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n        const edgeLineB = edgeB.asLine();\n        return ClosestLine(edgeLineA, edgeLineB);\n    }\n};\n\n;// ./Collision/Colliders/CircleCollider.ts\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * This is a circle collider for the excalibur rigid body physics simulation\n */\nclass CircleCollider extends Collider {\n    get worldPos() {\n        return this._globalMatrix.getPosition();\n    }\n    /**\n     * Get the radius of the circle\n     */\n    get radius() {\n        var _a;\n        if (this._radius) {\n            return this._radius;\n        }\n        const tx = this._transform;\n        const scale = (_a = tx === null || tx === void 0 ? void 0 : tx.globalScale) !== null && _a !== void 0 ? _a : Vector.One;\n        // This is a trade off, the alternative is retooling circles to support ellipse collisions\n        return (this._radius = this._naturalRadius * Math.min(scale.x, scale.y));\n    }\n    /**\n     * Set the radius of the circle\n     */\n    set radius(val) {\n        var _a;\n        const tx = this._transform;\n        const scale = (_a = tx === null || tx === void 0 ? void 0 : tx.globalScale) !== null && _a !== void 0 ? _a : Vector.One;\n        // This is a trade off, the alternative is retooling circles to support ellipse collisions\n        this._naturalRadius = val / Math.min(scale.x, scale.y);\n        this._localBoundsDirty = true;\n        this._radius = val;\n    }\n    constructor(options) {\n        super();\n        /**\n         * Position of the circle relative to the collider, by default (0, 0).\n         */\n        this.offset = Vector.Zero;\n        this._globalMatrix = AffineMatrix.identity();\n        this._localBoundsDirty = true;\n        this.offset = options.offset || Vector.Zero;\n        this.radius = options.radius || 0;\n        this._globalMatrix.translate(this.offset.x, this.offset.y);\n    }\n    /**\n     * Returns a clone of this shape, not associated with any collider\n     */\n    clone() {\n        return new CircleCollider({\n            offset: this.offset.clone(),\n            radius: this.radius\n        });\n    }\n    /**\n     * Get the center of the collider in world coordinates\n     */\n    get center() {\n        return this._globalMatrix.getPosition();\n    }\n    /**\n     * Tests if a point is contained in this collider\n     */\n    contains(point) {\n        var _a, _b;\n        const pos = (_b = (_a = this._transform) === null || _a === void 0 ? void 0 : _a.pos) !== null && _b !== void 0 ? _b : this.offset;\n        const distance = pos.distance(point);\n        if (distance <= this.radius) {\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Casts a ray at the Circle collider and returns the nearest point of collision\n     * @param ray\n     */\n    rayCast(ray, max = Infinity) {\n        var _a, _b;\n        // https://en.wikipedia.org/wiki/Intersection_(geometry)#A_line_and_a_circle\n        const c = this.center;\n        const dir = ray.dir;\n        const orig = ray.pos;\n        const u = c.sub(orig);\n        const u1 = dir.scale(u.dot(dir));\n        const u2 = u.sub(u1);\n        const d = u2.magnitude;\n        if (d > this.radius) {\n            return null;\n        }\n        else {\n            // tangent case\n            let toi = 0;\n            if (approximatelyEqual(d, this.radius, 0.0001)) {\n                toi = -dir.dot(orig.sub(c));\n                if (toi > 0 && toi < max) {\n                    const point = ray.getPoint(toi);\n                    return {\n                        point,\n                        normal: point.sub(c).normalize(),\n                        collider: this,\n                        body: (_a = this.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent),\n                        distance: toi\n                    };\n                }\n                return null;\n            }\n            else {\n                // two point\n                const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\n                const toi1 = -dir.dot(orig.sub(c)) + discriminant;\n                const toi2 = -dir.dot(orig.sub(c)) - discriminant;\n                const positiveToi = [];\n                if (toi1 >= 0) {\n                    positiveToi.push(toi1);\n                }\n                if (toi2 >= 0) {\n                    positiveToi.push(toi2);\n                }\n                const minToi = Math.min(...positiveToi);\n                if (minToi <= max) {\n                    const point = ray.getPoint(minToi);\n                    return {\n                        point,\n                        normal: point.sub(c).normalize(),\n                        collider: this,\n                        body: (_b = this.owner) === null || _b === void 0 ? void 0 : _b.get(BodyComponent),\n                        distance: minToi\n                    };\n                }\n                return null;\n            }\n        }\n    }\n    getClosestLineBetween(shape) {\n        if (shape instanceof CircleCollider) {\n            return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\n        }\n        else if (shape instanceof PolygonCollider) {\n            return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\n        }\n        else if (shape instanceof EdgeCollider) {\n            return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\n        }\n        else {\n            throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n        }\n    }\n    /**\n     * @inheritdoc\n     */\n    collide(collider) {\n        if (collider instanceof CircleCollider) {\n            return CollisionJumpTable.CollideCircleCircle(this, collider);\n        }\n        else if (collider instanceof PolygonCollider) {\n            return CollisionJumpTable.CollideCirclePolygon(this, collider);\n        }\n        else if (collider instanceof EdgeCollider) {\n            return CollisionJumpTable.CollideCircleEdge(this, collider);\n        }\n        else {\n            throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\n        }\n    }\n    /**\n     * Find the point on the collider furthest in the direction specified\n     */\n    getFurthestPoint(direction) {\n        return this.center.add(direction.normalize().scale(this.radius));\n    }\n    /**\n     * Find the local point on the shape in the direction specified\n     * @param direction\n     */\n    getFurthestLocalPoint(direction) {\n        const dir = direction.normalize();\n        return dir.scale(this.radius);\n    }\n    /**\n     * Get the axis aligned bounding box for the circle collider in world coordinates\n     */\n    get bounds() {\n        return this.localBounds.transform(this._globalMatrix);\n    }\n    /**\n     * Get the axis aligned bounding box for the circle collider in local coordinates\n     */\n    get localBounds() {\n        if (this._localBoundsDirty) {\n            this._localBounds = new BoundingBox(-this._naturalRadius, -this._naturalRadius, +this._naturalRadius, +this._naturalRadius);\n            this._localBoundsDirty = false;\n        }\n        return this._localBounds;\n    }\n    /**\n     * Get axis not implemented on circles, since there are infinite axis in a circle\n     */\n    get axes() {\n        return [];\n    }\n    /**\n     * Returns the moment of inertia of a circle given it's mass\n     * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n     */\n    getInertia(mass) {\n        return (mass * this.radius * this.radius) / 2;\n    }\n    /* istanbul ignore next */\n    update(transform) {\n        var _a;\n        this._transform = transform;\n        const globalMat = (_a = transform.matrix) !== null && _a !== void 0 ? _a : this._globalMatrix;\n        globalMat.clone(this._globalMatrix);\n        this._globalMatrix.translate(this.offset.x, this.offset.y);\n        this._radius = undefined;\n    }\n    /**\n     * Project the circle along a specified axis\n     */\n    project(axis) {\n        const scalars = [];\n        const point = this.center;\n        const dotProduct = point.dot(axis);\n        scalars.push(dotProduct);\n        scalars.push(dotProduct + this.radius);\n        scalars.push(dotProduct - this.radius);\n        return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n    }\n    debug(ex, color, options) {\n        var _a, _b, _c, _d;\n        const { lineWidth } = { ...{ lineWidth: 1 }, ...options };\n        const tx = this._transform;\n        const scale = (_a = tx === null || tx === void 0 ? void 0 : tx.globalScale) !== null && _a !== void 0 ? _a : Vector.One;\n        const rotation = (_b = tx === null || tx === void 0 ? void 0 : tx.globalRotation) !== null && _b !== void 0 ? _b : 0;\n        const pos = (_c = tx === null || tx === void 0 ? void 0 : tx.globalPos) !== null && _c !== void 0 ? _c : Vector.Zero;\n        ex.save();\n        ex.translate(pos.x, pos.y);\n        ex.rotate(rotation);\n        ex.scale(scale.x, scale.y);\n        ex.drawCircle((_d = this.offset) !== null && _d !== void 0 ? _d : Vector.Zero, this._naturalRadius, Color.Transparent, color, lineWidth);\n        ex.restore();\n    }\n}\n\n;// ./Collision/Detection/CollisionContact.ts\n\n\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nclass CollisionContact {\n    constructor(colliderA, colliderB, mtv, normal, tangent, points, localPoints, info) {\n        var _a, _b, _c, _d, _e, _f;\n        this._canceled = false;\n        this.bodyA = null;\n        this.bodyB = null;\n        this.colliderA = colliderA;\n        this.colliderB = colliderB;\n        this.mtv = mtv;\n        this.normal = normal;\n        this.tangent = tangent;\n        this.points = points;\n        this.localPoints = localPoints;\n        this.info = info;\n        this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n        if (colliderA.composite || colliderB.composite) {\n            // Add on the parent composite pair for start/end contact if 'together\n            const colliderAId = ((_a = colliderA.composite) === null || _a === void 0 ? void 0 : _a.compositeStrategy) === 'separate' ? colliderA.id : (_c = (_b = colliderA.composite) === null || _b === void 0 ? void 0 : _b.id) !== null && _c !== void 0 ? _c : colliderA.id;\n            const colliderBId = ((_d = colliderB.composite) === null || _d === void 0 ? void 0 : _d.compositeStrategy) === 'separate' ? colliderB.id : (_f = (_e = colliderB.composite) === null || _e === void 0 ? void 0 : _e.id) !== null && _f !== void 0 ? _f : colliderB.id;\n            this.id += '|' + Pair.calculatePairHash(colliderAId, colliderBId);\n        }\n        if (this.colliderA.owner) {\n            this.bodyA = this.colliderA.owner.get(BodyComponent);\n        }\n        if (this.colliderB.owner) {\n            this.bodyB = this.colliderB.owner.get(BodyComponent);\n        }\n    }\n    /**\n     * Match contact awake state, except if body's are Fixed\n     */\n    matchAwake() {\n        const bodyA = this.bodyA;\n        const bodyB = this.bodyB;\n        if (bodyA && bodyB) {\n            if (bodyA.isSleeping !== bodyB.isSleeping) {\n                if (bodyA.isSleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= bodyA.wakeThreshold) {\n                    bodyA.isSleeping = false;\n                }\n                if (bodyB.isSleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= bodyB.wakeThreshold) {\n                    bodyB.isSleeping = false;\n                }\n            }\n        }\n    }\n    isCanceled() {\n        return this._canceled;\n    }\n    cancel() {\n        this._canceled = true;\n    }\n    /**\n     * Biases the contact so that the given collider is colliderA\n     */\n    bias(collider) {\n        if (collider !== this.colliderA && collider !== this.colliderB) {\n            throw new Error('Collider must be either colliderA or colliderB from this contact');\n        }\n        if (collider === this.colliderA) {\n            return this;\n        }\n        const colliderA = this.colliderA;\n        const colliderB = this.colliderB;\n        this.colliderB = colliderA;\n        this.colliderA = colliderB;\n        this.mtv = this.mtv.negate();\n        this.normal = this.normal.negate();\n        this.tangent = this.tangent.negate();\n        return this;\n    }\n}\n\n;// ./Collision/Colliders/SeparatingAxis.ts\n\n\n\n\n/**\n * Specific information about a contact and it's separation\n */\nclass SeparationInfo {\n    constructor() {\n        /**\n         * Axis of separation from the collider's perspective\n         */\n        this.axis = vec(0, 0);\n        /**\n         * Local axis of separation from the collider's perspective\n         */\n        this.localAxis = vec(0, 0);\n        /**\n         * Side of separation (reference) from the collider's perspective\n         */\n        this.side = new LineSegment(vec(0, 0), vec(0, 0));\n        /**\n         * Local side of separation (reference) from the collider's perspective\n         */\n        this.localSide = new LineSegment(vec(0, 0), vec(0, 0));\n        /**\n         * Point on collider B (incident point)\n         */\n        this.point = vec(0, 0);\n        /**\n         * Local point on collider B (incident point)\n         */\n        this.localPoint = vec(0, 0);\n    }\n}\nclass SeparatingAxis {\n    static findPolygonPolygonSeparation(polyA, polyB) {\n        // if polyB has 0 scale we need to hop back to degenerate separation\n        if (polyB.transform.matrix.determinant() === 0) {\n            return SeparatingAxis.findPolygonPolygonSeparationDegenerate(polyA, polyB);\n        }\n        // Multi contact from SAT\n        // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\n        // do a SAT test to find a min axis if it exists\n        let bestSeparation = -Number.MAX_VALUE;\n        let bestSideIndex = -1;\n        let localPoint;\n        // Work inside polyB reference frame\n        // inv polyB converts to local space from polyA world space\n        const toPolyBSpace = polyB.transform.inverse.multiply(polyA.transform.matrix, SeparatingAxis._SCRATCH_MATRIX);\n        const toPolyBSpaceRotation = toPolyBSpace.getRotation();\n        const normalsA = polyA.normals;\n        const pointsA = polyA.points;\n        const pointsB = polyB.points;\n        for (let pointsAIndex = 0; pointsAIndex < pointsA.length; pointsAIndex++) {\n            const normal = normalsA[pointsAIndex].rotate(toPolyBSpaceRotation, SeparatingAxis._ZERO, SeparatingAxis._SCRATCH_NORMAL);\n            const point = toPolyBSpace.multiply(pointsA[pointsAIndex], SeparatingAxis._SCRATCH_POINT);\n            // For every point in polyB\n            // We want to see how much overlap there is on the axis provided by the normal\n            // We want to find the minimum overlap among all points\n            let smallestPointDistance = Number.MAX_VALUE;\n            let smallestLocalPoint;\n            for (let pointsBIndex = 0; pointsBIndex < pointsB.length; pointsBIndex++) {\n                const distance = normal.dot(pointsB[pointsBIndex].sub(point, SeparatingAxis._SCRATCH_SUB_POINT));\n                if (distance < smallestPointDistance) {\n                    smallestPointDistance = distance;\n                    smallestLocalPoint = pointsB[pointsBIndex];\n                }\n            }\n            // We take the maximum overlap as the separation between the\n            // A negative separation means there were no gaps between the two shapes\n            if (smallestPointDistance > bestSeparation) {\n                bestSeparation = smallestPointDistance;\n                bestSideIndex = pointsAIndex;\n                localPoint = smallestLocalPoint;\n            }\n        }\n        // TODO can we avoid applying world space transforms?\n        const bestSide2 = (bestSideIndex + 1) % pointsA.length;\n        const separationInfo = SeparatingAxis.SeparationPool.get();\n        separationInfo.collider = polyA;\n        separationInfo.separation = bestSeparation;\n        if (bestSeparation > 0) {\n            // early out because if separation is > 0 then no local point\n            return separationInfo;\n        }\n        normalsA[bestSideIndex].clone(separationInfo.localAxis);\n        normalsA[bestSideIndex].rotate(polyA.transform.rotation, SeparatingAxis._ZERO, separationInfo.axis);\n        polyA.transform.matrix.multiply(pointsA[bestSideIndex], separationInfo.side.begin);\n        polyA.transform.matrix.multiply(pointsA[bestSide2], separationInfo.side.end);\n        polyB.transform.matrix.multiply(localPoint, separationInfo.point);\n        separationInfo.sideId = bestSideIndex;\n        localPoint.clone(separationInfo.localPoint);\n        pointsA[bestSideIndex].clone(separationInfo.localSide.begin);\n        pointsA[bestSide2].clone(separationInfo.localSide.end);\n        return separationInfo;\n    }\n    static findCirclePolygonSeparation(circle, polygon) {\n        const axes = polygon.axes;\n        const pc = polygon.center;\n        // Special SAT with circles\n        const polyDir = pc.sub(circle.worldPos);\n        const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\n        axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\n        let minOverlap = Number.MAX_VALUE;\n        let minAxis = null;\n        let minIndex = -1;\n        for (let i = 0; i < axes.length; i++) {\n            const proj1 = polygon.project(axes[i]);\n            const proj2 = circle.project(axes[i]);\n            const overlap = proj1.getOverlap(proj2);\n            if (overlap <= 0) {\n                return null;\n            }\n            else {\n                if (overlap < minOverlap) {\n                    minOverlap = overlap;\n                    minAxis = axes[i];\n                    minIndex = i;\n                }\n            }\n        }\n        if (minIndex < 0) {\n            return null;\n        }\n        return minAxis.normalize().scale(minOverlap);\n    }\n    static findPolygonPolygonSeparationDegenerate(polyA, polyB) {\n        let bestSeparation = -Number.MAX_VALUE;\n        let bestSide = null;\n        let bestAxis = null;\n        let bestSideIndex = -1;\n        let bestOtherPoint = null;\n        const sides = polyA.getSides();\n        const localSides = polyA.getLocalSides();\n        for (let i = 0; i < sides.length; i++) {\n            const side = sides[i];\n            const axis = side.normal();\n            const vertB = polyB.getFurthestPoint(axis.negate());\n            // Separation on side i's axis\n            // We are looking for the largest separation between poly A's sides\n            const vertSeparation = side.distanceToPoint(vertB, true);\n            if (vertSeparation > bestSeparation) {\n                bestSeparation = vertSeparation;\n                bestSide = side;\n                bestAxis = axis;\n                bestSideIndex = i;\n                bestOtherPoint = vertB;\n            }\n        }\n        return {\n            collider: polyA,\n            separation: bestAxis ? bestSeparation : 99,\n            axis: bestAxis,\n            side: bestSide,\n            localSide: localSides[bestSideIndex],\n            sideId: bestSideIndex,\n            point: bestOtherPoint,\n            localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis.negate()) : null\n        };\n    }\n}\nSeparatingAxis.SeparationPool = new Pool(() => new SeparationInfo(), (i) => i, // no recycle\n500);\nSeparatingAxis._ZERO = vec(0, 0);\nSeparatingAxis._SCRATCH_POINT = vec(0, 0);\nSeparatingAxis._SCRATCH_SUB_POINT = vec(0, 0);\nSeparatingAxis._SCRATCH_NORMAL = vec(0, 0);\nSeparatingAxis._SCRATCH_MATRIX = AffineMatrix.identity();\nSeparatingAxis.SeparationPool.disableWarnings = true;\n\n;// ./Collision/Colliders/CollisionJumpTable.ts\n\n\n\n\n\n\n\n\n\n\nconst ScratchZero = Vector.Zero; // TODO constant vector\nconst ScratchNormal = Vector.Zero; // TODO constant vector\nconst ScratchMatrix = AffineMatrix.identity();\nconst CollisionJumpTable = {\n    CollideCircleCircle(circleA, circleB) {\n        const circleAPos = circleA.worldPos;\n        const circleBPos = circleB.worldPos;\n        const combinedRadius = circleA.radius + circleB.radius;\n        const distance = circleAPos.distance(circleBPos);\n        if (distance > combinedRadius) {\n            return [];\n        }\n        // negative means overlap\n        const separation = combinedRadius - distance;\n        // Normal points from A -> B\n        const normal = circleBPos.sub(circleAPos).normalize();\n        const tangent = normal.perpendicular();\n        const mvt = normal.scale(separation);\n        const point = circleA.getFurthestPoint(normal);\n        const local = circleA.getFurthestLocalPoint(normal);\n        const info = {\n            collider: circleA,\n            separation,\n            axis: normal,\n            point: point\n        };\n        return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\n    },\n    CollideCirclePolygon(circle, polygon) {\n        var _a, _b;\n        let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\n        if (!minAxis) {\n            return [];\n        }\n        // make sure that the minAxis is pointing away from circle\n        const sameDir = minAxis.dot(polygon.center.sub(circle.center));\n        minAxis = sameDir < 0 ? minAxis.negate() : minAxis;\n        const point = circle.getFurthestPoint(minAxis);\n        const xf = (_b = (_a = circle.owner) === null || _a === void 0 ? void 0 : _a.get(TransformComponent)) !== null && _b !== void 0 ? _b : new TransformComponent();\n        const local = xf.applyInverse(point);\n        const normal = minAxis.normalize();\n        const info = {\n            collider: circle,\n            separation: -minAxis.magnitude,\n            axis: normal,\n            point: point,\n            localPoint: local,\n            side: polygon.findSide(normal.negate()),\n            localSide: polygon.findLocalSide(normal.negate())\n        };\n        return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\n    },\n    CollideCircleEdge(circle, edge) {\n        // TODO not sure this actually abides by local/world collisions\n        // Are edge.begin and edge.end local space or world space? I think they should be local\n        // center of the circle in world pos\n        const cc = circle.center;\n        // vector in the direction of the edge\n        const edgeWorld = edge.asLine();\n        const e = edgeWorld.end.sub(edgeWorld.begin);\n        // amount of overlap with the circle's center along the edge direction\n        const u = e.dot(edgeWorld.end.sub(cc));\n        const v = e.dot(cc.sub(edgeWorld.begin));\n        const side = edge.asLine();\n        const localSide = edge.asLocalLine();\n        // Potential region A collision (circle is on the left side of the edge, before the beginning)\n        if (v <= 0) {\n            const da = edgeWorld.begin.sub(cc);\n            const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\n            // save some sqrts\n            if (dda > circle.radius * circle.radius) {\n                return []; // no collision\n            }\n            const normal = da.normalize();\n            const separation = circle.radius - Math.sqrt(dda);\n            const info = {\n                collider: circle,\n                separation: separation,\n                axis: normal,\n                point: side.begin,\n                side: side,\n                localSide: localSide\n            };\n            return [\n                new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\n            ];\n        }\n        // Potential region B collision (circle is on the right side of the edge, after the end)\n        if (u <= 0) {\n            const db = edgeWorld.end.sub(cc);\n            const ddb = db.dot(db);\n            if (ddb > circle.radius * circle.radius) {\n                return [];\n            }\n            const normal = db.normalize();\n            const separation = circle.radius - Math.sqrt(ddb);\n            const info = {\n                collider: circle,\n                separation: separation,\n                axis: normal,\n                point: side.end,\n                side: side,\n                localSide: localSide\n            };\n            return [\n                new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\n            ];\n        }\n        // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\n        const den = e.dot(e);\n        const pointOnEdge = edgeWorld.begin\n            .scale(u)\n            .add(edgeWorld.end.scale(v))\n            .scale(1 / den);\n        const d = cc.sub(pointOnEdge);\n        const dd = d.dot(d);\n        if (dd > circle.radius * circle.radius) {\n            return []; // no collision\n        }\n        let normal = e.perpendicular();\n        // flip correct direction\n        if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\n            normal.x = -normal.x;\n            normal.y = -normal.y;\n        }\n        normal = normal.normalize();\n        const separation = circle.radius - Math.sqrt(dd);\n        const mvt = normal.scale(separation);\n        const info = {\n            collider: circle,\n            separation: separation,\n            axis: normal,\n            point: pointOnEdge,\n            side: side,\n            localSide: localSide\n        };\n        return [\n            new CollisionContact(circle, edge, mvt, normal.negate(), normal.negate().perpendicular(), [pointOnEdge], [pointOnEdge.sub(edge.worldPos)], info)\n        ];\n    },\n    CollideEdgeEdge() {\n        // Edge-edge collision doesn't make sense\n        return [];\n    },\n    CollidePolygonEdge(polygon, edge) {\n        var _a;\n        const pc = polygon.center;\n        const ec = edge.center;\n        const dir = ec.sub(pc).normalize();\n        // build a temporary polygon from the edge to use SAT\n        const linePoly = new PolygonCollider({\n            points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\n            offset: edge.offset\n        });\n        linePoly.owner = edge.owner;\n        const tx = (_a = edge.owner) === null || _a === void 0 ? void 0 : _a.get(TransformComponent);\n        if (tx) {\n            linePoly.update(edge.owner.get(TransformComponent).get());\n        }\n        // Gross hack but poly-poly works well\n        const contact = this.CollidePolygonPolygon(polygon, linePoly);\n        if (contact.length) {\n            // Fudge the contact back to edge\n            contact[0].colliderB = edge;\n            contact[0].id = Pair.calculatePairHash(polygon.id, edge.id);\n        }\n        return contact;\n    },\n    CollidePolygonPolygon(polyA, polyB) {\n        // Multi contact from SAT\n        // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\n        // do a SAT test to find a min axis if it exists\n        const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\n        // If there is no overlap from boxA's perspective we can end early\n        if (separationA.separation > 0) {\n            return [];\n        }\n        const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\n        // If there is no overlap from boxB's perspective exit now\n        if (separationB.separation > 0) {\n            return [];\n        }\n        // Separations are both negative, we want to pick the least negative (minimal movement)\n        const separation = separationA.separation > separationB.separation ? separationA : separationB;\n        // The incident side is the most opposite from the axes of collision on the other collider\n        const other = separation.collider === polyA ? polyB : polyA;\n        const main = separation.collider === polyA ? polyA : polyB;\n        const toIncidentFrame = other.transform.inverse.multiply(main.transform.matrix, ScratchMatrix);\n        const toIncidentFrameRotation = toIncidentFrame.getRotation();\n        const referenceEdgeNormal = main.normals[separation.sideId].rotate(toIncidentFrameRotation, ScratchZero, ScratchNormal);\n        let minEdge = Number.MAX_VALUE;\n        let incidentEdgeIndex = 0;\n        for (let i = 0; i < other.normals.length; i++) {\n            const value = referenceEdgeNormal.dot(other.normals[i]);\n            if (value < minEdge) {\n                minEdge = value;\n                incidentEdgeIndex = i;\n            }\n        }\n        // Clip incident side by the perpendicular lines at each end of the reference side\n        // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\n        const referenceSide = separation.localSide.transform(toIncidentFrame);\n        const referenceDirection = separation.localAxis.perpendicular().negate().rotate(toIncidentFrameRotation);\n        const incidentSide = new LineSegment(other.points[incidentEdgeIndex], other.points[(incidentEdgeIndex + 1) % other.points.length]);\n        const clipRight = incidentSide.clip(referenceDirection.negate(), -referenceDirection.dot(referenceSide.begin), false);\n        let clipLeft = null;\n        if (clipRight) {\n            clipLeft = clipRight.clip(referenceDirection, referenceDirection.dot(referenceSide.end), false);\n        }\n        if (clipLeft) {\n            const localPoints = [];\n            const points = [];\n            const clipPoints = clipLeft.getPoints();\n            for (let i = 0; i < clipPoints.length; i++) {\n                const p = clipPoints[i];\n                if (referenceSide.below(p)) {\n                    localPoints.push(p);\n                    points.push(other.transform.apply(p));\n                }\n            }\n            let normal = separation.axis;\n            let tangent = normal.perpendicular();\n            // Point Contact A -> B\n            if (polyB.center.sub(polyA.center).dot(normal) < 0) {\n                normal = normal.negate();\n                tangent = normal.perpendicular();\n            }\n            return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\n        }\n        return [];\n    },\n    FindContactSeparation(contact, localPoint) {\n        var _a, _b, _c, _d;\n        const shapeA = contact.colliderA;\n        const txA = (_b = (_a = contact.bodyA) === null || _a === void 0 ? void 0 : _a.transform) !== null && _b !== void 0 ? _b : new TransformComponent();\n        const shapeB = contact.colliderB;\n        const txB = (_d = (_c = contact.bodyB) === null || _c === void 0 ? void 0 : _c.transform) !== null && _d !== void 0 ? _d : new TransformComponent();\n        // both are circles\n        if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\n            const combinedRadius = shapeA.radius + shapeB.radius;\n            const distance = txA.pos.distance(txB.pos);\n            const separation = combinedRadius - distance;\n            return -separation;\n        }\n        // both are polygons\n        if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\n            if (contact.info.localSide) {\n                let side;\n                let worldPoint;\n                if (contact.info.collider === shapeA) {\n                    side = new LineSegment(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\n                    worldPoint = txB.apply(localPoint);\n                }\n                else {\n                    side = new LineSegment(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\n                    worldPoint = txA.apply(localPoint);\n                }\n                return side.distanceToPoint(worldPoint, true);\n            }\n        }\n        // polygon v circle\n        if ((shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\n            (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)) {\n            const worldPoint = txA.apply(localPoint);\n            if (contact.info.side) {\n                return contact.info.side.distanceToPoint(worldPoint, true);\n            }\n        }\n        // polygon v edge\n        if ((shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\n            (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)) {\n            let worldPoint;\n            if (contact.info.collider === shapeA) {\n                worldPoint = txB.apply(localPoint);\n            }\n            else {\n                worldPoint = txA.apply(localPoint);\n            }\n            if (contact.info.side) {\n                return contact.info.side.distanceToPoint(worldPoint, true);\n            }\n        }\n        // circle v edge\n        if ((shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\n            (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)) {\n            // Local point is always on the edge which is always shapeB\n            const worldPoint = txB.apply(localPoint);\n            let circlePoint;\n            if (shapeA instanceof CircleCollider) {\n                circlePoint = shapeA.getFurthestPoint(contact.normal);\n            }\n            const dist = worldPoint.distance(circlePoint);\n            if (contact.info.side) {\n                return dist > 0 ? -dist : 0;\n            }\n        }\n        return 0;\n    }\n};\n\n;// ./Collision/Colliders/EdgeCollider.ts\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Edge is a single line collider to create collisions with a single line.\n */\nclass EdgeCollider extends Collider {\n    constructor(options) {\n        var _a;\n        super();\n        this._globalMatrix = AffineMatrix.identity();\n        this.begin = options.begin || Vector.Zero;\n        this.end = options.end || Vector.Zero;\n        this.offset = (_a = options.offset) !== null && _a !== void 0 ? _a : Vector.Zero;\n    }\n    /**\n     * Returns a clone of this Edge, not associated with any collider\n     */\n    clone() {\n        return new EdgeCollider({\n            begin: this.begin.clone(),\n            end: this.end.clone()\n        });\n    }\n    get worldPos() {\n        var _a;\n        const tx = this._transform;\n        return (_a = tx === null || tx === void 0 ? void 0 : tx.globalPos.add(this.offset)) !== null && _a !== void 0 ? _a : this.offset;\n    }\n    /**\n     * Get the center of the collision area in world coordinates\n     */\n    get center() {\n        const begin = this._getTransformedBegin();\n        const end = this._getTransformedEnd();\n        const pos = begin.average(end);\n        return pos;\n    }\n    _getTransformedBegin() {\n        return this._globalMatrix.multiply(this.begin);\n    }\n    _getTransformedEnd() {\n        return this._globalMatrix.multiply(this.end);\n    }\n    /**\n     * Returns the slope of the line in the form of a vector\n     */\n    getSlope() {\n        const begin = this._getTransformedBegin();\n        const end = this._getTransformedEnd();\n        const distance = begin.distance(end);\n        return end.sub(begin).scale(1 / distance);\n    }\n    /**\n     * Returns the length of the line segment in pixels\n     */\n    getLength() {\n        const begin = this._getTransformedBegin();\n        const end = this._getTransformedEnd();\n        const distance = begin.distance(end);\n        return distance;\n    }\n    /**\n     * Tests if a point is contained in this collision area\n     */\n    contains() {\n        return false;\n    }\n    /**\n     * @inheritdoc\n     */\n    rayCast(ray, max = Infinity) {\n        var _a;\n        const numerator = this._getTransformedBegin().sub(ray.pos);\n        // Test is line and ray are parallel and non intersecting\n        if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\n            return null;\n        }\n        // Lines are parallel\n        const divisor = ray.dir.cross(this.getSlope());\n        if (divisor === 0) {\n            return null;\n        }\n        const t = numerator.cross(this.getSlope()) / divisor;\n        if (t >= 0 && t <= max) {\n            const u = numerator.cross(ray.dir) / divisor / this.getLength();\n            if (u >= 0 && u <= 1) {\n                return {\n                    distance: t,\n                    normal: this.asLine().normal(),\n                    collider: this,\n                    body: (_a = this.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent),\n                    point: ray.getPoint(t)\n                };\n            }\n        }\n        return null;\n    }\n    /**\n     * Returns the closes line between this and another collider, from this -> collider\n     * @param shape\n     */\n    getClosestLineBetween(shape) {\n        if (shape instanceof CircleCollider) {\n            return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\n        }\n        else if (shape instanceof PolygonCollider) {\n            return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\n        }\n        else if (shape instanceof EdgeCollider) {\n            return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\n        }\n        else {\n            throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n        }\n    }\n    /**\n     * @inheritdoc\n     */\n    collide(shape) {\n        if (shape instanceof CircleCollider) {\n            return CollisionJumpTable.CollideCircleEdge(shape, this);\n        }\n        else if (shape instanceof PolygonCollider) {\n            return CollisionJumpTable.CollidePolygonEdge(shape, this);\n        }\n        else if (shape instanceof EdgeCollider) {\n            return CollisionJumpTable.CollideEdgeEdge();\n        }\n        else {\n            throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\n        }\n    }\n    /**\n     * Find the point on the collider furthest in the direction specified\n     */\n    getFurthestPoint(direction) {\n        const transformedBegin = this._getTransformedBegin();\n        const transformedEnd = this._getTransformedEnd();\n        if (direction.dot(transformedBegin) > 0) {\n            return transformedBegin;\n        }\n        else {\n            return transformedEnd;\n        }\n    }\n    _boundsFromBeginEnd(begin, end, padding = 10) {\n        // A perfectly vertical or horizontal edge would have a bounds 0 width or height\n        // this causes problems for the collision system so we give them some padding\n        return new BoundingBox(Math.min(begin.x, end.x) - padding, Math.min(begin.y, end.y) - padding, Math.max(begin.x, end.x) + padding, Math.max(begin.y, end.y) + padding);\n    }\n    /**\n     * Get the axis aligned bounding box for the edge collider in world space\n     */\n    get bounds() {\n        const transformedBegin = this._getTransformedBegin();\n        const transformedEnd = this._getTransformedEnd();\n        return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\n    }\n    /**\n     * Get the axis aligned bounding box for the edge collider in local space\n     */\n    get localBounds() {\n        return this._boundsFromBeginEnd(this.begin, this.end);\n    }\n    /**\n     * Returns this edge represented as a line in world coordinates\n     */\n    asLine() {\n        return new LineSegment(this._getTransformedBegin(), this._getTransformedEnd());\n    }\n    /**\n     * Return this edge as a line in local line coordinates (relative to the position)\n     */\n    asLocalLine() {\n        return new LineSegment(this.begin, this.end);\n    }\n    /**\n     * Get the axis associated with the edge\n     */\n    get axes() {\n        const e = this._getTransformedEnd().sub(this._getTransformedBegin());\n        const edgeNormal = e.normal();\n        const axes = [];\n        axes.push(edgeNormal);\n        axes.push(edgeNormal.negate());\n        axes.push(edgeNormal.normal());\n        axes.push(edgeNormal.normal().negate());\n        return axes;\n    }\n    /**\n     * Get the moment of inertia for an edge\n     * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n     */\n    getInertia(mass) {\n        const length = this.end.sub(this.begin).distance() / 2;\n        return mass * length * length;\n    }\n    /**\n     * @inheritdoc\n     */\n    update(transform) {\n        var _a;\n        this._transform = transform;\n        const globalMat = (_a = transform.matrix) !== null && _a !== void 0 ? _a : this._globalMatrix;\n        globalMat.clone(this._globalMatrix);\n        this._globalMatrix.translate(this.offset.x, this.offset.y);\n    }\n    /**\n     * Project the edge along a specified axis\n     */\n    project(axis) {\n        const scalars = [];\n        const points = [this._getTransformedBegin(), this._getTransformedEnd()];\n        const len = points.length;\n        for (let i = 0; i < len; i++) {\n            scalars.push(points[i].dot(axis));\n        }\n        return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n    }\n    debug(ex, color) {\n        const begin = this._getTransformedBegin();\n        const end = this._getTransformedEnd();\n        ex.drawLine(begin, end, color, 2);\n        ex.drawCircle(begin, 2, color);\n        ex.drawCircle(end, 2, color);\n    }\n}\n\n;// ./Graphics/Debug.ts\n\nclass Debug {\n    static registerGraphicsContext(ctx) {\n        Debug._ctx = ctx;\n    }\n    static draw(debugDrawCall) {\n        this._drawCalls.push(debugDrawCall);\n    }\n    static drawPoint(point, options) {\n        Debug.draw((ctx) => {\n            ctx.debug.drawPoint(point, options);\n        });\n    }\n    static drawLine(start, end, options) {\n        Debug.draw((ctx) => {\n            ctx.debug.drawLine(start, end, options);\n        });\n    }\n    static drawLines(points, options) {\n        if (points.length > 1) {\n            Debug.draw((ctx) => {\n                for (let i = 0; i < points.length - 1; i++) {\n                    ctx.debug.drawLine(points[i], points[i + 1], options);\n                }\n            });\n        }\n    }\n    static drawText(text, pos) {\n        Debug.draw((ctx) => {\n            ctx.debug.drawText(text, pos);\n        });\n    }\n    static drawPolygon(points, options) {\n        if (points.length > 1) {\n            Debug.draw((ctx) => {\n                const firstPoint = points[0];\n                const polygon = [...points, firstPoint];\n                for (let i = 0; i < polygon.length - 1; i++) {\n                    ctx.debug.drawLine(polygon[i], polygon[i + 1], options);\n                }\n            });\n        }\n    }\n    static drawCircle(center, radius, options) {\n        const { color, strokeColor, width } = {\n            color: Color.Black,\n            strokeColor: undefined,\n            width: undefined,\n            ...options\n        };\n        Debug.draw((ctx) => {\n            ctx.drawCircle(center, radius, color, strokeColor, width);\n        });\n    }\n    static drawBounds(boundingBox, options) {\n        Debug.draw((ctx) => {\n            ctx.debug.drawRect(boundingBox.left, boundingBox.top, boundingBox.width, boundingBox.height, options);\n        });\n    }\n    static drawRay(ray, options) {\n        const { distance, color } = {\n            color: Color.Blue,\n            distance: 10,\n            ...options\n        };\n        Debug.draw((ctx) => {\n            const start = ray.pos;\n            const end = ray.pos.add(ray.dir.scale(distance));\n            ctx.debug.drawLine(start, end, { color });\n        });\n    }\n    static flush(ctx) {\n        ctx.save();\n        ctx.z = Debug.z;\n        for (const drawCall of Debug._drawCalls) {\n            drawCall(ctx);\n        }\n        ctx.restore();\n        Debug.clear();\n    }\n    static clear() {\n        Debug._drawCalls.length = 0;\n    }\n}\nDebug._drawCalls = [];\nDebug.z = Infinity;\n\n;// ./Collision/Colliders/PolygonCollider.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Polygon collider for detecting collisions\n */\nclass PolygonCollider extends Collider {\n    flagDirty() {\n        this._localBoundsDirty = true;\n        this._localSidesDirty = true;\n        this._transformedPointsDirty = true;\n        this._sidesDirty = true;\n    }\n    get normals() {\n        return this._normals;\n    }\n    /**\n     * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n     * Excalibur stores these in counter-clockwise order\n     */\n    set points(points) {\n        if (points.length < 3) {\n            throw new Error('PolygonCollider cannot be created with less that 3 points');\n        }\n        this._points = points;\n        this._checkAndUpdateWinding(this._points);\n        this._calculateNormals();\n        this.flagDirty();\n    }\n    _calculateNormals() {\n        const normals = [];\n        for (let i = 0; i < this._points.length; i++) {\n            normals.push(this._points[(i + 1) % this._points.length].sub(this._points[i]).normal());\n        }\n        this._normals = normals;\n    }\n    /**\n     * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n     * Excalibur stores these in counter-clockwise order\n     */\n    get points() {\n        return this._points;\n    }\n    get transform() {\n        return this._transform;\n    }\n    constructor(options) {\n        var _a;\n        super();\n        this._logger = Logger.getInstance();\n        this._transform = new transform_Transform();\n        this._transformedPoints = [];\n        this._sides = [];\n        this._localSides = [];\n        this._transformedPointsDirty = true;\n        this._sidesDirty = true;\n        this._localSidesDirty = true;\n        this._localBoundsDirty = true;\n        this.offset = (_a = options.offset) !== null && _a !== void 0 ? _a : Vector.Zero;\n        this._transform.pos.x += this.offset.x;\n        this._transform.pos.y += this.offset.y;\n        this.points = options.points;\n        if (!this.isConvex()) {\n            if (!options.suppressConvexWarning) {\n                this._logger.warn('Excalibur only supports convex polygon colliders and will not behave properly.' +\n                    'Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles');\n            }\n        }\n        // calculate initial transformation\n        this._calculateTransformation();\n    }\n    _checkAndUpdateWinding(points) {\n        const counterClockwise = this._isCounterClockwiseWinding(points);\n        if (!counterClockwise) {\n            points.reverse();\n        }\n    }\n    _isCounterClockwiseWinding(points) {\n        // https://stackoverflow.com/a/1165943\n        let sum = 0;\n        for (let i = 0; i < points.length; i++) {\n            sum += (points[(i + 1) % points.length].x - points[i].x) * (points[(i + 1) % points.length].y + points[i].y);\n        }\n        return sum < 0;\n    }\n    /**\n     * Returns if the polygon collider is convex, Excalibur does not handle non-convex collision shapes.\n     * Call {@apilink Polygon.triangulate} to generate a {@apilink CompositeCollider} from this non-convex shape\n     */\n    isConvex() {\n        // From SO: https://stackoverflow.com/a/45372025\n        if (this.points.length < 3) {\n            return false;\n        }\n        let oldPoint = this.points[this.points.length - 2];\n        let newPoint = this.points[this.points.length - 1];\n        let direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n        let oldDirection = 0;\n        let orientation = 0;\n        let angleSum = 0;\n        for (const [i, point] of this.points.entries()) {\n            oldPoint = newPoint;\n            oldDirection = direction;\n            newPoint = point;\n            direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n            if (oldPoint.equals(newPoint)) {\n                return false; // repeat point\n            }\n            let angle = direction - oldDirection;\n            if (angle <= -Math.PI) {\n                angle += Math.PI * 2;\n            }\n            else if (angle > Math.PI) {\n                angle -= Math.PI * 2;\n            }\n            if (i === 0) {\n                if (angle === 0.0) {\n                    return false;\n                }\n                orientation = angle > 0 ? 1 : -1;\n            }\n            else {\n                if (orientation * angle <= 0) {\n                    return false;\n                }\n            }\n            angleSum += angle;\n        }\n        return Math.abs(Math.round(angleSum / (Math.PI * 2))) === 1;\n    }\n    /**\n     * Tessellates the polygon into a triangle fan as a {@apilink CompositeCollider} of triangle polygons\n     */\n    tessellate() {\n        const polygons = [];\n        for (let i = 1; i < this.points.length - 2; i++) {\n            polygons.push([this.points[0], this.points[i + 1], this.points[i + 2]]);\n        }\n        polygons.push([this.points[0], this.points[1], this.points[2]]);\n        return new CompositeCollider(polygons.map((points) => Shape.Polygon(points)));\n    }\n    /**\n     * Triangulate the polygon collider using the \"Ear Clipping\" algorithm.\n     * Returns a new {@apilink CompositeCollider} made up of smaller triangles.\n     */\n    triangulate() {\n        // https://www.youtube.com/watch?v=hTJFcHutls8\n        if (this.points.length < 3) {\n            throw Error('Invalid polygon');\n        }\n        const triangles = [];\n        // algorithm likes clockwise\n        const vertices = [...this.points].reverse();\n        let vertexCount = vertices.length;\n        /**\n         * Returns the previous index based on the current vertex\n         */\n        function getPrevIndex(index) {\n            return index === 0 ? vertexCount - 1 : index - 1;\n        }\n        /**\n         * Retrieves the next index based on the current vertex\n         */\n        function getNextIndex(index) {\n            return index === vertexCount - 1 ? 0 : index + 1;\n        }\n        /**\n         * Whether or not the angle at this vertex index is convex\n         */\n        function isConvex(index) {\n            const prev = getPrevIndex(index);\n            const next = getNextIndex(index);\n            const va = vertices[prev];\n            const vb = vertices[index];\n            const vc = vertices[next];\n            // Check convexity\n            const leftArm = va.sub(vb);\n            const rightArm = vc.sub(vb);\n            // Positive cross product is convex\n            if (leftArm.cross(rightArm) < 0) {\n                return false;\n            }\n            return true;\n        }\n        const convexVertices = vertices.map((_, i) => isConvex(i));\n        /**\n         * Quick test for point in triangle\n         */\n        function isPointInTriangle(point, a, b, c) {\n            const ab = b.sub(a);\n            const bc = c.sub(b);\n            const ca = a.sub(c);\n            const ap = point.sub(a);\n            const bp = point.sub(b);\n            const cp = point.sub(c);\n            const cross1 = ab.cross(ap);\n            const cross2 = bc.cross(bp);\n            const cross3 = ca.cross(cp);\n            if (cross1 > 0 || cross2 > 0 || cross3 > 0) {\n                return false;\n            }\n            return true;\n        }\n        /**\n         * Calculate the area of the triangle\n         */\n        // function triangleArea(a: Vector, b: Vector, c: Vector) {\n        //   return Math.abs(a.x * (b.y - c.y) + b.x * (c.y - a.y) + c.x * (a.y - c.y))/2;\n        // }\n        /**\n         * Find the next suitable ear tip\n         */\n        function findEarTip() {\n            for (let i = 0; i < vertexCount; i++) {\n                if (convexVertices[i]) {\n                    const prev = getPrevIndex(i);\n                    const next = getNextIndex(i);\n                    const va = vertices[prev];\n                    const vb = vertices[i];\n                    const vc = vertices[next];\n                    let isEar = true;\n                    // Check that if any vertices are in the triangle a, b, c\n                    for (let j = 0; j < vertexCount; j++) {\n                        // We can skip these verts because they are the triangle we are testing\n                        if (j === i || j === prev || j === next) {\n                            continue;\n                        }\n                        const point = vertices[j];\n                        if (isPointInTriangle(point, va, vb, vc)) {\n                            isEar = false;\n                            break;\n                        }\n                    }\n                    // Add ear to polygon list and remove from list\n                    if (isEar) {\n                        return i;\n                    }\n                }\n            }\n            // Fall back to any convex vertex\n            for (let i = 0; i < vertexCount; i++) {\n                if (convexVertices[i]) {\n                    return i;\n                }\n            }\n            // bail and return the first one?\n            return 0;\n        }\n        /**\n         * Cut the ear and produce a triangle, update internal state\n         */\n        function cutEarTip(index) {\n            const prev = getPrevIndex(index);\n            const next = getNextIndex(index);\n            const va = vertices[prev];\n            const vb = vertices[index];\n            const vc = vertices[next];\n            // Clockwise winding\n            // if (triangleArea(va, vb, vc) > 0) {\n            triangles.push([va, vb, vc]);\n            // }\n            vertices.splice(index, 1);\n            convexVertices.splice(index, 1);\n            vertexCount--;\n        }\n        // Loop over all the vertices finding ears\n        while (vertexCount > 3) {\n            const earIndex = findEarTip();\n            cutEarTip(earIndex);\n            // reclassify vertices\n            for (let i = 0; i < vertexCount; i++) {\n                convexVertices[i] = isConvex(i);\n            }\n        }\n        // Last triangle after the loop\n        triangles.push([vertices[0], vertices[1], vertices[2]]);\n        // FIXME: there is a colinear triangle that sneaks in here sometimes\n        return new CompositeCollider(triangles.map((points) => Shape.Polygon(points, Vector.Zero, true)));\n    }\n    /**\n     * Returns a clone of this ConvexPolygon, not associated with any collider\n     */\n    clone() {\n        return new PolygonCollider({\n            offset: this.offset.clone(),\n            points: this.points.map((p) => p.clone())\n        });\n    }\n    /**\n     * Returns the world position of the collider, which is the current body transform plus any defined offset\n     */\n    get worldPos() {\n        return this._transform.pos;\n    }\n    /**\n     * Get the center of the collider in world coordinates\n     */\n    get center() {\n        return this.bounds.center;\n    }\n    /**\n     * Calculates the underlying transformation from the body relative space to world space\n     */\n    _calculateTransformation() {\n        const points = this.points;\n        const len = points.length;\n        this._transformedPoints.length = 0; // clear out old transform\n        for (let i = 0; i < len; i++) {\n            this._transformedPoints[i] = this._transform.apply(points[i].clone());\n        }\n    }\n    /**\n     * Gets the points that make up the polygon in world space, from actor relative space (if specified)\n     */\n    getTransformedPoints() {\n        if (this._transformedPointsDirty) {\n            this._calculateTransformation();\n            this._transformedPointsDirty = false;\n        }\n        return this._transformedPoints;\n    }\n    /**\n     * Gets the sides of the polygon in world space\n     */\n    getSides() {\n        if (this._sidesDirty) {\n            const lines = [];\n            const points = this.getTransformedPoints();\n            const len = points.length;\n            for (let i = 0; i < len; i++) {\n                // This winding is important\n                lines.push(new LineSegment(points[i], points[(i + 1) % len]));\n            }\n            this._sides = lines;\n            this._sidesDirty = false;\n        }\n        return this._sides;\n    }\n    /**\n     * Returns the local coordinate space sides\n     */\n    getLocalSides() {\n        if (this._localSidesDirty) {\n            const lines = [];\n            const points = this.points;\n            const len = points.length;\n            for (let i = 0; i < len; i++) {\n                // This winding is important\n                lines.push(new LineSegment(points[i], points[(i + 1) % len]));\n            }\n            this._localSides = lines;\n            this._localSidesDirty = false;\n        }\n        return this._localSides;\n    }\n    /**\n     * Given a direction vector find the world space side that is most in that direction\n     * @param direction\n     */\n    findSide(direction) {\n        const sides = this.getSides();\n        let bestSide = sides[0];\n        let maxDistance = -Number.MAX_VALUE;\n        for (let side = 0; side < sides.length; side++) {\n            const currentSide = sides[side];\n            const sideNormal = currentSide.normal();\n            const mostDirection = sideNormal.dot(direction);\n            if (mostDirection > maxDistance) {\n                bestSide = currentSide;\n                maxDistance = mostDirection;\n            }\n        }\n        return bestSide;\n    }\n    /**\n     * Given a direction vector find the local space side that is most in that direction\n     * @param direction\n     */\n    findLocalSide(direction) {\n        const sides = this.getLocalSides();\n        let bestSide = sides[0];\n        let maxDistance = -Number.MAX_VALUE;\n        for (let side = 0; side < sides.length; side++) {\n            const currentSide = sides[side];\n            const sideNormal = currentSide.normal();\n            const mostDirection = sideNormal.dot(direction);\n            if (mostDirection > maxDistance) {\n                bestSide = currentSide;\n                maxDistance = mostDirection;\n            }\n        }\n        return bestSide;\n    }\n    /**\n     * Get the axis associated with the convex polygon\n     */\n    get axes() {\n        const axes = [];\n        const sides = this.getSides();\n        for (let i = 0; i < sides.length; i++) {\n            axes.push(sides[i].normal());\n        }\n        return axes;\n    }\n    /**\n     * Updates the transform for the collision geometry\n     *\n     * Collision geometry (points/bounds) will not change until this is called.\n     * @param transform\n     */\n    update(transform) {\n        if (transform) {\n            // This change means an update must be performed in order for geometry to update\n            transform.cloneWithParent(this._transform);\n            this._transformedPointsDirty = true;\n            this._sidesDirty = true;\n            if (this.offset.x !== 0 || this.offset.y !== 0) {\n                this._transform.pos.x += this.offset.x;\n                this._transform.pos.y += this.offset.y;\n            }\n            if (this._transform.isMirrored()) {\n                // negative transforms really mess with things in collision local space\n                // flatten out the negatives by applying to geometry\n                this.points = this.points.map((p) => vec(p.x * sign(this._transform.scale.x), p.y * sign(this._transform.scale.y)));\n                this._transform.scale.x = Math.abs(this._transform.scale.x);\n                this._transform.scale.y = Math.abs(this._transform.scale.y);\n            }\n        }\n    }\n    /**\n     * Tests if a point is contained in this collider in world space\n     */\n    contains(point) {\n        // Always cast to the right, as long as we cast in a consistent fixed direction we\n        // will be fine\n        const localPoint = this._transform.applyInverse(point);\n        const testRay = new Ray(localPoint, new Vector(1, 0));\n        let intersectCount = 0;\n        const sides = this.getLocalSides();\n        for (let sideIndex = 0; sideIndex < sides.length; sideIndex++) {\n            const side = sides[sideIndex];\n            if (testRay.intersect(side) >= 0) {\n                intersectCount++;\n            }\n        }\n        if (intersectCount % 2 === 0) {\n            return false;\n        }\n        return true;\n    }\n    getClosestLineBetween(collider) {\n        if (collider instanceof CircleCollider) {\n            return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\n        }\n        else if (collider instanceof PolygonCollider) {\n            return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\n        }\n        else if (collider instanceof EdgeCollider) {\n            return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\n        }\n        else {\n            throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n        }\n    }\n    /**\n     * Returns a collision contact if the 2 colliders collide, otherwise collide will\n     * return null.\n     * @param collider\n     */\n    collide(collider) {\n        if (collider instanceof CircleCollider) {\n            return CollisionJumpTable.CollideCirclePolygon(collider, this);\n        }\n        else if (collider instanceof PolygonCollider) {\n            return CollisionJumpTable.CollidePolygonPolygon(this, collider);\n        }\n        else if (collider instanceof EdgeCollider) {\n            return CollisionJumpTable.CollidePolygonEdge(this, collider);\n        }\n        else {\n            throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n        }\n    }\n    /**\n     * Find the point on the collider furthest in the direction specified\n     */\n    getFurthestPoint(direction) {\n        const pts = this.getTransformedPoints();\n        let furthestPoint = null;\n        let maxDistance = -Number.MAX_VALUE;\n        for (let i = 0; i < pts.length; i++) {\n            const distance = direction.dot(pts[i]);\n            if (distance > maxDistance) {\n                maxDistance = distance;\n                furthestPoint = pts[i];\n            }\n        }\n        return furthestPoint;\n    }\n    /**\n     * Find the local point on the collider furthest in the direction specified\n     * @param direction\n     */\n    getFurthestLocalPoint(direction) {\n        const pts = this.points;\n        let furthestPoint = pts[0];\n        let maxDistance = -Number.MAX_VALUE;\n        for (let i = 0; i < pts.length; i++) {\n            const distance = direction.dot(pts[i]);\n            if (distance > maxDistance) {\n                maxDistance = distance;\n                furthestPoint = pts[i];\n            }\n        }\n        return furthestPoint;\n    }\n    /**\n     * Finds the closes face to the point using perpendicular distance\n     * @param point point to test against polygon\n     */\n    getClosestFace(point) {\n        const sides = this.getSides();\n        let min = Number.POSITIVE_INFINITY;\n        let faceIndex = -1;\n        let distance = -1;\n        for (let i = 0; i < sides.length; i++) {\n            const dist = sides[i].distanceToPoint(point);\n            if (dist < min) {\n                min = dist;\n                faceIndex = i;\n                distance = dist;\n            }\n        }\n        if (faceIndex !== -1) {\n            return {\n                distance: sides[faceIndex].normal().scale(distance),\n                face: sides[faceIndex]\n            };\n        }\n        return null;\n    }\n    /**\n     * Get the axis aligned bounding box for the polygon collider in world coordinates\n     */\n    get bounds() {\n        return this.localBounds.transform(this._transform.matrix);\n    }\n    /**\n     * Get the axis aligned bounding box for the polygon collider in local coordinates\n     */\n    get localBounds() {\n        if (this._localBoundsDirty) {\n            this._localBounds = BoundingBox.fromPoints(this.points);\n            this._localBoundsDirty = false;\n        }\n        return this._localBounds;\n    }\n    /**\n     * Get the moment of inertia for an arbitrary polygon\n     * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n     */\n    getInertia(mass) {\n        if (this._cachedMass === mass && this._cachedInertia) {\n            return this._cachedInertia;\n        }\n        let numerator = 0;\n        let denominator = 0;\n        const points = this.points;\n        for (let i = 0; i < points.length; i++) {\n            const iplusone = (i + 1) % points.length;\n            const crossTerm = points[iplusone].cross(points[i]);\n            numerator += crossTerm * (points[i].dot(points[i]) + points[i].dot(points[iplusone]) + points[iplusone].dot(points[iplusone]));\n            denominator += crossTerm;\n        }\n        this._cachedMass = mass;\n        return (this._cachedInertia = (mass / 6) * (numerator / denominator));\n    }\n    /**\n     * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\n     */\n    rayCast(ray, max = Infinity) {\n        var _a;\n        // find the minimum contact time greater than 0\n        // contact times less than 0 are behind the ray and we don't want those\n        const sides = this.getSides();\n        const len = sides.length;\n        let minContactTime = Number.MAX_VALUE;\n        let contactSide;\n        let contactIndex = -1;\n        for (let i = 0; i < len; i++) {\n            const contactTime = ray.intersect(sides[i]);\n            if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\n                minContactTime = contactTime;\n                contactSide = sides[i];\n                contactIndex = i;\n            }\n        }\n        // contact was found\n        if (contactIndex >= 0) {\n            return {\n                collider: this,\n                distance: minContactTime,\n                body: (_a = this.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent),\n                point: ray.getPoint(minContactTime),\n                normal: contactSide.normal()\n            };\n        }\n        // no contact found\n        return null;\n    }\n    /**\n     * Project the edges of the polygon along a specified axis\n     */\n    project(axis) {\n        const points = this.getTransformedPoints();\n        const len = points.length;\n        let min = Number.MAX_VALUE;\n        let max = -Number.MAX_VALUE;\n        for (let i = 0; i < len; i++) {\n            const scalar = points[i].dot(axis);\n            min = Math.min(min, scalar);\n            max = Math.max(max, scalar);\n        }\n        return new Projection(min, max);\n    }\n    debug(ex, color, options) {\n        const points = this.getTransformedPoints();\n        Debug.drawPolygon(points, { color });\n    }\n}\n\n;// ./Collision/Colliders/Shape.ts\n\n\n\n\n\n\n\n/**\n * Excalibur helper for defining colliders quickly\n */\nclass Shape {\n    /**\n     * Creates a box collider, under the hood defines a {@apilink PolygonCollider} collider\n     * @param width Width of the box\n     * @param height Height of the box\n     * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\n     * @param offset Optional offset relative to the collider in local coordinates\n     */\n    static Box(width, height, anchor = Vector.Half, offset = Vector.Zero) {\n        return new PolygonCollider({\n            points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\n            offset: offset\n        });\n    }\n    /**\n     * Creates a new {@apilink PolygonCollider | `arbitrary polygon`} collider\n     *\n     * PolygonColliders are useful for creating convex polygon shapes\n     * @param points Points specified in counter clockwise\n     * @param offset Optional offset relative to the collider in local coordinates\n     */\n    static Polygon(points, offset = Vector.Zero, suppressConvexWarning = false) {\n        return new PolygonCollider({\n            points: points,\n            offset: offset,\n            suppressConvexWarning\n        });\n    }\n    /**\n     * Creates a new {@apilink CircleCollider | `circle`} collider\n     *\n     * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\n     * @param radius Radius of the circle collider\n     * @param offset Optional offset relative to the collider in local coordinates\n     */\n    static Circle(radius, offset = Vector.Zero) {\n        return new CircleCollider({\n            radius: radius,\n            offset: offset\n        });\n    }\n    /**\n     * Creates a new {@apilink EdgeCollider | `edge`} collider\n     *\n     * Edge colliders are useful for  floors, walls, and other barriers\n     * @param begin Beginning of the edge in local coordinates to the collider\n     * @param end Ending of the edge in local coordinates to the collider\n     */\n    static Edge(begin, end) {\n        return new EdgeCollider({\n            begin: begin,\n            end: end\n        });\n    }\n    /**\n     * Creates a new capsule shaped {@apilink CompositeCollider} using 2 circles and a box\n     *\n     * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\n     * player experience.\n     * @param width\n     * @param height\n     * @param offset Optional offset\n     */\n    static Capsule(width, height, offset = Vector.Zero) {\n        const logger = Logger.getInstance();\n        if (width === height) {\n            logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\n        }\n        const vertical = height >= width;\n        if (vertical) {\n            // height > width, if equal maybe use a circle\n            const capsule = new CompositeCollider([\n                Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\n                Shape.Box(width, height - width, Vector.Half, offset),\n                Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\n            ]);\n            return capsule;\n        }\n        else {\n            // width > height, if equal maybe use a circle\n            const capsule = new CompositeCollider([\n                Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\n                Shape.Box(width - height, height, Vector.Half, offset),\n                Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\n            ]);\n            return capsule;\n        }\n    }\n}\n\n;// ./Collision/ColliderComponent.ts\n\n\n\n\n\n\n\n\n\n\nclass ColliderComponent extends Component {\n    constructor(collider) {\n        super();\n        this.events = new EventEmitter();\n        /**\n         * Observable that notifies when a collider is added to the body\n         */\n        this.$colliderAdded = new Observable();\n        /**\n         * Observable that notifies when a collider is removed from the body\n         */\n        this.$colliderRemoved = new Observable();\n        this._collidersToRemove = [];\n        this.set(collider);\n    }\n    /**\n     * Get the current collider geometry\n     */\n    get() {\n        return this._collider;\n    }\n    /**\n     * Set the collider geometry\n     * @param collider\n     * @returns the collider you set\n     */\n    set(collider) {\n        this.clear();\n        if (collider) {\n            this._collider = collider;\n            this._collider.owner = this.owner;\n            collider.events.pipe(this.events);\n            this.$colliderAdded.notifyAll(collider);\n            this.update();\n        }\n        return collider;\n    }\n    /**\n     * Remove collider geometry from collider component\n     */\n    clear() {\n        if (this._collider) {\n            this._collidersToRemove.push(this._collider);\n            this._collider = null;\n        }\n    }\n    processColliderRemoval() {\n        for (const collider of this._collidersToRemove) {\n            collider.events.unpipe(this.events);\n            this.$colliderRemoved.notifyAll(collider);\n            collider.owner = null;\n        }\n    }\n    clone() {\n        const clone = new ColliderComponent(this._collider.clone());\n        return clone;\n    }\n    /**\n     * Return world space bounds\n     */\n    get bounds() {\n        var _a, _b;\n        return (_b = (_a = this._collider) === null || _a === void 0 ? void 0 : _a.bounds) !== null && _b !== void 0 ? _b : new BoundingBox();\n    }\n    /**\n     * Return local space bounds\n     */\n    get localBounds() {\n        var _a, _b;\n        return (_b = (_a = this._collider) === null || _a === void 0 ? void 0 : _a.localBounds) !== null && _b !== void 0 ? _b : new BoundingBox();\n    }\n    /**\n     * Update the collider's transformed geometry\n     */\n    update() {\n        var _a;\n        const tx = (_a = this.owner) === null || _a === void 0 ? void 0 : _a.get(TransformComponent);\n        if (this._collider) {\n            this._collider.owner = this.owner;\n            if (tx) {\n                this._collider.update(tx.get());\n            }\n        }\n    }\n    /**\n     * Collide component with another\n     * @param other\n     */\n    collide(other) {\n        let colliderA = this._collider;\n        let colliderB = other._collider;\n        if (!colliderA || !colliderB) {\n            return [];\n        }\n        // If we have a composite left hand side :(\n        // Might bite us, but to avoid updating all the handlers make composite always left side\n        let flipped = false;\n        if (colliderB instanceof CompositeCollider) {\n            colliderA = colliderB;\n            colliderB = this._collider;\n            flipped = true;\n        }\n        if (this._collider) {\n            const contacts = colliderA.collide(colliderB);\n            if (contacts) {\n                if (flipped) {\n                    contacts.forEach((contact) => {\n                        contact.mtv = contact.mtv.negate();\n                        contact.normal = contact.normal.negate();\n                        contact.tangent = contact.normal.perpendicular();\n                        contact.colliderA = this._collider;\n                        contact.colliderB = other._collider;\n                    });\n                }\n                return contacts;\n            }\n            return [];\n        }\n        return [];\n    }\n    onAdd(entity) {\n        if (this._collider) {\n            this.update();\n        }\n        // Wire up the collider events to the owning entity\n        this.events.on('precollision', (evt) => {\n            const precollision = evt;\n            entity.events.emit('precollision', new PreCollisionEvent(precollision.self, precollision.other, precollision.side, precollision.intersection, precollision.contact));\n            if (entity instanceof Actor) {\n                entity.onPreCollisionResolve(precollision.self, precollision.other, precollision.side, precollision.contact);\n            }\n        });\n        this.events.on('postcollision', (evt) => {\n            const postcollision = evt;\n            entity.events.emit('postcollision', new PostCollisionEvent(postcollision.self, postcollision.other, postcollision.side, postcollision.intersection, postcollision.contact));\n            if (entity instanceof Actor) {\n                entity.onPostCollisionResolve(postcollision.self, postcollision.other, postcollision.side, postcollision.contact);\n            }\n        });\n        this.events.on('collisionstart', (evt) => {\n            const start = evt;\n            entity.events.emit('collisionstart', new CollisionStartEvent(start.self, start.other, start.side, start.contact));\n            if (entity instanceof Actor) {\n                entity.onCollisionStart(start.self, start.other, start.side, start.contact);\n            }\n        });\n        this.events.on('collisionend', (evt) => {\n            const end = evt;\n            entity.events.emit('collisionend', new CollisionEndEvent(end.self, end.other, end.side, end.lastContact));\n            if (entity instanceof Actor) {\n                entity.onCollisionEnd(end.self, end.other, end.side, end.lastContact);\n            }\n        });\n    }\n    onRemove() {\n        this.events.clear();\n        this.$colliderRemoved.notifyAll(this._collider);\n    }\n    /**\n     * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\n     *\n     * If no width/height are specified the body will attempt to use the associated actor's width/height.\n     *\n     * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n     */\n    useBoxCollider(width, height, anchor = Vector.Half, center = Vector.Zero) {\n        const collider = Shape.Box(width, height, anchor, center);\n        return this.set(collider);\n    }\n    /**\n     * Sets up a {@apilink PolygonCollider | `polygon`} collision geometry based on a list of of points relative\n     *  to the anchor of the associated actor\n     * of this physics body.\n     *\n     * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\n     *\n     * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n     */\n    usePolygonCollider(points, center = Vector.Zero) {\n        const poly = Shape.Polygon(points, center);\n        return this.set(poly);\n    }\n    /**\n     * Sets up a {@apilink Circle | `circle collision geometry`} as the only collider with a specified radius in pixels.\n     *\n     * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n     */\n    useCircleCollider(radius, center = Vector.Zero) {\n        const collider = Shape.Circle(radius, center);\n        return this.set(collider);\n    }\n    /**\n     * Sets up an {@apilink Edge | `edge collision geometry`} with a start point and an end point relative to the anchor of the associated actor\n     * of this physics body.\n     *\n     * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n     */\n    useEdgeCollider(begin, end) {\n        const collider = Shape.Edge(begin, end);\n        return this.set(collider);\n    }\n    /**\n     * Setups up a {@apilink CompositeCollider} which can define any arbitrary set of excalibur colliders\n     * @param colliders\n     */\n    useCompositeCollider(colliders) {\n        return this.set(new CompositeCollider(colliders));\n    }\n}\n\n;// ./Collision/BodyComponent.ts\n\n\n\n\n\n\n\n\n\n\n\n\nvar DegreeOfFreedom;\n(function (DegreeOfFreedom) {\n    DegreeOfFreedom[\"Rotation\"] = \"rotation\";\n    DegreeOfFreedom[\"X\"] = \"x\";\n    DegreeOfFreedom[\"Y\"] = \"y\";\n})(DegreeOfFreedom || (DegreeOfFreedom = {}));\n/**\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\n * of physics simulation.\n */\nclass BodyComponent extends Component {\n    constructor(options) {\n        var _a, _b, _c;\n        super();\n        this.dependencies = [TransformComponent, MotionComponent];\n        this.id = createId('body', BodyComponent._ID++);\n        this.events = new EventEmitter();\n        this.oldTransform = new transform_Transform();\n        /**\n         * Indicates whether the old transform has been captured at least once for interpolation\n         * @internal\n         */\n        this.__oldTransformCaptured = false;\n        /**\n         * Enable or disabled the fixed update interpolation, by default interpolation is on.\n         */\n        this.enableFixedUpdateInterpolate = true;\n        /**\n         * Collision type for the rigidbody physics simulation, by default {@apilink CollisionType.PreventCollision}\n         */\n        this.collisionType = CollisionType.PreventCollision;\n        /**\n         * The collision group for the body's colliders, by default body colliders collide with everything\n         */\n        this.group = CollisionGroup.All;\n        this._sleeping = false;\n        /**\n         * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\n         * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\n         */\n        this.bounciness = 0.2;\n        /**\n         * The coefficient of friction on this actor.\n         *\n         * The {@apilink SolverStrategy.Arcade} does not support this property.\n         *\n         */\n        this.friction = 0.99;\n        /**\n         * Should use global gravity {@apilink Physics.gravity} in it's physics simulation, default is true\n         */\n        this.useGravity = true;\n        /**\n         * Degrees of freedom to limit\n         *\n         * Note: this only limits responses in the realistic solver, if velocity/angularVelocity is set the actor will still respond\n         */\n        this.limitDegreeOfFreedom = [];\n        this._oldGlobalPos = Vector.Zero;\n        /**\n         * The velocity of the actor last frame (vx, vy) in pixels/second\n         */\n        this.oldVel = new Vector(0, 0);\n        /**\n         * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\n         */\n        this.oldAcc = Vector.Zero;\n        this._impulseScratch = vec(0, 0);\n        this._distanceFromCenterScratch = vec(0, 0);\n        if (options) {\n            this.collisionType = (_a = options.type) !== null && _a !== void 0 ? _a : this.collisionType;\n            this.group = (_b = options.group) !== null && _b !== void 0 ? _b : this.group;\n            this.useGravity = (_c = options.useGravity) !== null && _c !== void 0 ? _c : this.useGravity;\n            this._bodyConfig = {\n                ...DefaultPhysicsConfig.bodies,\n                ...options.config\n            };\n        }\n        else {\n            this._bodyConfig = {\n                ...DefaultPhysicsConfig.bodies\n            };\n        }\n        this.updatePhysicsConfig(this._bodyConfig);\n        this._mass = BodyComponent._DEFAULT_CONFIG.defaultMass;\n    }\n    get matrix() {\n        return this.transform.get().matrix;\n    }\n    /**\n     * Called by excalibur to update physics config defaults if they change\n     * @param config\n     */\n    updatePhysicsConfig(config) {\n        this._bodyConfig = {\n            ...DefaultPhysicsConfig.bodies,\n            ...config\n        };\n        this.canSleep = this._bodyConfig.canSleepByDefault;\n        this.sleepMotion = this._bodyConfig.sleepEpsilon * 5;\n        this.wakeThreshold = this._bodyConfig.wakeThreshold;\n    }\n    /**\n     * Called by excalibur to update defaults\n     * @param config\n     */\n    static updateDefaultPhysicsConfig(config) {\n        BodyComponent._DEFAULT_CONFIG = config;\n    }\n    get mass() {\n        return this._mass;\n    }\n    set mass(newMass) {\n        this._mass = newMass;\n        this._cachedInertia = undefined;\n        this._cachedInverseInertia = undefined;\n    }\n    /**\n     * The inverse mass (1/mass) of the body. If {@apilink CollisionType.Fixed} this is 0, meaning \"infinite\" mass\n     */\n    get inverseMass() {\n        return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\n    }\n    /**\n     * Whether this body is sleeping or not\n     * @deprecated use isSleeping\n     */\n    get sleeping() {\n        return this.isSleeping;\n    }\n    /**\n     * Whether this body is sleeping or not\n     */\n    get isSleeping() {\n        return this._sleeping;\n    }\n    /**\n     * Set the sleep state of the body\n     * @param sleeping\n     * @deprecated use isSleeping\n     */\n    setSleeping(sleeping) {\n        this.isSleeping = sleeping;\n    }\n    set isSleeping(sleeping) {\n        this._sleeping = sleeping;\n        if (!sleeping) {\n            // Give it a kick to keep it from falling asleep immediately\n            this.sleepMotion = this._bodyConfig.sleepEpsilon * 5;\n        }\n        else {\n            this.vel = Vector.Zero;\n            this.acc = Vector.Zero;\n            this.angularVelocity = 0;\n            this.sleepMotion = 0;\n        }\n    }\n    /**\n     * Update body's {@apilink BodyComponent.sleepMotion} for the purpose of sleeping\n     */\n    updateMotion() {\n        if (this._sleeping) {\n            this.isSleeping = true;\n        }\n        const currentMotion = this.vel.magnitude * this.vel.magnitude + Math.abs(this.angularVelocity * this.angularVelocity);\n        const bias = this._bodyConfig.sleepBias;\n        this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\n        this.sleepMotion = clamp(this.sleepMotion, 0, 10 * this._bodyConfig.sleepEpsilon);\n        if (this.canSleep && this.sleepMotion < this._bodyConfig.sleepEpsilon) {\n            this.isSleeping = true;\n        }\n    }\n    /**\n     * Get the moment of inertia from the {@apilink ColliderComponent}\n     */\n    get inertia() {\n        if (this._cachedInertia) {\n            return this._cachedInertia;\n        }\n        // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\n        const collider = this.owner.get(ColliderComponent);\n        if (collider) {\n            collider.$colliderAdded.subscribe(() => {\n                this._cachedInertia = null;\n            });\n            collider.$colliderRemoved.subscribe(() => {\n                this._cachedInertia = null;\n            });\n            const maybeCollider = collider.get();\n            if (maybeCollider) {\n                return (this._cachedInertia = maybeCollider.getInertia(this.mass));\n            }\n        }\n        return 0;\n    }\n    /**\n     * Get the inverse moment of inertial from the {@apilink ColliderComponent}. If {@apilink CollisionType.Fixed} this is 0, meaning \"infinite\" mass\n     */\n    get inverseInertia() {\n        if (this._cachedInverseInertia) {\n            return this._cachedInverseInertia;\n        }\n        return (this._cachedInverseInertia = this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia);\n    }\n    /**\n     * Returns if the owner is active\n     * @deprecated use isActive\n     */\n    get active() {\n        var _a;\n        return !!((_a = this.owner) === null || _a === void 0 ? void 0 : _a.isActive);\n    }\n    /**\n     * Returns if the owner is active\n     */\n    get isActive() {\n        var _a;\n        return !!((_a = this.owner) === null || _a === void 0 ? void 0 : _a.isActive);\n    }\n    /**\n     * @deprecated Use globalPos\n     */\n    get center() {\n        return this.globalPos;\n    }\n    onAdd(owner) {\n        var _a, _b;\n        this.transform = (_a = this.owner) === null || _a === void 0 ? void 0 : _a.get(TransformComponent);\n        this.motion = (_b = this.owner) === null || _b === void 0 ? void 0 : _b.get(MotionComponent);\n    }\n    get pos() {\n        return this.transform.pos;\n    }\n    set pos(val) {\n        this.transform.pos = val;\n    }\n    /**\n     * The (x, y) position of the actor this will be in the middle of the actor if the\n     * {@apilink Actor.anchor} is set to (0.5, 0.5) which is default.\n     * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\n     */\n    get globalPos() {\n        return this.transform.globalPos;\n    }\n    set globalPos(val) {\n        this.transform.globalPos = val;\n    }\n    /**\n     * The position of the actor last frame (x, y) in pixels\n     */\n    get oldPos() {\n        return this.oldTransform.pos;\n    }\n    /**\n     * The global position of the actor last frame (x, y) in pixels\n     */\n    get oldGlobalPos() {\n        return this._oldGlobalPos;\n    }\n    /**\n     * The current velocity vector (vx, vy) of the actor in pixels/second\n     */\n    get vel() {\n        return this.motion.vel;\n    }\n    set vel(val) {\n        this.motion.vel = val;\n    }\n    /**\n     * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\n     * be useful to simulate a gravitational effect.\n     */\n    get acc() {\n        return this.motion.acc;\n    }\n    set acc(val) {\n        this.motion.acc = val;\n    }\n    /**\n     * The current torque applied to the actor\n     */\n    get torque() {\n        return this.motion.torque;\n    }\n    set torque(val) {\n        this.motion.torque = val;\n    }\n    /**\n     * Gets/sets the rotation of the body from the last frame.\n     */\n    get oldRotation() {\n        return this.oldTransform.rotation;\n    }\n    /**\n     * The rotation of the body in radians\n     */\n    get rotation() {\n        return this.transform.globalRotation;\n    }\n    set rotation(val) {\n        this.transform.globalRotation = val;\n    }\n    /**\n     * The scale vector of the actor\n     */\n    get scale() {\n        return this.transform.globalScale;\n    }\n    set scale(val) {\n        this.transform.globalScale = val;\n    }\n    /**\n     * The scale of the actor last frame\n     */\n    get oldScale() {\n        return this.oldTransform.scale;\n    }\n    /**\n     * The scale rate of change of the actor in scale/second\n     */\n    get scaleFactor() {\n        return this.motion.scaleFactor;\n    }\n    set scaleFactor(scaleFactor) {\n        this.motion.scaleFactor = scaleFactor;\n    }\n    /**\n     * Get the angular velocity in radians/second\n     */\n    get angularVelocity() {\n        return this.motion.angularVelocity;\n    }\n    /**\n     * Set the angular velocity in radians/second\n     */\n    set angularVelocity(value) {\n        this.motion.angularVelocity = value;\n    }\n    /**\n     * Apply a specific impulse to the body\n     * @param point\n     * @param impulse\n     */\n    applyImpulse(point, impulse) {\n        if (this.collisionType !== CollisionType.Active) {\n            return; // only active objects participate in the simulation\n        }\n        const finalImpulse = impulse.scale(this.inverseMass, this._impulseScratch);\n        if (this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.X) > -1) {\n            finalImpulse.x = 0;\n        }\n        if (this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.Y) > -1) {\n            finalImpulse.y = 0;\n        }\n        this.vel.addEqual(finalImpulse);\n        if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n            const distanceFromCenter = point.sub(this.globalPos, this._distanceFromCenterScratch);\n            this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n        }\n    }\n    /**\n     * Apply only linear impulse to the body\n     * @param impulse\n     */\n    applyLinearImpulse(impulse) {\n        if (this.collisionType !== CollisionType.Active) {\n            return; // only active objects participate in the simulation\n        }\n        const finalImpulse = impulse.scale(this.inverseMass);\n        if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n            finalImpulse.x = 0;\n        }\n        if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n            finalImpulse.y = 0;\n        }\n        this.vel = this.vel.add(finalImpulse);\n    }\n    /**\n     * Apply only angular impulse to the body\n     * @param point\n     * @param impulse\n     */\n    applyAngularImpulse(point, impulse) {\n        if (this.collisionType !== CollisionType.Active) {\n            return; // only active objects participate in the simulation\n        }\n        if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n            const distanceFromCenter = point.sub(this.globalPos);\n            this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n        }\n    }\n    /**\n     * Sets the old versions of pos, vel, acc, and scale.\n     */\n    captureOldTransform() {\n        // Capture old values before integration step updates them\n        this.__oldTransformCaptured = true;\n        const tx = this.transform.get();\n        tx.clone(this.oldTransform);\n        this.oldTransform.parent = tx.parent; // also grab parent\n        this.oldVel.setTo(this.vel.x, this.vel.y);\n        this.oldAcc.setTo(this.acc.x, this.acc.y);\n        this.oldGlobalPos.setTo(this.globalPos.x, this.globalPos.y);\n    }\n    clone() {\n        const component = super.clone();\n        return component;\n    }\n}\nBodyComponent._ID = 0;\nBodyComponent._DEFAULT_CONFIG = {\n    ...DefaultPhysicsConfig.bodies\n};\n\n;// ./Graphics/Rectangle.ts\n\n/**\n * A Rectangle {@apilink Graphic} for drawing rectangles to the {@apilink ExcaliburGraphicsContext}\n */\nclass Rectangle extends Raster {\n    constructor(options) {\n        super(options);\n        this.width = options.width;\n        this.height = options.height;\n        this.rasterize();\n    }\n    clone() {\n        return new Rectangle({\n            width: this.width,\n            height: this.height,\n            ...this.cloneGraphicOptions(),\n            ...this.cloneRasterOptions()\n        });\n    }\n    execute(ctx) {\n        if (this.color) {\n            ctx.fillRect(0, 0, this.width, this.height);\n        }\n        if (this.strokeColor) {\n            ctx.strokeRect(0, 0, this.width, this.height);\n        }\n    }\n}\n\n;// ./Graphics/Circle.ts\n\n\n/**\n * A circle {@apilink Graphic} for drawing circles to the {@apilink ExcaliburGraphicsContext}\n *\n * Circles default to {@apilink ImageFiltering.Blended}\n */\nclass Circle extends Raster {\n    get radius() {\n        return this._radius;\n    }\n    set radius(value) {\n        this._radius = value;\n        this.width = this._radius * 2;\n        this.height = this._radius * 2;\n        this.flagDirty();\n    }\n    constructor(options) {\n        var _a, _b, _c;\n        super(options);\n        this._radius = 0;\n        const lineWidth = (_a = options.lineWidth) !== null && _a !== void 0 ? _a : (options.strokeColor ? 1 : 0); // default lineWidth in canvas is 1px\n        this.padding = (_b = options.padding) !== null && _b !== void 0 ? _b : 2 + lineWidth / 2; // default 2 padding for circles looks nice\n        this.radius = options.radius;\n        this.filtering = (_c = options.filtering) !== null && _c !== void 0 ? _c : ImageFiltering.Blended;\n        this.rasterize();\n    }\n    clone() {\n        return new Circle({\n            radius: this.radius,\n            ...this.cloneGraphicOptions(),\n            ...this.cloneRasterOptions()\n        });\n    }\n    execute(ctx) {\n        if (this.radius > 0) {\n            ctx.beginPath();\n            ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\n            if (this.color) {\n                ctx.fill();\n            }\n            if (this.strokeColor) {\n                ctx.stroke();\n            }\n        }\n    }\n}\n\n;// ./Input/PointerComponent.ts\n\n/**\n * Add this component to optionally configure how the pointer\n * system detects pointer events.\n *\n * By default the collider shape is used and graphics bounds is not.\n *\n * If both collider shape and graphics bounds are enabled it will fire events if either or\n * are intersecting the pointer.\n */\nclass PointerComponent extends Component {\n    constructor(options) {\n        var _a, _b;\n        super();\n        /**\n         * Use any existing Collider component geometry for pointer events. This is useful if you want\n         * user pointer events only to trigger on the same collision geometry used in the collider component\n         * for collision resolution. Default is `true`.\n         */\n        this.useColliderShape = true;\n        /**\n         * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\n         * bounds around the graphic to trigger pointer events. Default is `true`.\n         */\n        this.useGraphicsBounds = true;\n        this.useColliderShape = (_a = options === null || options === void 0 ? void 0 : options.useColliderShape) !== null && _a !== void 0 ? _a : this.useColliderShape;\n        this.useGraphicsBounds = (_b = options === null || options === void 0 ? void 0 : options.useGraphicsBounds) !== null && _b !== void 0 ? _b : this.useGraphicsBounds;\n        this.localBounds = options === null || options === void 0 ? void 0 : options.localBounds;\n    }\n}\n\n;// ./Util/EasingFunctions.ts\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nclass EasingFunctions {\n    static CreateReversibleEasingFunction(easing) {\n        return (time, start, end, duration) => {\n            if (end < start) {\n                return start - (easing(time, end, start, duration) - end);\n            }\n            else {\n                return easing(time, start, end, duration);\n            }\n        };\n    }\n    static CreateVectorEasingFunction(easing) {\n        return (time, start, end, duration) => {\n            return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n        };\n    }\n}\nEasingFunctions.Linear = EasingFunctions.CreateReversibleEasingFunction((currentTime, startValue, endValue, duration) => {\n    endValue = endValue - startValue;\n    return (endValue * currentTime) / duration + startValue;\n});\nEasingFunctions.EaseInQuad = EasingFunctions.CreateReversibleEasingFunction((currentTime, startValue, endValue, duration) => {\n    endValue = endValue - startValue;\n    currentTime /= duration;\n    return endValue * currentTime * currentTime + startValue;\n});\nEasingFunctions.EaseOutQuad = EasingFunctions.CreateReversibleEasingFunction((currentTime, startValue, endValue, duration) => {\n    endValue = endValue - startValue;\n    currentTime /= duration;\n    return -endValue * currentTime * (currentTime - 2) + startValue;\n});\nEasingFunctions.EaseInOutQuad = EasingFunctions.CreateReversibleEasingFunction((currentTime, startValue, endValue, duration) => {\n    endValue = endValue - startValue;\n    currentTime /= duration / 2;\n    if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n    }\n    currentTime--;\n    return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n});\nEasingFunctions.EaseInCubic = EasingFunctions.CreateReversibleEasingFunction((currentTime, startValue, endValue, duration) => {\n    endValue = endValue - startValue;\n    currentTime /= duration;\n    return endValue * currentTime * currentTime * currentTime + startValue;\n});\nEasingFunctions.EaseOutCubic = EasingFunctions.CreateReversibleEasingFunction((currentTime, startValue, endValue, duration) => {\n    endValue = endValue - startValue;\n    currentTime /= duration;\n    currentTime--;\n    return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n});\nEasingFunctions.EaseInOutCubic = EasingFunctions.CreateReversibleEasingFunction((currentTime, startValue, endValue, duration) => {\n    endValue = endValue - startValue;\n    currentTime /= duration / 2;\n    if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n    }\n    currentTime -= 2;\n    return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n});\n\n;// ./Actions/ActionQueue.ts\n\n/**\n * Action Queues represent an ordered sequence of actions\n *\n * Action queues are part of the {@apilink ActionContext | `Action API`} and\n * store the list of actions to be executed for an {@apilink Actor}.\n *\n * Actors implement {@apilink Actor.actions} which can be manipulated by\n * advanced users to adjust the actions currently being executed in the\n * queue.\n */\nclass ActionQueue {\n    constructor(entity) {\n        this._actions = [];\n        this._currentAction = null;\n        this._completedActions = [];\n        this._entity = entity;\n    }\n    /**\n     * Add an action to the sequence\n     * @param action\n     */\n    add(action) {\n        this._actions.push(action);\n    }\n    /**\n     * Remove an action by reference from the sequence\n     * @param action\n     */\n    remove(action) {\n        const index = this._actions.indexOf(action);\n        this._actions.splice(index, 1);\n    }\n    /**\n     * Removes all actions from this sequence\n     */\n    clearActions() {\n        this._actions.length = 0;\n        this._completedActions.length = 0;\n        if (this._currentAction) {\n            this._currentAction.stop();\n        }\n    }\n    /**\n     *\n     * @returns The total list of actions in this sequence complete or not\n     */\n    getActions() {\n        return this._actions.concat(this._completedActions);\n    }\n    getIncompleteActions() {\n        return this._actions;\n    }\n    getCurrentAction() {\n        return this._currentAction;\n    }\n    /**\n     *\n     * @returns `true` if there are more actions to process in the sequence\n     */\n    hasNext() {\n        return this._actions.length > 0;\n    }\n    /**\n     * @returns `true` if the current sequence of actions is done\n     */\n    isComplete() {\n        return this._actions.length === 0;\n    }\n    /**\n     * Resets the sequence of actions, this is used to restart a sequence from the beginning\n     */\n    reset() {\n        this._actions = this.getActions();\n        const len = this._actions.length;\n        for (let i = 0; i < len; i++) {\n            this._actions[i].reset();\n        }\n        this._completedActions = [];\n    }\n    /**\n     * Update the queue which updates actions and handles completing actions\n     * @param elapsedMs\n     */\n    update(elapsedMs) {\n        if (this._actions.length > 0) {\n            if (this._currentAction !== this._actions[0]) {\n                this._currentAction = this._actions[0];\n                this._entity.emit('actionstart', new ActionStartEvent(this._currentAction, this._entity));\n            }\n            this._currentAction.update(elapsedMs);\n            if (this._currentAction.isComplete(this._entity)) {\n                this._entity.emit('actioncomplete', new ActionCompleteEvent(this._currentAction, this._entity));\n                const complete = this._actions.shift();\n                if (complete) {\n                    this._completedActions.push(complete);\n                }\n            }\n        }\n    }\n}\n\n;// ./Actions/Action.ts\nlet _ACTION_ID = 0;\n/**\n *\n */\nfunction nextActionId() {\n    return _ACTION_ID++;\n}\n\n;// ./Actions/Action/Repeat.ts\n\n\nclass Repeat {\n    constructor(entity, repeatBuilder, repeat) {\n        this.id = nextActionId();\n        this._stopped = false;\n        this._repeatBuilder = repeatBuilder;\n        this._repeatContext = new ActionContext(entity);\n        this._actionQueue = this._repeatContext.getQueue();\n        this._repeat = repeat;\n        this._originalRepeat = repeat;\n        this._repeatBuilder(this._repeatContext);\n        this._repeat--; // current execution is the first repeat\n    }\n    update(elapsedMs) {\n        if (this._actionQueue.isComplete()) {\n            this._actionQueue.clearActions();\n            this._repeatBuilder(this._repeatContext);\n            this._repeat--;\n        }\n        this._actionQueue.update(elapsedMs);\n    }\n    isComplete() {\n        return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\n    }\n    stop() {\n        this._stopped = true;\n    }\n    reset() {\n        this._repeat = this._originalRepeat;\n    }\n}\n\n;// ./Actions/Action/RepeatForever.ts\n\n\n/**\n * RepeatForever Action implementation, it is recommended you use the fluent action\n * context API.\n *\n *\n */\nclass RepeatForever {\n    constructor(entity, repeatBuilder) {\n        this.id = nextActionId();\n        this._stopped = false;\n        this._repeatBuilder = repeatBuilder;\n        this._repeatContext = new ActionContext(entity);\n        this._actionQueue = this._repeatContext.getQueue();\n        this._repeatBuilder(this._repeatContext);\n    }\n    update(elapsedMs) {\n        if (this._stopped) {\n            return;\n        }\n        if (this._actionQueue.isComplete()) {\n            this._actionQueue.clearActions();\n            this._repeatBuilder(this._repeatContext);\n        }\n        this._actionQueue.update(elapsedMs);\n    }\n    isComplete() {\n        return this._stopped;\n    }\n    stop() {\n        this._stopped = true;\n        this._actionQueue.clearActions();\n    }\n    reset() {\n        return;\n    }\n}\n\n;// ./Actions/RotationType.ts\n/**\n * An enum that describes the strategies that rotation actions can use\n */\nvar RotationType;\n(function (RotationType) {\n    /**\n     * Rotation via `ShortestPath` will use the smallest angle\n     * between the starting and ending points. This strategy is the default behavior.\n     */\n    RotationType[\"ShortestPath\"] = \"shortest-path\";\n    /**\n     * Rotation via `LongestPath` will use the largest angle\n     * between the starting and ending points.\n     */\n    RotationType[\"LongestPath\"] = \"longest-path\";\n    /**\n     * Rotation via `Clockwise` will travel in a clockwise direction,\n     * regardless of the starting and ending points.\n     */\n    RotationType[\"Clockwise\"] = \"clockwise\";\n    /**\n     * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\n     * regardless of the starting and ending points.\n     */\n    RotationType[\"CounterClockwise\"] = \"counter-clockwise\";\n})(RotationType || (RotationType = {}));\n\n;// ./Math/lerp.ts\n\n\n/**\n * Linear interpolation between `a` and `b`, at `time = 0` the value will be `a` at `time = 1` the value will be `b`\n * @param a\n * @param b\n * @param time\n */\nfunction lerp(a, b, time) {\n    return (1 - time) * a + b * time;\n}\n/**\n * Linear interpolation between angles in radians\n * @param startAngleRadians\n * @param endAngleRadians\n * @param rotationType\n * @param time\n */\nfunction lerpAngle(startAngleRadians, endAngleRadians, rotationType, time) {\n    const shortestPathIsPositive = (startAngleRadians - endAngleRadians + TwoPI) % TwoPI >= Math.PI;\n    const distance1 = Math.abs(endAngleRadians - startAngleRadians);\n    const distance2 = TwoPI - distance1;\n    let shortDistance = 0;\n    let longDistance = 0;\n    if (distance1 > distance2) {\n        shortDistance = distance2;\n        longDistance = distance1;\n    }\n    else {\n        shortDistance = distance1;\n        longDistance = distance2;\n    }\n    let distance = 0;\n    let direction = 1;\n    switch (rotationType) {\n        case RotationType.ShortestPath:\n            distance = shortDistance;\n            direction = shortestPathIsPositive ? 1 : -1;\n            break;\n        case RotationType.LongestPath:\n            distance = longDistance;\n            direction = shortestPathIsPositive ? -1 : 1;\n            break;\n        case RotationType.Clockwise:\n            direction = 1;\n            distance = shortestPathIsPositive ? shortDistance : longDistance;\n            break;\n        case RotationType.CounterClockwise:\n            direction = -1;\n            distance = shortestPathIsPositive ? longDistance : shortDistance;\n            break;\n    }\n    return startAngleRadians + direction * (distance * time);\n}\n/**\n * Linear interpolation between `a` and `b`, at `time = 0` the value will be `a` at `time = 1` the value will be `b`\n * @param a\n * @param b\n * @param time\n */\nfunction lerpVector(a, b, time) {\n    return a.scale(1 - time).add(b.scale(time));\n}\n/**\n * Inverse of a linear interpolation, given a `value` in between `a` and `b` return how close to `a` or `b` the `value` is.\n *\n * Example: `a=1`, `b=5`, `value=4` will return `.75`\n * @param a\n * @param b\n * @param value\n */\nfunction inverseLerp(a, b, value) {\n    return (value - a) / (b - a);\n}\n/**\n * Inverse of a linear interpolation, given a `value` in between `a` and `b` return how close to `a` or `b` the `value` is.\n *\n * **Warning** assumes that the `value` vector is co-linear with vector `a` and `b`\n *\n * Example: `a=1`, `b=5`, `value=4` will return `.75`\n * @param a\n * @param b\n * @param value\n */\nfunction inverseLerpVector(a, b, value) {\n    const numerator = value.sub(a);\n    const denominator = b.sub(a);\n    const x = numerator.x / denominator.x;\n    const y = numerator.y / denominator.y;\n    return Math.min(x, y);\n}\n/**\n * Remaps a value from a source domain to a destination\n * @param minSource\n * @param maxSource\n * @param minDestination\n * @param maxDestination\n * @param value\n */\nfunction remap(minSource, maxSource, minDestination, maxDestination, value) {\n    const time = inverseLerp(minSource, maxSource, value);\n    return lerp(minDestination, maxDestination, time);\n}\n/**\n * Remaps a value from a source domain to a destination\n *\n * **Warning** assumes that the `value` vector is co-linear with vector `minSource` and `maxSource`\n * @param minSource\n * @param maxSource\n * @param minDestination\n * @param maxDestination\n * @param value\n */\nfunction remapVector(minSource, maxSource, minDestination, maxDestination, value) {\n    const time = inverseLerpVector(minSource, maxSource, value);\n    return lerpVector(minDestination, maxDestination, time);\n}\n\n;// ./Actions/Action/MoveBy.ts\n\n\n\n\n\n\n\n/**\n *\n */\nfunction isMoveByOptions(x) {\n    return x.offset instanceof Vector && typeof x.durationMs === 'number';\n}\nclass MoveByWithOptions {\n    constructor(entity, options) {\n        var _a;\n        this.entity = entity;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._easing = EasingFunctions.Linear;\n        this._offset = options.offset;\n        this._easing = (_a = options.easing) !== null && _a !== void 0 ? _a : this._easing;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);\n        }\n        this._durationMs = options.durationMs;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._start = this._tx.pos.clone();\n            this._end = this._start.add(this._offset);\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        const currentPos = this._tx.pos;\n        const newPosX = this._easing(t, this._start.x, this._end.x, 1);\n        const newPosY = this._easing(t, this._start.y, this._end.y, 1);\n        const velX = (newPosX - currentPos.x) / (elapsedMs / 1000);\n        const velY = (newPosY - currentPos.y) / (elapsedMs / 1000);\n        this._motion.vel.x = velX;\n        this._motion.vel.y = velY;\n        if (this.isComplete(this.entity)) {\n            this._tx.pos = vec(this._end.x, this._end.y);\n            this._motion.vel = vec(0, 0);\n        }\n    }\n    isComplete(entity) {\n        return this._stopped || this._currentMs < 0;\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n        this._currentMs = 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n}\nclass MoveBy {\n    constructor(entity, offsetX, offsetY, speed) {\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._entity = entity;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._speed = speed;\n        this._offset = new Vector(offsetX, offsetY);\n        if (speed <= 0) {\n            Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n            throw new Error('Speed must be greater than 0 pixels per second');\n        }\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n            this._end = this._start.add(this._offset);\n            this._distance = this._offset.magnitude;\n            this._dir = this._end.sub(this._start).normalize();\n        }\n        if (this.isComplete(this._entity)) {\n            this._tx.pos = vec(this._end.x, this._end.y);\n            this._motion.vel = vec(0, 0);\n        }\n        else {\n            this._motion.vel = this._dir.scale(this._speed);\n        }\n    }\n    isComplete(entity) {\n        const tx = entity.get(TransformComponent);\n        return this._stopped || tx.pos.distance(this._start) >= this._distance;\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Actions/Action/MoveTo.ts\n\n\n\n\n\n\n/**\n *\n */\nfunction isMoveToOptions(x) {\n    return x.pos instanceof Vector && typeof x.durationMs === 'number';\n}\nclass MoveToWithOptions {\n    constructor(entity, options) {\n        var _a;\n        this.entity = entity;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._easing = EasingFunctions.Linear;\n        this._end = options.pos;\n        this._easing = (_a = options.easing) !== null && _a !== void 0 ? _a : this._easing;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);\n        }\n        this._durationMs = options.durationMs;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._start = this._tx.pos.clone();\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        const currentPos = this._tx.pos;\n        const newPosX = this._easing(t, this._start.x, this._end.x, 1);\n        const newPosY = this._easing(t, this._start.y, this._end.y, 1);\n        const velX = (newPosX - currentPos.x) / (elapsedMs / 1000);\n        const velY = (newPosY - currentPos.y) / (elapsedMs / 1000);\n        this._motion.vel.x = velX;\n        this._motion.vel.y = velY;\n        if (this.isComplete(this.entity)) {\n            this._tx.pos = vec(this._end.x, this._end.y);\n            this._motion.vel = vec(0, 0);\n        }\n    }\n    isComplete(entity) {\n        return this._stopped || this._currentMs < 0;\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n        this._currentMs = 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n}\nclass MoveTo {\n    constructor(entity, destX, destY, speed) {\n        this.entity = entity;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._end = new Vector(destX, destY);\n        this._speed = speed;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n            this._distance = this._start.distance(this._end);\n            this._dir = this._end.sub(this._start).normalize();\n        }\n        const m = this._dir.scale(this._speed);\n        this._motion.vel = vec(m.x, m.y);\n        if (this.isComplete(this.entity)) {\n            this._tx.pos = vec(this._end.x, this._end.y);\n            this._motion.vel = vec(0, 0);\n        }\n    }\n    isComplete(entity) {\n        const tx = entity.get(TransformComponent);\n        return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Actions/Action/RotateTo.ts\n\n\n\n\n\n\n/**\n *\n */\nfunction isRotateToOptions(x) {\n    return typeof x.angleRadians === 'number' && typeof x.durationMs === 'number';\n}\nclass RotateToWithOptions {\n    constructor(entity, options) {\n        var _a;\n        this.entity = entity;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._endAngle = 0;\n        this._startAngle = 0;\n        this._endAngle = options.angleRadians;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);\n        }\n        this._durationMs = options.durationMs;\n        this._rotationType = (_a = options.rotationType) !== null && _a !== void 0 ? _a : RotationType.ShortestPath;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._startAngle = this._tx.rotation;\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        const newAngle = lerpAngle(this._startAngle, this._endAngle, this._rotationType, t);\n        const currentAngle = this._tx.rotation;\n        const rx = (newAngle - currentAngle) / (elapsedMs / 1000);\n        this._motion.angularVelocity = rx;\n        if (this.isComplete(this.entity)) {\n            this._tx.rotation = this._endAngle;\n            this._motion.angularVelocity = 0;\n        }\n    }\n    isComplete(entity) {\n        return this._stopped || this._currentMs < 0;\n    }\n    stop() {\n        this._motion.angularVelocity = 0;\n        this._stopped = true;\n        this._currentMs = 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n}\nclass RotateTo {\n    constructor(entity, angleRadians, speed, rotationType) {\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._end = angleRadians;\n        this._speed = speed;\n        this._rotationType = rotationType || RotationType.ShortestPath;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._start = this._tx.rotation;\n            this._currentNonCannonAngle = this._tx.rotation;\n            const distance1 = Math.abs(this._end - this._start);\n            const distance2 = TwoPI - distance1;\n            if (distance1 > distance2) {\n                this._shortDistance = distance2;\n                this._longDistance = distance1;\n            }\n            else {\n                this._shortDistance = distance1;\n                this._longDistance = distance2;\n            }\n            this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n            switch (this._rotationType) {\n                case RotationType.ShortestPath:\n                    this._distance = this._shortDistance;\n                    if (this._shortestPathIsPositive) {\n                        this._direction = 1;\n                    }\n                    else {\n                        this._direction = -1;\n                    }\n                    break;\n                case RotationType.LongestPath:\n                    this._distance = this._longDistance;\n                    if (this._shortestPathIsPositive) {\n                        this._direction = -1;\n                    }\n                    else {\n                        this._direction = 1;\n                    }\n                    break;\n                case RotationType.Clockwise:\n                    this._direction = 1;\n                    if (this._shortestPathIsPositive) {\n                        this._distance = this._shortDistance;\n                    }\n                    else {\n                        this._distance = this._longDistance;\n                    }\n                    break;\n                case RotationType.CounterClockwise:\n                    this._direction = -1;\n                    if (!this._shortestPathIsPositive) {\n                        this._distance = this._shortDistance;\n                    }\n                    else {\n                        this._distance = this._longDistance;\n                    }\n                    break;\n            }\n        }\n        this._motion.angularVelocity = this._direction * this._speed;\n        this._currentNonCannonAngle += this._direction * this._speed * (elapsedMs / 1000);\n        if (this.isComplete()) {\n            this._tx.rotation = this._end;\n            this._motion.angularVelocity = 0;\n            this._stopped = true;\n        }\n    }\n    isComplete() {\n        const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\n        return this._stopped || distanceTraveled >= Math.abs(this._distance);\n    }\n    stop() {\n        this._motion.angularVelocity = 0;\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Actions/Action/RotateBy.ts\n\n\n\n\n\n\n/**\n *\n */\nfunction isRotateByOptions(x) {\n    return typeof x.angleRadiansOffset === 'number' && typeof x.durationMs === 'number';\n}\nclass RotateByWithOptions {\n    constructor(entity, options) {\n        var _a;\n        this.entity = entity;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._offset = 0;\n        this._startAngle = 0;\n        this._endAngle = 0;\n        this._offset = options.angleRadiansOffset;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);\n        }\n        this._durationMs = options.durationMs;\n        this._rotationType = (_a = options.rotationType) !== null && _a !== void 0 ? _a : RotationType.ShortestPath;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._startAngle = this._tx.rotation;\n            this._endAngle = canonicalizeAngle(this._startAngle + this._offset);\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        const newAngle = lerpAngle(this._startAngle, this._endAngle, this._rotationType, t);\n        const currentAngle = this._tx.rotation;\n        const rx = (newAngle - currentAngle) / (elapsedMs / 1000);\n        this._motion.angularVelocity = rx;\n        if (this.isComplete()) {\n            this._tx.rotation = this._endAngle;\n            this._motion.angularVelocity = 0;\n        }\n    }\n    isComplete() {\n        return this._stopped || this._currentMs < 0;\n    }\n    stop() {\n        this._motion.angularVelocity = 0;\n        this._stopped = true;\n        this._currentMs = 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n}\nclass RotateBy {\n    constructor(entity, angleRadiansOffset, speed, rotationType) {\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._speed = speed;\n        this._offset = angleRadiansOffset;\n        this._rotationType = rotationType || RotationType.ShortestPath;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._start = this._tx.rotation;\n            this._currentNonCannonAngle = this._tx.rotation;\n            this._end = this._start + this._offset;\n            const distance1 = Math.abs(this._end - this._start);\n            const distance2 = TwoPI - distance1;\n            if (distance1 > distance2) {\n                this._shortDistance = distance2;\n                this._longDistance = distance1;\n            }\n            else {\n                this._shortDistance = distance1;\n                this._longDistance = distance2;\n            }\n            this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n            switch (this._rotationType) {\n                case RotationType.ShortestPath:\n                    this._distance = this._shortDistance;\n                    if (this._shortestPathIsPositive) {\n                        this._direction = 1;\n                    }\n                    else {\n                        this._direction = -1;\n                    }\n                    break;\n                case RotationType.LongestPath:\n                    this._distance = this._longDistance;\n                    if (this._shortestPathIsPositive) {\n                        this._direction = -1;\n                    }\n                    else {\n                        this._direction = 1;\n                    }\n                    break;\n                case RotationType.Clockwise:\n                    this._direction = 1;\n                    if (this._shortDistance >= 0) {\n                        this._distance = this._shortDistance;\n                    }\n                    else {\n                        this._distance = this._longDistance;\n                    }\n                    break;\n                case RotationType.CounterClockwise:\n                    this._direction = -1;\n                    if (this._shortDistance <= 0) {\n                        this._distance = this._shortDistance;\n                    }\n                    else {\n                        this._distance = this._longDistance;\n                    }\n                    break;\n            }\n        }\n        this._motion.angularVelocity = this._direction * this._speed;\n        this._currentNonCannonAngle += this._direction * this._speed * (elapsedMs / 1000);\n        if (this.isComplete()) {\n            this._tx.rotation = this._end;\n            this._motion.angularVelocity = 0;\n            this._stopped = true;\n        }\n    }\n    isComplete() {\n        const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\n        return this._stopped || distanceTraveled >= Math.abs(this._distance);\n    }\n    stop() {\n        this._motion.angularVelocity = 0;\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n        this._start = undefined;\n        this._currentNonCannonAngle = undefined;\n        this._distance = undefined;\n    }\n}\n\n;// ./Actions/Action/ScaleTo.ts\n\n\n\n\n\n/**\n *\n */\nfunction isScaleToOptions(x) {\n    return typeof x.scale === 'object' && typeof x.durationMs === 'number';\n}\nclass ScaleToWithOptions {\n    constructor(entity, options) {\n        this.entity = entity;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._endScale = vec(1, 1);\n        this._startScale = vec(1, 1);\n        this._endScale = options.scale;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);\n        }\n        this._durationMs = options.durationMs;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._startScale = this._tx.scale;\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        const newScale = lerpVector(this._startScale, this._endScale, t);\n        const currentScale = this._tx.scale;\n        const sx = newScale.sub(currentScale).scale(1 / (elapsedMs / 1000));\n        this._motion.scaleFactor = sx;\n        if (this.isComplete()) {\n            this._tx.scale = this._endScale;\n            this._motion.angularVelocity = 0;\n        }\n    }\n    isComplete() {\n        return this._stopped || this._currentMs < 0;\n    }\n    stop() {\n        this._motion.scaleFactor = Vector.Zero;\n        this._stopped = true;\n        this._currentMs = 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n}\nclass ScaleTo {\n    constructor(entity, scaleX, scaleY, speedX, speedY) {\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._endX = scaleX;\n        this._endY = scaleY;\n        this._speedX = speedX;\n        this._speedY = speedY;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._startX = this._tx.scale.x;\n            this._startY = this._tx.scale.y;\n            this._distanceX = Math.abs(this._endX - this._startX);\n            this._distanceY = Math.abs(this._endY - this._startY);\n        }\n        if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\n            const directionX = this._endY < this._startY ? -1 : 1;\n            this._motion.scaleFactor.x = this._speedX * directionX;\n        }\n        else {\n            this._motion.scaleFactor.x = 0;\n        }\n        if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\n            const directionY = this._endY < this._startY ? -1 : 1;\n            this._motion.scaleFactor.y = this._speedY * directionY;\n        }\n        else {\n            this._motion.scaleFactor.y = 0;\n        }\n        if (this.isComplete()) {\n            this._tx.scale = vec(this._endX, this._endY);\n            this._motion.scaleFactor.x = 0;\n            this._motion.scaleFactor.y = 0;\n        }\n    }\n    isComplete() {\n        return (this._stopped ||\n            (Math.abs(this._tx.scale.x - this._startX) >= this._distanceX - 0.01 &&\n                Math.abs(this._tx.scale.y - this._startY) >= this._distanceY - 0.01));\n    }\n    stop() {\n        this._motion.scaleFactor.x = 0;\n        this._motion.scaleFactor.y = 0;\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Actions/Action/ScaleBy.ts\n\n\n\n\n\n/**\n *\n */\nfunction isScaleByOptions(x) {\n    return typeof x.scaleOffset === 'object' && typeof x.durationMs === 'number';\n}\nclass ScaleByWithOptions {\n    constructor(entity, options) {\n        this.entity = entity;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._endScale = vec(1, 1);\n        this._scaleOffset = vec(0, 0);\n        this._startScale = vec(1, 1);\n        this._scaleOffset = options.scaleOffset;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);\n        }\n        this._durationMs = options.durationMs;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._startScale = this._tx.scale;\n            this._endScale = this._startScale.add(this._scaleOffset);\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        const newScale = lerpVector(this._startScale, this._endScale, t);\n        const currentScale = this._tx.scale;\n        const sx = newScale.sub(currentScale).scale(1 / (elapsedMs / 1000));\n        this._motion.scaleFactor = sx;\n        if (this.isComplete()) {\n            this._tx.scale = this._endScale;\n            this._motion.angularVelocity = 0;\n        }\n    }\n    isComplete() {\n        return this._stopped || this._currentMs < 0;\n    }\n    stop() {\n        this._motion.scaleFactor = Vector.Zero;\n        this._stopped = true;\n        this._currentMs = 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n}\nclass ScaleBy {\n    constructor(entity, scaleOffsetX, scaleOffsetY, speed) {\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n        this._speedX = this._speedY = speed;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._startScale = this._tx.scale.clone();\n            this._endScale = this._startScale.add(this._offset);\n            this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n            this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n            this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n            this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n        }\n        this._motion.scaleFactor.x = this._speedX * this._directionX;\n        this._motion.scaleFactor.y = this._speedY * this._directionY;\n        if (this.isComplete()) {\n            this._tx.scale = this._endScale;\n            this._motion.scaleFactor.x = 0;\n            this._motion.scaleFactor.y = 0;\n        }\n    }\n    isComplete() {\n        return (this._stopped ||\n            (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX - 0.01 &&\n                Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY - 0.01));\n    }\n    stop() {\n        this._motion.scaleFactor.x = 0;\n        this._motion.scaleFactor.y = 0;\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Actions/Action/CallMethod.ts\n\nclass CallMethod {\n    constructor(method) {\n        this.id = nextActionId();\n        this._hasBeenCalled = false;\n        this._method = method;\n    }\n    update(elapsedMs) {\n        this._method();\n        this._hasBeenCalled = true;\n    }\n    isComplete() {\n        return this._hasBeenCalled;\n    }\n    reset() {\n        this._hasBeenCalled = false;\n    }\n    stop() {\n        this._hasBeenCalled = true;\n    }\n}\n\n;// ./Actions/Action/EaseTo.ts\n\n\n\n\n/**\n * @deprecated use moveTo({pos: Vector, durationMs: number, easing: EasingFunction})\n */\nclass EaseTo {\n    constructor(entity, x, y, duration, easingFcn) {\n        this.easingFcn = easingFcn;\n        this.id = nextActionId();\n        this._currentLerpTime = 0;\n        this._lerpDuration = 1 * 1000; // 1 second\n        this._lerpStart = new Vector(0, 0);\n        this._lerpEnd = new Vector(0, 0);\n        this._initialized = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._lerpDuration = duration;\n        this._lerpEnd = new Vector(x, y);\n    }\n    _initialize() {\n        this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\n        this._currentLerpTime = 0;\n    }\n    update(elapsedMs) {\n        if (!this._initialized) {\n            this._initialize();\n            this._initialized = true;\n        }\n        // Need to update lerp time first, otherwise the first update will always be zero\n        this._currentLerpTime += elapsedMs;\n        let newX = this._tx.pos.x;\n        let newY = this._tx.pos.y;\n        if (this._currentLerpTime < this._lerpDuration) {\n            if (this._lerpEnd.x < this._lerpStart.x) {\n                newX =\n                    this._lerpStart.x -\n                        (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n            }\n            else {\n                newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n            }\n            if (this._lerpEnd.y < this._lerpStart.y) {\n                newY =\n                    this._lerpStart.y -\n                        (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n            }\n            else {\n                newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n            }\n            // Given the lerp position figure out the velocity in pixels per second\n            this._motion.vel = vec((newX - this._tx.pos.x) / (elapsedMs / 1000), (newY - this._tx.pos.y) / (elapsedMs / 1000));\n        }\n        else {\n            this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\n            this._motion.vel = Vector.Zero;\n        }\n    }\n    isComplete() {\n        return this._stopped || this._currentLerpTime >= this._lerpDuration;\n    }\n    reset() {\n        this._initialized = false;\n        this._stopped = false;\n        this._currentLerpTime = 0;\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n    }\n}\n\n;// ./Actions/Action/EaseBy.ts\n\n\n\n\n/**\n * @deprecated use moveBy({offset: Vector, durationMs: number, easing: EasingFunction})\n */\nclass EaseBy {\n    constructor(entity, offsetX, offsetY, duration, easingFcn) {\n        this.easingFcn = easingFcn;\n        this.id = nextActionId();\n        this._currentLerpTime = 0;\n        this._lerpDuration = 1 * 1000; // 1 second\n        this._lerpStart = new Vector(0, 0);\n        this._lerpEnd = new Vector(0, 0);\n        this._initialized = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._lerpDuration = duration;\n        this._offset = new Vector(offsetX, offsetY);\n    }\n    _initialize() {\n        this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\n        this._currentLerpTime = 0;\n        this._lerpEnd = this._lerpStart.add(this._offset);\n    }\n    update(elapsedMs) {\n        if (!this._initialized) {\n            this._initialize();\n            this._initialized = true;\n        }\n        // Need to update lerp time first, otherwise the first update will always be zero\n        this._currentLerpTime += elapsedMs;\n        let newX = this._tx.pos.x;\n        let newY = this._tx.pos.y;\n        if (this._currentLerpTime < this._lerpDuration) {\n            if (this._lerpEnd.x < this._lerpStart.x) {\n                newX =\n                    this._lerpStart.x -\n                        (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n            }\n            else {\n                newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n            }\n            if (this._lerpEnd.y < this._lerpStart.y) {\n                newY =\n                    this._lerpStart.y -\n                        (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n            }\n            else {\n                newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n            }\n            // Given the lerp position figure out the velocity in pixels per second\n            this._motion.vel = vec((newX - this._tx.pos.x) / (elapsedMs / 1000), (newY - this._tx.pos.y) / (elapsedMs / 1000));\n        }\n        else {\n            this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\n            this._motion.vel = Vector.Zero;\n        }\n    }\n    isComplete() {\n        return this._stopped || this._currentLerpTime >= this._lerpDuration;\n    }\n    reset() {\n        this._initialized = false;\n        this._stopped = false;\n        this._currentLerpTime = 0;\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n    }\n}\n\n;// ./Actions/Action/Blink.ts\n\n\nclass Blink {\n    constructor(entity, timeVisible, timeNotVisible, numBlinks = 1) {\n        this.id = nextActionId();\n        this._timeVisible = 0;\n        this._timeNotVisible = 0;\n        this._elapsedTime = 0;\n        this._totalTime = 0;\n        this._stopped = false;\n        this._started = false;\n        this._graphics = entity.get(GraphicsComponent);\n        this._timeVisible = timeVisible;\n        this._timeNotVisible = timeNotVisible;\n        this._duration = (timeVisible + timeNotVisible) * numBlinks;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._elapsedTime = 0;\n            this._totalTime = 0;\n        }\n        if (!this._graphics) {\n            return;\n        }\n        this._elapsedTime += elapsedMs;\n        this._totalTime += elapsedMs;\n        if (this._graphics.isVisible && this._elapsedTime >= this._timeVisible) {\n            this._graphics.isVisible = false;\n            this._elapsedTime = 0;\n        }\n        if (!this._graphics.isVisible && this._elapsedTime >= this._timeNotVisible) {\n            this._graphics.isVisible = true;\n            this._elapsedTime = 0;\n        }\n        if (this.isComplete()) {\n            this._graphics.isVisible = true;\n        }\n    }\n    isComplete() {\n        return this._stopped || this._totalTime >= this._duration;\n    }\n    stop() {\n        if (this._graphics) {\n            this._graphics.isVisible = true;\n        }\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n        this._elapsedTime = 0;\n        this._totalTime = 0;\n    }\n}\n\n;// ./Actions/Action/Fade.ts\n\n\n\nclass Fade {\n    constructor(entity, endOpacity, durationMs) {\n        this.id = nextActionId();\n        this._multiplier = 1;\n        this._started = false;\n        this._stopped = false;\n        this._graphics = entity.get(GraphicsComponent);\n        this._endOpacity = endOpacity;\n        this._remainingTime = this._originalTime = durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._graphics) {\n            return;\n        }\n        if (!this._started) {\n            this._started = true;\n            this._remainingTime = this._originalTime;\n            // determine direction when we start\n            if (this._endOpacity < this._graphics.opacity) {\n                this._multiplier = -1;\n            }\n            else {\n                this._multiplier = 1;\n            }\n        }\n        if (this._remainingTime > 0) {\n            this._graphics.opacity +=\n                (this._multiplier * (Math.abs(this._graphics.opacity - this._endOpacity) * elapsedMs)) / this._remainingTime;\n        }\n        this._remainingTime -= elapsedMs;\n        if (this.isComplete()) {\n            this._graphics.opacity = this._endOpacity;\n        }\n        Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\n    }\n    isComplete() {\n        return this._stopped || this._remainingTime <= 0;\n    }\n    stop() {\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n        this._remainingTime = this._originalTime;\n    }\n}\n\n;// ./Actions/Action/Delay.ts\n\nclass Delay {\n    constructor(durationMs) {\n        this.id = nextActionId();\n        this._elapsedTime = 0;\n        this._started = false;\n        this._stopped = false;\n        this._delay = durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n        }\n        this._elapsedTime += elapsedMs;\n    }\n    isComplete() {\n        return this._stopped || this._elapsedTime >= this._delay;\n    }\n    stop() {\n        this._stopped = true;\n    }\n    reset() {\n        this._elapsedTime = 0;\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Actions/Action/Die.ts\n\n\nclass Die {\n    constructor(entity) {\n        this.id = nextActionId();\n        this._stopped = false;\n        this._entity = entity;\n    }\n    update(elapsedMs) {\n        this._entity.get(ActionsComponent).clearActions();\n        this._entity.kill();\n        this._stopped = true;\n    }\n    isComplete() {\n        return this._stopped;\n    }\n    stop() {\n        return;\n    }\n    reset() {\n        return;\n    }\n}\n\n;// ./Actions/Action/Follow.ts\n\n\n\n\nclass Follow {\n    constructor(entity, entityToFollow, followDistance) {\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._tx = entity.get(TransformComponent);\n        this._motion = entity.get(MotionComponent);\n        this._followTx = entityToFollow.get(TransformComponent);\n        this._followMotion = entityToFollow.get(MotionComponent);\n        this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n        this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\n        this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n        this._speed = 0;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._distanceBetween = this._current.distance(this._end);\n            this._dir = this._end.sub(this._current).normalize();\n        }\n        const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\n        if (actorToFollowSpeed !== 0) {\n            this._speed = actorToFollowSpeed;\n        }\n        this._current = vec(this._tx.pos.x, this._tx.pos.y);\n        this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\n        this._distanceBetween = this._current.distance(this._end);\n        this._dir = this._end.sub(this._current).normalize();\n        if (this._distanceBetween >= this._maximumDistance) {\n            const m = this._dir.scale(this._speed);\n            this._motion.vel = vec(m.x, m.y);\n        }\n        else {\n            this._motion.vel = vec(0, 0);\n        }\n        if (this.isComplete()) {\n            this._tx.pos = vec(this._end.x, this._end.y);\n            this._motion.vel = vec(0, 0);\n        }\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n    }\n    isComplete() {\n        // the actor following should never stop unless specified to do so\n        return this._stopped;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Actions/Action/Meet.ts\n\n\n\n\nclass Meet {\n    constructor(actor, actorToMeet, speed) {\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._speedWasSpecified = false;\n        this._tx = actor.get(TransformComponent);\n        this._motion = actor.get(MotionComponent);\n        this._meetTx = actorToMeet.get(TransformComponent);\n        this._meetMotion = actorToMeet.get(MotionComponent);\n        this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n        this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\n        this._speed = speed || 0;\n        if (speed !== undefined) {\n            this._speedWasSpecified = true;\n        }\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._started = true;\n            this._distanceBetween = this._current.distance(this._end);\n            this._dir = this._end.sub(this._current).normalize();\n        }\n        const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\n        if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n            this._speed = actorToMeetSpeed;\n        }\n        this._current = vec(this._tx.pos.x, this._tx.pos.y);\n        this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\n        this._distanceBetween = this._current.distance(this._end);\n        this._dir = this._end.sub(this._current).normalize();\n        const m = this._dir.scale(this._speed);\n        this._motion.vel = vec(m.x, m.y);\n        if (this.isComplete()) {\n            this._tx.pos = vec(this._end.x, this._end.y);\n            this._motion.vel = vec(0, 0);\n        }\n    }\n    isComplete() {\n        return this._stopped || this._distanceBetween <= 1;\n    }\n    stop() {\n        this._motion.vel = vec(0, 0);\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n        this._distanceBetween = Infinity;\n    }\n}\n\n;// ./Actions/Action/Flash.ts\n\n\nclass Flash {\n    constructor(entity, color, durationMs = 1000) {\n        var _a;\n        this.id = nextActionId();\n        this._stopped = false;\n        this._started = false;\n        this._total = 0;\n        this._currentDuration = 0;\n        this._graphics = entity.get(GraphicsComponent);\n        this._duration = durationMs;\n        this._entity = entity;\n        this._material = (_a = entity.scene) === null || _a === void 0 ? void 0 : _a.engine.graphicsContext.createMaterial({\n            name: 'flash-material',\n            color,\n            fragmentSource: `#version 300 es\n    \n        precision mediump float;\n        uniform float u_blend;\n        uniform sampler2D u_graphic;\n        uniform vec4 u_color;\n    \n        in vec2 v_uv; \n        out vec4 color;\n    \n        void main() { \n            vec4 textureColor = texture(u_graphic, v_uv); \n            color = mix(textureColor, u_color, u_blend * textureColor.a);\n            color.rgb = color.rgb * color.a;\n        }`\n        });\n        this._total = durationMs;\n    }\n    update(elapsedMs) {\n        var _a;\n        if (!this._started) {\n            this._started = true;\n            this._total = this._duration;\n            this._currentDuration = this._duration;\n            this._entity.graphics.material = this._material;\n        }\n        if (!this._graphics) {\n            return;\n        }\n        this._currentDuration -= elapsedMs;\n        if (this._graphics) {\n            (_a = this._material) === null || _a === void 0 ? void 0 : _a.update((shader) => {\n                shader.trySetUniformFloat('u_blend', this._currentDuration / this._total);\n            });\n        }\n        if (this.isComplete()) {\n            this._entity.graphics.material = null;\n        }\n    }\n    isComplete() {\n        return this._stopped || this._currentDuration <= 0;\n    }\n    stop() {\n        if (this._graphics) {\n            this._graphics.isVisible = true;\n        }\n        this._stopped = true;\n    }\n    reset() {\n        this._started = false;\n        this._stopped = false;\n    }\n}\n\n;// ./Math/bezier-curve.ts\n\n/**\n * BezierCurve that supports cubic Bezier curves.\n */\nclass BezierCurve {\n    constructor(options) {\n        var _a;\n        // Thanks Freya! https://www.youtube.com/watch?v=aVwxzDHniEw\n        this._distLookup = [];\n        this.quality = 4;\n        if (options.controlPoints.length !== 4) {\n            throw new Error('Only cubic bezier curves are supported');\n        }\n        this._controlPoints = [...options.controlPoints];\n        this.quality = (_a = options.quality) !== null && _a !== void 0 ? _a : this.quality;\n        this._calculateLookup();\n    }\n    get arcLength() {\n        return this._arcLength;\n    }\n    get controlPoints() {\n        return this._controlPoints;\n    }\n    set controlPoints(points) {\n        this._controlPoints = [...points];\n        this._calculateLookup();\n    }\n    setControlPoint(index, point) {\n        this._controlPoints[index] = point;\n        this._calculateLookup();\n    }\n    _calculateLookup() {\n        let totalLength = 0;\n        this._distLookup.length = 0;\n        let prev = this.controlPoints[0];\n        const n = this.controlPoints.length * this.quality;\n        for (let i = 0; i < n; i++) {\n            const t = i / (n - 1);\n            const pt = this.getPoint(t);\n            const diff = prev.distance(pt);\n            totalLength += diff;\n            this._distLookup.push(totalLength);\n            prev = pt;\n        }\n        this._arcLength = totalLength;\n    }\n    _getTimeGivenDistance(distance) {\n        const n = this._distLookup.length;\n        const arcLength = this.arcLength;\n        if (distance >= 0 && distance < arcLength) {\n            for (let i = 0; i < n - 1; i++) {\n                if (this._distLookup[i] <= distance && distance < this._distLookup[i + 1]) {\n                    return remap(this._distLookup[i], this._distLookup[i + 1], i / (n - 1), (i + 1) / (n - 1), distance);\n                }\n            }\n        }\n        return distance / arcLength;\n    }\n    /**\n     * Get the point on the Bezier curve at a certain time\n     * @param time Between 0-1\n     */\n    getPoint(time) {\n        const points = [...this.controlPoints];\n        for (let r = 1; r < points.length; r++) {\n            for (let i = 0; i < points.length - r; i++) {\n                points[i] = lerpVector(points[i], points[i + 1], time);\n            }\n        }\n        return points[0];\n    }\n    /**\n     * Get the tangent of the Bezier curve at a certain time\n     * @param time Between 0-1\n     */\n    getTangent(time) {\n        const timeSquared = time * time;\n        const p0 = this.controlPoints[0];\n        const p1 = this.controlPoints[1];\n        const p2 = this.controlPoints[2];\n        const p3 = this.controlPoints[3];\n        // Derivative of Bernstein polynomial\n        const pPrime = p0\n            .scale(-3 * timeSquared + 6 * time - 3)\n            .add(p1.scale(9 * timeSquared - 12 * time + 3).add(p2.scale(-9 * timeSquared + 6 * time).add(p3.scale(3 * timeSquared))));\n        return pPrime.normalize();\n    }\n    /**\n     * Get the tangent of the Bezier curve where the distance is uniformly distributed over time\n     * @param time\n     */\n    getUniformTangent(time) {\n        const desiredDistance = time * this.arcLength;\n        const uniformTime = this._getTimeGivenDistance(desiredDistance);\n        return this.getTangent(uniformTime);\n    }\n    /**\n     * Get the normal of the Bezier curve at a certain time\n     * @param time Between 0-1\n     */\n    getNormal(time) {\n        return this.getTangent(time).normal();\n    }\n    /**\n     * Get the normal of the Bezier curve where the distance is uniformly distributed over time\n     * @param time\n     */\n    getUniformNormal(time) {\n        return this.getUniformTangent(time).normal();\n    }\n    /**\n     * Points are spaced uniformly across the length of the curve over time\n     * @param time\n     */\n    getUniformPoint(time) {\n        const desiredDistance = time * this.arcLength;\n        const uniformTime = this._getTimeGivenDistance(desiredDistance);\n        return this.getPoint(uniformTime);\n    }\n    clone() {\n        return new BezierCurve({\n            controlPoints: [...this.controlPoints],\n            quality: this.quality\n        });\n    }\n}\n\n;// ./Actions/Action/CurveTo.ts\n\n\n\nclass CurveTo {\n    constructor(entity, options) {\n        var _a;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._mode = 'dynamic';\n        this._entity = entity;\n        this._tx = this._entity.get(TransformComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);\n        }\n        this._curve = new BezierCurve({\n            controlPoints: [vec(0, 0), ...options.controlPoints],\n            quality: options.quality\n        });\n        this._durationMs = options.durationMs;\n        this._mode = (_a = options.mode) !== null && _a !== void 0 ? _a : this._mode;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._curve.setControlPoint(0, this._tx.globalPos.clone());\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        if (this._mode === 'dynamic') {\n            this._tx.pos = this._curve.getPoint(t);\n        }\n        else {\n            this._tx.pos = this._curve.getUniformPoint(t);\n        }\n        if (this.isComplete(this._entity)) {\n            if (this._mode === 'dynamic') {\n                this._tx.pos = this._curve.getPoint(1);\n            }\n            else {\n                this._tx.pos = this._curve.getUniformPoint(1);\n            }\n        }\n    }\n    isComplete(entity) {\n        return this._stopped || this._currentMs < 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n    stop() {\n        this._stopped = true;\n        this._currentMs = 0;\n    }\n}\n\n;// ./Actions/Action/CurveBy.ts\n\n\n\nclass CurveBy {\n    constructor(entity, options) {\n        var _a;\n        this.id = nextActionId();\n        this._started = false;\n        this._stopped = false;\n        this._mode = 'dynamic';\n        this._entity = entity;\n        this._tx = this._entity.get(TransformComponent);\n        if (!this._tx) {\n            throw new Error(`Entity ${entity.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);\n        }\n        this._curve = this._curve = new BezierCurve({\n            controlPoints: [vec(0, 0), ...options.controlPoints],\n            quality: options.quality\n        });\n        this._durationMs = options.durationMs;\n        this._mode = (_a = options.mode) !== null && _a !== void 0 ? _a : this._mode;\n        this._currentMs = this._durationMs;\n    }\n    update(elapsedMs) {\n        if (!this._started) {\n            this._curve.setControlPoint(0, this._tx.globalPos);\n            this._curve.setControlPoint(1, this._curve.controlPoints[1].add(this._tx.globalPos));\n            this._curve.setControlPoint(2, this._curve.controlPoints[2].add(this._tx.globalPos));\n            this._curve.setControlPoint(3, this._curve.controlPoints[3].add(this._tx.globalPos));\n            this._started = true;\n        }\n        this._currentMs -= elapsedMs;\n        const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\n        if (this._mode === 'dynamic') {\n            this._tx.pos = this._curve.getPoint(t);\n        }\n        else {\n            this._tx.pos = this._curve.getUniformPoint(t);\n        }\n        if (this.isComplete(this._entity)) {\n            if (this._mode === 'dynamic') {\n                this._tx.pos = this._curve.getPoint(1);\n            }\n            else {\n                this._tx.pos = this._curve.getUniformPoint(1);\n            }\n        }\n    }\n    isComplete(entity) {\n        return this._stopped || this._currentMs < 0;\n    }\n    reset() {\n        this._currentMs = this._durationMs;\n        this._started = false;\n        this._stopped = false;\n    }\n    stop() {\n        this._stopped = true;\n    }\n}\n\n;// ./Actions/ActionContext.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * The fluent Action API allows you to perform \"actions\" on\n * {@apilink Actor | `actors`} such as following, moving, rotating, and\n * more. You can implement your own actions by implementing\n * the {@apilink Action} interface.\n */\nclass ActionContext {\n    constructor(entity) {\n        this._entity = entity;\n        this._queue = new ActionQueue(entity);\n    }\n    getQueue() {\n        return this._queue;\n    }\n    update(elapsedMs) {\n        this._queue.update(elapsedMs);\n    }\n    /**\n     * Clears all queued actions from the Actor\n     */\n    clearActions() {\n        this._queue.clearActions();\n    }\n    runAction(action) {\n        action.reset();\n        this._queue.add(action);\n        return this;\n    }\n    /**\n     * Animates an actor with a specified bezier curve by an offset to the current position, the start point is assumed\n     * to be the actors current position\n     * @param options\n     */\n    curveBy(options) {\n        this._queue.add(new CurveBy(this._entity, options));\n        return this;\n    }\n    /**\n     * Animates an actor with a specified bezier curve to an absolute world space coordinate, the start point is assumed\n     * to be the actors current position\n     * @param options\n     */\n    curveTo(options) {\n        this._queue.add(new CurveTo(this._entity, options));\n        return this;\n    }\n    easeTo(...args) {\n        var _a, _b;\n        let x = 0;\n        let y = 0;\n        let duration = 0;\n        let easingFcn = EasingFunctions.Linear;\n        if (args[0] instanceof Vector) {\n            x = args[0].x;\n            y = args[0].y;\n            duration = args[1];\n            easingFcn = (_a = args[2]) !== null && _a !== void 0 ? _a : easingFcn;\n        }\n        else {\n            x = args[0];\n            y = args[1];\n            duration = args[2];\n            easingFcn = (_b = args[3]) !== null && _b !== void 0 ? _b : easingFcn;\n        }\n        this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\n        return this;\n    }\n    easeBy(...args) {\n        var _a, _b;\n        let offsetX = 0;\n        let offsetY = 0;\n        let duration = 0;\n        let easingFcn = EasingFunctions.Linear;\n        if (args[0] instanceof Vector) {\n            offsetX = args[0].x;\n            offsetY = args[0].y;\n            duration = args[1];\n            easingFcn = (_a = args[2]) !== null && _a !== void 0 ? _a : easingFcn;\n        }\n        else {\n            offsetX = args[0];\n            offsetY = args[1];\n            duration = args[2];\n            easingFcn = (_b = args[3]) !== null && _b !== void 0 ? _b : easingFcn;\n        }\n        this._queue.add(new EaseBy(this._entity, offsetX, offsetY, duration, easingFcn));\n        return this;\n    }\n    moveTo(xOrPosOrOptions, yOrSpeed, speedOrUndefined) {\n        let x = 0;\n        let y = 0;\n        let speed = 0;\n        if (xOrPosOrOptions instanceof Vector) {\n            x = xOrPosOrOptions.x;\n            y = xOrPosOrOptions.y;\n            speed = +(yOrSpeed !== null && yOrSpeed !== void 0 ? yOrSpeed : 0);\n            this._queue.add(new MoveTo(this._entity, x, y, speed));\n        }\n        else if (typeof xOrPosOrOptions === 'number' && typeof yOrSpeed === 'number' && typeof speedOrUndefined === 'number') {\n            x = xOrPosOrOptions;\n            y = yOrSpeed;\n            speed = speedOrUndefined;\n            this._queue.add(new MoveTo(this._entity, x, y, speed));\n        }\n        else if (isMoveToOptions(xOrPosOrOptions)) {\n            this._queue.add(new MoveToWithOptions(this._entity, xOrPosOrOptions));\n        }\n        return this;\n    }\n    moveBy(xOffsetOrVectorOrOptions, yOffsetOrSpeed, speedOrUndefined) {\n        let xOffset = 0;\n        let yOffset = 0;\n        let speed = 0;\n        if (xOffsetOrVectorOrOptions instanceof Vector && typeof yOffsetOrSpeed === 'number') {\n            xOffset = xOffsetOrVectorOrOptions.x;\n            yOffset = xOffsetOrVectorOrOptions.y;\n            speed = yOffsetOrSpeed;\n            this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\n        }\n        else if (typeof xOffsetOrVectorOrOptions === 'number' && typeof yOffsetOrSpeed === 'number' && typeof speedOrUndefined === 'number') {\n            xOffset = xOffsetOrVectorOrOptions;\n            yOffset = yOffsetOrSpeed;\n            speed = speedOrUndefined;\n            this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\n        }\n        else if (isMoveByOptions(xOffsetOrVectorOrOptions)) {\n            this._queue.add(new MoveByWithOptions(this._entity, xOffsetOrVectorOrOptions));\n        }\n        return this;\n    }\n    rotateTo(angleRadiansOrOptions, speed, rotationType) {\n        if (typeof angleRadiansOrOptions === 'number' && typeof speed === 'number') {\n            this._queue.add(new RotateTo(this._entity, angleRadiansOrOptions, speed, rotationType));\n        }\n        else if (typeof angleRadiansOrOptions === 'object') {\n            this._queue.add(new RotateToWithOptions(this._entity, angleRadiansOrOptions));\n        }\n        return this;\n    }\n    rotateBy(angleRadiansOffsetOrOptions, speed, rotationType) {\n        if (typeof angleRadiansOffsetOrOptions === 'object') {\n            this._queue.add(new RotateByWithOptions(this._entity, angleRadiansOffsetOrOptions));\n        }\n        else {\n            this._queue.add(new RotateBy(this._entity, angleRadiansOffsetOrOptions, speed, rotationType));\n        }\n        return this;\n    }\n    scaleTo(sizeXOrVectorOrOptions, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined) {\n        let sizeX = 1;\n        let sizeY = 1;\n        let speedX = 0;\n        let speedY = 0;\n        if (isScaleToOptions(sizeXOrVectorOrOptions)) {\n            this._queue.add(new ScaleToWithOptions(this._entity, sizeXOrVectorOrOptions));\n            return this;\n        }\n        if (sizeXOrVectorOrOptions instanceof Vector && sizeYOrSpeed instanceof Vector) {\n            sizeX = sizeXOrVectorOrOptions.x;\n            sizeY = sizeXOrVectorOrOptions.y;\n            speedX = sizeYOrSpeed.x;\n            speedY = sizeYOrSpeed.y;\n        }\n        if (typeof sizeXOrVectorOrOptions === 'number' && typeof sizeYOrSpeed === 'number') {\n            sizeX = sizeXOrVectorOrOptions;\n            sizeY = sizeYOrSpeed;\n            speedX = speedXOrUndefined;\n            speedY = speedYOrUndefined;\n        }\n        this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\n        return this;\n    }\n    scaleBy(sizeOffsetXOrVectorOrOptions, sizeOffsetYOrSpeed, speed) {\n        if (isScaleByOptions(sizeOffsetXOrVectorOrOptions)) {\n            this._queue.add(new ScaleByWithOptions(this._entity, sizeOffsetXOrVectorOrOptions));\n            return this;\n        }\n        let sizeOffsetX = 1;\n        let sizeOffsetY = 1;\n        if (sizeOffsetXOrVectorOrOptions instanceof Vector) {\n            sizeOffsetX = sizeOffsetXOrVectorOrOptions.x;\n            sizeOffsetY = sizeOffsetXOrVectorOrOptions.y;\n            speed = sizeOffsetYOrSpeed;\n        }\n        if (typeof sizeOffsetXOrVectorOrOptions === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\n            sizeOffsetX = sizeOffsetXOrVectorOrOptions;\n            sizeOffsetY = sizeOffsetYOrSpeed;\n        }\n        this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\n        return this;\n    }\n    /**\n     * This method will cause an actor to blink (become visible and not\n     * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n     * the actor should be visible per blink, and the amount of time not visible.\n     * This method is part of the actor 'Action' fluent API allowing action chaining.\n     * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n     * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n     * @param numBlinks       The number of times to blink\n     */\n    blink(timeVisible, timeNotVisible, numBlinks = 1) {\n        this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\n        return this;\n    }\n    /**\n     * This method will cause an actor's opacity to change from its current value\n     * to the provided value by a specified time (in milliseconds). This method is\n     * part of the actor 'Action' fluent API allowing action chaining.\n     * @param opacity  The ending opacity\n     * @param durationMs     The time it should take to fade the actor (in milliseconds)\n     */\n    fade(opacity, durationMs) {\n        this._queue.add(new Fade(this._entity, opacity, durationMs));\n        return this;\n    }\n    /**\n     * This will cause an actor to flash a specific color for a period of time\n     * @param color\n     * @param durationMs The duration in milliseconds\n     */\n    flash(color, durationMs = 1000) {\n        this._queue.add(new Flash(this._entity, color, durationMs));\n        return this;\n    }\n    /**\n     * This method will delay the next action from executing for a certain\n     * amount of time (in milliseconds). This method is part of the actor\n     * 'Action' fluent API allowing action chaining.\n     * @param durationMs  The amount of time to delay the next action in the queue from executing in milliseconds\n     */\n    delay(durationMs) {\n        this._queue.add(new Delay(durationMs));\n        return this;\n    }\n    /**\n     * This method will add an action to the queue that will remove the actor from the\n     * scene once it has completed its previous  Any actions on the\n     * action queue after this action will not be executed.\n     */\n    die() {\n        this._queue.add(new Die(this._entity));\n        return this;\n    }\n    /**\n     * This method allows you to call an arbitrary method as the next action in the\n     * action queue. This is useful if you want to execute code in after a specific\n     * action, i.e An actor arrives at a destination after traversing a path\n     */\n    callMethod(method) {\n        this._queue.add(new CallMethod(method));\n        return this;\n    }\n    /**\n     * This method will cause the actor to repeat all of the actions built in\n     * the `repeatBuilder` callback. If the number of repeats\n     * is not specified it will repeat forever. This method is part of\n     * the actor 'Action' fluent API allowing action chaining\n     *\n     * ```typescript\n     * // Move up in a zig-zag by repeated moveBy's\n     * actor.actions.repeat(repeatCtx => {\n     * repeatCtx.moveBy(10, 0, 10);\n     * repeatCtx.moveBy(0, 10, 10);\n     * }, 5);\n     * ```\n     * @param repeatBuilder The builder to specify the repeatable list of actions\n     * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n     * will repeat forever\n     */\n    repeat(repeatBuilder, times) {\n        if (!times) {\n            this.repeatForever(repeatBuilder);\n            return this;\n        }\n        this._queue.add(new Repeat(this._entity, repeatBuilder, times));\n        return this;\n    }\n    /**\n     * This method will cause the actor to repeat all of the actions built in\n     * the `repeatBuilder` callback. If the number of repeats\n     * is not specified it will repeat forever. This method is part of\n     * the actor 'Action' fluent API allowing action chaining\n     *\n     * ```typescript\n     * // Move up in a zig-zag by repeated moveBy's\n     * actor.actions.repeat(repeatCtx => {\n     * repeatCtx.moveBy(10, 0, 10);\n     * repeatCtx.moveBy(0, 10, 10);\n     * }, 5);\n     * ```\n     * @param repeatBuilder The builder to specify the repeatable list of actions\n     */\n    repeatForever(repeatBuilder) {\n        this._queue.add(new RepeatForever(this._entity, repeatBuilder));\n        return this;\n    }\n    /**\n     * This method will cause the entity to follow another at a specified distance\n     * @param entity           The entity to follow\n     * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n     */\n    follow(entity, followDistance) {\n        if (followDistance === undefined) {\n            this._queue.add(new Follow(this._entity, entity));\n        }\n        else {\n            this._queue.add(new Follow(this._entity, entity, followDistance));\n        }\n        return this;\n    }\n    /**\n     * This method will cause the entity to move towards another until they\n     * collide \"meet\" at a specified speed.\n     * @param entity  The entity to meet\n     * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n     */\n    meet(entity, speed) {\n        if (speed === undefined) {\n            this._queue.add(new Meet(this._entity, entity));\n        }\n        else {\n            this._queue.add(new Meet(this._entity, entity, speed));\n        }\n        return this;\n    }\n    /**\n     * Returns a promise that resolves when the current action queue up to now\n     * is finished.\n     */\n    toPromise() {\n        const temp = new Promise((resolve) => {\n            this._queue.add(new CallMethod(() => {\n                resolve();\n            }));\n        });\n        return temp;\n    }\n}\n\n;// ./Actions/ActionsComponent.ts\n\n\n\n\nclass ActionsComponent extends Component {\n    constructor() {\n        super(...arguments);\n        this.dependencies = [TransformComponent, MotionComponent];\n        this._ctx = null;\n    }\n    onAdd(entity) {\n        this._ctx = new ActionContext(entity);\n    }\n    onRemove() {\n        this._ctx = null;\n    }\n    _getCtx() {\n        if (!this._ctx) {\n            throw new Error('Actions component not attached to an entity, no context available');\n        }\n        return this._ctx;\n    }\n    /**\n     * Returns the internal action queue\n     * @returns action queue\n     */\n    getQueue() {\n        if (!this._ctx) {\n            throw new Error('Actions component not attached to an entity, no queue available');\n        }\n        return this._ctx.getQueue();\n    }\n    /**\n     * Runs a specific action in the action queue\n     * @param action\n     */\n    runAction(action) {\n        if (!this._ctx) {\n            throw new Error('Actions component not attached to an entity, cannot run action');\n        }\n        return this._ctx.runAction(action);\n    }\n    /**\n     * Updates the internal action context, performing action and moving through the internal queue\n     * @param elapsedMs\n     */\n    update(elapsedMs) {\n        var _a;\n        return (_a = this._ctx) === null || _a === void 0 ? void 0 : _a.update(elapsedMs);\n    }\n    /**\n     * Clears all queued actions from the Actor\n     */\n    clearActions() {\n        var _a;\n        (_a = this._ctx) === null || _a === void 0 ? void 0 : _a.clearActions();\n    }\n    /**\n     * Animates an actor with a specified bezier curve by an offset to the current position, the start point is assumed\n     * to be the actors current position\n     * @param options\n     */\n    curveBy(options) {\n        return this._getCtx().curveBy.apply(this._ctx, [options]);\n    }\n    /**\n     * Animates an actor with a specified bezier curve to an absolute world space coordinate, the start point is assumed\n     * to be the actors current position\n     * @param options\n     */\n    curveTo(options) {\n        return this._getCtx().curveTo.apply(this._ctx, [options]);\n    }\n    easeTo(...args) {\n        return this._getCtx().easeTo.apply(this._ctx, args);\n    }\n    easeBy(...args) {\n        return this._getCtx().easeBy.apply(this._ctx, args);\n    }\n    moveTo(xOrPosOrOptions, yOrSpeed, speedOrUndefined) {\n        return this._getCtx().moveTo.apply(this._ctx, [xOrPosOrOptions, yOrSpeed, speedOrUndefined]);\n    }\n    moveBy(xOffsetOrVectorOptions, yOffsetOrSpeed, speedOrUndefined) {\n        return this._getCtx().moveBy.apply(this._ctx, [xOffsetOrVectorOptions, yOffsetOrSpeed, speedOrUndefined]);\n    }\n    rotateTo(angleRadians, speed, rotationType) {\n        return this._getCtx().rotateTo.apply(this._ctx, [angleRadians, speed, rotationType]);\n    }\n    rotateBy(angleRadiansOffsetOrOptions, speed, rotationType) {\n        return this._getCtx().rotateBy.apply(this._ctx, [angleRadiansOffsetOrOptions, speed, rotationType]);\n    }\n    scaleTo(sizeXOrVectorOrOptions, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined) {\n        return this._getCtx().scaleTo.apply(this._ctx, [sizeXOrVectorOrOptions, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\n    }\n    scaleBy(sizeOffsetXOrVectorOrOptions, sizeOffsetYOrSpeed, speed) {\n        return this._getCtx().scaleBy.apply(this._ctx, [sizeOffsetXOrVectorOrOptions, sizeOffsetYOrSpeed, speed]);\n    }\n    /**\n     * This method will cause an actor to blink (become visible and not\n     * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n     * the actor should be visible per blink, and the amount of time not visible.\n     * This method is part of the actor 'Action' fluent API allowing action chaining.\n     * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n     * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n     * @param numBlinks       The number of times to blink\n     */\n    blink(timeVisible, timeNotVisible, numBlinks) {\n        return this._getCtx().blink(timeVisible, timeNotVisible, numBlinks);\n    }\n    /**\n     * This method will cause an actor's opacity to change from its current value\n     * to the provided value by a specified time (in milliseconds). This method is\n     * part of the actor 'Action' fluent API allowing action chaining.\n     * @param opacity  The ending opacity\n     * @param durationMs     The time it should take to fade the actor (in milliseconds)\n     */\n    fade(opacity, durationMs) {\n        return this._getCtx().fade(opacity, durationMs);\n    }\n    /**\n     * This will cause an actor to flash a specific color for a period of time\n     * @param color\n     * @param durationMs The duration in milliseconds\n     */\n    flash(color, durationMs = 1000) {\n        return this._getCtx().flash(color, durationMs);\n    }\n    /**\n     * This method will delay the next action from executing for a certain\n     * amount of time (in milliseconds). This method is part of the actor\n     * 'Action' fluent API allowing action chaining.\n     * @param durationMs  The amount of time to delay the next action in the queue from executing in milliseconds\n     */\n    delay(durationMs) {\n        return this._getCtx().delay(durationMs);\n    }\n    /**\n     * This method will add an action to the queue that will remove the actor from the\n     * scene once it has completed its previous  Any actions on the\n     * action queue after this action will not be executed.\n     */\n    die() {\n        return this._getCtx().die();\n    }\n    /**\n     * This method allows you to call an arbitrary method as the next action in the\n     * action queue. This is useful if you want to execute code in after a specific\n     * action, i.e An actor arrives at a destination after traversing a path\n     */\n    callMethod(method) {\n        return this._getCtx().callMethod(method);\n    }\n    /**\n     * This method will cause the actor to repeat all of the actions built in\n     * the `repeatBuilder` callback. If the number of repeats\n     * is not specified it will repeat forever. This method is part of\n     * the actor 'Action' fluent API allowing action chaining\n     *\n     * ```typescript\n     * // Move up in a zig-zag by repeated moveBy's\n     * actor.actions.repeat(repeatCtx => {\n     * repeatCtx.moveBy(10, 0, 10);\n     * repeatCtx.moveBy(0, 10, 10);\n     * }, 5);\n     * ```\n     * @param repeatBuilder The builder to specify the repeatable list of actions\n     * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n     * will repeat forever\n     */\n    repeat(repeatBuilder, times) {\n        return this._getCtx().repeat(repeatBuilder, times);\n    }\n    /**\n     * This method will cause the actor to repeat all of the actions built in\n     * the `repeatBuilder` callback. If the number of repeats\n     * is not specified it will repeat forever. This method is part of\n     * the actor 'Action' fluent API allowing action chaining\n     *\n     * ```typescript\n     * // Move up in a zig-zag by repeated moveBy's\n     * actor.actions.repeat(repeatCtx => {\n     * repeatCtx.moveBy(10, 0, 10);\n     * repeatCtx.moveBy(0, 10, 10);\n     * }, 5);\n     * ```\n     * @param repeatBuilder The builder to specify the repeatable list of actions\n     */\n    repeatForever(repeatBuilder) {\n        return this._getCtx().repeatForever(repeatBuilder);\n    }\n    /**\n     * This method will cause the entity to follow another at a specified distance\n     * @param entity           The entity to follow\n     * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n     */\n    follow(entity, followDistance) {\n        return this._getCtx().follow(entity, followDistance);\n    }\n    /**\n     * This method will cause the entity to move towards another until they\n     * collide \"meet\" at a specified speed.\n     * @param entity  The entity to meet\n     * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n     */\n    meet(entity, speed) {\n        return this._getCtx().meet(entity, speed);\n    }\n    /**\n     * Returns a promise that resolves when the current action queue up to now\n     * is finished.\n     */\n    toPromise() {\n        return this._getCtx().toPromise();\n    }\n}\n\n;// ./Actor.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Type guard for checking if something is an Actor\n * @param x\n */\nfunction isActor(x) {\n    return x instanceof Actor;\n}\nconst ActorEvents = {\n    CollisionStart: 'collisionstart',\n    CollisionEnd: 'collisionend',\n    PreCollision: 'precollision',\n    PostCollision: 'postcollision',\n    Kill: 'kill',\n    PreKill: 'prekill',\n    PostKill: 'postkill',\n    PreDraw: 'predraw',\n    PostDraw: 'postdraw',\n    PreTransformDraw: 'pretransformdraw',\n    PostTransformDraw: 'posttransformdraw',\n    PreDebugDraw: 'predebugdraw',\n    PostDebugDraw: 'postdebugdraw',\n    PointerUp: 'pointerup',\n    PointerDown: 'pointerdown',\n    PointerEnter: 'pointerenter',\n    PointerLeave: 'pointerleave',\n    PointerMove: 'pointermove',\n    PointerCancel: 'pointercancel',\n    Wheel: 'pointerwheel',\n    PointerDrag: 'pointerdragstart',\n    PointerDragEnd: 'pointerdragend',\n    PointerDragEnter: 'pointerdragenter',\n    PointerDragLeave: 'pointerdragleave',\n    PointerDragMove: 'pointerdragmove',\n    EnterViewPort: 'enterviewport',\n    ExitViewPort: 'exitviewport',\n    ActionStart: 'actionstart',\n    ActionComplete: 'actioncomplete'\n};\n/**\n * The most important primitive in Excalibur is an `Actor`. Anything that\n * can move on the screen, collide with another `Actor`, respond to events,\n * or interact with the current scene, must be an actor. An `Actor` **must**\n * be part of a {@apilink Scene} for it to be drawn to the screen.\n */\nclass Actor extends Entity {\n    /**\n     * Gets the position vector of the actor in pixels\n     */\n    get pos() {\n        return this.transform.pos;\n    }\n    /**\n     * Sets the position vector of the actor in pixels\n     */\n    set pos(thePos) {\n        this.transform.pos = thePos.clone();\n    }\n    /**\n     * Gets the position vector of the actor from the last frame\n     */\n    get oldPos() {\n        return this.body.oldPos;\n    }\n    /**\n     * Gets the global position vector of the actor from the last frame\n     */\n    get oldGlobalPos() {\n        return this.body.oldGlobalPos;\n    }\n    /**\n     * Sets the position vector of the actor in the last frame\n     */\n    set oldPos(thePos) {\n        this.body.oldPos.setTo(thePos.x, thePos.y);\n    }\n    /**\n     * Gets the velocity vector of the actor in pixels/sec\n     */\n    get vel() {\n        return this.motion.vel;\n    }\n    /**\n     * Sets the velocity vector of the actor in pixels/sec\n     */\n    set vel(theVel) {\n        this.motion.vel = theVel.clone();\n    }\n    /**\n     * Gets the velocity vector of the actor from the last frame\n     */\n    get oldVel() {\n        return this.body.oldVel;\n    }\n    /**\n     * Sets the velocity vector of the actor from the last frame\n     */\n    set oldVel(theVel) {\n        this.body.oldVel.setTo(theVel.x, theVel.y);\n    }\n    /**\n     * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\n     * useful to simulate a gravitational effect.\n     */\n    get acc() {\n        return this.motion.acc;\n    }\n    /**\n     * Sets the acceleration vector of teh actor in pixels/second/second\n     */\n    set acc(theAcc) {\n        this.motion.acc = theAcc.clone();\n    }\n    /**\n     * Sets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\n     */\n    set oldAcc(theAcc) {\n        this.body.oldAcc.setTo(theAcc.x, theAcc.y);\n    }\n    /**\n     * Gets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\n     */\n    get oldAcc() {\n        return this.body.oldAcc;\n    }\n    /**\n     * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n     */\n    get rotation() {\n        return this.transform.rotation;\n    }\n    /**\n     * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n     */\n    set rotation(theAngle) {\n        this.transform.rotation = theAngle;\n    }\n    /**\n     * Gets the rotational velocity of the actor in radians/second\n     */\n    get angularVelocity() {\n        return this.motion.angularVelocity;\n    }\n    /**\n     * Sets the rotational velocity of the actor in radians/sec\n     */\n    set angularVelocity(angularVelocity) {\n        this.motion.angularVelocity = angularVelocity;\n    }\n    get scale() {\n        return this.get(TransformComponent).scale;\n    }\n    set scale(scale) {\n        this.get(TransformComponent).scale = scale;\n    }\n    /**\n     * The anchor to apply all actor related transformations like rotation,\n     * translation, and scaling. By default the anchor is in the center of\n     * the actor. By default it is set to the center of the actor (.5, .5)\n     *\n     * An anchor of (.5, .5) will ensure that drawings are centered.\n     *\n     * Use `anchor.setTo` to set the anchor to a different point using\n     * values between 0 and 1. For example, anchoring to the top-left would be\n     * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\n     */\n    get anchor() {\n        return this._anchor;\n    }\n    set anchor(vec) {\n        this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\n        this._handleAnchorChange(vec);\n    }\n    _handleAnchorChange(v) {\n        if (this.graphics) {\n            this.graphics.anchor = v;\n        }\n    }\n    /**\n     * The offset in pixels to apply to all actor graphics\n     *\n     * Default offset of (0, 0)\n     */\n    get offset() {\n        return this._offset;\n    }\n    set offset(vec) {\n        this._offset = watch(vec, (v) => this._handleOffsetChange(v));\n        this._handleOffsetChange(vec);\n    }\n    _handleOffsetChange(v) {\n        if (this.graphics) {\n            this.graphics.offset = v;\n        }\n    }\n    /**\n     * Indicates whether the actor is physically in the viewport\n     */\n    get isOffScreen() {\n        return this.hasTag('ex.offscreen');\n    }\n    get draggable() {\n        return this._draggable;\n    }\n    set draggable(isDraggable) {\n        if (isDraggable) {\n            if (isDraggable && !this._draggable) {\n                this.events.on('pointerdragstart', this._pointerDragStartHandler);\n                this.events.on('pointerdragend', this._pointerDragEndHandler);\n                this.events.on('pointerdragmove', this._pointerDragMoveHandler);\n                this.events.on('pointerdragleave', this._pointerDragLeaveHandler);\n            }\n            else if (!isDraggable && this._draggable) {\n                this.events.off('pointerdragstart', this._pointerDragStartHandler);\n                this.events.off('pointerdragend', this._pointerDragEndHandler);\n                this.events.off('pointerdragmove', this._pointerDragMoveHandler);\n                this.events.off('pointerdragleave', this._pointerDragLeaveHandler);\n            }\n            this._draggable = isDraggable;\n        }\n    }\n    /**\n     * Sets the color of the actor's current graphic\n     */\n    get color() {\n        return this.graphics.color;\n    }\n    set color(v) {\n        this.graphics.color = v;\n    }\n    // #endregion\n    /**\n     *\n     * @param config\n     */\n    constructor(config) {\n        super();\n        this.events = new EventEmitter();\n        this._anchor = watch(Vector.Half, (v) => this._handleAnchorChange(v));\n        this._offset = watch(Vector.Zero, (v) => this._handleOffsetChange(v));\n        /**\n         * Convenience reference to the global logger\n         */\n        this.logger = Logger.getInstance();\n        /**\n         * Draggable helper\n         */\n        this._draggable = false;\n        this._dragging = false;\n        this._pointerDragStartHandler = () => {\n            this._dragging = true;\n        };\n        this._pointerDragEndHandler = () => {\n            this._dragging = false;\n        };\n        this._pointerDragMoveHandler = (pe) => {\n            if (this._dragging) {\n                this.pos = pe.worldPos;\n            }\n        };\n        this._pointerDragLeaveHandler = (pe) => {\n            if (this._dragging) {\n                this.pos = pe.worldPos;\n            }\n        };\n        const { name, x, y, pos, coordPlane, scale, width, height, radius, collider, vel, acc, rotation, angularVelocity, z, color, visible, opacity, anchor, offset, collisionType, collisionGroup, silenceWarnings } = {\n            ...config\n        };\n        this.name = name !== null && name !== void 0 ? name : this.name;\n        this.anchor = anchor !== null && anchor !== void 0 ? anchor : Actor.defaults.anchor.clone();\n        this.offset = offset !== null && offset !== void 0 ? offset : Vector.Zero;\n        this.transform = new TransformComponent();\n        this.addComponent(this.transform);\n        this.pos = pos !== null && pos !== void 0 ? pos : vec(x !== null && x !== void 0 ? x : 0, y !== null && y !== void 0 ? y : 0);\n        this.rotation = rotation !== null && rotation !== void 0 ? rotation : 0;\n        this.scale = scale !== null && scale !== void 0 ? scale : vec(1, 1);\n        this.z = z !== null && z !== void 0 ? z : 0;\n        this.transform.coordPlane = coordPlane !== null && coordPlane !== void 0 ? coordPlane : CoordPlane.World;\n        this._silenceWarnings = silenceWarnings !== null && silenceWarnings !== void 0 ? silenceWarnings : false;\n        this.pointer = new PointerComponent();\n        this.addComponent(this.pointer);\n        this.graphics = new GraphicsComponent({\n            anchor: this.anchor,\n            offset: this.offset,\n            opacity: opacity\n        });\n        this.addComponent(this.graphics);\n        this.motion = new MotionComponent();\n        this.addComponent(this.motion);\n        this.vel = vel !== null && vel !== void 0 ? vel : Vector.Zero;\n        this.acc = acc !== null && acc !== void 0 ? acc : Vector.Zero;\n        this.angularVelocity = angularVelocity !== null && angularVelocity !== void 0 ? angularVelocity : 0;\n        this.actions = new ActionsComponent();\n        this.addComponent(this.actions);\n        this.body = new BodyComponent();\n        this.addComponent(this.body);\n        this.body.collisionType = collisionType !== null && collisionType !== void 0 ? collisionType : CollisionType.Passive;\n        if (collisionGroup) {\n            this.body.group = collisionGroup;\n        }\n        if (color) {\n            this.color = color;\n        }\n        if (collider) {\n            this.collider = new ColliderComponent(collider);\n            this.addComponent(this.collider);\n        }\n        else if (radius) {\n            this.collider = new ColliderComponent(Shape.Circle(radius));\n            this.addComponent(this.collider);\n            if (color) {\n                this.graphics.add(new Circle({\n                    color: color,\n                    radius\n                }));\n            }\n        }\n        else {\n            if (width > 0 && height > 0) {\n                this.collider = new ColliderComponent(Shape.Box(width, height, this.anchor));\n                this.addComponent(this.collider);\n                if (color && width && height) {\n                    this.graphics.add(new Rectangle({\n                        color: color,\n                        width,\n                        height\n                    }));\n                }\n            }\n            else {\n                this.collider = new ColliderComponent();\n                this.addComponent(this.collider); // no collider\n            }\n        }\n        this.graphics.isVisible = visible !== null && visible !== void 0 ? visible : true;\n    }\n    clone() {\n        const clone = new Actor({\n            silenceWarnings: this._silenceWarnings,\n            color: this.color.clone(),\n            anchor: this.anchor.clone(),\n            offset: this.offset.clone()\n        });\n        clone.clearComponents();\n        clone.processComponentRemoval();\n        // Clone builtins, order is important, same as ctor\n        clone.addComponent((clone.transform = this.transform.clone()), true);\n        clone.addComponent((clone.pointer = this.pointer.clone()), true);\n        clone.addComponent((clone.graphics = this.graphics.clone()), true);\n        clone.addComponent((clone.motion = this.motion.clone()), true);\n        clone.addComponent((clone.actions = this.actions.clone()), true);\n        clone.addComponent((clone.body = this.body.clone()), true);\n        clone.addComponent((clone.collider = this.collider.clone()), true);\n        const builtInComponents = [\n            this.transform,\n            this.pointer,\n            this.graphics,\n            this.motion,\n            this.actions,\n            this.body,\n            this.collider\n        ];\n        // Clone non-builtin the current actors components\n        const components = this.getComponents();\n        for (const c of components) {\n            if (!builtInComponents.includes(c)) {\n                clone.addComponent(c.clone(), true);\n            }\n        }\n        return clone;\n    }\n    /**\n     * `onInitialize` is called before the first update of the actor. This method is meant to be\n     * overridden. This is where initialization of child actors should take place.\n     *\n     * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n     */\n    onInitialize(engine) {\n        // Override me\n    }\n    /**\n     * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\n     *\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     * @internal\n     */\n    _initialize(engine) {\n        super._initialize(engine);\n        for (const child of this.children) {\n            child._initialize(engine);\n        }\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    // #endregion\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _prekill handler for {@apilink onPreKill} lifecycle event\n     * @internal\n     */\n    _prekill(scene) {\n        this.events.emit('prekill', new PreKillEvent(this));\n        this.onPreKill(scene);\n    }\n    /**\n     * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\n     *\n     * `onPreKill` is called directly before an actor is killed and removed from its current {@apilink Scene}.\n     */\n    onPreKill(scene) {\n        // Override me\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _prekill handler for {@apilink onPostKill} lifecycle event\n     * @internal\n     */\n    _postkill(scene) {\n        this.events.emit('postkill', new PostKillEvent(this));\n        this.onPostKill(scene);\n    }\n    /**\n     * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\n     *\n     * `onPostKill` is called directly after an actor is killed and remove from its current {@apilink Scene}.\n     */\n    onPostKill(scene) {\n        // Override me\n    }\n    /**\n     * If the current actor is a member of the scene, this will remove\n     * it from the scene graph. It will no longer be drawn or updated.\n     */\n    kill() {\n        if (this.scene) {\n            this._prekill(this.scene);\n            this.events.emit('kill', new KillEvent(this));\n            super.kill();\n            this._postkill(this.scene);\n        }\n        else {\n            this.logger.warn(`Cannot kill actor named \"${this.name}\", it was never added to the Scene`);\n        }\n    }\n    /**\n     * If the current actor is killed, it will now not be killed.\n     */\n    unkill() {\n        this.isActive = true;\n    }\n    /**\n     * Indicates wether the actor has been killed.\n     */\n    isKilled() {\n        return !this.isActive;\n    }\n    /**\n     * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\n     * Actors with a higher z-index are drawn on top of actors with a lower z-index\n     */\n    get z() {\n        return this.get(TransformComponent).z;\n    }\n    /**\n     * Sets the z-index of an actor and updates it in the drawing list for the scene.\n     * The z-index determines the relative order an actor is drawn in.\n     * Actors with a higher z-index are drawn on top of actors with a lower z-index\n     * @param newZ new z-index to assign\n     */\n    set z(newZ) {\n        this.get(TransformComponent).z = newZ;\n    }\n    /**\n     * Get the center point of an actor (global position)\n     */\n    get center() {\n        const globalPos = this.getGlobalPos();\n        return new Vector(globalPos.x + this.width / 2 - this.anchor.x * this.width, globalPos.y + this.height / 2 - this.anchor.y * this.height);\n    }\n    /**\n     * Get the local center point of an actor\n     */\n    get localCenter() {\n        return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\n    }\n    get width() {\n        return this.collider.localBounds.width * this.getGlobalScale().x;\n    }\n    get height() {\n        return this.collider.localBounds.height * this.getGlobalScale().y;\n    }\n    /**\n     * Gets this actor's rotation taking into account any parent relationships\n     * @returns Rotation angle in radians\n     * @deprecated Use {@apilink globalRotation} instead\n     */\n    getGlobalRotation() {\n        return this.get(TransformComponent).globalRotation;\n    }\n    /**\n     * The actor's rotation (in radians) taking into account any parent relationships\n     */\n    get globalRotation() {\n        return this.get(TransformComponent).globalRotation;\n    }\n    /**\n     * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\n     * @returns Position in world coordinates\n     * @deprecated Use {@apilink globalPos} instead\n     */\n    getGlobalPos() {\n        return this.get(TransformComponent).globalPos;\n    }\n    /**\n     * The actor's world position taking into account parent relationships, scaling, rotation, and translation\n     */\n    get globalPos() {\n        return this.get(TransformComponent).globalPos;\n    }\n    /**\n     * Gets the global scale of the Actor\n     * @deprecated Use {@apilink globalScale} instead\n     */\n    getGlobalScale() {\n        return this.get(TransformComponent).globalScale;\n    }\n    /**\n     * The global scale of the Actor\n     */\n    get globalScale() {\n        return this.get(TransformComponent).globalScale;\n    }\n    /**\n     * The global z-index of the actor\n     */\n    get globalZ() {\n        return this.get(TransformComponent).globalZ;\n    }\n    // #region Collision\n    /**\n     * Tests whether the x/y specified are contained in the actor\n     * @param x  X coordinate to test (in world coordinates)\n     * @param y  Y coordinate to test (in world coordinates)\n     * @param recurse checks whether the x/y are contained in any child actors (if they exist).\n     */\n    contains(x, y, recurse = false) {\n        const point = vec(x, y);\n        const collider = this.get(ColliderComponent);\n        collider.update();\n        const geom = collider.get();\n        if (!geom) {\n            return false;\n        }\n        const containment = geom.contains(point);\n        if (recurse) {\n            return (containment ||\n                this.children.some((child) => {\n                    return child.contains(x, y, true);\n                }));\n        }\n        return containment;\n    }\n    /**\n     * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\n     * @param actor     Actor to test\n     * @param distance  Distance in pixels to test\n     */\n    within(actor, distance) {\n        const collider = this.get(ColliderComponent);\n        const otherCollider = actor.get(ColliderComponent);\n        const me = collider.get();\n        const other = otherCollider.get();\n        if (me && other) {\n            return me.getClosestLineBetween(other).getLength() <= distance;\n        }\n        return false;\n    }\n    // #endregion\n    // #region Update\n    /**\n     * Called by the Engine, updates the state of the actor\n     * @internal\n     * @param engine The reference to the current game engine\n     * @param elapsedMs  The time elapsed since the last update in milliseconds\n     */\n    update(engine, elapsedMs) {\n        this._initialize(engine);\n        this._add(engine);\n        this._preupdate(engine, elapsedMs);\n        this._postupdate(engine, elapsedMs);\n        this._remove(engine);\n    }\n    /**\n     * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPreUpdate` is called directly before an actor is updated.\n     */\n    onPreUpdate(engine, elapsedMs) {\n        // Override me\n    }\n    /**\n     * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n     *\n     * `onPostUpdate` is called directly after an actor is updated.\n     */\n    onPostUpdate(engine, elapsedMs) {\n        // Override me\n    }\n    /**\n     * Fires before every collision resolution for a confirmed contact\n     * @param self\n     * @param other\n     * @param side\n     * @param contact\n     */\n    onPreCollisionResolve(self, other, side, contact) {\n        // Override me\n    }\n    /**\n     * Fires after every resolution for a confirmed contact.\n     * @param self\n     * @param other\n     * @param side\n     * @param contact\n     */\n    onPostCollisionResolve(self, other, side, contact) {\n        // Override me\n    }\n    /**\n     * Fires once when 2 entities with a ColliderComponent first start colliding or touching, if the Colliders stay in contact this\n     * does not continue firing until they separate and re-collide.\n     * @param self\n     * @param other\n     * @param side\n     * @param contact\n     */\n    onCollisionStart(self, other, side, contact) {\n        // Override me\n    }\n    /**\n     * Fires once when 2 entities with a ColliderComponent separate after having been in contact.\n     * @param self\n     * @param other\n     * @param side\n     * @param lastContact\n     */\n    onCollisionEnd(self, other, side, lastContact) {\n        // Override me\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\n     * @internal\n     */\n    _preupdate(engine, elapsedMs) {\n        this.events.emit('preupdate', new PreUpdateEvent(engine, elapsedMs, this));\n        this.onPreUpdate(engine, elapsedMs);\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\n     * @internal\n     */\n    _postupdate(engine, elapsedMs) {\n        this.events.emit('postupdate', new PostUpdateEvent(engine, elapsedMs, this));\n        this.onPostUpdate(engine, elapsedMs);\n    }\n}\n// #region Properties\n/**\n * Set defaults for all Actors\n */\nActor.defaults = {\n    anchor: Vector.Half\n};\n\n;// ./ScreenElement.ts\n\n\n\n\n\n/**\n * Type guard to detect a screen element\n */\nfunction isScreenElement(actor) {\n    return actor instanceof ScreenElement;\n}\n/**\n * Helper {@apilink Actor} primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nclass ScreenElement extends Actor {\n    constructor(config) {\n        var _a, _b;\n        super({ ...config });\n        this.get(TransformComponent).coordPlane = CoordPlane.Screen;\n        this.anchor = (_a = config === null || config === void 0 ? void 0 : config.anchor) !== null && _a !== void 0 ? _a : vec(0, 0);\n        this.body.collisionType = (_b = config === null || config === void 0 ? void 0 : config.collisionType) !== null && _b !== void 0 ? _b : CollisionType.PreventCollision;\n        this.pointer.useGraphicsBounds = true;\n        this.pointer.useColliderShape = false;\n        if (!(config === null || config === void 0 ? void 0 : config.collider) && (config === null || config === void 0 ? void 0 : config.width) > 0 && (config === null || config === void 0 ? void 0 : config.height) > 0) {\n            this.collider.useBoxCollider(this.width, this.height, this.anchor);\n        }\n    }\n    _initialize(engine) {\n        this._engine = engine;\n        super._initialize(engine);\n    }\n    contains(x, y, useWorld = true) {\n        if (useWorld) {\n            return super.contains(x, y);\n        }\n        const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n        return super.contains(coords.x, coords.y);\n    }\n}\n\n;// ./Timer.ts\n\n\n/**\n * The Excalibur timer hooks into the internal timer and fires callbacks,\n * after a certain interval, optionally repeating.\n */\nclass Timer {\n    get complete() {\n        return this._complete;\n    }\n    constructor(options) {\n        var _a;\n        this._logger = Logger.getInstance();\n        this.id = 0;\n        this._elapsedTime = 0;\n        this._totalTimeAlive = 0;\n        this._running = false;\n        this._numberOfTicks = 0;\n        this.interval = 10;\n        this.repeats = false;\n        this.maxNumberOfRepeats = -1;\n        this.randomRange = [0, 0];\n        this._baseInterval = 10;\n        this._generateRandomInterval = () => {\n            return this._baseInterval + this.random.integer(this.randomRange[0], this.randomRange[1]);\n        };\n        this._complete = false;\n        this.scene = null;\n        const fcn = (_a = options.action) !== null && _a !== void 0 ? _a : options.fcn;\n        const interval = options.interval;\n        const repeats = options.repeats;\n        const numberOfRepeats = options.numberOfRepeats;\n        const randomRange = options.randomRange;\n        const random = options.random;\n        if (!!numberOfRepeats && numberOfRepeats >= 0) {\n            this.maxNumberOfRepeats = numberOfRepeats;\n            if (!repeats) {\n                throw new Error('repeats must be set to true if numberOfRepeats is set');\n            }\n        }\n        this.id = Timer._MAX_ID++;\n        this._callbacks = [];\n        this._baseInterval = this.interval = interval;\n        if (!!randomRange) {\n            if (randomRange[0] > randomRange[1]) {\n                throw new Error('min value must be lower than max value for range');\n            }\n            //We use the instance of ex.Random to generate the range\n            this.random = random !== null && random !== void 0 ? random : new Random();\n            this.randomRange = randomRange;\n            this.interval = this._generateRandomInterval();\n            this.on(() => {\n                this.interval = this._generateRandomInterval();\n            });\n        }\n        this.repeats = repeats || this.repeats;\n        if (fcn) {\n            this.on(fcn);\n        }\n    }\n    /**\n     * Adds a new callback to be fired after the interval is complete\n     * @param action The callback to be added to the callback list, to be fired after the interval is complete.\n     */\n    on(action) {\n        this._callbacks.push(action);\n    }\n    /**\n     * Removes a callback from the callback list to be fired after the interval is complete.\n     * @param action The callback to be removed from the callback list, to be fired after the interval is complete.\n     */\n    off(action) {\n        const index = this._callbacks.indexOf(action);\n        this._callbacks.splice(index, 1);\n    }\n    /**\n     * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\n     * @param elapsedMs  Number of elapsed milliseconds since the last update.\n     */\n    update(elapsedMs) {\n        if (this._running) {\n            this._totalTimeAlive += elapsedMs;\n            this._elapsedTime += elapsedMs;\n            if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\n                this._complete = true;\n                this._running = false;\n                this._elapsedTime = 0;\n            }\n            if (!this.complete && this._elapsedTime >= this.interval) {\n                this._callbacks.forEach((c) => {\n                    c.call(this);\n                });\n                this._numberOfTicks++;\n                if (this.repeats) {\n                    this._elapsedTime = 0;\n                }\n                else {\n                    this._complete = true;\n                    this._running = false;\n                    this._elapsedTime = 0;\n                }\n            }\n        }\n    }\n    /**\n     * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\n     *\n     * Warning** you may need to call `timer.start()` again if the timer had completed\n     * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\n     * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\n     */\n    reset(newInterval, newNumberOfRepeats) {\n        if (!!newInterval && newInterval >= 0) {\n            this._baseInterval = this.interval = newInterval;\n        }\n        if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\n            this.maxNumberOfRepeats = newNumberOfRepeats;\n            if (!this.repeats) {\n                throw new Error('repeats must be set to true if numberOfRepeats is set');\n            }\n        }\n        this._complete = false;\n        this._elapsedTime = 0;\n        this._numberOfTicks = 0;\n    }\n    get timesRepeated() {\n        return this._numberOfTicks;\n    }\n    getTimeRunning() {\n        return this._totalTimeAlive;\n    }\n    /**\n     * @returns milliseconds until the next action callback, if complete will return 0\n     */\n    get timeToNextAction() {\n        if (this.complete) {\n            return 0;\n        }\n        return this.interval - this._elapsedTime;\n    }\n    /**\n     * @returns milliseconds elapsed toward the next action\n     */\n    get timeElapsedTowardNextAction() {\n        return this._elapsedTime;\n    }\n    get isRunning() {\n        return this._running;\n    }\n    /**\n     * Pauses the timer, time will no longer increment towards the next call\n     */\n    pause() {\n        this._running = false;\n        return this;\n    }\n    /**\n     * Resumes the timer, time will now increment towards the next call.\n     */\n    resume() {\n        this._running = true;\n        return this;\n    }\n    /**\n     * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\n     */\n    start() {\n        if (!this.scene) {\n            this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\n        }\n        this._running = true;\n        if (this.complete) {\n            this._complete = false;\n            this._elapsedTime = 0;\n            this._numberOfTicks = 0;\n        }\n        return this;\n    }\n    /**\n     * Stops the timer and resets the elapsed time counter towards the next action invocation\n     */\n    stop() {\n        this._running = false;\n        this._elapsedTime = 0;\n        this._numberOfTicks = 0;\n        return this;\n    }\n    /**\n     * Cancels the timer, preventing any further executions.\n     */\n    cancel() {\n        this.pause();\n        if (this.scene) {\n            this.scene.cancelTimer(this);\n        }\n    }\n}\nTimer._MAX_ID = 0;\n\n;// ./Graphics/ParallaxComponent.ts\n\n\nclass ParallaxComponent extends Component {\n    constructor(parallaxFactor) {\n        super();\n        this.parallaxFactor = vec(1.0, 1.0);\n        this.parallaxFactor = parallaxFactor !== null && parallaxFactor !== void 0 ? parallaxFactor : this.parallaxFactor;\n    }\n}\n\n;// ./Graphics/DebugGraphicsComponent.ts\n\n/**\n * Provide arbitrary drawing for the purposes of debugging your game\n *\n * Will only show when the Engine is set to debug mode {@apilink Engine.showDebug} or {@apilink Engine.toggleDebug}\n *\n */\nclass DebugGraphicsComponent extends Component {\n    constructor(draw, useTransform = true) {\n        super();\n        this.draw = draw;\n        this.useTransform = useTransform;\n    }\n}\n\n;// ./Input/PointerEventsToObjectDispatcher.ts\n\n/**\n *\n */\nfunction hasNestedEvents(object) {\n    return object && object._dispatchPointerEvents && object._processPointerToObject;\n}\nclass PointerTargetObjectProxy {\n    get events() {\n        return this.object.events;\n    }\n    init(object, contains, active) {\n        this.object = object;\n        this.contains = contains;\n        this.active = active;\n    }\n}\nclass PointerEventsToObjectDispatcher {\n    constructor() {\n        this._proxyPool = new RentalPool(() => new PointerTargetObjectProxy(), (p) => p, 100);\n        this._objectToProxy = new Map();\n        this._proxies = [];\n        this._lastFrameObjectToPointers = new Map();\n        this._currentFrameObjectToPointers = new Map();\n    }\n    /**\n     * Tracks an object to associate with pointers and their events\n     * @param object\n     * @param contains\n     * @param active\n     */\n    addObject(object, contains, active) {\n        const proxy = this._proxyPool.rent(false);\n        proxy.init(object, contains, active);\n        this._proxies.push(proxy);\n        this._objectToProxy.set(object, proxy);\n    }\n    _getProxy(object) {\n        const proxy = this._objectToProxy.get(object);\n        if (proxy) {\n            return proxy;\n        }\n        throw new Error('No PointerTargetProxy for object');\n    }\n    /**\n     * Untracks an object associated with pointers and their events\n     * @param object\n     */\n    removeObject(object) {\n        const proxy = this._objectToProxy.get(object);\n        if (proxy) {\n            const index = this._proxies.indexOf(proxy);\n            if (index > -1) {\n                this._proxies.splice(index, 1);\n            }\n            this._proxyPool.return(proxy);\n        }\n    }\n    _objectCurrentlyUnderPointer(object, pointerId) {\n        return !!(this._currentFrameObjectToPointers.has(object) && this._currentFrameObjectToPointers.get(object).includes(pointerId));\n    }\n    _objectWasUnderPointer(object, pointerId) {\n        return !!(this._lastFrameObjectToPointers.has(object) && this._lastFrameObjectToPointers.get(object).includes(pointerId));\n    }\n    _entered(object, pointerId) {\n        return this._objectCurrentlyUnderPointer(object, pointerId) && !this._lastFrameObjectToPointers.has(object);\n    }\n    _left(object, pointerId) {\n        return !this._currentFrameObjectToPointers.has(object) && this._objectWasUnderPointer(object, pointerId);\n    }\n    /**\n     * Manually associate a pointer id with an object.\n     *\n     * This assumes you've checked that the pointer is indeed over the object.\n     */\n    addPointerToObject(object, pointerId) {\n        const maybeProxy = this._objectToProxy.get(object);\n        if (maybeProxy) {\n            this._addPointerToProxy(maybeProxy, pointerId);\n        }\n    }\n    _addPointerToProxy(object, pointerId) {\n        if (!this._currentFrameObjectToPointers.has(object)) {\n            this._currentFrameObjectToPointers.set(object, [pointerId]);\n            return;\n        }\n        const pointers = this._currentFrameObjectToPointers.get(object);\n        this._currentFrameObjectToPointers.set(object, pointers.concat(pointerId));\n    }\n    /**\n     * Dispatches the appropriate pointer events in sortedObject order on tracked objects\n     * @param receiver\n     * @param sortedObjects\n     */\n    dispatchEvents(receiver, sortedObjects) {\n        const lastFrameEntities = new Set(this._lastFrameObjectToPointers.keys());\n        const currentFrameEntities = new Set(this._currentFrameObjectToPointers.keys());\n        // Filter preserves z order\n        let lastMovePerPointer;\n        let lastUpPerPointer;\n        let lastDownPerPointer;\n        // Dispatch events in proxy z order\n        for (let i = 0; i < sortedObjects.length; i++) {\n            const object = sortedObjects[i];\n            const proxy = this._getProxy(object);\n            if (hasNestedEvents(object)) {\n                object._dispatchPointerEvents(receiver);\n            }\n            if (lastFrameEntities.has(proxy) || currentFrameEntities.has(proxy)) {\n                lastDownPerPointer = this._processDownAndEmit(receiver, proxy);\n                lastUpPerPointer = this._processUpAndEmit(receiver, proxy);\n                lastMovePerPointer = this._processMoveAndEmit(receiver, proxy);\n                const lastUpDownMoveEvents = [...lastMovePerPointer.values(), ...lastDownPerPointer.values(), ...lastUpPerPointer.values()];\n                this._processEnterLeaveAndEmit(receiver, proxy, lastUpDownMoveEvents);\n                this._processCancelAndEmit(receiver, proxy);\n                this._processWheelAndEmit(receiver, proxy);\n            }\n        }\n    }\n    /**\n     * Given the tracked objects, update pointer containment given the provided contains()\n     * @param receiver\n     * @param objects\n     */\n    processPointerToObject(receiver, objects) {\n        // Pre-process find entities under pointers\n        for (let objectIndex = 0; objectIndex < objects.length; objectIndex++) {\n            const object = objects[objectIndex];\n            const proxy = this._getProxy(object);\n            if (hasNestedEvents(object)) {\n                object._processPointerToObject(receiver);\n            }\n            for (const [pointerId, pos] of receiver.currentFramePointerCoords.entries()) {\n                if (proxy.contains(pos)) {\n                    this._addPointerToProxy(proxy, pointerId);\n                }\n            }\n        }\n    }\n    /**\n     * Clear current frames pointer-object associations and track last frame pointer-object associations\n     */\n    clear() {\n        this._lastFrameObjectToPointers.clear();\n        this._lastFrameObjectToPointers = new Map(this._currentFrameObjectToPointers);\n        this._currentFrameObjectToPointers.clear();\n    }\n    _processDownAndEmit(receiver, object) {\n        const lastDownPerPointer = new Map();\n        // Loop through down and dispatch to entities\n        for (const event of receiver.currentFrameDown) {\n            if (event.active && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\n                object.events.emit('pointerdown', event);\n                if (receiver.isDragStart(event.pointerId)) {\n                    object.events.emit('pointerdragstart', event);\n                }\n            }\n            lastDownPerPointer.set(event.pointerId, event);\n        }\n        return lastDownPerPointer;\n    }\n    _processUpAndEmit(receiver, object) {\n        const lastUpPerPointer = new Map();\n        // Loop through up and dispatch to entities\n        for (const event of receiver.currentFrameUp) {\n            if (event.active && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\n                object.events.emit('pointerup', event);\n                if (receiver.isDragEnd(event.pointerId)) {\n                    object.events.emit('pointerdragend', event);\n                }\n            }\n            lastUpPerPointer.set(event.pointerId, event);\n        }\n        return lastUpPerPointer;\n    }\n    _processMoveAndEmit(receiver, object) {\n        const lastMovePerPointer = new Map();\n        // Loop through move and dispatch to entities\n        for (const event of receiver.currentFrameMove) {\n            if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\n                // move\n                object.events.emit('pointermove', event);\n                if (receiver.isDragging(event.pointerId)) {\n                    object.events.emit('pointerdragmove', event);\n                }\n            }\n            lastMovePerPointer.set(event.pointerId, event);\n        }\n        return lastMovePerPointer;\n    }\n    _processEnterLeaveAndEmit(receiver, object, lastUpDownMoveEvents) {\n        // up, down, and move are considered for enter and leave\n        for (const event of lastUpDownMoveEvents) {\n            // enter\n            if (event.active && object.active() && this._entered(object, event.pointerId)) {\n                object.events.emit('pointerenter', event);\n                if (receiver.isDragging(event.pointerId)) {\n                    object.events.emit('pointerdragenter', event);\n                }\n                break;\n            }\n            if (event.active &&\n                object.active() &&\n                // leave can happen on move\n                (this._left(object, event.pointerId) ||\n                    // or leave can happen on pointer up\n                    (this._objectCurrentlyUnderPointer(object, event.pointerId) && event.type === 'up'))) {\n                object.events.emit('pointerleave', event);\n                if (receiver.isDragging(event.pointerId)) {\n                    object.events.emit('pointerdragleave', event);\n                }\n                break;\n            }\n        }\n    }\n    _processCancelAndEmit(receiver, object) {\n        // cancel\n        for (const event of receiver.currentFrameCancel) {\n            if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\n                object.events.emit('pointercancel', event);\n            }\n        }\n    }\n    _processWheelAndEmit(receiver, object) {\n        // wheel\n        for (const event of receiver.currentFrameWheel) {\n            // Currently the wheel only fires under the primary pointer '0'\n            if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, 0)) {\n                object.events.emit('pointerwheel', event);\n            }\n        }\n    }\n}\n\n;// ./TileMap/TileMap.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst TileMapEvents = {\n    PreUpdate: 'preupdate',\n    PostUpdate: 'postupdate',\n    PreDraw: 'predraw',\n    PostDraw: 'postdraw',\n    PointerUp: 'pointerup',\n    PointerDown: 'pointerdown',\n    PointerMove: 'pointermove',\n    PointerCancel: 'pointercancel'\n};\n/**\n * The TileMap provides a mechanism for doing flat 2D tiles rendered in a grid.\n *\n * TileMaps are useful for top down or side scrolling grid oriented games.\n */\nclass TileMap extends Entity {\n    flagCollidersDirty() {\n        this._collidersDirty = true;\n    }\n    flagTilesDirty() {\n        for (let i = 0; i < this.tiles.length; i++) {\n            if (this.tiles[i]) {\n                this.tiles[i].flagDirty();\n            }\n        }\n    }\n    get x() {\n        var _a;\n        return (_a = this.transform.pos.x) !== null && _a !== void 0 ? _a : 0;\n    }\n    set x(val) {\n        var _a;\n        if ((_a = this.transform) === null || _a === void 0 ? void 0 : _a.pos) {\n            this.get(TransformComponent).pos = vec(val, this.y);\n        }\n    }\n    get y() {\n        var _a, _b;\n        return (_b = (_a = this.transform) === null || _a === void 0 ? void 0 : _a.pos.y) !== null && _b !== void 0 ? _b : 0;\n    }\n    set y(val) {\n        var _a;\n        if ((_a = this.transform) === null || _a === void 0 ? void 0 : _a.pos) {\n            this.transform.pos = vec(this.x, val);\n        }\n    }\n    get z() {\n        var _a;\n        return (_a = this.transform.z) !== null && _a !== void 0 ? _a : 0;\n    }\n    set z(val) {\n        if (this.transform) {\n            this.transform.z = val;\n        }\n    }\n    get rotation() {\n        var _a, _b;\n        return (_b = (_a = this.transform) === null || _a === void 0 ? void 0 : _a.rotation) !== null && _b !== void 0 ? _b : 0;\n    }\n    set rotation(val) {\n        if (this.transform) {\n            this.transform.rotation = val;\n        }\n    }\n    get scale() {\n        var _a, _b;\n        return (_b = (_a = this.transform) === null || _a === void 0 ? void 0 : _a.scale) !== null && _b !== void 0 ? _b : Vector.One;\n    }\n    set scale(val) {\n        var _a;\n        if ((_a = this.transform) === null || _a === void 0 ? void 0 : _a.scale) {\n            this.transform.scale = val;\n        }\n    }\n    get pos() {\n        return this.transform.pos;\n    }\n    set pos(val) {\n        this.transform.pos = val;\n    }\n    get vel() {\n        return this._motion.vel;\n    }\n    set vel(val) {\n        this._motion.vel = val;\n    }\n    /**\n     * Width of the whole tile map in pixels\n     */\n    get width() {\n        return this.tileWidth * this.columns * this.scale.x;\n    }\n    /**\n     * Height of the whole tilemap in pixels\n     */\n    get height() {\n        return this.tileHeight * this.rows * this.scale.y;\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    /**\n     * @param options\n     */\n    constructor(options) {\n        var _a, _b, _c;\n        super([], options.name);\n        this.events = new EventEmitter();\n        this._token = 0;\n        this.logger = Logger.getInstance();\n        this.tiles = [];\n        this._rows = [];\n        this._cols = [];\n        this.renderFromTopOfGraphic = false;\n        this.meshingLookBehind = 10;\n        this._collidersDirty = true;\n        this._oldRotation = 0;\n        this._originalOffsets = new WeakMap();\n        this.meshingLookBehind = (_a = options.meshingLookBehind) !== null && _a !== void 0 ? _a : this.meshingLookBehind;\n        this.addComponent(new TransformComponent());\n        this.addComponent(new MotionComponent());\n        this.addComponent(new BodyComponent({\n            type: CollisionType.Fixed\n        }));\n        this.addComponent(new GraphicsComponent({\n            onPostDraw: (ctx, elapsedMs) => this.draw(ctx, elapsedMs)\n        }));\n        this.addComponent(new DebugGraphicsComponent((ctx, debugFlags) => this.debug(ctx, debugFlags), false));\n        this.addComponent(new ColliderComponent());\n        this.addComponent(new PointerComponent());\n        this.pointer = this.get(PointerComponent);\n        this._graphics = this.get(GraphicsComponent);\n        this.transform = this.get(TransformComponent);\n        this._motion = this.get(MotionComponent);\n        this.collider = this.get(ColliderComponent);\n        this._composite = this.collider.useCompositeCollider([]);\n        this.transform.pos = (_b = options.pos) !== null && _b !== void 0 ? _b : Vector.Zero;\n        this._oldPos = this.transform.pos.clone();\n        this._oldScale = this.transform.scale.clone();\n        this.renderFromTopOfGraphic = (_c = options.renderFromTopOfGraphic) !== null && _c !== void 0 ? _c : this.renderFromTopOfGraphic;\n        this.tileWidth = options.tileWidth;\n        this.tileHeight = options.tileHeight;\n        this.rows = options.rows;\n        this.columns = options.columns;\n        this._pointerEventDispatcher = new PointerEventsToObjectDispatcher();\n        this.tiles = new Array(this.rows * this.columns);\n        this._rows = new Array(this.rows);\n        this._cols = new Array(this.columns);\n        let currentCol = [];\n        for (let i = 0; i < this.columns; i++) {\n            for (let j = 0; j < this.rows; j++) {\n                const tile = new Tile({\n                    x: i,\n                    y: j,\n                    map: this\n                });\n                tile.map = this;\n                this.tiles[i + j * this.columns] = tile;\n                this._pointerEventDispatcher.addObject(tile, (vec) => {\n                    // TODO handle geometry/graphics\n                    return tile.bounds.contains(vec.worldPos);\n                }, () => true);\n                currentCol.push(tile);\n                if (!this._rows[j]) {\n                    this._rows[j] = [];\n                }\n                this._rows[j].push(tile);\n            }\n            this._cols[i] = currentCol;\n            currentCol = [];\n        }\n        this._graphics.localBounds = new BoundingBox({\n            left: 0,\n            top: 0,\n            right: this.columns * this.tileWidth * this.scale.x,\n            bottom: this.rows * this.tileHeight * this.scale.y\n        });\n    }\n    _initialize(engine) {\n        super._initialize(engine);\n        this._engine = engine;\n    }\n    _getOrSetColliderOriginalOffset(collider) {\n        var _a;\n        if (!this._originalOffsets.has(collider)) {\n            const originalOffset = collider.offset;\n            this._originalOffsets.set(collider, originalOffset);\n            return originalOffset;\n        }\n        else {\n            return (_a = this._originalOffsets.get(collider)) !== null && _a !== void 0 ? _a : Vector.Zero;\n        }\n    }\n    /**\n     * Tiles colliders based on the solid tiles in the tilemap.\n     */\n    _updateColliders() {\n        this.collider.$colliderRemoved.notifyAll(this._composite);\n        this._composite.clearColliders();\n        const colliders = [];\n        this._composite = this.collider.useCompositeCollider([]);\n        let current = null;\n        /**\n         * Returns wether or not the 2 boxes share an edge and are the same height\n         * @param prev\n         * @param next\n         * @returns true if they share and edge, false if not\n         */\n        const shareEdges = (prev, next) => {\n            if (prev && next) {\n                // same top/bottom\n                return (prev.top === next.top &&\n                    prev.bottom === next.bottom &&\n                    // Shared right/left edge\n                    prev.right === next.left);\n            }\n            return false;\n        };\n        /**\n         * Potentially merges the current collider into a list of previous ones, mutating the list\n         * If checkAndCombine returns true, the collider was successfully merged and should be thrown away\n         * @param current current collider to test\n         * @param colliders List of colliders to consider merging with\n         * @param maxLookBack The amount of colliders to look back for combination\n         * @returns false when no combination found, true when successfully combined\n         */\n        const checkAndCombine = (current, colliders, maxLookBack = this.meshingLookBehind) => {\n            if (!current) {\n                return false;\n            }\n            // walk backwards through the list of colliders and combine with the first that shares an edge\n            for (let i = colliders.length - 1; i >= 0; i--) {\n                if (maxLookBack-- < 0) {\n                    // blunt the O(n^2) algorithm a bit\n                    return false;\n                }\n                const prev = colliders[i];\n                if (shareEdges(prev, current)) {\n                    colliders[i] = prev.combine(current);\n                    return true;\n                }\n            }\n            return false;\n        };\n        // ? configurable bias perhaps, horizontal strips vs. vertical ones\n        // Bad tile collider packing algorithm\n        for (let i = 0; i < this.columns; i++) {\n            // Scan column for colliders\n            for (let j = 0; j < this.rows; j++) {\n                const tile = this.tiles[i + j * this.columns];\n                // Current tile in column is solid build up current collider\n                if (tile.solid) {\n                    // Use custom collider otherwise bounding box\n                    if (tile.getColliders().length > 0) {\n                        // tile with custom collider interrupting the current run\n                        for (const collider of tile.getColliders()) {\n                            const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n                            collider.offset = vec(tile.x * this.tileWidth * this.scale.x, tile.y * this.tileHeight * this.scale.y).add(originalOffset);\n                            collider.owner = this;\n                            this._composite.addCollider(collider);\n                        }\n                        //we push any current collider before nulling the current run\n                        if (current && !checkAndCombine(current, colliders)) {\n                            colliders.push(current);\n                        }\n                        current = null;\n                        // Use the bounding box\n                    }\n                    else {\n                        if (!current) {\n                            // no current run, start one\n                            current = tile.defaultGeometry;\n                        }\n                        else {\n                            // combine with current run\n                            current = current.combine(tile.defaultGeometry);\n                        }\n                    }\n                }\n                else {\n                    // Not solid skip and cut off the current collider\n                    // End of run check and combine\n                    if (current && !checkAndCombine(current, colliders)) {\n                        colliders.push(current);\n                    }\n                    current = null;\n                }\n            }\n            // After a column is complete check to see if it can be merged into the last one\n            // Eno of run check and combine\n            if (current && !checkAndCombine(current, colliders)) {\n                // else new collider if no combination\n                colliders.push(current);\n            }\n            current = null;\n        }\n        for (const c of colliders) {\n            const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\n            collider.owner = this;\n            this._composite.addCollider(collider);\n        }\n        this.collider.update();\n        // Notify that colliders have been updated\n        this.collider.$colliderAdded.notifyAll(this._composite);\n    }\n    /**\n     * Returns the {@apilink Tile} by index (row major order)\n     *\n     * Returns null if out of bounds\n     */\n    getTileByIndex(index) {\n        var _a;\n        return (_a = this.tiles[index]) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * Returns the {@apilink Tile} by its x and y integer coordinates\n     *\n     * Returns null if out of bounds\n     *\n     * For example, if I want the tile in fifth column (x), and second row (y):\n     * `getTile(4, 1)` 0 based, so 0 is the first in row/column\n     */\n    getTile(x, y) {\n        if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\n            return null;\n        }\n        return this.tiles[x + y * this.columns];\n    }\n    /**\n     * Returns the {@apilink Tile} by testing a point in world coordinates,\n     * returns `null` if no Tile was found.\n     */\n    getTileByPoint(point) {\n        const { x, y } = this._getTileCoordinates(point);\n        const tile = this.getTile(x, y);\n        if (x >= 0 && y >= 0 && x < this.columns && y < this.rows && tile) {\n            return tile;\n        }\n        return null;\n    }\n    _getTileCoordinates(point) {\n        // Convert to Tile Space point\n        point = this.transform.applyInverse(point);\n        const x = Math.floor(point.x / this.tileWidth);\n        const y = Math.floor(point.y / this.tileHeight);\n        return { x, y };\n    }\n    getRows() {\n        return this._rows;\n    }\n    getColumns() {\n        return this._cols;\n    }\n    /**\n     * Returns the on screen tiles for a tilemap, this will overshoot by a small amount because of the internal quad tree data structure.\n     *\n     * Useful if you need to perform specific logic on onscreen tiles\n     */\n    getOnScreenTiles() {\n        let worldBounds = this._engine.screen.getWorldBounds();\n        const maybeParallax = this.get(ParallaxComponent);\n        if (maybeParallax && this.isInitialized) {\n            let pos = this.pos;\n            const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\n            const parallaxOffset = this._engine.currentScene.camera.pos.scale(oneMinusFactor);\n            pos = pos.sub(parallaxOffset);\n            // adjust world bounds by parallax factor\n            worldBounds = worldBounds.translate(pos);\n        }\n        const bounds = this.transform.coordPlane === CoordPlane.Screen ? this._engine.screen.getScreenBounds() : worldBounds;\n        const topLeft = this._getTileCoordinates(bounds.topLeft);\n        const topRight = this._getTileCoordinates(bounds.topRight);\n        const bottomRight = this._getTileCoordinates(bounds.bottomRight);\n        const bottomLeft = this._getTileCoordinates(bounds.bottomLeft);\n        const tileStartX = Math.min(clamp(topLeft.x, 0, this.columns - 1), clamp(topRight.x, 0, this.columns - 1));\n        const tileStartY = Math.min(clamp(topLeft.y, 0, this.rows - 1), clamp(topRight.y, 0, this.rows - 1));\n        const tileEndX = Math.max(clamp(bottomRight.x, 0, this.columns - 1), clamp(bottomLeft.x, 0, this.columns - 1));\n        const tileEndY = Math.max(clamp(bottomRight.y, 0, this.rows - 1), clamp(bottomLeft.y, 0, this.rows - 1));\n        const tiles = [];\n        for (let x = tileStartX; x <= tileEndX; x++) {\n            for (let y = tileStartY; y <= tileEndY; y++) {\n                tiles.push(this.getTile(x, y));\n            }\n        }\n        return tiles;\n    }\n    /**\n     * @internal\n     */\n    _processPointerToObject(receiver) {\n        this._pointerEventDispatcher.processPointerToObject(receiver, this.tiles);\n    }\n    /**\n     * @internal\n     */\n    _dispatchPointerEvents(receiver) {\n        this._pointerEventDispatcher.dispatchEvents(receiver, this.tiles);\n    }\n    update(engine, elapsedMs) {\n        this._initialize(engine);\n        this.onPreUpdate(engine, elapsedMs);\n        this.emit('preupdate', new PreUpdateEvent(engine, elapsedMs, this));\n        // Update colliders\n        if (!this._oldPos.equals(this.pos) || this._oldRotation !== this.rotation || !this._oldScale.equals(this.scale)) {\n            this.flagCollidersDirty();\n            this.flagTilesDirty();\n        }\n        if (this._collidersDirty) {\n            this._collidersDirty = false;\n            this._updateColliders();\n        }\n        // Clear last frame's events\n        this._pointerEventDispatcher.clear();\n        this._token++;\n        this.pos.clone(this._oldPos);\n        this._oldRotation = this.rotation;\n        this.scale.clone(this._oldScale);\n        this.transform.pos = this.pos;\n        this.onPostUpdate(engine, elapsedMs);\n        this.emit('postupdate', new PostUpdateEvent(engine, elapsedMs, this));\n    }\n    /**\n     * Draws the tile map to the screen. Called by the {@apilink Scene}.\n     * @param ctx ExcaliburGraphicsContext\n     * @param elapsedMs  The number of milliseconds since the last draw\n     */\n    draw(ctx, elapsedMs) {\n        if (!this.isInitialized) {\n            return;\n        }\n        this.emit('predraw', new PreDrawEvent(ctx, elapsedMs, this)); // TODO fix event\n        let graphics, graphicsIndex, graphicsLen;\n        const tiles = this.getOnScreenTiles();\n        for (let i = 0; i < tiles.length; i++) {\n            const tile = tiles[i];\n            // get non-negative tile sprites\n            const offsets = tile.getGraphicsOffsets();\n            graphics = tile.getGraphics();\n            for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\n                // draw sprite, warning if sprite doesn't exist\n                const graphic = graphics[graphicsIndex];\n                const offset = offsets[graphicsIndex];\n                if (graphic) {\n                    if (hasGraphicsTick(graphic)) {\n                        graphic === null || graphic === void 0 ? void 0 : graphic.tick(elapsedMs, this._token);\n                    }\n                    const offsetY = this.renderFromTopOfGraphic ? 0 : graphic.height - this.tileHeight;\n                    graphic.draw(ctx, tile.x * this.tileWidth + offset.x, tile.y * this.tileHeight - offsetY + offset.y);\n                }\n            }\n        }\n        this.emit('postdraw', new PostDrawEvent(ctx, elapsedMs, this));\n    }\n    debug(gfx, debugFlags) {\n        const { showAll, showGrid, gridColor, gridWidth, showSolidBounds: showColliderBounds, solidBoundsColor: colliderBoundsColor, showColliderGeometry } = debugFlags.tilemap;\n        const { geometryColor, geometryLineWidth, geometryPointSize } = debugFlags.collider;\n        const width = this.tileWidth * this.columns * this.scale.x;\n        const height = this.tileHeight * this.rows * this.scale.y;\n        const pos = this.pos;\n        if (showGrid || showAll) {\n            for (let r = 0; r < this.rows + 1; r++) {\n                const yOffset = vec(0, r * this.tileHeight * this.scale.y);\n                gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), gridColor, gridWidth);\n            }\n            for (let c = 0; c < this.columns + 1; c++) {\n                const xOffset = vec(c * this.tileWidth * this.scale.x, 0);\n                gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), gridColor, gridWidth);\n            }\n        }\n        if (showAll || showColliderBounds || showColliderGeometry) {\n            const colliders = this._composite.getColliders();\n            gfx.save();\n            gfx.translate(this.pos.x, this.pos.y);\n            gfx.scale(this.scale.x, this.scale.y);\n            for (const collider of colliders) {\n                const bounds = collider.localBounds;\n                const pos = collider.worldPos.sub(this.pos);\n                if (showColliderBounds) {\n                    gfx.drawRectangle(pos, bounds.width, bounds.height, colliderBoundsColor);\n                }\n            }\n            gfx.restore();\n            if (showColliderGeometry) {\n                for (const collider of colliders) {\n                    collider.debug(gfx, geometryColor, { lineWidth: geometryLineWidth, pointSize: geometryPointSize });\n                }\n            }\n        }\n        if (showAll || showColliderBounds) {\n            gfx.save();\n            gfx.z = 999;\n            if (showColliderBounds) {\n                for (let i = 0; i < this.tiles.length; i++) {\n                    this.tiles[i].bounds.draw(gfx);\n                }\n            }\n            gfx.restore();\n        }\n    }\n}\n/**\n * TileMap Tile\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a {@apilink TileMap}.\n *\n * Tiles can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nclass Tile {\n    /**\n     * Return the world position of the top left corner of the tile\n     */\n    get pos() {\n        if (this._posDirty) {\n            this._recalculate();\n            this._posDirty = false;\n        }\n        return this._pos;\n    }\n    /**\n     * Width of the tile in pixels\n     */\n    get width() {\n        return this._width;\n    }\n    /**\n     * Height of the tile in pixels\n     */\n    get height() {\n        return this._height;\n    }\n    /**\n     * Wether this tile should be treated as solid by the tilemap\n     */\n    get solid() {\n        return this._solid;\n    }\n    /**\n     * Wether this tile should be treated as solid by the tilemap\n     */\n    set solid(val) {\n        var _a;\n        (_a = this.map) === null || _a === void 0 ? void 0 : _a.flagCollidersDirty();\n        this._solid = val;\n    }\n    /**\n     * Current list of graphics for this tile\n     */\n    getGraphics() {\n        return this._graphics;\n    }\n    /**\n     * Current list of offsets for this tile's graphics\n     */\n    getGraphicsOffsets() {\n        return this._offsets;\n    }\n    /**\n     * Add another {@apilink Graphic} to this TileMap tile\n     * @param graphic\n     */\n    addGraphic(graphic, options) {\n        this._graphics.push(graphic);\n        if (options === null || options === void 0 ? void 0 : options.offset) {\n            this._offsets.push(options.offset);\n        }\n        else {\n            this._offsets.push(Vector.Zero);\n        }\n    }\n    /**\n     * Remove an instance of a {@apilink Graphic} from this tile\n     */\n    removeGraphic(graphic) {\n        const index = this._graphics.indexOf(graphic);\n        if (index > -1) {\n            this._graphics.splice(index, 1);\n            this._offsets.splice(index, 1);\n        }\n    }\n    /**\n     * Clear all graphics from this tile\n     */\n    clearGraphics() {\n        this._graphics.length = 0;\n        this._offsets.length = 0;\n    }\n    /**\n     * Returns the list of colliders\n     */\n    getColliders() {\n        return this._colliders;\n    }\n    /**\n     * Adds a custom collider to the {@apilink Tile} to use instead of it's bounds\n     *\n     * If no collider is set but {@apilink Tile.solid} is set, the tile bounds are used as a collider.\n     *\n     * **Note!** the {@apilink Tile.solid} must be set to true for it to act as a \"fixed\" collider\n     * @param collider\n     */\n    addCollider(collider) {\n        this._colliders.push(collider);\n        this.map.flagCollidersDirty();\n    }\n    /**\n     * Removes a collider from the {@apilink Tile}\n     * @param collider\n     */\n    removeCollider(collider) {\n        const index = this._colliders.indexOf(collider);\n        if (index > -1) {\n            this._colliders.splice(index, 1);\n        }\n        this.map.flagCollidersDirty();\n    }\n    /**\n     * Clears all colliders from the {@apilink Tile}\n     */\n    clearColliders() {\n        this._colliders.length = 0;\n        this.map.flagCollidersDirty();\n    }\n    constructor(options) {\n        var _a, _b;\n        this._posDirty = false;\n        this.events = new EventEmitter();\n        this._solid = false;\n        this._graphics = [];\n        this._offsets = [];\n        /**\n         * Current list of colliders for this tile\n         */\n        this._colliders = [];\n        /**\n         * Arbitrary data storage per tile, useful for any game specific data\n         */\n        this.data = new Map();\n        this.x = options.x;\n        this.y = options.y;\n        this.map = options.map;\n        this._width = options.map.tileWidth * this.map.scale.x;\n        this._height = options.map.tileHeight * this.map.scale.y;\n        this.solid = (_a = options.solid) !== null && _a !== void 0 ? _a : this.solid;\n        this._graphics = (_b = options.graphics) !== null && _b !== void 0 ? _b : [];\n        this._recalculate();\n    }\n    flagDirty() {\n        return (this._posDirty = true);\n    }\n    _recalculate() {\n        const geometryPos = this.map.pos.add(vec(this.x * this.map.tileWidth, this.y * this.map.tileHeight));\n        this._geometry = new BoundingBox(geometryPos.x, geometryPos.y, geometryPos.x + this.map.tileWidth, geometryPos.y + this.map.tileHeight);\n        this._width = this.map.tileWidth * this.map.scale.x;\n        this._height = this.map.tileHeight * this.map.scale.y;\n        this._pos = this.map.pos.add(vec(this.x * this._width, this.y * this._height));\n        this._bounds = new BoundingBox(this._pos.x, this._pos.y, this._pos.x + this._width, this._pos.y + this._height);\n        if (this.map.rotation) {\n            this._bounds = this._bounds.rotate(this.map.rotation, this.map.pos);\n        }\n        this._posDirty = false;\n    }\n    /**\n     * Tile bounds in world space\n     */\n    get bounds() {\n        if (this._posDirty) {\n            this._recalculate();\n        }\n        return this._bounds;\n    }\n    get defaultGeometry() {\n        return this._geometry;\n    }\n    /**\n     * Tile position in world space\n     */\n    get center() {\n        if (this._posDirty) {\n            this._recalculate();\n        }\n        return new Vector(this._pos.x + this._width / 2, this._pos.y + this._height / 2);\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        if (handler) {\n            this.events.off(eventName, handler);\n        }\n        else {\n            this.events.off(eventName);\n        }\n    }\n}\n\n;// ./Camera.ts\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Container to house convenience strategy methods\n * @internal\n */\nclass StrategyContainer {\n    constructor(camera) {\n        this.camera = camera;\n    }\n    /**\n     * Creates and adds the {@apilink LockCameraToActorStrategy} on the current camera.\n     * @param actor The actor to lock the camera to\n     */\n    lockToActor(actor) {\n        this.camera.addStrategy(new LockCameraToActorStrategy(actor));\n    }\n    /**\n     * Creates and adds the {@apilink LockCameraToActorAxisStrategy} on the current camera\n     * @param actor The actor to lock the camera to\n     * @param axis The axis to follow the actor on\n     */\n    lockToActorAxis(actor, axis) {\n        this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\n    }\n    /**\n     * Creates and adds the {@apilink ElasticToActorStrategy} on the current camera\n     * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n     * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n     * correct and bounce around the target\n     * @param actor Target actor to elastically follow\n     * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n     * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n     */\n    elasticToActor(actor, cameraElasticity, cameraFriction) {\n        this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\n    }\n    /**\n     * Creates and adds the {@apilink RadiusAroundActorStrategy} on the current camera\n     * @param actor Target actor to follow when it is \"radius\" pixels away\n     * @param radius Number of pixels away before the camera will follow\n     */\n    radiusAroundActor(actor, radius) {\n        this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\n    }\n    /**\n     * Creates and adds the {@apilink LimitCameraBoundsStrategy} on the current camera\n     * @param box The bounding box to limit the camera to.\n     */\n    limitCameraBounds(box) {\n        this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\n    }\n}\n/**\n * Camera axis enum\n */\nvar Axis;\n(function (Axis) {\n    Axis[Axis[\"X\"] = 0] = \"X\";\n    Axis[Axis[\"Y\"] = 1] = \"Y\";\n})(Axis || (Axis = {}));\n/**\n * Lock a camera to the exact x/y position of an actor.\n */\nclass LockCameraToActorStrategy {\n    constructor(target) {\n        this.target = target;\n        this.action = (target, camera, engine, elapsedMs) => {\n            const center = target.center;\n            return center;\n        };\n    }\n}\n/**\n * Lock a camera to a specific axis around an actor.\n */\nclass LockCameraToActorAxisStrategy {\n    constructor(target, axis) {\n        this.target = target;\n        this.axis = axis;\n        this.action = (target, cam, _eng, elapsedMs) => {\n            const center = target.center;\n            const currentFocus = cam.getFocus();\n            if (this.axis === Axis.X) {\n                return new Vector(center.x, currentFocus.y);\n            }\n            else {\n                return new Vector(currentFocus.x, center.y);\n            }\n        };\n    }\n}\n/**\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\n */\nclass ElasticToActorStrategy {\n    /**\n     * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n     * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n     * correct and bounce around the target\n     * @param target Target actor to elastically follow\n     * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n     * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n     */\n    constructor(target, cameraElasticity, cameraFriction) {\n        this.target = target;\n        this.cameraElasticity = cameraElasticity;\n        this.cameraFriction = cameraFriction;\n        this.action = (target, cam, _eng, elapsedMs) => {\n            const position = target.center;\n            let focus = cam.getFocus();\n            let cameraVel = cam.vel.clone();\n            // Calculate the stretch vector, using the spring equation\n            // F = kX\n            // https://en.wikipedia.org/wiki/Hooke's_law\n            // Apply to the current camera velocity\n            const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\n            cameraVel = cameraVel.add(stretch);\n            // Calculate the friction (-1 to apply a force in the opposition of motion)\n            // Apply to the current camera velocity\n            const friction = cameraVel.scale(-1).scale(this.cameraFriction);\n            cameraVel = cameraVel.add(friction);\n            // Update position by velocity deltas\n            focus = focus.add(cameraVel);\n            return focus;\n        };\n    }\n}\nclass RadiusAroundActorStrategy {\n    /**\n     *\n     * @param target Target actor to follow when it is \"radius\" pixels away\n     * @param radius Number of pixels away before the camera will follow\n     */\n    constructor(target, radius) {\n        this.target = target;\n        this.radius = radius;\n        this.action = (target, cam, _eng, elapsedMs) => {\n            const position = target.center;\n            const focus = cam.getFocus();\n            const direction = position.sub(focus);\n            const distance = direction.magnitude;\n            if (distance >= this.radius) {\n                const offset = distance - this.radius;\n                return focus.add(direction.normalize().scale(offset));\n            }\n            return focus;\n        };\n    }\n}\n/**\n * Prevent a camera from going beyond the given camera dimensions.\n */\nclass LimitCameraBoundsStrategy {\n    constructor(target) {\n        this.target = target;\n        /**\n         * Useful for limiting the camera to a {@apilink TileMap}'s dimensions, or a specific area inside the map.\n         *\n         * Note that this strategy does not perform any movement by itself.\n         * It only sets the camera position to within the given bounds when the camera has gone beyond them.\n         * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\n         *\n         * Make sure that the camera bounds are at least as large as the viewport size.\n         * @param target The bounding box to limit the camera to\n         */\n        this.boundSizeChecked = false; // Check and warn only once\n        this.action = (target, cam, _eng, elapsedMs) => {\n            const focus = cam.getFocus();\n            if (!this.boundSizeChecked) {\n                if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\n                    Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\n                }\n                this.boundSizeChecked = true;\n            }\n            let focusX = focus.x;\n            let focusY = focus.y;\n            if (focus.x < target.left + _eng.halfDrawWidth) {\n                focusX = target.left + _eng.halfDrawWidth;\n            }\n            else if (focus.x > target.right - _eng.halfDrawWidth) {\n                focusX = target.right - _eng.halfDrawWidth;\n            }\n            if (focus.y < target.top + _eng.halfDrawHeight) {\n                focusY = target.top + _eng.halfDrawHeight;\n            }\n            else if (focus.y > target.bottom - _eng.halfDrawHeight) {\n                focusY = target.bottom - _eng.halfDrawHeight;\n            }\n            return vec(focusX, focusY);\n        };\n    }\n}\nconst CameraEvents = {\n    Initialize: 'initialize',\n    PreUpdate: 'preupdate',\n    PostUpdate: 'postupdate'\n};\n/**\n * Cameras\n *\n * {@apilink Camera} is the base class for all Excalibur cameras. Cameras are used\n * to move around your game and set focus. They are used to determine\n * what is \"off screen\" and can be used to scale the game.\n *\n */\nclass Camera {\n    constructor() {\n        this.events = new EventEmitter();\n        this.transform = AffineMatrix.identity();\n        this.inverse = AffineMatrix.identity();\n        this._cameraStrategies = [];\n        this.strategy = new StrategyContainer(this);\n        /**\n         * Get or set current zoom of the camera, defaults to 1\n         */\n        this._z = 1;\n        /**\n         * Get or set rate of change in zoom, defaults to 0\n         */\n        this.dz = 0;\n        /**\n         * Get or set zoom acceleration\n         */\n        this.az = 0;\n        /**\n         * Current rotation of the camera\n         */\n        this.rotation = 0;\n        this._angularVelocity = 0;\n        this._posChanged = false;\n        this._pos = new WatchVector(Vector.Zero, () => {\n            this._posChanged = true;\n        });\n        /**\n         * Interpolated camera position if more draws are running than updates\n         *\n         * Enabled when `Engine.fixedUpdateFps` is enabled, in all other cases this will be the same as pos\n         */\n        this.drawPos = this.pos.clone();\n        this._oldPos = this.pos.clone();\n        /**\n         * Get or set the camera's velocity\n         */\n        this.vel = Vector.Zero;\n        /**\n         * Get or set the camera's acceleration\n         */\n        this.acc = Vector.Zero;\n        this._cameraMoving = false;\n        this._currentLerpTime = 0;\n        this._lerpDuration = 1000; // 1 second\n        this._lerpStart = null;\n        this._lerpEnd = null;\n        //camera effects\n        this._isShaking = false;\n        this._shakeMagnitudeX = 0;\n        this._shakeMagnitudeY = 0;\n        this._shakeDuration = 0;\n        this._elapsedShakeTime = 0;\n        this._xShake = 0;\n        this._yShake = 0;\n        this._isZooming = false;\n        this._zoomStart = 1;\n        this._zoomEnd = 1;\n        this._currentZoomTime = 0;\n        this._zoomDuration = 0;\n        this._zoomEasing = EasingFunctions.EaseInOutCubic;\n        this._easing = EasingFunctions.EaseInOutCubic;\n        this._halfWidth = 0;\n        this._halfHeight = 0;\n        this._viewport = null;\n        this._isInitialized = false;\n        this._snapPos = vec(0, 0);\n    }\n    get zoom() {\n        return this._z;\n    }\n    set zoom(val) {\n        this._z = val;\n        if (this._engine) {\n            this._halfWidth = this._engine.halfDrawWidth;\n            this._halfHeight = this._engine.halfDrawHeight;\n        }\n    }\n    /**\n     * Get or set the camera's angular velocity\n     */\n    get angularVelocity() {\n        return this._angularVelocity;\n    }\n    set angularVelocity(value) {\n        this._angularVelocity = value;\n    }\n    /**\n     * Get or set the camera's position\n     */\n    get pos() {\n        return this._pos;\n    }\n    set pos(vec) {\n        this._posChanged = true;\n        this._pos = new WatchVector(vec, () => {\n            this._posChanged = true;\n        });\n    }\n    /**\n     * Has the position changed since the last update\n     */\n    hasChanged() {\n        return this._posChanged;\n    }\n    /**\n     * Get the camera's x position\n     */\n    get x() {\n        return this.pos.x;\n    }\n    /**\n     * Set the camera's x position (cannot be set when following an {@apilink Actor} or when moving)\n     */\n    set x(value) {\n        if (!this._follow && !this._cameraMoving) {\n            this.pos = vec(value, this.pos.y);\n        }\n    }\n    /**\n     * Get the camera's y position\n     */\n    get y() {\n        return this.pos.y;\n    }\n    /**\n     * Set the camera's y position (cannot be set when following an {@apilink Actor} or when moving)\n     */\n    set y(value) {\n        if (!this._follow && !this._cameraMoving) {\n            this.pos = vec(this.pos.x, value);\n        }\n    }\n    /**\n     * Get or set the camera's x velocity\n     */\n    get dx() {\n        return this.vel.x;\n    }\n    set dx(value) {\n        this.vel = vec(value, this.vel.y);\n    }\n    /**\n     * Get or set the camera's y velocity\n     */\n    get dy() {\n        return this.vel.y;\n    }\n    set dy(value) {\n        this.vel = vec(this.vel.x, value);\n    }\n    /**\n     * Get or set the camera's x acceleration\n     */\n    get ax() {\n        return this.acc.x;\n    }\n    set ax(value) {\n        this.acc = vec(value, this.acc.y);\n    }\n    /**\n     * Get or set the camera's y acceleration\n     */\n    get ay() {\n        return this.acc.y;\n    }\n    set ay(value) {\n        this.acc = vec(this.acc.x, value);\n    }\n    /**\n     * Returns the focal point of the camera, a new point giving the x and y position of the camera\n     */\n    getFocus() {\n        return this.pos;\n    }\n    /**\n     * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\n     * @param pos The target position to move to\n     * @param duration The duration in milliseconds the move should last\n     * @param [easingFn] An optional easing function ({@apilink EasingFunctions.EaseInOutCubic} by default)\n     * @returns A {@apilink Promise} that resolves when movement is finished, including if it's interrupted.\n     *          The {@apilink Promise} value is the {@apilink Vector} of the target position. It will be rejected if a move cannot be made.\n     */\n    move(pos, duration, easingFn = EasingFunctions.EaseInOutCubic) {\n        if (typeof easingFn !== 'function') {\n            throw 'Please specify an EasingFunction';\n        }\n        // cannot move when following an actor\n        if (this._follow) {\n            return Promise.reject(pos);\n        }\n        // resolve existing promise, if any\n        if (this._lerpPromise && this._lerpResolve) {\n            this._lerpResolve(pos);\n        }\n        this._lerpPromise = new Promise((resolve) => {\n            this._lerpResolve = resolve;\n        });\n        this._lerpStart = this.getFocus().clone();\n        this._lerpDuration = duration;\n        this._lerpEnd = pos;\n        this._currentLerpTime = 0;\n        this._cameraMoving = true;\n        this._easing = easingFn;\n        return this._lerpPromise;\n    }\n    /**\n     * Sets the camera to shake at the specified magnitudes for the specified duration\n     * @param magnitudeX  The x magnitude of the shake\n     * @param magnitudeY  The y magnitude of the shake\n     * @param duration    The duration of the shake in milliseconds\n     */\n    shake(magnitudeX, magnitudeY, duration) {\n        this._isShaking = true;\n        this._shakeMagnitudeX = magnitudeX;\n        this._shakeMagnitudeY = magnitudeY;\n        this._shakeDuration = duration;\n    }\n    /**\n     * Zooms the camera in or out by the specified scale over the specified duration.\n     * If no duration is specified, it take effect immediately.\n     * @param scale    The scale of the zoom\n     * @param duration The duration of the zoom in milliseconds\n     */\n    zoomOverTime(scale, duration = 0, easingFn = EasingFunctions.EaseInOutCubic) {\n        this._zoomPromise = new Promise((resolve) => {\n            this._zoomResolve = resolve;\n        });\n        if (duration) {\n            this._isZooming = true;\n            this._zoomEasing = easingFn;\n            this._currentZoomTime = 0;\n            this._zoomDuration = duration;\n            this._zoomStart = this.zoom;\n            this._zoomEnd = scale;\n        }\n        else {\n            this._isZooming = false;\n            this.zoom = scale;\n            return Promise.resolve(true);\n        }\n        return this._zoomPromise;\n    }\n    /**\n     * Gets the bounding box of the viewport of this camera in world coordinates\n     */\n    get viewport() {\n        if (this._viewport) {\n            return this._viewport;\n        }\n        return new BoundingBox(0, 0, 0, 0);\n    }\n    /**\n     * Adds a new camera strategy to this camera\n     * @param cameraStrategy Instance of an {@apilink CameraStrategy}\n     */\n    addStrategy(cameraStrategy) {\n        this._cameraStrategies.push(cameraStrategy);\n    }\n    /**\n     * Removes a camera strategy by reference\n     * @param cameraStrategy Instance of an {@apilink CameraStrategy}\n     */\n    removeStrategy(cameraStrategy) {\n        removeItemFromArray(cameraStrategy, this._cameraStrategies);\n    }\n    /**\n     * Clears all camera strategies from the camera\n     */\n    clearAllStrategies() {\n        this._cameraStrategies.length = 0;\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\n     * @internal\n     */\n    _preupdate(engine, elapsedMs) {\n        this.events.emit('preupdate', new PreUpdateEvent(engine, elapsedMs, this));\n        this.onPreUpdate(engine, elapsedMs);\n    }\n    /**\n     * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPreUpdate` is called directly before a scene is updated.\n     */\n    onPreUpdate(engine, elapsedMs) {\n        // Overridable\n    }\n    /**\n     *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\n     * @internal\n     */\n    _postupdate(engine, elapsedMs) {\n        this.events.emit('postupdate', new PostUpdateEvent(engine, elapsedMs, this));\n        this.onPostUpdate(engine, elapsedMs);\n    }\n    /**\n     * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPostUpdate` is called directly after a scene is updated.\n     */\n    onPostUpdate(engine, elapsedMs) {\n        // Overridable\n    }\n    get isInitialized() {\n        return this._isInitialized;\n    }\n    _initialize(engine) {\n        if (!this.isInitialized) {\n            this._engine = engine;\n            this._screen = engine.screen;\n            const currentRes = this._screen.contentArea;\n            let center = vec(currentRes.width / 2, currentRes.height / 2);\n            if (!this._engine.loadingComplete) {\n                // If there was a loading screen, we peek the configured resolution\n                const res = this._screen.peekResolution();\n                if (res) {\n                    center = vec(res.width / 2, res.height / 2);\n                }\n            }\n            this._halfWidth = center.x;\n            this._halfHeight = center.y;\n            // If the user has not set the camera pos, apply default center screen position\n            if (!this._posChanged) {\n                this.pos = center;\n            }\n            this.pos.clone(this.drawPos);\n            // First frame bootstrap\n            // Ensure camera tx is correct\n            // Run update twice to ensure properties are init'd\n            this.updateTransform(this.pos);\n            // Run strategies for first frame\n            this.runStrategies(engine, engine.clock.elapsed());\n            // Setup the first frame viewport\n            this.updateViewport();\n            // It's important to update the camera after strategies\n            // This prevents jitter\n            this.updateTransform(this.pos);\n            this.pos.clone(this._oldPos);\n            this.onInitialize(engine);\n            this.events.emit('initialize', new InitializeEvent(engine, this));\n            this._isInitialized = true;\n        }\n    }\n    /**\n     * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPostUpdate` is called directly after a scene is updated.\n     */\n    onInitialize(engine) {\n        // Overridable\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    runStrategies(engine, elapsedMs) {\n        for (const s of this._cameraStrategies) {\n            this.pos = s.action.call(s, s.target, this, engine, elapsedMs);\n        }\n    }\n    updateViewport() {\n        // recalculate viewport\n        this._viewport = new BoundingBox(this.x - this._halfWidth, this.y - this._halfHeight, this.x + this._halfWidth, this.y + this._halfHeight);\n    }\n    update(engine, elapsedMs) {\n        this._initialize(engine);\n        this._preupdate(engine, elapsedMs);\n        this.pos.clone(this._oldPos);\n        // Update placements based on linear algebra\n        this.pos = this.pos.add(this.vel.scale(elapsedMs / 1000));\n        this.zoom += (this.dz * elapsedMs) / 1000;\n        this.vel = this.vel.add(this.acc.scale(elapsedMs / 1000));\n        this.dz += (this.az * elapsedMs) / 1000;\n        this.rotation += (this.angularVelocity * elapsedMs) / 1000;\n        if (this._isZooming) {\n            if (this._currentZoomTime < this._zoomDuration) {\n                const zoomEasing = this._zoomEasing;\n                const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\n                this.zoom = newZoom;\n                this._currentZoomTime += elapsedMs;\n            }\n            else {\n                this._isZooming = false;\n                this.zoom = this._zoomEnd;\n                this._currentZoomTime = 0;\n                this._zoomResolve(true);\n            }\n        }\n        if (this._cameraMoving) {\n            if (this._currentLerpTime < this._lerpDuration) {\n                const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n                const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\n                this.pos = lerpPoint;\n                this._currentLerpTime += elapsedMs;\n            }\n            else {\n                this.pos = this._lerpEnd;\n                const end = this._lerpEnd.clone();\n                this._lerpStart = null;\n                this._lerpEnd = null;\n                this._currentLerpTime = 0;\n                this._cameraMoving = false;\n                // Order matters here, resolve should be last so any chain promises have a clean slate\n                this._lerpResolve(end);\n            }\n        }\n        if (this._isDoneShaking()) {\n            this._isShaking = false;\n            this._elapsedShakeTime = 0;\n            this._shakeMagnitudeX = 0;\n            this._shakeMagnitudeY = 0;\n            this._shakeDuration = 0;\n            this._xShake = 0;\n            this._yShake = 0;\n        }\n        else {\n            this._elapsedShakeTime += elapsedMs;\n            this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\n            this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\n        }\n        this.runStrategies(engine, elapsedMs);\n        this.updateViewport();\n        // It's important to update the camera after strategies\n        // This prevents jitter\n        this.updateTransform(this.pos);\n        this._postupdate(engine, elapsedMs);\n        this._posChanged = false;\n    }\n    /**\n     * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\n     * @param ctx Canvas context to apply transformations\n     */\n    draw(ctx) {\n        // default to the current position\n        this.pos.clone(this.drawPos);\n        // interpolation if fixed update is on\n        // must happen on the draw, because more draws are potentially happening than updates\n        if (this._engine.fixedUpdateTimestep) {\n            const blend = this._engine.currentFrameLagMs / this._engine.fixedUpdateTimestep;\n            const interpolatedPos = this.pos.scale(blend).add(this._oldPos.scale(1.0 - blend));\n            interpolatedPos.clone(this.drawPos);\n            this.updateTransform(interpolatedPos);\n        }\n        // Snap camera to pixel\n        if (ctx.snapToPixel) {\n            const snapPos = this.drawPos.clone(this._snapPos);\n            snapPos.x = ~~(snapPos.x + pixelSnapEpsilon * sign(snapPos.x));\n            snapPos.y = ~~(snapPos.y + pixelSnapEpsilon * sign(snapPos.y));\n            snapPos.clone(this.drawPos);\n            this.updateTransform(snapPos);\n        }\n        ctx.multiply(this.transform);\n    }\n    updateTransform(pos) {\n        // center the camera\n        const newCanvasWidth = this._screen.resolution.width / this.zoom;\n        const newCanvasHeight = this._screen.resolution.height / this.zoom;\n        const cameraPos = vec(-pos.x + newCanvasWidth / 2 + this._xShake, -pos.y + newCanvasHeight / 2 + this._yShake);\n        // Calculate camera transform\n        this.transform.reset();\n        this.transform.scale(this.zoom, this.zoom);\n        // rotate about the focus\n        this.transform.translate(newCanvasWidth / 2, newCanvasHeight / 2);\n        this.transform.rotate(this.rotation);\n        this.transform.translate(-newCanvasWidth / 2, -newCanvasHeight / 2);\n        this.transform.translate(cameraPos.x, cameraPos.y);\n        this.transform.inverse(this.inverse);\n    }\n    _isDoneShaking() {\n        return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\n    }\n}\n\n;// ./Trigger.ts\n\n\n\n\nconst TriggerEvents = {\n    ExitTrigger: 'exit',\n    EnterTrigger: 'enter'\n};\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when {@apilink Trigger.visible} is set to `true`.\n */\nclass Trigger extends Actor {\n    /**\n     * @param options Trigger options\n     */\n    constructor(options) {\n        var _a, _b, _c, _d;\n        super({ ...options });\n        this.events = new EventEmitter();\n        this.filter = (_a = options.filter) !== null && _a !== void 0 ? _a : (() => true);\n        this.repeat = (_b = options.repeat) !== null && _b !== void 0 ? _b : -1;\n        this.action = (_c = options.action) !== null && _c !== void 0 ? _c : (() => undefined);\n        this.target = options.target;\n        this.graphics.isVisible = (_d = options.visible) !== null && _d !== void 0 ? _d : false;\n        this.body.collisionType = CollisionType.Passive;\n        this.events.on('collisionstart', ({ other: collider }) => {\n            if (!this._matchesTarget(collider.owner)) {\n                return;\n            }\n            this.events.emit('enter', new EnterTriggerEvent(this, collider.owner));\n            this._dispatchAction(collider.owner);\n            // remove trigger if its done, -1 repeat forever\n            if (this.repeat === 0) {\n                this.kill();\n            }\n        });\n        this.events.on('collisionend', ({ other: collider }) => {\n            if (this._matchesTarget(collider.owner)) {\n                this.events.emit('exit', new ExitTriggerEvent(this, collider.owner));\n            }\n        });\n    }\n    _matchesTarget(entity) {\n        return this.filter(entity) && (this.target === undefined || this.target === entity);\n    }\n    _dispatchAction(target) {\n        if (this.repeat !== 0) {\n            this.action.call(this, target);\n            this.repeat--;\n        }\n    }\n}\n\n;// ./EntityComponentSystem/Priority.ts\n/**\n * Higher priorities run earlier than others in the system update\n */\nconst SystemPriority = {\n    Highest: -Infinity,\n    Higher: -5,\n    Average: 0,\n    Lower: 5,\n    Lowest: Infinity\n};\n\n;// ./EntityComponentSystem/System.ts\n\n/**\n * Enum that determines whether to run the system in the update or draw phase\n */\nvar SystemType;\n(function (SystemType) {\n    SystemType[\"Update\"] = \"update\";\n    SystemType[\"Draw\"] = \"draw\";\n})(SystemType || (SystemType = {}));\n/**\n * An Excalibur {@apilink System} that updates entities of certain types.\n * Systems are scene specific\n *\n *\n *\n * Excalibur Systems currently require at least 1 Component type to operated\n *\n * Multiple types are declared as a type union\n * For example:\n *\n * ```typescript\n * class MySystem extends System {\n *   public readonly types = ['a', 'b'] as const;\n *   public readonly systemType = SystemType.Update;\n *   public update(elapsedMs) {\n *      ...\n *   }\n * }\n * ```\n */\nclass System {\n}\n/**\n * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\n * For a system to execute before all other a lower priority value (-1 for example) must be set.\n * For a system to execute after all other a higher priority value (10 for example) must be set.\n */\nSystem.priority = SystemPriority.Average;\n\n;// ./EntityComponentSystem/EntityManager.ts\n\n\n// Add/Remove entities and components\nclass EntityManager {\n    constructor(_world) {\n        this._world = _world;\n        this.entities = [];\n        this._entityIndex = {};\n        this._childAddedHandlerMap = new Map();\n        this._childRemovedHandlerMap = new Map();\n        this._createChildAddedHandler = () => (e) => {\n            this.addEntity(e);\n        };\n        this._createChildRemovedHandler = () => (e) => {\n            this.removeEntity(e, false);\n        };\n        this._entitiesToRemove = [];\n    }\n    /**\n     * Runs the entity lifecycle\n     * @param scene\n     * @param elapsed\n     */\n    updateEntities(scene, elapsed) {\n        for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\n            const entity = this.entities[entityIndex];\n            entity.update(scene.engine, elapsed);\n            if (!entity.isActive) {\n                this.removeEntity(entity);\n            }\n        }\n    }\n    findEntitiesForRemoval() {\n        for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\n            const entity = this.entities[entityIndex];\n            if (!entity.isActive) {\n                this.removeEntity(entity);\n            }\n        }\n    }\n    /**\n     * Adds an entity to be tracked by the EntityManager\n     * @param entity\n     */\n    addEntity(entity) {\n        entity.isActive = true;\n        entity.scene = this._world.scene;\n        if (entity && !this._entityIndex[entity.id]) {\n            this._entityIndex[entity.id] = entity;\n            this.entities.push(entity);\n            this._world.queryManager.addEntity(entity);\n            // if entity has children\n            entity.children.forEach((c) => {\n                c.scene = entity.scene;\n                this.addEntity(c);\n            });\n            const childAdded = this._createChildAddedHandler();\n            this._childAddedHandlerMap.set(entity, childAdded);\n            const childRemoved = this._createChildRemovedHandler();\n            this._childRemovedHandlerMap.set(entity, childRemoved);\n            entity.childrenAdded$.subscribe(childAdded);\n            entity.childrenRemoved$.subscribe(childRemoved);\n        }\n    }\n    removeEntity(idOrEntity, deferred = true) {\n        var _a, _b;\n        let id = 0;\n        if (idOrEntity instanceof Entity) {\n            id = idOrEntity.id;\n        }\n        else {\n            id = idOrEntity;\n        }\n        const entity = this._entityIndex[id];\n        if (entity && entity.isActive) {\n            entity.isActive = false;\n        }\n        if (entity && deferred) {\n            this._entitiesToRemove.push(entity);\n            return;\n        }\n        delete this._entityIndex[id];\n        if (entity) {\n            entity.scene = null;\n            removeItemFromArray(entity, this.entities);\n            this._world.queryManager.removeEntity(entity);\n            // if entity has children\n            entity.children.forEach((c) => {\n                c.scene = null;\n                this.removeEntity(c, deferred);\n            });\n            const childAddedHandler = this._childAddedHandlerMap.get(entity);\n            if (childAddedHandler) {\n                entity.childrenAdded$.unsubscribe(childAddedHandler);\n            }\n            const childRemovedHandler = this._childRemovedHandlerMap.get(entity);\n            if (childRemovedHandler) {\n                entity.childrenRemoved$.unsubscribe(childRemovedHandler);\n            }\n            // stats\n            if ((_b = (_a = this._world) === null || _a === void 0 ? void 0 : _a.scene) === null || _b === void 0 ? void 0 : _b.engine) {\n                this._world.scene.engine.stats.currFrame.actors.killed++;\n            }\n        }\n    }\n    processEntityRemovals() {\n        for (let entityIndex = 0; entityIndex < this._entitiesToRemove.length; entityIndex++) {\n            const entity = this._entitiesToRemove[entityIndex];\n            if (entity.isActive) {\n                continue;\n            }\n            this.removeEntity(entity, false);\n        }\n        this._entitiesToRemove.length = 0;\n    }\n    processComponentRemovals() {\n        for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\n            const entity = this.entities[entityIndex];\n            entity.processComponentRemoval();\n        }\n    }\n    getById(id) {\n        return this._entityIndex[id];\n    }\n    getByName(name) {\n        return this.entities.filter((e) => e.name === name);\n    }\n    clear() {\n        for (let i = this.entities.length - 1; i >= 0; i--) {\n            this.removeEntity(this.entities[i]);\n        }\n    }\n}\n\n;// ./EntityComponentSystem/Query.ts\n\n/**\n * Represents query for entities that match a list of types that is cached and observable\n *\n * Queries can be strongly typed by supplying a type union in the optional type parameter\n * ```typescript\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\n * ```\n */\nclass Query {\n    constructor(requiredComponents) {\n        this.requiredComponents = requiredComponents;\n        this.components = new Set();\n        this.entities = [];\n        /**\n         * This fires right after the component is added\n         */\n        this.entityAdded$ = new Observable();\n        /**\n         * This fires right before the component is actually removed from the entity, it will still be available for cleanup purposes\n         */\n        this.entityRemoved$ = new Observable();\n        if (requiredComponents.length === 0) {\n            throw new Error('Cannot create query without components');\n        }\n        for (const type of requiredComponents) {\n            this.components.add(type);\n        }\n        this.id = Query.createId(requiredComponents);\n    }\n    static createId(requiredComponents) {\n        // TODO what happens if a user defines the same type name as a built in type\n        // ! TODO this could be dangerous depending on the bundler's settings for names\n        // Maybe some kind of hash function is better here?\n        return requiredComponents\n            .slice()\n            .map((c) => c.name)\n            .sort()\n            .join('-');\n    }\n    /**\n     * Potentially adds an entity to a query index, returns true if added, false if not\n     * @param entity\n     */\n    checkAndAdd(entity) {\n        if (!this.entities.includes(entity) && entity.hasAll(Array.from(this.components))) {\n            this.entities.push(entity);\n            this.entityAdded$.notifyAll(entity);\n            return true;\n        }\n        return false;\n    }\n    removeEntity(entity) {\n        const index = this.entities.indexOf(entity);\n        if (index > -1) {\n            this.entities.splice(index, 1);\n            this.entityRemoved$.notifyAll(entity);\n        }\n    }\n    /**\n     * Returns a list of entities that match the query\n     * @param sort Optional sorting function to sort entities returned from the query\n     */\n    getEntities(sort) {\n        if (sort) {\n            this.entities.sort(sort);\n        }\n        return this.entities;\n    }\n}\n\n;// ./EntityComponentSystem/TagQuery.ts\n\nclass TagQuery {\n    constructor(requiredTags) {\n        this.requiredTags = requiredTags;\n        this.tags = new Set();\n        this.entities = [];\n        /**\n         * This fires right after the component is added\n         */\n        this.entityAdded$ = new Observable();\n        /**\n         * This fires right before the component is actually removed from the entity, it will still be available for cleanup purposes\n         */\n        this.entityRemoved$ = new Observable();\n        if (requiredTags.length === 0) {\n            throw new Error('Cannot create tag query without tags');\n        }\n        for (const tag of requiredTags) {\n            this.tags.add(tag);\n        }\n        this.id = TagQuery.createId(requiredTags);\n    }\n    static createId(requiredComponents) {\n        return requiredComponents.slice().sort().join('-');\n    }\n    checkAndAdd(entity) {\n        if (!this.entities.includes(entity) && entity.hasAllTags(Array.from(this.tags))) {\n            this.entities.push(entity);\n            this.entityAdded$.notifyAll(entity);\n            return true;\n        }\n        return false;\n    }\n    removeEntity(entity) {\n        const index = this.entities.indexOf(entity);\n        if (index > -1) {\n            this.entities.splice(index, 1);\n            this.entityRemoved$.notifyAll(entity);\n        }\n    }\n    /**\n     * Returns a list of entities that match the query\n     * @param sort Optional sorting function to sort entities returned from the query\n     */\n    getEntities(sort) {\n        if (sort) {\n            this.entities.sort(sort);\n        }\n        return this.entities;\n    }\n}\n\n;// ./EntityComponentSystem/QueryManager.ts\n\n\n/**\n * The query manager is responsible for updating all queries when entities/components change\n */\nclass QueryManager {\n    constructor(_world) {\n        this._world = _world;\n        this._queries = new Map();\n        this._addComponentHandlers = new Map();\n        this._removeComponentHandlers = new Map();\n        this._componentToQueriesIndex = new Map();\n        this._tagQueries = new Map();\n        this._addTagHandlers = new Map();\n        this._removeTagHandlers = new Map();\n        this._tagToQueriesIndex = new Map();\n        this._createAddComponentHandler = (entity) => (c) => {\n            this.addComponent(entity, c);\n        };\n        this._createRemoveComponentHandler = (entity) => (c) => {\n            this.removeComponent(entity, c);\n        };\n        this._createAddTagHandler = (entity) => (tag) => {\n            this.addTag(entity, tag);\n        };\n        this._createRemoveTagHandler = (entity) => (tag) => {\n            this.removeTag(entity, tag);\n        };\n    }\n    createQuery(requiredComponents) {\n        const id = Query.createId(requiredComponents);\n        if (this._queries.has(id)) {\n            // short circuit if query is already created\n            return this._queries.get(id);\n        }\n        const query = new Query(requiredComponents);\n        this._queries.set(query.id, query);\n        // index maintenance\n        for (const component of requiredComponents) {\n            const queries = this._componentToQueriesIndex.get(component);\n            if (!queries) {\n                this._componentToQueriesIndex.set(component, [query]);\n            }\n            else {\n                queries.push(query);\n            }\n        }\n        for (const entity of this._world.entities) {\n            this.addEntity(entity);\n        }\n        return query;\n    }\n    createTagQuery(requiredTags) {\n        const id = TagQuery.createId(requiredTags);\n        if (this._tagQueries.has(id)) {\n            // short circuit if query is already created\n            return this._tagQueries.get(id);\n        }\n        const query = new TagQuery(requiredTags);\n        this._tagQueries.set(query.id, query);\n        // index maintenance\n        for (const tag of requiredTags) {\n            const queries = this._tagToQueriesIndex.get(tag);\n            if (!queries) {\n                this._tagToQueriesIndex.set(tag, [query]);\n            }\n            else {\n                queries.push(query);\n            }\n        }\n        for (const entity of this._world.entities) {\n            this.addEntity(entity);\n        }\n        return query;\n    }\n    /**\n     * Scans queries and locates any that need this entity added\n     * @param entity\n     */\n    addEntity(entity) {\n        const maybeAddComponent = this._addComponentHandlers.get(entity);\n        const maybeRemoveComponent = this._removeComponentHandlers.get(entity);\n        const addComponent = maybeAddComponent !== null && maybeAddComponent !== void 0 ? maybeAddComponent : this._createAddComponentHandler(entity);\n        const removeComponent = maybeRemoveComponent !== null && maybeRemoveComponent !== void 0 ? maybeRemoveComponent : this._createRemoveComponentHandler(entity);\n        this._addComponentHandlers.set(entity, addComponent);\n        this._removeComponentHandlers.set(entity, removeComponent);\n        const maybeAddTag = this._addTagHandlers.get(entity);\n        const maybeRemoveTag = this._removeTagHandlers.get(entity);\n        const addTag = maybeAddTag !== null && maybeAddTag !== void 0 ? maybeAddTag : this._createAddTagHandler(entity);\n        const removeTag = maybeRemoveTag !== null && maybeRemoveTag !== void 0 ? maybeRemoveTag : this._createRemoveTagHandler(entity);\n        this._addTagHandlers.set(entity, addTag);\n        this._removeTagHandlers.set(entity, removeTag);\n        for (const query of this._queries.values()) {\n            query.checkAndAdd(entity);\n        }\n        for (const tagQuery of this._tagQueries.values()) {\n            tagQuery.checkAndAdd(entity);\n        }\n        entity.componentAdded$.subscribe(addComponent);\n        entity.componentRemoved$.subscribe(removeComponent);\n        entity.tagAdded$.subscribe(addTag);\n        entity.tagRemoved$.subscribe(removeTag);\n    }\n    /**\n     * Scans queries and locates any that need this entity removed\n     * @param entity\n     */\n    removeEntity(entity) {\n        // Handle components\n        const addComponent = this._addComponentHandlers.get(entity);\n        const removeComponent = this._removeComponentHandlers.get(entity);\n        for (const query of this._queries.values()) {\n            query.removeEntity(entity);\n        }\n        if (addComponent) {\n            entity.componentAdded$.unsubscribe(addComponent);\n        }\n        if (removeComponent) {\n            entity.componentRemoved$.unsubscribe(removeComponent);\n        }\n        // Handle tags\n        const addTag = this._addTagHandlers.get(entity);\n        const removeTag = this._removeTagHandlers.get(entity);\n        for (const tagQuery of this._tagQueries.values()) {\n            tagQuery.removeEntity(entity);\n        }\n        if (addTag) {\n            entity.tagAdded$.unsubscribe(addTag);\n        }\n        if (removeTag) {\n            entity.tagRemoved$.unsubscribe(removeTag);\n        }\n    }\n    /**\n     * Updates any queries when a component is added to an entity\n     * @param entity\n     * @param component\n     */\n    addComponent(entity, component) {\n        var _a;\n        const queries = (_a = this._componentToQueriesIndex.get(component.constructor)) !== null && _a !== void 0 ? _a : [];\n        for (const query of queries) {\n            query.checkAndAdd(entity);\n        }\n    }\n    /**\n     * Updates any queries when a component is removed from an entity\n     * @param entity\n     * @param component\n     */\n    removeComponent(entity, component) {\n        var _a;\n        const queries = (_a = this._componentToQueriesIndex.get(component.constructor)) !== null && _a !== void 0 ? _a : [];\n        for (const query of queries) {\n            query.removeEntity(entity);\n        }\n    }\n    /**\n     * Updates any queries when a tag is added to an entity\n     * @param entity\n     * @param tag\n     */\n    addTag(entity, tag) {\n        var _a;\n        const queries = (_a = this._tagToQueriesIndex.get(tag)) !== null && _a !== void 0 ? _a : [];\n        for (const query of queries) {\n            query.checkAndAdd(entity);\n        }\n    }\n    /**\n     * Updates any queries when a component is removed from an entity\n     * @param entity\n     * @param tag\n     */\n    removeTag(entity, tag) {\n        var _a;\n        const queries = (_a = this._tagToQueriesIndex.get(tag)) !== null && _a !== void 0 ? _a : [];\n        for (const query of queries) {\n            query.removeEntity(entity);\n        }\n    }\n}\n\n;// ./EntityComponentSystem/SystemManager.ts\n\n\n/**\n *\n */\nfunction isSystemConstructor(x) {\n    var _a, _b;\n    return !!(x === null || x === void 0 ? void 0 : x.prototype) && !!((_b = (_a = x === null || x === void 0 ? void 0 : x.prototype) === null || _a === void 0 ? void 0 : _a.constructor) === null || _b === void 0 ? void 0 : _b.name);\n}\n/**\n * The SystemManager is responsible for keeping track of all systems in a scene.\n * Systems are scene specific\n */\nclass SystemManager {\n    constructor(_world) {\n        this._world = _world;\n        /**\n         * List of systems, to add a new system call {@apilink SystemManager.addSystem}\n         */\n        this.systems = [];\n        this.initialized = false;\n    }\n    /**\n     * Get a system registered in the manager by type\n     * @param systemType\n     */\n    get(systemType) {\n        return this.systems.find((s) => s instanceof systemType);\n    }\n    /**\n     * Adds a system to the manager, it will now be updated every frame\n     * @param systemOrCtor\n     */\n    addSystem(systemOrCtor) {\n        let system;\n        if (systemOrCtor instanceof System) {\n            system = systemOrCtor;\n        }\n        else {\n            system = new systemOrCtor(this._world);\n        }\n        this.systems.push(system);\n        this.systems.sort((a, b) => a.constructor.priority - b.constructor.priority);\n        // If systems are added and the manager has already been init'd\n        // then immediately init the system\n        if (this.initialized && system.initialize) {\n            system.initialize(this._world, this._world.scene);\n        }\n    }\n    /**\n     * Removes a system from the manager, it will no longer be updated\n     * @param system\n     */\n    removeSystem(system) {\n        removeItemFromArray(system, this.systems);\n    }\n    /**\n     * Initialize all systems in the manager\n     *\n     * Systems added after initialize() will be initialized on add\n     */\n    initialize() {\n        if (!this.initialized) {\n            this.initialized = true;\n            for (const s of this.systems) {\n                if (s.initialize) {\n                    s.initialize(this._world, this._world.scene);\n                }\n            }\n        }\n    }\n    /**\n     * Updates all systems\n     * @param type whether this is an update or draw system\n     * @param scene context reference\n     * @param elapsedMs time in milliseconds\n     */\n    updateSystems(type, scene, elapsedMs) {\n        const systems = this.systems.filter((s) => s.systemType === type);\n        for (const s of systems) {\n            if (s.preupdate) {\n                s.preupdate(scene, elapsedMs);\n            }\n        }\n        for (const s of systems) {\n            s.update(elapsedMs);\n        }\n        for (const s of systems) {\n            if (s.postupdate) {\n                s.postupdate(scene, elapsedMs);\n            }\n        }\n    }\n    clear() {\n        for (let i = this.systems.length - 1; i >= 0; i--) {\n            this.removeSystem(this.systems[i]);\n        }\n    }\n}\n\n;// ./EntityComponentSystem/World.ts\n\n\n\n\n\n/**\n * The World is a self-contained entity component system for a particular context.\n */\nclass World {\n    /**\n     * The context type is passed to the system updates\n     * @param scene\n     */\n    constructor(scene) {\n        this.scene = scene;\n        this.queryManager = new QueryManager(this);\n        this.entityManager = new EntityManager(this);\n        this.systemManager = new SystemManager(this);\n    }\n    /**\n     * Query the ECS world for entities that match your components\n     * @param requiredTypes\n     */\n    query(requiredTypes) {\n        return this.queryManager.createQuery(requiredTypes);\n    }\n    queryTags(requiredTags) {\n        return this.queryManager.createTagQuery(requiredTags);\n    }\n    /**\n     * Update systems by type and time elapsed in milliseconds\n     */\n    update(type, elapsedMs) {\n        if (type === SystemType.Update) {\n            this.entityManager.updateEntities(this.scene, elapsedMs);\n        }\n        this.systemManager.updateSystems(type, this.scene, elapsedMs);\n        this.entityManager.findEntitiesForRemoval();\n        this.entityManager.processComponentRemovals();\n        this.entityManager.processEntityRemovals();\n    }\n    add(entityOrSystem) {\n        if (entityOrSystem instanceof Entity) {\n            this.entityManager.addEntity(entityOrSystem);\n        }\n        if (entityOrSystem instanceof System || isSystemConstructor(entityOrSystem)) {\n            this.systemManager.addSystem(entityOrSystem);\n        }\n    }\n    /**\n     * Get a system out of the ECS world\n     */\n    get(system) {\n        return this.systemManager.get(system);\n    }\n    remove(entityOrSystem, deferred = true) {\n        if (entityOrSystem instanceof Entity) {\n            this.entityManager.removeEntity(entityOrSystem, deferred);\n        }\n        if (entityOrSystem instanceof System) {\n            this.systemManager.removeSystem(entityOrSystem);\n        }\n    }\n    get entities() {\n        return this.entityManager.entities;\n    }\n    clearEntities() {\n        this.entityManager.clear();\n    }\n    clearSystems() {\n        this.systemManager.clear();\n    }\n}\n\n;// ./Collision/MotionSystem.ts\n\n\n\n\n\n\n\nclass MotionSystem extends System {\n    constructor(world, physics) {\n        super();\n        this.world = world;\n        this.physics = physics;\n        this.systemType = SystemType.Update;\n        this._physicsConfigDirty = false;\n        physics.$configUpdate.subscribe(() => (this._physicsConfigDirty = true));\n        this.query = this.world.query([TransformComponent, MotionComponent]);\n    }\n    update(elapsedMs) {\n        let transform;\n        let motion;\n        const entities = this.query.entities;\n        const substep = this.physics.config.substep;\n        for (let i = 0; i < entities.length; i++) {\n            transform = entities[i].get(TransformComponent);\n            motion = entities[i].get(MotionComponent);\n            const optionalBody = entities[i].get(BodyComponent);\n            if (this._physicsConfigDirty && optionalBody) {\n                optionalBody.updatePhysicsConfig(this.physics.config.bodies);\n            }\n            if (optionalBody === null || optionalBody === void 0 ? void 0 : optionalBody.isSleeping) {\n                continue;\n            }\n            const totalAcc = motion.acc.clone();\n            if ((optionalBody === null || optionalBody === void 0 ? void 0 : optionalBody.collisionType) === CollisionType.Active && (optionalBody === null || optionalBody === void 0 ? void 0 : optionalBody.useGravity)) {\n                totalAcc.addEqual(this.physics.config.gravity);\n            }\n            // capture old transform of this entity and all of its children so that\n            // any transform properties that derived from their parents are properly captured\n            if (!entities[i].parent) {\n                this.captureOldTransformWithChildren(entities[i]);\n            }\n            // Update transform and motion based on Euler linear algebra\n            EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs / substep);\n        }\n        this._physicsConfigDirty = false;\n    }\n    captureOldTransformWithChildren(entity) {\n        var _a;\n        (_a = entity.get(BodyComponent)) === null || _a === void 0 ? void 0 : _a.captureOldTransform();\n        for (let i = 0; i < entity.children.length; i++) {\n            this.captureOldTransformWithChildren(entity.children[i]);\n        }\n    }\n}\nMotionSystem.priority = SystemPriority.Higher;\n\n;// ./Collision/Solver/ArcadeSolver.ts\n\n\n\n\n\n/**\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\n * and negates velocity along the collision normal.\n *\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\n *\n */\nclass ArcadeSolver {\n    constructor(config) {\n        this.config = config;\n        this.directionMap = new Map();\n        this.distanceMap = new Map();\n    }\n    solve(contacts) {\n        // Events and init\n        this.preSolve(contacts);\n        // Remove any canceled contacts\n        contacts = contacts.filter((c) => !c.isCanceled());\n        // Locate collision bias order\n        let bias;\n        switch (this.config.contactSolveBias) {\n            case ContactSolveBias.HorizontalFirst: {\n                bias = HorizontalFirst;\n                break;\n            }\n            case ContactSolveBias.VerticalFirst: {\n                bias = VerticalFirst;\n                break;\n            }\n            default: {\n                bias = None;\n            }\n        }\n        // Sort by bias (None, VerticalFirst, HorizontalFirst) to avoid artifacts with seams\n        // Sort contacts by distance to avoid artifacts with seams\n        // It's important to solve in a specific order\n        contacts.sort((a, b) => {\n            const aDir = this.directionMap.get(a.id);\n            const bDir = this.directionMap.get(b.id);\n            const aDist = this.distanceMap.get(a.id);\n            const bDist = this.distanceMap.get(b.id);\n            return bias[aDir] - bias[bDir] || aDist - bDist;\n        });\n        for (const contact of contacts) {\n            // Solve position first in arcade\n            this.solvePosition(contact);\n            // Solve velocity second in arcade\n            this.solveVelocity(contact);\n        }\n        // Events and any contact house-keeping the solver needs\n        this.postSolve(contacts);\n        return contacts;\n    }\n    preSolve(contacts) {\n        const epsilon = 0.0001;\n        for (let i = 0; i < contacts.length; i++) {\n            const contact = contacts[i];\n            if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\n                // Cancel near 0 mtv collisions\n                contact.cancel();\n                continue;\n            }\n            const side = Side.fromDirection(contact.mtv);\n            const mtv = contact.mtv.negate();\n            const distance = Math.abs(contact.info.separation);\n            this.distanceMap.set(contact.id, distance);\n            this.directionMap.set(contact.id, side === Side.Left || side === Side.Right ? 'horizontal' : 'vertical');\n            // Publish collision events on both participants\n            contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv, contact));\n            contact.colliderB.events.emit('precollision', new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate(), contact));\n        }\n    }\n    postSolve(contacts) {\n        var _a, _b;\n        for (let i = 0; i < contacts.length; i++) {\n            const contact = contacts[i];\n            if (contact.isCanceled()) {\n                continue;\n            }\n            const colliderA = contact.colliderA;\n            const colliderB = contact.colliderB;\n            const bodyA = (_a = colliderA.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n            const bodyB = (_b = colliderB.owner) === null || _b === void 0 ? void 0 : _b.get(BodyComponent);\n            if (bodyA && bodyB) {\n                if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n                    continue;\n                }\n            }\n            const side = Side.fromDirection(contact.mtv);\n            const mtv = contact.mtv.negate();\n            // Publish collision events on both participants\n            contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv, contact));\n            contact.colliderB.events.emit('postcollision', new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate(), contact));\n        }\n    }\n    solvePosition(contact) {\n        var _a, _b;\n        const epsilon = 0.0001;\n        // if bounds no longer intersect skip to the next\n        // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\n        if (!contact.colliderA.bounds.overlaps(contact.colliderB.bounds, epsilon)) {\n            // Cancel the contact to prevent and solving\n            contact.cancel();\n            return;\n        }\n        if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\n            // Cancel near 0 mtv collisions\n            contact.cancel();\n            return;\n        }\n        let mtv = contact.mtv;\n        const colliderA = contact.colliderA;\n        const colliderB = contact.colliderB;\n        const bodyA = (_a = colliderA.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n        const bodyB = (_b = colliderB.owner) === null || _b === void 0 ? void 0 : _b.get(BodyComponent);\n        if (bodyA && bodyB) {\n            if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n                return;\n            }\n            if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\n                // split overlaps if both are Active\n                mtv = mtv.scale(0.5);\n            }\n            // Resolve overlaps\n            if (bodyA.collisionType === CollisionType.Active) {\n                bodyA.globalPos.x -= mtv.x;\n                bodyA.globalPos.y -= mtv.y;\n                colliderA.update(bodyA.transform.get());\n            }\n            if (bodyB.collisionType === CollisionType.Active) {\n                bodyB.globalPos.x += mtv.x;\n                bodyB.globalPos.y += mtv.y;\n                colliderB.update(bodyB.transform.get());\n            }\n        }\n    }\n    solveVelocity(contact) {\n        var _a, _b;\n        if (contact.isCanceled()) {\n            return;\n        }\n        const colliderA = contact.colliderA;\n        const colliderB = contact.colliderB;\n        const bodyA = (_a = colliderA.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n        const bodyB = (_b = colliderB.owner) === null || _b === void 0 ? void 0 : _b.get(BodyComponent);\n        if (bodyA && bodyB) {\n            if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n                return;\n            }\n            const normal = contact.normal;\n            const opposite = normal.negate();\n            if (bodyA.collisionType === CollisionType.Active) {\n                // only adjust velocity if the contact normal is opposite to the current velocity\n                // this avoids catching edges on a platform when sliding off\n                if (bodyA.vel.normalize().dot(opposite) < 0) {\n                    // Cancel out velocity opposite direction of collision normal\n                    const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\n                    bodyA.vel = bodyA.vel.add(velAdj);\n                }\n            }\n            if (bodyB.collisionType === CollisionType.Active) {\n                // only adjust velocity if the contact normal is opposite to the current velocity\n                // this avoids catching edges on a platform\n                if (bodyB.vel.normalize().dot(normal) < 0) {\n                    const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\n                    bodyB.vel = bodyB.vel.add(velAdj);\n                }\n            }\n        }\n    }\n}\n\n;// ./Collision/Solver/ContactConstraintPoint.ts\n\n/**\n * Holds information about contact points, meant to be reused over multiple frames of contact\n */\nclass ContactConstraintPoint {\n    constructor(point, local, contact) {\n        this.point = point;\n        this.local = local;\n        this.contact = contact;\n        /**\n         * Impulse accumulated over time in normal direction\n         */\n        this.normalImpulse = 0;\n        /**\n         * Impulse accumulated over time in the tangent direction\n         */\n        this.tangentImpulse = 0;\n        /**\n         * Effective mass seen in the normal direction\n         */\n        this.normalMass = 0;\n        /**\n         * Effective mass seen in the tangent direction\n         */\n        this.tangentMass = 0;\n        /**\n         * Direction from center of mass of bodyA to contact point\n         */\n        this.aToContact = new Vector(0, 0);\n        /**\n         * Direction from center of mass of bodyB to contact point\n         */\n        this.bToContact = new Vector(0, 0);\n        /**\n         * Original contact velocity combined with bounciness\n         */\n        this.originalVelocityAndRestitution = 0;\n        this.update();\n    }\n    /**\n     * Updates the contact information\n     */\n    update() {\n        const bodyA = this.contact.bodyA;\n        const bodyB = this.contact.bodyB;\n        if (bodyA && bodyB) {\n            const normal = this.contact.normal;\n            const tangent = this.contact.tangent;\n            this.aToContact = this.point.sub(bodyA.globalPos);\n            this.bToContact = this.point.sub(bodyB.globalPos);\n            const aToContactNormal = this.aToContact.cross(normal);\n            const bToContactNormal = this.bToContact.cross(normal);\n            this.normalMass =\n                bodyA.inverseMass +\n                    bodyB.inverseMass +\n                    bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n                    bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n            const aToContactTangent = this.aToContact.cross(tangent);\n            const bToContactTangent = this.bToContact.cross(tangent);\n            this.tangentMass =\n                bodyA.inverseMass +\n                    bodyB.inverseMass +\n                    bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n                    bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n        }\n        return this;\n    }\n    /**\n     * Returns the relative velocity between bodyA and bodyB\n     */\n    getRelativeVelocity() {\n        const bodyA = this.contact.bodyA;\n        const bodyB = this.contact.bodyB;\n        if (bodyA && bodyB) {\n            // Relative velocity in linear terms\n            // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\n            const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\n            const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\n            return velB.sub(velA);\n        }\n        return Vector.Zero;\n    }\n}\n\n;// ./Collision/Solver/RealisticSolver.ts\n\n\n\n\n\n\n\nclass RealisticSolver {\n    constructor(config) {\n        this.config = config;\n        this.lastFrameContacts = new Map();\n        // map contact id to contact points\n        this.idToContactConstraint = new Map();\n    }\n    getContactConstraints(id) {\n        var _a;\n        return (_a = this.idToContactConstraint.get(id)) !== null && _a !== void 0 ? _a : [];\n    }\n    solve(contacts) {\n        // Events and init\n        this.preSolve(contacts);\n        // Remove any canceled contacts\n        contacts = contacts.filter((c) => !c.isCanceled());\n        // Solve velocity first\n        this.solveVelocity(contacts);\n        // Solve position last because non-overlap is the most important\n        this.solvePosition(contacts);\n        // Events and any contact house-keeping the solver needs\n        this.postSolve(contacts);\n        return contacts;\n    }\n    preSolve(contacts) {\n        var _a, _b, _c;\n        const epsilon = 0.0001;\n        for (let i = 0; i < contacts.length; i++) {\n            const contact = contacts[i];\n            if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\n                // Cancel near 0 mtv collisions\n                contact.cancel();\n                continue;\n            }\n            // Publish collision events on both participants\n            const side = Side.fromDirection(contact.mtv);\n            contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact));\n            contact.colliderA.events.emit('beforecollisionresolve', new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact));\n            contact.colliderB.events.emit('precollision', new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact));\n            contact.colliderB.events.emit('beforecollisionresolve', new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact));\n            // Match awake state for sleeping\n            contact.matchAwake();\n        }\n        // Keep track of contacts that done\n        const finishedContactIds = Array.from(this.idToContactConstraint.keys());\n        for (let i = 0; i < contacts.length; i++) {\n            const contact = contacts[i];\n            // Remove all current contacts that are not done\n            const index = finishedContactIds.indexOf(contact.id);\n            if (index > -1) {\n                finishedContactIds.splice(index, 1);\n            }\n            const contactPoints = (_a = this.idToContactConstraint.get(contact.id)) !== null && _a !== void 0 ? _a : [];\n            let pointIndex = 0;\n            const bodyA = contact.bodyA;\n            const bodyB = contact.bodyB;\n            if (bodyA && bodyB) {\n                for (let j = 0; j < contact.points.length; j++) {\n                    const point = contact.points[j];\n                    const normal = contact.normal;\n                    const tangent = contact.tangent;\n                    const aToContact = point.sub(bodyA.globalPos);\n                    const bToContact = point.sub(bodyB.globalPos);\n                    const aToContactNormal = aToContact.cross(normal);\n                    const bToContactNormal = bToContact.cross(normal);\n                    const normalMass = bodyA.inverseMass +\n                        bodyB.inverseMass +\n                        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n                        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n                    const aToContactTangent = aToContact.cross(tangent);\n                    const bToContactTangent = bToContact.cross(tangent);\n                    const tangentMass = bodyA.inverseMass +\n                        bodyB.inverseMass +\n                        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n                        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n                    // Preserve normal/tangent impulse by re-using the contact point if it's close\n                    if (contactPoints[pointIndex] && ((_c = (_b = contactPoints[pointIndex]) === null || _b === void 0 ? void 0 : _b.point) === null || _c === void 0 ? void 0 : _c.squareDistance(point)) < 4) {\n                        contactPoints[pointIndex].point = point;\n                        contactPoints[pointIndex].local = contact.localPoints[pointIndex];\n                    }\n                    else {\n                        // new contact if it's not close or doesn't exist\n                        contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\n                    }\n                    // Update contact point calculations\n                    contactPoints[pointIndex].aToContact = aToContact;\n                    contactPoints[pointIndex].bToContact = bToContact;\n                    contactPoints[pointIndex].normalMass = 1.0 / normalMass;\n                    contactPoints[pointIndex].tangentMass = 1.0 / tangentMass;\n                    // Calculate relative velocity before solving to accurately do restitution\n                    const restitution = bodyA.bounciness > bodyB.bounciness ? bodyA.bounciness : bodyB.bounciness;\n                    const relativeVelocity = contact.normal.dot(contactPoints[pointIndex].getRelativeVelocity());\n                    contactPoints[pointIndex].originalVelocityAndRestitution = 0;\n                    if (relativeVelocity < -0.1) {\n                        // TODO what's a good threshold here?\n                        contactPoints[pointIndex].originalVelocityAndRestitution = -restitution * relativeVelocity;\n                    }\n                    pointIndex++;\n                }\n            }\n            this.idToContactConstraint.set(contact.id, contactPoints);\n        }\n        // Clean up any contacts that did not occur last frame\n        for (const id of finishedContactIds) {\n            this.idToContactConstraint.delete(id);\n        }\n        // Warm contacts with accumulated impulse\n        // Useful for tall stacks\n        if (this.config.warmStart) {\n            this.warmStart(contacts);\n        }\n        else {\n            for (let i = 0; i < contacts.length; i++) {\n                const contact = contacts[i];\n                const contactPoints = this.getContactConstraints(contact.id);\n                for (const point of contactPoints) {\n                    point.normalImpulse = 0;\n                    point.tangentImpulse = 0;\n                }\n            }\n        }\n    }\n    postSolve(contacts) {\n        for (let i = 0; i < contacts.length; i++) {\n            const contact = contacts[i];\n            const bodyA = contact.bodyA;\n            const bodyB = contact.bodyB;\n            if (bodyA && bodyB) {\n                // Skip post solve for active+passive collisions\n                if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n                    continue;\n                }\n                // Update motion values for sleeping\n                bodyA.updateMotion();\n                bodyB.updateMotion();\n            }\n            // Publish collision events on both participants\n            const side = Side.fromDirection(contact.mtv);\n            contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact));\n            contact.colliderA.events.emit('aftercollisionresolve', new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact));\n            contact.colliderB.events.emit('postcollision', new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact));\n            contact.colliderB.events.emit('aftercollisionresolve', new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact));\n        }\n        // Store contacts\n        this.lastFrameContacts.clear();\n        for (let i = 0; i < contacts.length; i++) {\n            const c = contacts[i];\n            this.lastFrameContacts.set(c.id, c);\n        }\n    }\n    /**\n     * Warm up body's based on previous frame contact points\n     * @param contacts\n     */\n    warmStart(contacts) {\n        var _a;\n        for (let i = 0; i < contacts.length; i++) {\n            const contact = contacts[i];\n            const bodyA = contact.bodyA;\n            const bodyB = contact.bodyB;\n            if (bodyA && bodyB) {\n                const contactPoints = (_a = this.idToContactConstraint.get(contact.id)) !== null && _a !== void 0 ? _a : [];\n                for (const point of contactPoints) {\n                    if (this.config.warmStart) {\n                        const normalImpulse = contact.normal.scale(point.normalImpulse);\n                        const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\n                        const impulse = normalImpulse.add(tangentImpulse);\n                        bodyA.applyImpulse(point.point, impulse.negate());\n                        bodyB.applyImpulse(point.point, impulse);\n                    }\n                    else {\n                        point.normalImpulse = 0;\n                        point.tangentImpulse = 0;\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Iteratively solve the position overlap constraint\n     * @param contacts\n     */\n    solvePosition(contacts) {\n        var _a;\n        for (let i = 0; i < this.config.positionIterations; i++) {\n            for (let i = 0; i < contacts.length; i++) {\n                const contact = contacts[i];\n                const bodyA = contact.bodyA;\n                const bodyB = contact.bodyB;\n                if (bodyA && bodyB) {\n                    // Skip solving active+passive\n                    if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n                        continue;\n                    }\n                    const constraints = (_a = this.idToContactConstraint.get(contact.id)) !== null && _a !== void 0 ? _a : [];\n                    for (const point of constraints) {\n                        const normal = contact.normal;\n                        const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\n                        const steeringConstant = this.config.steeringFactor; //0.2;\n                        const maxCorrection = -5;\n                        const slop = this.config.slop; //1;\n                        // Clamp to avoid over-correction\n                        // Remember that we are shooting for 0 overlap in the end\n                        const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\n                        const impulse = normal.scale(-steeringForce * point.normalMass);\n                        // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\n                        // We adjust position and rotation instead of doing the velocity\n                        if (bodyA.collisionType === CollisionType.Active) {\n                            // TODO make applyPseudoImpulse function?\n                            const impulseForce = impulse.negate().scale(bodyA.inverseMass);\n                            if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n                                impulseForce.x = 0;\n                            }\n                            if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n                                impulseForce.y = 0;\n                            }\n                            bodyA.globalPos = bodyA.globalPos.add(impulseForce);\n                            if (!bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n                                bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\n                            }\n                        }\n                        if (bodyB.collisionType === CollisionType.Active) {\n                            const impulseForce = impulse.scale(bodyB.inverseMass);\n                            if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n                                impulseForce.x = 0;\n                            }\n                            if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n                                impulseForce.y = 0;\n                            }\n                            bodyB.globalPos = bodyB.globalPos.add(impulseForce);\n                            if (!bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n                                bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n    solveVelocity(contacts) {\n        var _a;\n        for (let i = 0; i < this.config.velocityIterations; i++) {\n            for (let i = 0; i < contacts.length; i++) {\n                const contact = contacts[i];\n                const bodyA = contact.bodyA;\n                const bodyB = contact.bodyB;\n                if (bodyA && bodyB) {\n                    // Skip solving active+passive\n                    if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n                        continue;\n                    }\n                    const friction = Math.min(bodyA.friction, bodyB.friction);\n                    const constraints = (_a = this.idToContactConstraint.get(contact.id)) !== null && _a !== void 0 ? _a : [];\n                    // Friction constraint\n                    for (const point of constraints) {\n                        const relativeVelocity = point.getRelativeVelocity();\n                        // Negate velocity in tangent direction to simulate friction\n                        const tangentVelocity = -relativeVelocity.dot(contact.tangent);\n                        let impulseDelta = tangentVelocity * point.tangentMass;\n                        // Clamping based in Erin Catto's GDC 2006 talk\n                        // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\n                        // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\n                        // But deltas can vary\n                        const maxFriction = friction * point.normalImpulse;\n                        const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\n                        impulseDelta = newImpulse - point.tangentImpulse;\n                        point.tangentImpulse = newImpulse;\n                        const impulse = contact.tangent.scale(impulseDelta);\n                        bodyA.applyImpulse(point.point, impulse.negate());\n                        bodyB.applyImpulse(point.point, impulse);\n                    }\n                    // Bounce constraint\n                    for (const point of constraints) {\n                        // Need to recalc relative velocity because the previous step could have changed vel\n                        const relativeVelocity = point.getRelativeVelocity();\n                        // Compute impulse in normal direction\n                        const normalVelocity = relativeVelocity.dot(contact.normal);\n                        // Per Erin it is a mistake to apply the restitution inside the iteration\n                        // From Erin Catto's Box2D we keep original contact velocity and adjust by small impulses\n                        let impulseDelta = -point.normalMass * (normalVelocity - point.originalVelocityAndRestitution);\n                        // Clamping based in Erin Catto's GDC 2014 talk\n                        // Accumulated impulse stored in the contact is always positive (dV > 0)\n                        // But deltas can be negative\n                        const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\n                        impulseDelta = newImpulse - point.normalImpulse;\n                        point.normalImpulse = newImpulse;\n                        const impulse = contact.normal.scale(impulseDelta);\n                        bodyA.applyImpulse(point.point, impulse.negate());\n                        bodyB.applyImpulse(point.point, impulse);\n                    }\n                }\n            }\n        }\n    }\n}\n\n;// ./Collision/CollisionSystem.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nclass CollisionSystem extends System {\n    get _processor() {\n        return this._physics.collisionProcessor;\n    }\n    constructor(world, _physics) {\n        super();\n        this._physics = _physics;\n        this.systemType = SystemType.Update;\n        this._configDirty = false;\n        this._lastFrameContacts = new Map();\n        this._currentFrameContacts = new Map();\n        this._arcadeSolver = new ArcadeSolver(_physics.config.arcade);\n        this._realisticSolver = new RealisticSolver(_physics.config.realistic);\n        this._physics.$configUpdate.subscribe(() => (this._configDirty = true));\n        this._trackCollider = (c) => this._processor.track(c);\n        this._untrackCollider = (c) => this._processor.untrack(c);\n        this.query = world.query([TransformComponent, MotionComponent, ColliderComponent]);\n        this.query.entityAdded$.subscribe((e) => {\n            const colliderComponent = e.get(ColliderComponent);\n            colliderComponent.$colliderAdded.subscribe(this._trackCollider);\n            colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\n            const collider = colliderComponent.get();\n            if (collider) {\n                this._processor.track(collider);\n            }\n        });\n        this.query.entityRemoved$.subscribe((e) => {\n            const colliderComponent = e.get(ColliderComponent);\n            const collider = colliderComponent.get();\n            if (colliderComponent && collider) {\n                this._processor.untrack(collider);\n            }\n        });\n        this._motionSystem = world.get(MotionSystem);\n    }\n    initialize(world, scene) {\n        this._engine = scene.engine;\n    }\n    update(elapsedMs) {\n        var _a, _b, _c, _d;\n        if (!this._physics.config.enabled) {\n            return;\n        }\n        // TODO do we need to do this every frame?\n        // Collect up all the colliders and update them\n        let colliders = [];\n        for (let entityIndex = 0; entityIndex < this.query.entities.length; entityIndex++) {\n            const entity = this.query.entities[entityIndex];\n            const colliderComp = entity.get(ColliderComponent);\n            const collider = colliderComp === null || colliderComp === void 0 ? void 0 : colliderComp.get();\n            if (colliderComp && ((_a = colliderComp.owner) === null || _a === void 0 ? void 0 : _a.isActive) && collider) {\n                colliderComp.update();\n                // Flatten composite colliders\n                if (collider instanceof CompositeCollider) {\n                    const compositeColliders = collider.getColliders();\n                    if (!collider.compositeStrategy) {\n                        collider.compositeStrategy = this._physics.config.colliders.compositeStrategy;\n                    }\n                    colliders = colliders.concat(compositeColliders);\n                }\n                else {\n                    colliders.push(collider);\n                }\n            }\n        }\n        // Update the spatial partitioning data structures\n        // TODO if collider invalid it will break the processor\n        // TODO rename \"update\" to something more specific\n        this._processor.update(colliders, elapsedMs);\n        // Run broadphase on all colliders and locates potential collisions\n        let pairs = this._processor.broadphase(colliders, elapsedMs);\n        this._currentFrameContacts.clear();\n        // Given possible pairs find actual contacts\n        let contacts = []; // = this._processor.narrowphase(pairs, this._engine?.debug?.stats?.currFrame);\n        const solver = this.getSolver();\n        // Solve, this resolves the position/velocity so entities aren't overlapping\n        const substep = this._physics.config.substep;\n        for (let step = 0; step < substep; step++) {\n            if (step > 0) {\n                // first step is run by the MotionSystem when configured, so skip\n                this._motionSystem.update(elapsedMs);\n            }\n            // Re-use pairs from previous collision\n            if (contacts.length) {\n                pairs = contacts.map((c) => new Pair(c.colliderA, c.colliderB));\n            }\n            if (pairs.length) {\n                contacts = this._processor.narrowphase(pairs, (_d = (_c = (_b = this._engine) === null || _b === void 0 ? void 0 : _b.debug) === null || _c === void 0 ? void 0 : _c.stats) === null || _d === void 0 ? void 0 : _d.currFrame);\n                contacts = solver.solve(contacts);\n                // Record contacts for start/end\n                for (const contact of contacts) {\n                    if (contact.isCanceled()) {\n                        continue;\n                    }\n                    // Process composite ids, things with the same composite id are treated as the same collider for start/end\n                    const index = contact.id.indexOf('|');\n                    if (index > 0) {\n                        const compositeId = contact.id.substring(index + 1);\n                        this._currentFrameContacts.set(compositeId, contact);\n                    }\n                    else {\n                        this._currentFrameContacts.set(contact.id, contact);\n                    }\n                }\n            }\n        }\n        // Emit contact start/end events\n        this.runContactStartEnd();\n        // reset the last frame cache\n        this._lastFrameContacts.clear();\n        // Keep track of collisions contacts that have started or ended\n        this._lastFrameContacts = new Map(this._currentFrameContacts);\n        // Process deferred collider removals\n        for (const entity of this.query.entities) {\n            const collider = entity.get(ColliderComponent);\n            if (collider) {\n                collider.processColliderRemoval();\n            }\n        }\n    }\n    postupdate() {\n        SeparatingAxis.SeparationPool.done();\n    }\n    getSolver() {\n        if (this._configDirty) {\n            this._configDirty = false;\n            this._arcadeSolver = new ArcadeSolver(this._physics.config.arcade);\n            this._realisticSolver = new RealisticSolver(this._physics.config.realistic);\n        }\n        return this._physics.config.solver === SolverStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\n    }\n    debug(ex) {\n        this._processor.debug(ex, 0);\n    }\n    runContactStartEnd() {\n        // If composite colliders are 'together' collisions may have a duplicate id because we want to treat those as a singular start/end\n        for (const [id, c] of this._currentFrameContacts) {\n            // find all new contacts\n            if (!this._lastFrameContacts.has(id)) {\n                const colliderA = c.colliderA;\n                const colliderB = c.colliderB;\n                const side = Side.fromDirection(c.mtv);\n                const opposite = Side.getOpposite(side);\n                colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, side, c));\n                colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, side, c));\n                colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, opposite, c));\n                colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, opposite, c));\n            }\n        }\n        // find all contacts that have ceased\n        for (const [id, c] of this._lastFrameContacts) {\n            if (!this._currentFrameContacts.has(id)) {\n                const colliderA = c.colliderA;\n                const colliderB = c.colliderB;\n                const side = Side.fromDirection(c.mtv);\n                const opposite = Side.getOpposite(side);\n                colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB, side, c));\n                colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB, side, c));\n                colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA, opposite, c));\n                colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA, opposite, c));\n            }\n        }\n    }\n}\nCollisionSystem.priority = SystemPriority.Higher;\n\n;// ./Graphics/TransformInterpolation.ts\n\n/**\n * Blend 2 transforms for interpolation, will interpolate from the context of newTx's parent if it exists\n */\nfunction blendTransform(oldTx, newTx, blend, target) {\n    if (oldTx.parent !== newTx.parent) {\n        // Caller expects a local transform\n        // Adjust old tx to be local to the new parent whatever that is\n        const oldTxWithNewParent = oldTx.clone();\n        const oldGlobalPos = oldTx.globalPos.clone();\n        const oldGlobalScale = oldTx.globalScale.clone();\n        const oldGlobalRotation = oldTx.globalRotation;\n        oldTxWithNewParent.parent = newTx.parent;\n        oldTxWithNewParent.globalPos = oldGlobalPos;\n        oldTxWithNewParent.globalScale = oldGlobalScale;\n        oldTxWithNewParent.globalRotation = oldGlobalRotation;\n        oldTx = oldTxWithNewParent;\n    }\n    let interpolatedPos = newTx.pos;\n    let interpolatedScale = newTx.scale;\n    let interpolatedRotation = newTx.rotation;\n    interpolatedPos = newTx.pos.scale(blend).add(oldTx.pos.scale(1.0 - blend));\n    interpolatedScale = newTx.scale.scale(blend).add(oldTx.scale.scale(1.0 - blend));\n    // Rotational lerp https://stackoverflow.com/a/30129248\n    const cosine = (1.0 - blend) * Math.cos(oldTx.rotation) + blend * Math.cos(newTx.rotation);\n    const sine = (1.0 - blend) * Math.sin(oldTx.rotation) + blend * Math.sin(newTx.rotation);\n    interpolatedRotation = Math.atan2(sine, cosine);\n    const tx = target !== null && target !== void 0 ? target : new transform_Transform();\n    tx.setTransform(interpolatedPos, interpolatedRotation, interpolatedScale);\n    return tx;\n}\n/**\n *\n */\nfunction blendGlobalTransform(oldTx, newTx, blend, target) {\n    let interpolatedPos = newTx.globalPos;\n    let interpolatedScale = newTx.globalScale;\n    let interpolatedRotation = newTx.globalRotation;\n    interpolatedPos = newTx.globalPos.scale(blend).add(oldTx.globalPos.scale(1.0 - blend));\n    interpolatedScale = newTx.globalScale.scale(blend).add(oldTx.globalScale.scale(1.0 - blend));\n    // Rotational lerp https://stackoverflow.com/a/30129248\n    const cosine = (1.0 - blend) * Math.cos(oldTx.globalRotation) + blend * Math.cos(newTx.globalRotation);\n    const sine = (1.0 - blend) * Math.sin(oldTx.globalRotation) + blend * Math.sin(newTx.globalRotation);\n    interpolatedRotation = Math.atan2(sine, cosine);\n    const tx = target !== null && target !== void 0 ? target : new Transform();\n    tx.setTransform(interpolatedPos, interpolatedRotation, interpolatedScale);\n    return tx;\n}\n\n;// ./Graphics/GraphicsSystem.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\nclass GraphicsSystem extends System {\n    get sortedTransforms() {\n        return this._sortedTransforms;\n    }\n    constructor(world) {\n        super();\n        this.world = world;\n        this.systemType = SystemType.Draw;\n        this._token = 0;\n        this._sortedTransforms = [];\n        this._zHasChanged = false;\n        this._zIndexUpdate = () => {\n            this._zHasChanged = true;\n        };\n        this._targetInterpolationTransform = new transform_Transform();\n        this.query = this.world.query([TransformComponent, GraphicsComponent]);\n        this.query.entityAdded$.subscribe((e) => {\n            const tx = e.get(TransformComponent);\n            this._sortedTransforms.push(tx);\n            tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n            this._zHasChanged = true;\n        });\n        this.query.entityRemoved$.subscribe((e) => {\n            const tx = e.get(TransformComponent);\n            tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n            const index = this._sortedTransforms.indexOf(tx);\n            if (index > -1) {\n                this._sortedTransforms.splice(index, 1);\n            }\n        });\n    }\n    initialize(world, scene) {\n        this._camera = scene.camera;\n        this._engine = scene.engine;\n    }\n    preupdate() {\n        // Graphics context could be switched to fallback in a new frame\n        this._graphicsContext = this._engine.graphicsContext;\n        if (this._zHasChanged) {\n            this._sortedTransforms.sort((a, b) => {\n                return a.globalZ - b.globalZ;\n            });\n            this._zHasChanged = false;\n        }\n    }\n    update(elapsedMs) {\n        this._token++;\n        let graphics;\n        FontCache.checkAndClearCache();\n        // This is a performance enhancement, most things are in world space\n        // so if we can only do this once saves a ton of transform updates\n        this._graphicsContext.save();\n        if (this._camera) {\n            this._camera.draw(this._graphicsContext);\n        }\n        for (let transformIndex = 0; transformIndex < this._sortedTransforms.length; transformIndex++) {\n            const transform = this._sortedTransforms[transformIndex];\n            const entity = transform.owner;\n            // If the entity is offscreen skip\n            if (entity.hasTag('ex.offscreen')) {\n                continue;\n            }\n            graphics = entity.get(GraphicsComponent);\n            // Exit if graphics set to not visible\n            if (!graphics.isVisible) {\n                continue;\n            }\n            // Optionally run the onPreTransformDraw graphics lifecycle draw\n            if (graphics.onPreTransformDraw) {\n                graphics.onPreTransformDraw(this._graphicsContext, elapsedMs);\n            }\n            entity.events.emit('pretransformdraw', new PreTransformDrawEvent(this._graphicsContext, elapsedMs, entity));\n            // This optionally sets our camera based on the entity coord plan (world vs. screen)\n            if (transform.coordPlane === CoordPlane.Screen) {\n                this._graphicsContext.restore();\n            }\n            this._graphicsContext.save();\n            if (transform.coordPlane === CoordPlane.Screen) {\n                this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\n            }\n            // Tick any graphics state (but only once) for animations and graphics groups\n            graphics.update(elapsedMs, this._token);\n            // Apply parallax\n            const parallax = entity.get(ParallaxComponent);\n            if (parallax) {\n                // We use the Tiled formula\n                // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\n                // cameraPos * (1 - parallaxFactor)\n                const oneMinusFactor = Vector.One.sub(parallax.parallaxFactor);\n                const parallaxOffset = this._camera.drawPos.scale(oneMinusFactor);\n                this._graphicsContext.translate(parallaxOffset.x, parallaxOffset.y);\n            }\n            // Position the entity + estimate lag\n            this._applyTransform(entity);\n            // If there is a material enable it on the context\n            if (graphics.material) {\n                this._graphicsContext.material = graphics.material;\n            }\n            // Optionally run the onPreDraw graphics lifecycle draw\n            if (graphics.onPreDraw) {\n                graphics.onPreDraw(this._graphicsContext, elapsedMs);\n            }\n            entity.events.emit('predraw', new PreDrawEvent(this._graphicsContext, elapsedMs, entity));\n            // this._graphicsContext.opacity *= graphics.opacity;\n            this._applyOpacity(entity);\n            // Draw the graphics component\n            this._drawGraphicsComponent(graphics, transform);\n            // Optionally run the onPostDraw graphics lifecycle draw\n            if (graphics.onPostDraw) {\n                graphics.onPostDraw(this._graphicsContext, elapsedMs);\n            }\n            entity.events.emit('postdraw', new PostDrawEvent(this._graphicsContext, elapsedMs, entity));\n            this._graphicsContext.restore();\n            // Reset the transform back to the original world space\n            if (transform.coordPlane === CoordPlane.Screen) {\n                this._graphicsContext.save();\n                if (this._camera) {\n                    this._camera.draw(this._graphicsContext);\n                }\n            }\n            // Optionally run the onPreTransformDraw graphics lifecycle draw\n            if (graphics.onPostTransformDraw) {\n                graphics.onPostTransformDraw(this._graphicsContext, elapsedMs);\n            }\n            entity.events.emit('posttransformdraw', new PostTransformDrawEvent(this._graphicsContext, elapsedMs, entity));\n        }\n        this._graphicsContext.restore();\n    }\n    _drawGraphicsComponent(graphicsComponent, transformComponent) {\n        var _a, _b;\n        if (graphicsComponent.isVisible) {\n            const flipHorizontal = graphicsComponent.flipHorizontal;\n            const flipVertical = graphicsComponent.flipVertical;\n            const graphic = graphicsComponent.current;\n            const options = (_a = graphicsComponent.currentOptions) !== null && _a !== void 0 ? _a : {};\n            if (graphic) {\n                let anchor = graphicsComponent.anchor;\n                let offset = graphicsComponent.offset;\n                let scaleX = 1;\n                let scaleY = 1;\n                // handle specific overrides\n                if (options === null || options === void 0 ? void 0 : options.anchor) {\n                    anchor = options.anchor;\n                }\n                if (options === null || options === void 0 ? void 0 : options.offset) {\n                    offset = options.offset;\n                }\n                const globalScale = transformComponent.globalScale;\n                scaleX *= graphic.scale.x * globalScale.x;\n                scaleY *= graphic.scale.y * globalScale.y;\n                // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n                const offsetX = -graphic.width * anchor.x + offset.x * scaleX;\n                const offsetY = -graphic.height * anchor.y + offset.y * scaleY;\n                const oldFlipHorizontal = graphic.flipHorizontal;\n                const oldFlipVertical = graphic.flipVertical;\n                if (flipHorizontal || flipVertical) {\n                    // flip any currently flipped graphics\n                    graphic.flipHorizontal = flipHorizontal ? !oldFlipHorizontal : oldFlipHorizontal;\n                    graphic.flipVertical = flipVertical ? !oldFlipVertical : oldFlipVertical;\n                }\n                graphic === null || graphic === void 0 ? void 0 : graphic.draw(this._graphicsContext, offsetX, offsetY);\n                if (flipHorizontal || flipVertical) {\n                    graphic.flipHorizontal = oldFlipHorizontal;\n                    graphic.flipVertical = oldFlipVertical;\n                }\n                // TODO move debug code out?\n                if (((_b = this._engine) === null || _b === void 0 ? void 0 : _b.isDebug) && this._engine.debug.graphics.showBounds) {\n                    const offset = vec(offsetX, offsetY);\n                    if (graphic instanceof GraphicsGroup) {\n                        for (const member of graphic.members) {\n                            let g;\n                            let pos = Vector.Zero;\n                            if (member instanceof Graphic) {\n                                g = member;\n                            }\n                            else {\n                                g = member.graphic;\n                                pos = member.offset;\n                            }\n                            if (graphic.useAnchor) {\n                                g === null || g === void 0 ? void 0 : g.localBounds.translate(offset.add(pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n                            }\n                            else {\n                                g === null || g === void 0 ? void 0 : g.localBounds.translate(pos).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n                            }\n                        }\n                    }\n                    else {\n                        /* istanbul ignore next */\n                        graphic === null || graphic === void 0 ? void 0 : graphic.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * This applies the current entity transform to the graphics context\n     * @param entity\n     */\n    _applyTransform(entity) {\n        const ancestors = entity.getAncestors();\n        for (let i = 0; i < ancestors.length; i++) {\n            const ancestor = ancestors[i];\n            const transform = ancestor === null || ancestor === void 0 ? void 0 : ancestor.get(TransformComponent);\n            const optionalBody = ancestor === null || ancestor === void 0 ? void 0 : ancestor.get(BodyComponent);\n            if (transform) {\n                let tx = transform.get();\n                if (optionalBody) {\n                    if (this._engine.fixedUpdateTimestep && optionalBody.__oldTransformCaptured && optionalBody.enableFixedUpdateInterpolate) {\n                        // Interpolate graphics if needed\n                        const blend = this._engine.currentFrameLagMs / this._engine.fixedUpdateTimestep;\n                        tx = blendTransform(optionalBody.oldTransform, transform.get(), blend, this._targetInterpolationTransform);\n                    }\n                }\n                this._graphicsContext.z = transform.globalZ;\n                this._graphicsContext.translate(tx.pos.x, tx.pos.y);\n                this._graphicsContext.scale(tx.scale.x, tx.scale.y);\n                this._graphicsContext.rotate(tx.rotation);\n            }\n        }\n    }\n    _applyOpacity(entity) {\n        var _a;\n        const ancestors = entity.getAncestors();\n        for (let i = 0; i < ancestors.length; i++) {\n            const ancestor = ancestors[i];\n            const maybeGraphics = ancestor === null || ancestor === void 0 ? void 0 : ancestor.get(GraphicsComponent);\n            this._graphicsContext.opacity *= (_a = maybeGraphics === null || maybeGraphics === void 0 ? void 0 : maybeGraphics.opacity) !== null && _a !== void 0 ? _a : 1;\n        }\n    }\n}\nGraphicsSystem.priority = SystemPriority.Average;\n\n;// ./Debug/DebugSystem.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nclass DebugSystem extends System {\n    constructor(world) {\n        super();\n        this.world = world;\n        this.systemType = SystemType.Draw;\n        this.query = this.world.query([TransformComponent]);\n    }\n    initialize(world, scene) {\n        this._graphicsContext = scene.engine.graphicsContext;\n        this._camera = scene.camera;\n        this._engine = scene.engine;\n        this._collisionSystem = world.systemManager.get(CollisionSystem);\n    }\n    update() {\n        var _a;\n        if (!this._engine.isDebug) {\n            return;\n        }\n        const filterSettings = this._engine.debug.filter;\n        let id;\n        let name;\n        const entitySettings = this._engine.debug.entity;\n        let tx;\n        const txSettings = this._engine.debug.transform;\n        let motion;\n        const motionSettings = this._engine.debug.motion;\n        let colliderComp;\n        const colliderSettings = this._engine.debug.collider;\n        const physicsSettings = this._engine.debug.physics;\n        let graphics;\n        const graphicsSettings = this._engine.debug.graphics;\n        let debugDraw;\n        let body;\n        const bodySettings = this._engine.debug.body;\n        const cameraSettings = this._engine.debug.camera;\n        for (let i = 0; i < this.query.entities.length; i++) {\n            const entity = this.query.entities[i];\n            if (entity.hasTag('offscreen')) {\n                // skip offscreen entities\n                continue;\n            }\n            if (entity instanceof Particle) {\n                // Particles crush the renderer :(\n                continue;\n            }\n            if (filterSettings.useFilter) {\n                const allIds = filterSettings.ids.length === 0;\n                const idMatch = allIds || filterSettings.ids.includes(entity.id);\n                if (!idMatch) {\n                    continue;\n                }\n                const allNames = filterSettings.nameQuery === '';\n                const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\n                if (!nameMatch) {\n                    continue;\n                }\n            }\n            let cursor = Vector.Zero;\n            const lineHeight = vec(0, 16);\n            id = entity.id;\n            name = entity.name;\n            tx = entity.get(TransformComponent);\n            // This optionally sets our camera based on the entity coord plan (world vs. screen)\n            this._pushCameraTransform(tx);\n            this._graphicsContext.save();\n            if (tx.coordPlane === CoordPlane.Screen) {\n                this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\n            }\n            this._graphicsContext.z = txSettings.debugZIndex;\n            this._applyTransform(entity);\n            if (tx) {\n                if (txSettings.showAll || txSettings.showPosition) {\n                    this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\n                }\n                if (txSettings.showAll || txSettings.showPositionLabel) {\n                    this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (txSettings.showAll || txSettings.showZIndex) {\n                    this._graphicsContext.debug.drawText(`z(${tx.z.toFixed(1)})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (entitySettings.showAll || entitySettings.showId) {\n                    this._graphicsContext.debug.drawText(`id(${id}) ${entity.parent ? 'child of id(' + ((_a = entity.parent) === null || _a === void 0 ? void 0 : _a.id) + ')' : ''}`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (entitySettings.showAll || entitySettings.showName) {\n                    this._graphicsContext.debug.drawText(`name(${name})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (txSettings.showAll || txSettings.showRotation) {\n                    this._graphicsContext.drawLine(Vector.Zero, Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero), txSettings.rotationColor, 2);\n                    this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (txSettings.showAll || txSettings.showScale) {\n                    this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\n                }\n            }\n            graphics = entity.get(GraphicsComponent);\n            if (graphics) {\n                if (graphicsSettings.showAll || graphicsSettings.showBounds) {\n                    const bounds = graphics.localBounds;\n                    bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\n                }\n            }\n            debugDraw = entity.get(DebugGraphicsComponent);\n            if (debugDraw) {\n                if (!debugDraw.useTransform) {\n                    this._graphicsContext.restore();\n                }\n                debugDraw.draw(this._graphicsContext, this._engine.debug);\n                if (!debugDraw.useTransform) {\n                    this._graphicsContext.save();\n                    this._applyTransform(entity);\n                }\n            }\n            body = entity.get(BodyComponent);\n            if (body) {\n                if (bodySettings.showAll || bodySettings.showCollisionGroup) {\n                    this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (bodySettings.showAll || bodySettings.showCollisionType) {\n                    this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (bodySettings.showAll || bodySettings.showMass) {\n                    this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (bodySettings.showAll || bodySettings.showMotion) {\n                    this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (bodySettings.showAll || bodySettings.showSleeping) {\n                    this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.isSleeping : 'cant sleep'})`, cursor);\n                    cursor = cursor.add(lineHeight);\n                }\n            }\n            this._graphicsContext.restore();\n            // World space\n            this._graphicsContext.save();\n            if (tx.coordPlane === CoordPlane.Screen) {\n                this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\n            }\n            this._graphicsContext.z = txSettings.debugZIndex;\n            motion = entity.get(MotionComponent);\n            if (motion) {\n                if (motionSettings.showAll || motionSettings.showVelocity) {\n                    this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\n                    this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\n                    cursor = cursor.add(lineHeight);\n                }\n                if (motionSettings.showAll || motionSettings.showAcceleration) {\n                    this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\n                }\n            }\n            // Colliders live in world space already so after the restore()\n            colliderComp = entity.get(ColliderComponent);\n            if (colliderComp) {\n                const collider = colliderComp.get();\n                if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\n                    collider.debug(this._graphicsContext, colliderSettings.geometryColor, {\n                        lineWidth: colliderSettings.geometryLineWidth,\n                        pointSize: colliderSettings.geometryPointSize\n                    });\n                }\n                if (colliderSettings.showAll || colliderSettings.showBounds) {\n                    if (collider instanceof CompositeCollider) {\n                        const colliders = collider.getColliders();\n                        for (const collider of colliders) {\n                            const bounds = collider.bounds;\n                            const pos = vec(bounds.left, bounds.top);\n                            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n                            if (colliderSettings.showAll || colliderSettings.showOwner) {\n                                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\n                            }\n                        }\n                        colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\n                    }\n                    else if (collider) {\n                        const bounds = colliderComp.bounds;\n                        const pos = vec(bounds.left, bounds.top);\n                        this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n                        if (colliderSettings.showAll || colliderSettings.showOwner) {\n                            this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\n                        }\n                    }\n                }\n            }\n            this._graphicsContext.restore();\n            this._popCameraTransform(tx);\n        }\n        this._graphicsContext.save();\n        this._camera.draw(this._graphicsContext);\n        if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\n            this._collisionSystem.debug(this._graphicsContext);\n        }\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\n            for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\n                if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\n                    for (const point of contact.points) {\n                        this._graphicsContext.debug.drawPoint(point, {\n                            size: physicsSettings.contactSize,\n                            color: physicsSettings.collisionContactColor\n                        });\n                    }\n                }\n                if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\n                    for (const point of contact.points) {\n                        this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\n                            color: physicsSettings.collisionNormalColor\n                        });\n                    }\n                }\n            }\n        }\n        this._graphicsContext.restore();\n        if (cameraSettings) {\n            this._graphicsContext.save();\n            this._camera.draw(this._graphicsContext);\n            if (cameraSettings.showAll || cameraSettings.showFocus) {\n                this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\n            }\n            if (cameraSettings.showAll || cameraSettings.showZoom) {\n                this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\n            }\n            this._graphicsContext.restore();\n        }\n        this._graphicsContext.flush();\n    }\n    postupdate(engine, elapsedMs) {\n        if (this._engine.isDebug) {\n            this._graphicsContext.save();\n            if (this._camera) {\n                this._camera.draw(this._graphicsContext);\n            }\n            Debug.flush(this._graphicsContext);\n            this._graphicsContext.restore();\n        }\n    }\n    /**\n     * This applies the current entity transform to the graphics context\n     * @param entity\n     */\n    _applyTransform(entity) {\n        const ancestors = entity.getAncestors();\n        for (const ancestor of ancestors) {\n            const transform = ancestor === null || ancestor === void 0 ? void 0 : ancestor.get(TransformComponent);\n            if (transform) {\n                this._graphicsContext.translate(transform.pos.x, transform.pos.y);\n                this._graphicsContext.scale(transform.scale.x, transform.scale.y);\n                this._graphicsContext.rotate(transform.rotation);\n            }\n        }\n    }\n    /**\n     * Applies the current camera transform if in world coordinates\n     * @param transform\n     */\n    _pushCameraTransform(transform) {\n        // Establish camera offset per entity\n        if (transform.coordPlane === CoordPlane.World) {\n            this._graphicsContext.save();\n            if (this._camera) {\n                this._camera.draw(this._graphicsContext);\n            }\n        }\n    }\n    /**\n     * Resets the current camera transform if in world coordinates\n     * @param transform\n     */\n    _popCameraTransform(transform) {\n        if (transform.coordPlane === CoordPlane.World) {\n            // Apply camera world offset\n            this._graphicsContext.restore();\n        }\n    }\n}\nDebugSystem.priority = SystemPriority.Lowest;\n\n;// ./Collision/Detection/SparseHashGrid.ts\n\n\n\n\nclass HashGridProxy {\n    constructor(object, gridSize) {\n        this.object = object;\n        this.id = -1;\n        this.cells = [];\n        this.hasZeroBounds = false;\n        this.gridSize = gridSize;\n        this.bounds = object.bounds;\n        this.hasZeroBounds = this.bounds.hasZeroDimensions();\n        this.leftX = Math.floor(this.bounds.left / this.gridSize);\n        this.rightX = Math.floor(this.bounds.right / this.gridSize);\n        this.bottomY = Math.floor(this.bounds.bottom / this.gridSize);\n        this.topY = Math.floor(this.bounds.top / this.gridSize);\n    }\n    /**\n     * Has the hashed bounds changed\n     */\n    hasChanged() {\n        const bounds = this.object.bounds;\n        const leftX = Math.floor(bounds.left / this.gridSize);\n        const rightX = Math.floor(bounds.right / this.gridSize);\n        const bottomY = Math.floor(bounds.bottom / this.gridSize);\n        const topY = Math.floor(bounds.top / this.gridSize);\n        if (this.leftX !== leftX || this.rightX !== rightX || this.bottomY !== bottomY || this.topY !== topY) {\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Clears all collider references\n     */\n    clear() {\n        for (const cell of this.cells) {\n            const index = cell.proxies.indexOf(this);\n            if (index > -1) {\n                cell.proxies.splice(index, 1);\n            }\n            // TODO reclaim cell in pool if empty?\n        }\n    }\n    /**\n     * Update bounds of the proxy\n     */\n    updateBounds() {\n        this.bounds = this.object.bounds;\n    }\n    /**\n     * Updates the hashed bounds coordinates\n     */\n    update() {\n        this.bounds = this.object.bounds;\n        this.leftX = Math.floor(this.bounds.left / this.gridSize);\n        this.rightX = Math.floor(this.bounds.right / this.gridSize);\n        this.bottomY = Math.floor(this.bounds.bottom / this.gridSize);\n        this.topY = Math.floor(this.bounds.top / this.gridSize);\n        this.hasZeroBounds = this.object.bounds.hasZeroDimensions();\n    }\n}\nclass HashGridCell {\n    constructor() {\n        this.proxies = [];\n    }\n    configure(x, y) {\n        this.x = x;\n        this.y = y;\n        this.key = HashGridCell.calculateHashKey(x, y);\n    }\n    static calculateHashKey(x, y) {\n        return `${x}+${y}`;\n    }\n}\nclass SparseHashGrid {\n    constructor(options) {\n        this.bounds = new BoundingBox();\n        this._hashGridCellPool = new RentalPool(() => new HashGridCell(), (instance) => {\n            instance.configure(0, 0);\n            instance.proxies.length = 0;\n            return instance;\n        }, 1000);\n        this.gridSize = options.size;\n        this.sparseHashGrid = new Map();\n        this.objectToProxy = new Map();\n        if (options.proxyFactory) {\n            this._buildProxy = (object) => options.proxyFactory(object, this.gridSize);\n        }\n        else {\n            this._buildProxy = (object) => new HashGridProxy(object, this.gridSize);\n        }\n        // TODO dynamic grid size potentially larger than the largest collider\n        // TODO Re-hash the objects if the median proves to be different\n    }\n    query(boundsOrPoint) {\n        const results = new Set();\n        if (boundsOrPoint instanceof BoundingBox) {\n            const bounds = boundsOrPoint;\n            const leftX = Math.floor(bounds.left / this.gridSize);\n            const rightX = Math.floor(bounds.right / this.gridSize);\n            const bottomY = Math.floor(bounds.bottom / this.gridSize);\n            const topY = Math.floor(bounds.top / this.gridSize);\n            for (let x = leftX; x <= rightX; x++) {\n                for (let y = topY; y <= bottomY; y++) {\n                    const key = HashGridCell.calculateHashKey(x, y);\n                    // Hash bounds into appropriate cell\n                    const cell = this.sparseHashGrid.get(key);\n                    if (cell) {\n                        for (let i = 0; i < cell.proxies.length; i++) {\n                            cell.proxies[i].updateBounds();\n                            if (cell.proxies[i].bounds.intersect(bounds)) {\n                                results.add(cell.proxies[i].object);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        else {\n            const point = boundsOrPoint;\n            const key = HashGridCell.calculateHashKey(Math.floor(point.x / this.gridSize), Math.floor(point.y / this.gridSize));\n            // Hash points into appropriate cell\n            const cell = this.sparseHashGrid.get(key);\n            if (cell) {\n                for (let i = 0; i < cell.proxies.length; i++) {\n                    cell.proxies[i].updateBounds();\n                    if (cell.proxies[i].bounds.contains(point)) {\n                        results.add(cell.proxies[i].object);\n                    }\n                }\n            }\n        }\n        return Array.from(results);\n    }\n    get(xCoord, yCoord) {\n        const key = HashGridCell.calculateHashKey(xCoord, yCoord);\n        const cell = this.sparseHashGrid.get(key);\n        return cell;\n    }\n    _insert(x, y, proxy) {\n        const key = HashGridCell.calculateHashKey(x, y);\n        // Hash collider into appropriate cell\n        let cell = this.sparseHashGrid.get(key);\n        if (!cell) {\n            cell = this._hashGridCellPool.rent();\n            cell.configure(x, y);\n            this.sparseHashGrid.set(cell.key, cell);\n        }\n        cell.proxies.push(proxy);\n        proxy.cells.push(cell); // TODO dupes, doesn't seem to be a problem\n        this.bounds.combine(proxy.bounds, this.bounds);\n    }\n    _remove(x, y, proxy) {\n        const key = HashGridCell.calculateHashKey(x, y);\n        // Hash collider into appropriate cell\n        const cell = this.sparseHashGrid.get(key);\n        if (cell) {\n            const proxyIndex = cell.proxies.indexOf(proxy);\n            if (proxyIndex > -1) {\n                cell.proxies.splice(proxyIndex, 1);\n            }\n            const cellIndex = proxy.cells.indexOf(cell);\n            if (cellIndex > -1) {\n                proxy.cells.splice(cellIndex, 1);\n            }\n            if (cell.proxies.length === 0) {\n                this._hashGridCellPool.return(cell);\n                this.sparseHashGrid.delete(key);\n            }\n        }\n    }\n    track(target) {\n        const proxy = this._buildProxy(target);\n        this.objectToProxy.set(target, proxy);\n        for (let x = proxy.leftX; x <= proxy.rightX; x++) {\n            for (let y = proxy.topY; y <= proxy.bottomY; y++) {\n                this._insert(x, y, proxy);\n            }\n        }\n    }\n    untrack(target) {\n        const proxy = this.objectToProxy.get(target);\n        if (proxy) {\n            proxy.clear();\n            this.objectToProxy.delete(target);\n        }\n    }\n    update(targets) {\n        let updated = 0;\n        // FIXME resetting bounds is wrong, if nothing has updated then\n        // the bounds stay 0\n        // this.bounds.reset();\n        for (const target of targets) {\n            const proxy = this.objectToProxy.get(target);\n            if (!proxy) {\n                continue;\n            }\n            if (proxy.hasChanged()) {\n                // TODO slightly wasteful only remove from changed\n                for (let x = proxy.leftX; x <= proxy.rightX; x++) {\n                    for (let y = proxy.topY; y <= proxy.bottomY; y++) {\n                        this._remove(x, y, proxy);\n                    }\n                }\n                proxy.update();\n                // TODO slightly wasteful only add new\n                for (let x = proxy.leftX; x <= proxy.rightX; x++) {\n                    for (let y = proxy.topY; y <= proxy.bottomY; y++) {\n                        this._insert(x, y, proxy);\n                    }\n                }\n                updated++;\n            }\n        }\n        return updated;\n    }\n    debug(ex, elapsedMs) {\n        const transparent = Color.Transparent;\n        const color = Color.White;\n        for (const cell of this.sparseHashGrid.values()) {\n            ex.drawRectangle(vec(cell.x * this.gridSize, cell.y * this.gridSize), this.gridSize, this.gridSize, transparent, color, 2);\n        }\n    }\n}\n\n;// ./Input/PointerSystem.ts\n\n\n\n\n\n\n/**\n * The PointerSystem is responsible for dispatching pointer events to entities\n * that need them.\n *\n * The PointerSystem can be optionally configured by the {@apilink PointerComponent}, by default Entities use\n * the {@apilink Collider}'s shape for pointer events.\n */\nclass PointerSystem extends System {\n    constructor(world) {\n        super();\n        this.world = world;\n        this.systemType = SystemType.Update;\n        this._graphicsHashGrid = new SparseHashGrid({ size: 100 });\n        this._graphics = [];\n        this._entityToPointer = new Map();\n        this._pointerEventDispatcher = new PointerEventsToObjectDispatcher();\n        /**\n         * Optionally override component configuration for all entities\n         */\n        this.overrideUseColliderShape = false;\n        /**\n         * Optionally override component configuration for all entities\n         */\n        this.overrideUseGraphicsBounds = false;\n        this._sortedTransforms = [];\n        this._sortedEntities = [];\n        this._zHasChanged = false;\n        this._zIndexUpdate = () => {\n            this._zHasChanged = true;\n        };\n        this.query = this.world.query([TransformComponent, PointerComponent]);\n        this.query.entityAdded$.subscribe((e) => {\n            const tx = e.get(TransformComponent);\n            const pointer = e.get(PointerComponent);\n            this._pointerEventDispatcher.addObject(e, (pos) => {\n                // If pointer bounds defined\n                if (pointer && pointer.localBounds) {\n                    const pointerBounds = pointer.localBounds.transform(tx.get().matrix);\n                    return pointerBounds.contains(tx.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos);\n                }\n                return false;\n            }, () => e.isActive);\n            this._entityToPointer.set(e, pointer);\n            const maybeGfx = e.get(GraphicsComponent);\n            if (maybeGfx) {\n                this._graphics.push(maybeGfx);\n                this._graphicsHashGrid.track(maybeGfx);\n            }\n            this._sortedTransforms.push(tx);\n            this._sortedEntities.push(tx.owner);\n            tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n            this._zHasChanged = true;\n        });\n        this.query.entityRemoved$.subscribe((e) => {\n            this._pointerEventDispatcher.removeObject(e);\n            const tx = e.get(TransformComponent);\n            this._entityToPointer.delete(e);\n            const maybeGfx = e.get(GraphicsComponent);\n            if (maybeGfx) {\n                const index = this._graphics.indexOf(maybeGfx);\n                if (index > -1) {\n                    this._graphics.splice(index, 1);\n                }\n                this._graphicsHashGrid.untrack(maybeGfx);\n            }\n            tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n            const index = this._sortedTransforms.indexOf(tx);\n            if (index > -1) {\n                this._sortedTransforms.splice(index, 1);\n                this._sortedEntities.splice(index, 1);\n            }\n        });\n    }\n    initialize(world, scene) {\n        this._engine = scene.engine;\n        this._scene = scene;\n    }\n    preupdate() {\n        if (this._scene.camera.hasChanged()) {\n            // if the camera has changed we want to force a transform update so pointers can be correctly calc'd\n            this._scene.camera.updateTransform(this._scene.camera.pos);\n        }\n        // event receiver might change per frame\n        this._receivers = [this._engine.input.pointers, this._scene.input.pointers];\n        this._engineReceiver = this._engine.input.pointers;\n        if (this._zHasChanged) {\n            this._sortedTransforms.sort((a, b) => {\n                return b.z - a.z;\n            });\n            this._sortedEntities = this._sortedTransforms.map((t) => t.owner);\n            this._zHasChanged = false;\n        }\n    }\n    update() {\n        // Update graphics\n        this._graphicsHashGrid.update(this._graphics);\n        // Locate all the pointer/entity mappings\n        for (const [pointerId, pos] of this._engineReceiver.currentFramePointerCoords.entries()) {\n            const colliders = this._scene.physics.query(pos.worldPos);\n            for (let i = 0; i < colliders.length; i++) {\n                const collider = colliders[i];\n                const maybePointer = this._entityToPointer.get(collider.owner);\n                if (maybePointer && (maybePointer.useColliderShape || this.overrideUseColliderShape)) {\n                    this._pointerEventDispatcher.addPointerToObject(collider.owner, pointerId);\n                }\n            }\n            const graphics = this._graphicsHashGrid.query(pos.worldPos);\n            for (let i = 0; i < graphics.length; i++) {\n                const graphic = graphics[i];\n                const maybePointer = this._entityToPointer.get(graphic.owner);\n                if (maybePointer && (maybePointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\n                    this._pointerEventDispatcher.addPointerToObject(graphic.owner, pointerId);\n                }\n            }\n        }\n        this._pointerEventDispatcher.processPointerToObject(this._engineReceiver, this._sortedEntities);\n        // Dispatch pointer events on entities\n        this._pointerEventDispatcher.dispatchEvents(this._engineReceiver, this._sortedEntities);\n        // Dispatch pointer events on top level pointers\n        this._receivers.forEach((r) => r.update());\n        // Clear last frame's events\n        this._pointerEventDispatcher.clear();\n        this._receivers.forEach((r) => r.clear());\n    }\n}\nPointerSystem.priority = SystemPriority.Higher;\n\n;// ./Actions/ActionsSystem.ts\n\n\n\nclass ActionsSystem extends System {\n    constructor(world) {\n        super();\n        this.world = world;\n        this.systemType = SystemType.Update;\n        this._actions = [];\n        this.query = this.world.query([ActionsComponent]);\n        this.query.entityAdded$.subscribe((e) => this._actions.push(e.get(ActionsComponent)));\n        this.query.entityRemoved$.subscribe((e) => {\n            const action = e.get(ActionsComponent);\n            const index = this._actions.indexOf(action);\n            if (index > -1) {\n                this._actions.splice(index, 1);\n            }\n        });\n    }\n    update(elapsedMs) {\n        for (let i = 0; i < this._actions.length; i++) {\n            const action = this._actions[i];\n            action.update(elapsedMs);\n        }\n    }\n}\nActionsSystem.priority = SystemPriority.Higher;\n\n;// ./TileMap/IsometricEntityComponent.ts\n\nclass IsometricEntityComponent extends Component {\n    /**\n     * Specify the isometric map to use to position this entity's z-index\n     * @param mapOrOptions\n     */\n    constructor(mapOrOptions) {\n        super();\n        /**\n         * Vertical \"height\" in the isometric world\n         */\n        this.elevation = 0;\n        this.columns = mapOrOptions.columns;\n        this.rows = mapOrOptions.rows;\n        this.tileWidth = mapOrOptions.tileWidth;\n        this.tileHeight = mapOrOptions.tileHeight;\n    }\n}\n\n;// ./TileMap/IsometricEntitySystem.ts\n\n\n\n\nclass IsometricEntitySystem extends System {\n    constructor(world) {\n        super();\n        this.world = world;\n        this.systemType = SystemType.Update;\n        this.query = this.world.query([TransformComponent, IsometricEntityComponent]);\n    }\n    update() {\n        let transform;\n        let iso;\n        for (let i = 0; i < this.query.entities.length; i++) {\n            const entity = this.query.entities[i];\n            transform = entity.get(TransformComponent);\n            iso = entity.get(IsometricEntityComponent);\n            const maxZindexPerElevation = Math.max(iso.columns * iso.tileWidth, iso.rows * iso.tileHeight);\n            const newZ = maxZindexPerElevation * iso.elevation + transform.pos.y;\n            transform.z = newZ;\n        }\n    }\n}\nIsometricEntitySystem.priority = SystemPriority.Lower;\n\n;// ./Graphics/OffscreenSystem.ts\n\n\n\n\n\n\n\n\nclass OffscreenSystem extends System {\n    constructor(world) {\n        super();\n        this.world = world;\n        this.systemType = SystemType.Draw;\n        this.query = this.world.query([TransformComponent, GraphicsComponent]);\n    }\n    initialize(world, scene) {\n        this._camera = scene.camera;\n        this._screen = scene.engine.screen;\n    }\n    update() {\n        this._worldBounds = this._screen.getWorldBounds();\n        let transform;\n        let graphics;\n        let maybeParallax;\n        for (let i = 0; i < this.query.entities.length; i++) {\n            const entity = this.query.entities[i];\n            graphics = entity.get(GraphicsComponent);\n            transform = entity.get(TransformComponent);\n            maybeParallax = entity.get(ParallaxComponent);\n            let parallaxOffset;\n            if (maybeParallax) {\n                // We use the Tiled formula\n                // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\n                // cameraPos * (1 - parallaxFactor)\n                const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\n                parallaxOffset = this._camera.pos.scale(oneMinusFactor);\n            }\n            // Figure out if entities are offscreen\n            const entityOffscreen = this._isOffscreen(transform, graphics, parallaxOffset);\n            if (entityOffscreen && !entity.hasTag('ex.offscreen')) {\n                entity.events.emit('exitviewport', new ExitViewPortEvent(entity));\n                entity.addTag('ex.offscreen');\n            }\n            if (!entityOffscreen && entity.hasTag('ex.offscreen')) {\n                entity.events.emit('enterviewport', new EnterViewPortEvent(entity));\n                entity.removeTag('ex.offscreen');\n            }\n        }\n    }\n    _isOffscreen(transform, graphics, parallaxOffset) {\n        if (graphics.forceOnScreen) {\n            return false;\n        }\n        if (transform.coordPlane === CoordPlane.World) {\n            let bounds = graphics.localBounds;\n            if (parallaxOffset) {\n                bounds = bounds.translate(parallaxOffset);\n            }\n            const transformedBounds = bounds.transform(transform.get().matrix);\n            const graphicsOffscreen = !this._worldBounds.overlaps(transformedBounds);\n            return graphicsOffscreen;\n        }\n        else {\n            // TODO screen coordinates\n            return false;\n        }\n    }\n}\nOffscreenSystem.priority = SystemPriority.Higher;\n\n;// ./Collision/Detection/SparseHashGridCollisionProcessor.ts\n\n\n\n\n\n\n\n\n\n/**\n * Proxy type to stash collision info\n */\nclass HashColliderProxy extends HashGridProxy {\n    constructor(collider, gridSize) {\n        var _a, _b;\n        super(collider, gridSize);\n        this.collider = collider;\n        this.id = -1;\n        this.hasZeroBounds = false;\n        /**\n         * References to the hash cell the collider is a current member of\n         */\n        this.cells = [];\n        this.gridSize = gridSize;\n        const bounds = collider.bounds;\n        this.hasZeroBounds = bounds.hasZeroDimensions();\n        this.leftX = Math.floor(bounds.left / this.gridSize);\n        this.rightX = Math.floor(bounds.right / this.gridSize);\n        this.bottomY = Math.floor(bounds.bottom / this.gridSize);\n        this.topY = Math.floor(bounds.top / this.gridSize);\n        this.owner = collider.owner;\n        this.body = (_a = this.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n        this.collisionType = (_b = this.body.collisionType) !== null && _b !== void 0 ? _b : CollisionType.PreventCollision;\n    }\n    /**\n     * Updates the hashed bounds coordinates\n     */\n    update() {\n        var _a, _b;\n        super.update();\n        this.body = (_a = this.owner) === null || _a === void 0 ? void 0 : _a.get(BodyComponent);\n        this.collisionType = (_b = this.body.collisionType) !== null && _b !== void 0 ? _b : CollisionType.PreventCollision;\n        this.hasZeroBounds = this.collider.localBounds.hasZeroDimensions();\n    }\n}\n/**\n * This collision processor uses a sparsely populated grid of uniform cells to bucket potential\n * colliders together for the purpose of detecting collision pairs and collisions.\n */\nclass SparseHashGridCollisionProcessor {\n    constructor(options) {\n        this._pairs = new Set();\n        this._nonPairs = new Set();\n        this._pairPool = new Pool(() => new Pair({ id: createId('collider', 0) }, { id: createId('collider', 0) }), (instance) => {\n            instance.colliderA = null;\n            instance.colliderB = null;\n            return instance;\n        }, 200);\n        this.gridSize = options.size;\n        this.hashGrid = new SparseHashGrid({\n            size: this.gridSize,\n            proxyFactory: (collider, size) => new HashColliderProxy(collider, size)\n        });\n        this._pairPool.disableWarnings = true;\n        // TODO dynamic grid size potentially larger than the largest collider\n        // TODO Re-hash the objects if the median proves to be different\n    }\n    getColliders() {\n        return Array.from(this.hashGrid.objectToProxy.keys());\n    }\n    query(boundsOrPoint) {\n        // FIXME workaround TS: https://github.com/microsoft/TypeScript/issues/14107\n        return this.hashGrid.query(boundsOrPoint);\n    }\n    rayCast(ray, options) {\n        var _a, _b, _c;\n        // DDA raycast algo\n        const results = [];\n        const maxDistance = (_a = options === null || options === void 0 ? void 0 : options.maxDistance) !== null && _a !== void 0 ? _a : Infinity;\n        const collisionGroup = options === null || options === void 0 ? void 0 : options.collisionGroup;\n        const collisionMask = !collisionGroup ? (_b = options === null || options === void 0 ? void 0 : options.collisionMask) !== null && _b !== void 0 ? _b : CollisionGroup.All.category : collisionGroup.category;\n        const searchAllColliders = (_c = options === null || options === void 0 ? void 0 : options.searchAllColliders) !== null && _c !== void 0 ? _c : false;\n        const unitRay = ray.dir.normalize();\n        const dydx = unitRay.y / unitRay.x;\n        const dxdy = unitRay.x / unitRay.y;\n        const unitStepX = Math.sqrt(1 + dydx * dydx) * this.gridSize;\n        const unitStepY = Math.sqrt(1 + dxdy * dxdy) * this.gridSize;\n        const startXCoord = ray.pos.x / this.gridSize;\n        const startYCoord = ray.pos.y / this.gridSize;\n        const stepDir = vec(1, 1);\n        let currentXCoord = ~~startXCoord;\n        let currentYCoord = ~~startYCoord;\n        let currentRayLengthX = 0;\n        let currentRayLengthY = 0;\n        if (unitRay.x < 0) {\n            stepDir.x = -1;\n            currentRayLengthX = (startXCoord - currentXCoord) * unitStepX;\n        }\n        else {\n            stepDir.x = 1;\n            currentRayLengthX = (currentXCoord + 1 - startXCoord) * unitStepX;\n        }\n        if (unitRay.y < 0) {\n            stepDir.y = -1;\n            currentRayLengthY = (startYCoord - currentYCoord) * unitStepY;\n        }\n        else {\n            stepDir.y = 1;\n            currentRayLengthY = (currentYCoord + 1 - startYCoord) * unitStepY;\n        }\n        const collidersVisited = new Set();\n        let done = false;\n        let maxIterations = 9999;\n        while (!done && maxIterations > 0) {\n            maxIterations--; // safety exit\n            // exit if exhausted max hash grid coordinate, bounds of the sparse grid\n            if (!this.hashGrid.bounds.contains(vec(currentXCoord * this.gridSize, currentYCoord * this.gridSize))) {\n                break;\n            }\n            // Test colliders at cell\n            const key = HashGridCell.calculateHashKey(currentXCoord, currentYCoord);\n            const cell = this.hashGrid.sparseHashGrid.get(key);\n            if (cell) {\n                const cellHits = [];\n                for (let colliderIndex = 0; colliderIndex < cell.proxies.length; colliderIndex++) {\n                    const collider = cell.proxies[colliderIndex];\n                    if (!collidersVisited.has(collider.collider.id.value)) {\n                        collidersVisited.add(collider.collider.id.value);\n                        if ((options === null || options === void 0 ? void 0 : options.ignoreCollisionGroupAll) && collider.body.group === CollisionGroup.All) {\n                            continue;\n                        }\n                        const canCollide = (collisionMask & collider.body.group.category) !== 0;\n                        // Early exit if not the right group\n                        if (collider.body.group && !canCollide) {\n                            continue;\n                        }\n                        const hit = collider.collider.rayCast(ray, maxDistance);\n                        // Collect up all the colliders that hit inside a cell\n                        // they can be in any order so we need to sort them next\n                        if (hit) {\n                            cellHits.push(hit);\n                        }\n                    }\n                }\n                cellHits.sort((hit1, hit2) => hit1.distance - hit2.distance);\n                for (let i = 0; i < cellHits.length; i++) {\n                    const hit = cellHits[i];\n                    if (options === null || options === void 0 ? void 0 : options.filter) {\n                        if (options.filter(hit)) {\n                            results.push(hit);\n                            if (!searchAllColliders) {\n                                done = true;\n                                break;\n                            }\n                        }\n                    }\n                    else {\n                        results.push(hit);\n                        if (!searchAllColliders) {\n                            done = true;\n                            break;\n                        }\n                    }\n                }\n            }\n            if (currentRayLengthX < currentRayLengthY) {\n                currentXCoord += stepDir.x;\n                currentRayLengthX += unitStepX;\n            }\n            else {\n                currentYCoord += stepDir.y;\n                currentRayLengthY += unitStepY;\n            }\n        }\n        // Sort by distance\n        results.sort((hit1, hit2) => hit1.distance - hit2.distance);\n        if (!searchAllColliders && results.length) {\n            return [results[0]];\n        }\n        return results;\n    }\n    /**\n     * Adds the collider to the internal data structure for collision tracking\n     * @param target\n     */\n    track(target) {\n        let colliders = [target];\n        if (target instanceof CompositeCollider) {\n            const compColliders = target.getColliders();\n            for (const c of compColliders) {\n                c.owner = target.owner;\n            }\n            colliders = compColliders;\n        }\n        for (const target of colliders) {\n            this.hashGrid.track(target);\n        }\n    }\n    /**\n     * Removes a collider from the internal data structure for tracking collisions\n     * @param target\n     */\n    untrack(target) {\n        let colliders = [target];\n        if (target instanceof CompositeCollider) {\n            colliders = target.getColliders();\n        }\n        for (const target of colliders) {\n            this.hashGrid.untrack(target);\n        }\n    }\n    _canCollide(colliderA, colliderB) {\n        // Prevent self collision\n        if (colliderA.collider.id === colliderB.collider.id) {\n            return false;\n        }\n        // Colliders with the same owner do not collide (composite colliders)\n        if (colliderA.owner && colliderB.owner && colliderA.owner.id === colliderB.owner.id) {\n            return false;\n        }\n        // if the pair has a member with zero dimension don't collide\n        if (colliderA.hasZeroBounds || colliderB.hasZeroBounds) {\n            return false;\n        }\n        // If both are in the same collision group short circuit\n        if (!colliderA.body.group.canCollide(colliderB.body.group)) {\n            return false;\n        }\n        // if both are fixed short circuit\n        if (colliderA.collisionType === CollisionType.Fixed && colliderB.collisionType === CollisionType.Fixed) {\n            return false;\n        }\n        // if the either is prevent collision short circuit\n        if (colliderA.collisionType === CollisionType.PreventCollision || colliderB.collisionType === CollisionType.PreventCollision) {\n            return false;\n        }\n        // if either is dead short circuit\n        if (!colliderA.owner.isActive || !colliderB.owner.isActive) {\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Runs the broadphase sweep over tracked colliders and returns possible collision pairs\n     * @param targets\n     * @param elapsedMs\n     */\n    broadphase(targets, elapsedMs) {\n        const pairs = [];\n        this._pairs.clear();\n        this._nonPairs.clear();\n        let proxyId = 0;\n        for (const proxy of this.hashGrid.objectToProxy.values()) {\n            proxy.id = proxyId++; // track proxies we've already processed\n            if (!proxy.owner.isActive || proxy.collisionType === CollisionType.PreventCollision) {\n                continue;\n            }\n            // for every cell proxy collider is member of\n            for (let cellIndex = 0; cellIndex < proxy.cells.length; cellIndex++) {\n                const cell = proxy.cells[cellIndex];\n                // TODO Can we skip any cells or make this iteration faster?\n                // maybe a linked list here\n                for (let otherIndex = 0; otherIndex < cell.proxies.length; otherIndex++) {\n                    const other = cell.proxies[otherIndex];\n                    if (other.id === proxy.id) {\n                        // skip duplicates\n                        continue;\n                    }\n                    const id = Pair.calculatePairHash(proxy.collider.id, other.collider.id);\n                    if (this._nonPairs.has(id)) {\n                        continue; // Is there a way we can re-use the non-pair cache\n                    }\n                    if (!this._pairs.has(id) && this._canCollide(proxy, other) && proxy.object.bounds.overlaps(other.object.bounds)) {\n                        const pair = this._pairPool.get();\n                        pair.colliderA = proxy.collider;\n                        pair.colliderB = other.collider;\n                        pair.id = id;\n                        this._pairs.add(id);\n                        pairs.push(pair);\n                    }\n                    else {\n                        this._nonPairs.add(id);\n                    }\n                }\n            }\n        }\n        return pairs;\n    }\n    /**\n     * Runs a fine grain pass on collision pairs and does geometry intersection tests producing any contacts\n     * @param pairs\n     * @param stats\n     */\n    narrowphase(pairs, stats) {\n        const contacts = [];\n        for (let i = 0; i < pairs.length; i++) {\n            const newContacts = pairs[i].collide();\n            for (let j = 0; j < newContacts.length; j++) {\n                const c = newContacts[j];\n                contacts.push(c);\n                if (stats) {\n                    stats.physics.contacts.set(c.id, c);\n                }\n            }\n        }\n        this._pairPool.done();\n        if (stats) {\n            stats.physics.collisions += contacts.length;\n        }\n        return contacts; // TODO maybe we can re-use contacts as likely pairs next frame\n    }\n    /**\n     * Perform data structure maintenance, returns number of colliders updated\n     */\n    update(targets, elapsedMs) {\n        return this.hashGrid.update(targets);\n    }\n    /**\n     * Draws the internal data structure\n     * @param ex\n     * @param elapsedMs\n     */\n    debug(ex, elapsedMs) {\n        this.hashGrid.debug(ex, elapsedMs);\n    }\n}\n\n;// ./Collision/PhysicsWorld.ts\n\n\n\n\n\nclass PhysicsWorld {\n    get config() {\n        return watchDeep(this._config, (change) => {\n            this.$configUpdate.notifyAll(change);\n        });\n    }\n    set config(newConfig) {\n        this._config = newConfig;\n        this.$configUpdate.notifyAll(newConfig);\n    }\n    /**\n     * Spatial data structure for locating potential collision pairs and ray casts\n     */\n    get collisionProcessor() {\n        if (this._configDirty) {\n            this._configDirty = false;\n            // preserve tracked colliders if config updates\n            const colliders = this._collisionProcessor.getColliders();\n            if (this._config.spatialPartition === SpatialPartitionStrategy.SparseHashGrid) {\n                this._collisionProcessor = new SparseHashGridCollisionProcessor(this._config.sparseHashGrid);\n            }\n            else {\n                this._collisionProcessor = new DynamicTreeCollisionProcessor(this._config);\n            }\n            for (const collider of colliders) {\n                this._collisionProcessor.track(collider);\n            }\n        }\n        return this._collisionProcessor;\n    }\n    constructor(config) {\n        this.$configUpdate = new Observable();\n        this._configDirty = false;\n        this.config = config;\n        this.$configUpdate.subscribe((config) => {\n            this._configDirty = true;\n            BodyComponent.updateDefaultPhysicsConfig(config.bodies);\n        });\n        if (this._config.spatialPartition === SpatialPartitionStrategy.SparseHashGrid) {\n            this._collisionProcessor = new SparseHashGridCollisionProcessor(this._config.sparseHashGrid);\n        }\n        else {\n            this._collisionProcessor = new DynamicTreeCollisionProcessor(this._config);\n        }\n    }\n    /**\n     * Raycast into the scene's physics world\n     * @param ray\n     * @param options\n     */\n    rayCast(ray, options) {\n        return this.collisionProcessor.rayCast(ray, options);\n    }\n    query(pointOrBounds) {\n        // FIXME workaround TS: https://github.com/microsoft/TypeScript/issues/14107\n        return this._collisionProcessor.query(pointOrBounds);\n    }\n}\n\n;// ./Input/Gamepad.ts\n\n\nconst GamepadEvents = {\n    GamepadConnect: 'connect',\n    GamepadDisconnect: 'disconnect',\n    GamepadButton: 'button',\n    GamepadAxis: 'axis'\n};\n/**\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\n * to provide controller support for your games.\n */\nclass Gamepads {\n    constructor() {\n        this.events = new EventEmitter();\n        /**\n         * Whether or not to poll for Gamepad input (default: `false`)\n         */\n        this.enabled = false;\n        /**\n         * Whether or not Gamepad API is supported\n         */\n        this.supported = !!navigator.getGamepads;\n        this._gamePadTimeStamps = [0, 0, 0, 0];\n        this._oldPads = [];\n        this._pads = [];\n        this._initSuccess = false;\n        this._navigator = navigator;\n        this._minimumConfiguration = null;\n        this._enabled = true;\n    }\n    init() {\n        if (!this.supported) {\n            return;\n        }\n        if (this._initSuccess) {\n            return;\n        }\n        // In Chrome, this will return 4 undefined items until a button is pressed\n        // In FF, this will not return any items until a button is pressed\n        this._oldPads = this._clonePads(this._navigator.getGamepads());\n        if (this._oldPads.length && this._oldPads[0]) {\n            this._initSuccess = true;\n        }\n    }\n    toggleEnabled(enabled) {\n        this._enabled = enabled;\n    }\n    /**\n     * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\n     * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\n     * all other controllers with more axis or buttons are valid as well. If no minimum\n     * configuration is set all pads are valid.\n     */\n    setMinimumGamepadConfiguration(config) {\n        this._enableAndUpdate(); // if config is used, implicitly enable\n        this._minimumConfiguration = config;\n    }\n    /**\n     * When implicitly enabled, set the enabled flag and run an update so information is updated\n     */\n    _enableAndUpdate() {\n        if (!this.enabled) {\n            this.enabled = true;\n            this.update();\n        }\n    }\n    /**\n     * Checks a navigator gamepad against the minimum configuration if present.\n     */\n    _isGamepadValid(pad) {\n        if (!this._minimumConfiguration) {\n            return true;\n        }\n        if (!pad) {\n            return false;\n        }\n        const axesLength = pad.axes.filter((value) => {\n            return typeof value !== undefined;\n        }).length;\n        const buttonLength = pad.buttons.filter((value) => {\n            return typeof value !== undefined;\n        }).length;\n        return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        this._enableAndUpdate(); // implicitly enable\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this._enableAndUpdate(); // implicitly enable\n        this.events.off(eventName, handler);\n    }\n    /**\n     * Updates Gamepad state and publishes Gamepad events\n     */\n    update() {\n        if (!this.enabled || !this.supported) {\n            return;\n        }\n        if (!this._enabled) {\n            return;\n        }\n        this.init();\n        const gamepads = this._navigator.getGamepads();\n        for (let i = 0; i < gamepads.length; i++) {\n            if (!gamepads[i]) {\n                const gamepad = this.at(i);\n                // If was connected, but now isn't emit the disconnect event\n                if (gamepad.connected) {\n                    this.events.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\n                }\n                // Reset connection status\n                gamepad.connected = false;\n                continue;\n            }\n            else {\n                if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\n                    this.events.emit('connect', new GamepadConnectEvent(i, this.at(i)));\n                }\n                // Set connection status\n                this.at(i).connected = true;\n            }\n            this.at(i).update();\n            // Only supported in Chrome\n            if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\n                continue;\n            }\n            this._gamePadTimeStamps[i] = gamepads[i].timestamp;\n            // Add reference to navigator gamepad\n            this.at(i).navigatorGamepad = gamepads[i];\n            // Buttons\n            let b, bi, a, ai, value;\n            for (b in Buttons) {\n                bi = Buttons[b];\n                if (typeof bi === 'number') {\n                    if (gamepads[i].buttons[bi]) {\n                        value = gamepads[i].buttons[bi].value;\n                        if (value !== this._oldPads[i].getButton(bi)) {\n                            if (gamepads[i].buttons[bi].pressed) {\n                                this.at(i).updateButton(bi, value);\n                                this.at(i).events.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\n                            }\n                            else {\n                                this.at(i).updateButton(bi, 0);\n                            }\n                        }\n                    }\n                }\n            }\n            // Axes\n            for (a in Axes) {\n                ai = Axes[a];\n                if (typeof ai === 'number') {\n                    value = gamepads[i].axes[ai];\n                    if (value !== this._oldPads[i].getAxes(ai)) {\n                        this.at(i).updateAxes(ai, value);\n                        this.at(i).events.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\n                    }\n                }\n            }\n            this._oldPads[i] = this._clonePad(gamepads[i]);\n        }\n    }\n    /**\n     * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\n     */\n    at(index) {\n        this._enableAndUpdate(); // implicitly enable gamepads when at() is called\n        if (index >= this._pads.length) {\n            // Ensure there is a pad to retrieve\n            for (let i = this._pads.length - 1, max = index; i < max; i++) {\n                this._pads.push(new Gamepad());\n                this._oldPads.push(new Gamepad());\n            }\n        }\n        return this._pads[index];\n    }\n    /**\n     * Returns a list of all valid gamepads that meet the minimum configuration requirement.\n     */\n    getValidGamepads() {\n        this._enableAndUpdate();\n        const result = [];\n        for (let i = 0; i < this._pads.length; i++) {\n            if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\n                result.push(this.at(i));\n            }\n        }\n        return result;\n    }\n    /**\n     * Gets the number of connected gamepads\n     */\n    count() {\n        return this._pads.filter((p) => p.connected).length;\n    }\n    _clonePads(pads) {\n        const arr = [];\n        for (let i = 0, len = pads.length; i < len; i++) {\n            arr.push(this._clonePad(pads[i]));\n        }\n        return arr;\n    }\n    /**\n     * Fastest way to clone a known object is to do it yourself\n     */\n    _clonePad(pad) {\n        let i, len;\n        const clonedPad = new Gamepad();\n        if (!pad) {\n            return clonedPad;\n        }\n        for (i = 0, len = pad.buttons.length; i < len; i++) {\n            if (pad.buttons[i]) {\n                clonedPad.updateButton(i, pad.buttons[i].value);\n            }\n        }\n        for (i = 0, len = pad.axes.length; i < len; i++) {\n            clonedPad.updateAxes(i, pad.axes[i]);\n        }\n        return clonedPad;\n    }\n}\n/**\n * The minimum value an axis has to move before considering it a change\n */\nGamepads.MinAxisMoveThreshold = 0.05;\n/**\n * Gamepad holds state information for a connected controller. See {@apilink Gamepads}\n * for more information on handling controller input.\n */\nclass Gamepad {\n    constructor() {\n        this.events = new EventEmitter();\n        this.connected = false;\n        this._axes = new Array(4);\n        this._buttons = new Array(16);\n        this._buttonsUp = new Array(16);\n        this._buttonsDown = new Array(16);\n        for (let i = 0; i < this._buttons.length; i++) {\n            this._buttons[i] = 0;\n        }\n        for (let i = 0; i < this._axes.length; i++) {\n            this._axes[i] = 0;\n        }\n    }\n    update() {\n        // Reset buttonsDown and buttonsUp after update is complete\n        this._buttonsDown = new Array(16);\n        this._buttonsUp = new Array(16);\n    }\n    /**\n     * Whether or not the given button is pressed\n     * @deprecated will be removed in v0.28.0. Use isButtonHeld instead\n     * @param button     The button to query\n     * @param threshold  The threshold over which the button is considered to be pressed\n     */\n    isButtonPressed(button, threshold = 1) {\n        return this._buttons[button] >= threshold;\n    }\n    /**\n     * Tests if a certain button is held down. This is persisted between frames.\n     * @param button     The button to query\n     * @param threshold  The threshold over which the button is considered to be pressed\n     */\n    isButtonHeld(button, threshold = 1) {\n        return this._buttons[button] >= threshold;\n    }\n    /**\n     * Tests if a certain button was just pressed this frame. This is cleared at the end of the update frame.\n     * @param button Test whether a button was just pressed\n     * @param threshold  The threshold over which the button is considered to be pressed\n     */\n    wasButtonPressed(button, threshold = 1) {\n        return this._buttonsDown[button] >= threshold;\n    }\n    /**\n     * Tests if a certain button was just released this frame. This is cleared at the end of the update frame.\n     * @param button  Test whether a button was just released\n     */\n    wasButtonReleased(button) {\n        return Boolean(this._buttonsUp[button]);\n    }\n    /**\n     * Gets the given button value between 0 and 1\n     */\n    getButton(button) {\n        return this._buttons[button];\n    }\n    /**\n     * Gets the given axis value between -1 and 1. Values below\n     * {@apilink MinAxisMoveThreshold} are considered 0.\n     */\n    getAxes(axes) {\n        const value = this._axes[axes];\n        if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\n            return 0;\n        }\n        else {\n            return value;\n        }\n    }\n    updateButton(buttonIndex, value) {\n        // button was just released\n        if (value === 0 && this._buttons[buttonIndex]) {\n            this._buttonsUp[buttonIndex] = 1;\n            // button was just pressed\n        }\n        else {\n            this._buttonsDown[buttonIndex] = value;\n        }\n        this._buttons[buttonIndex] = value;\n    }\n    updateAxes(axesIndex, value) {\n        this._axes[axesIndex] = value;\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n}\n/**\n * Gamepad Buttons enumeration\n */\nvar Buttons;\n(function (Buttons) {\n    /**\n     * Face 1 button (e.g. A)\n     */\n    Buttons[Buttons[\"Face1\"] = 0] = \"Face1\";\n    /**\n     * Face 2 button (e.g. B)\n     */\n    Buttons[Buttons[\"Face2\"] = 1] = \"Face2\";\n    /**\n     * Face 3 button (e.g. X)\n     */\n    Buttons[Buttons[\"Face3\"] = 2] = \"Face3\";\n    /**\n     * Face 4 button (e.g. Y)\n     */\n    Buttons[Buttons[\"Face4\"] = 3] = \"Face4\";\n    /**\n     * Left bumper button\n     */\n    Buttons[Buttons[\"LeftBumper\"] = 4] = \"LeftBumper\";\n    /**\n     * Right bumper button\n     */\n    Buttons[Buttons[\"RightBumper\"] = 5] = \"RightBumper\";\n    /**\n     * Left trigger button\n     */\n    Buttons[Buttons[\"LeftTrigger\"] = 6] = \"LeftTrigger\";\n    /**\n     * Right trigger button\n     */\n    Buttons[Buttons[\"RightTrigger\"] = 7] = \"RightTrigger\";\n    /**\n     * Select button\n     */\n    Buttons[Buttons[\"Select\"] = 8] = \"Select\";\n    /**\n     * Start button\n     */\n    Buttons[Buttons[\"Start\"] = 9] = \"Start\";\n    /**\n     * Left analog stick press (e.g. L3)\n     */\n    Buttons[Buttons[\"LeftStick\"] = 10] = \"LeftStick\";\n    /**\n     * Right analog stick press (e.g. R3)\n     */\n    Buttons[Buttons[\"RightStick\"] = 11] = \"RightStick\";\n    /**\n     * D-pad up\n     */\n    Buttons[Buttons[\"DpadUp\"] = 12] = \"DpadUp\";\n    /**\n     * D-pad down\n     */\n    Buttons[Buttons[\"DpadDown\"] = 13] = \"DpadDown\";\n    /**\n     * D-pad left\n     */\n    Buttons[Buttons[\"DpadLeft\"] = 14] = \"DpadLeft\";\n    /**\n     * D-pad right\n     */\n    Buttons[Buttons[\"DpadRight\"] = 15] = \"DpadRight\";\n})(Buttons || (Buttons = {}));\n/**\n * Gamepad Axes enumeration\n */\nvar Axes;\n(function (Axes) {\n    /**\n     * Left analogue stick X direction\n     */\n    Axes[Axes[\"LeftStickX\"] = 0] = \"LeftStickX\";\n    /**\n     * Left analogue stick Y direction\n     */\n    Axes[Axes[\"LeftStickY\"] = 1] = \"LeftStickY\";\n    /**\n     * Right analogue stick X direction\n     */\n    Axes[Axes[\"RightStickX\"] = 2] = \"RightStickX\";\n    /**\n     * Right analogue stick Y direction\n     */\n    Axes[Axes[\"RightStickY\"] = 3] = \"RightStickY\";\n})(Axes || (Axes = {}));\n\n;// ./Input/InputMapper.ts\n/**\n * This allows you to map multiple inputs to specific commands! This is especially useful when\n * you need to allow multiple input sources to control a specific action.\n */\nclass InputMapper {\n    constructor(inputs) {\n        this.inputs = inputs;\n        this._handlers = new Map();\n    }\n    /**\n     * Executes the input map, called internally by Excalibur\n     */\n    execute() {\n        for (const [input, command] of this._handlers.entries()) {\n            const results = input(this.inputs);\n            if (results) {\n                command(results);\n            }\n        }\n    }\n    /**\n     * This allows you to map multiple inputs to specific commands! This is useful\n     *\n     * The inputHandler should return a truthy value if you wish the commandHandler to fire.\n     *\n     * Example:\n     * ```typescript\n     * const moveRight = (amount: number) => { actor.vel.x = 100 * amount }\n     * const moveLeft = (amount: number) => { actor.vel.x = -100 * amount }\n     * const moveUp = (amount: number) => { actor.vel.y = -100 * amount }\n     * const moveDown = (amount: number) => { actor.vel.y = 100 * amount }\n     *\n     * engine.inputMapper.on(({keyboard}) => keyboard.isHeld(ex.Keys.ArrowRight) ? 1 : 0, moveRight);\n     * engine.inputMapper.on(({gamepads}) => gamepads.at(0).isButtonPressed(ex.Buttons.DpadRight) ? 1 : 0, moveRight);\n     * engine.inputMapper.on(({gamepads}) => gamepads.at(0).getAxes(ex.Axes.LeftStickX) > 0 ?\n     *  gamepads.at(0).getAxes(ex.Axes.LeftStickX) : 0, moveRight);\n     * ```\n     * @param inputHandler\n     * @param commandHandler\n     */\n    on(inputHandler, commandHandler) {\n        this._handlers.set(inputHandler, commandHandler);\n    }\n}\n\n;// ./Util/IFrame.ts\n/**\n * Checks if excalibur is in a x-origin iframe\n */\nfunction isCrossOriginIframe() {\n    try {\n        // Try and listen to events on top window frame if within an iframe.\n        //\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\n        //\n        // Attempt to add an event listener, which triggers a DOMException on\n        // cross-origin iframes\n        const noop = () => {\n            return;\n        };\n        window.top.addEventListener('blur', noop);\n        window.top.removeEventListener('blur', noop);\n    }\n    catch (_a) {\n        return true;\n    }\n    return false;\n}\n\n;// ./Input/Keyboard.ts\n\n\n\n\n/**\n * Enum representing physical input key codes\n *\n * Spec: https://w3c.github.io/uievents-code/#key-alphanumeric-section\n */\nvar Keys;\n(function (Keys) {\n    // Writing System Keys https://w3c.github.io/uievents-code/#key-alphanumeric-writing-system\n    Keys[\"Backquote\"] = \"Backquote\";\n    Keys[\"Backslash\"] = \"Backslash\";\n    Keys[\"BracketLeft\"] = \"BracketLeft\";\n    Keys[\"BracketRight\"] = \"BracketRight\";\n    Keys[\"Comma\"] = \"Comma\";\n    // NUMBERS\n    Keys[\"Key0\"] = \"Digit0\";\n    Keys[\"Key1\"] = \"Digit1\";\n    Keys[\"Key2\"] = \"Digit2\";\n    Keys[\"Key3\"] = \"Digit3\";\n    Keys[\"Key4\"] = \"Digit4\";\n    Keys[\"Key5\"] = \"Digit5\";\n    Keys[\"Key6\"] = \"Digit6\";\n    Keys[\"Key7\"] = \"Digit7\";\n    Keys[\"Key8\"] = \"Digit8\";\n    Keys[\"Key9\"] = \"Digit9\";\n    Keys[\"Digit0\"] = \"Digit0\";\n    Keys[\"Digit1\"] = \"Digit1\";\n    Keys[\"Digit2\"] = \"Digit2\";\n    Keys[\"Digit3\"] = \"Digit3\";\n    Keys[\"Digit4\"] = \"Digit4\";\n    Keys[\"Digit5\"] = \"Digit5\";\n    Keys[\"Digit6\"] = \"Digit6\";\n    Keys[\"Digit7\"] = \"Digit7\";\n    Keys[\"Digit8\"] = \"Digit8\";\n    Keys[\"Digit9\"] = \"Digit9\";\n    Keys[\"Equal\"] = \"Equal\";\n    Keys[\"IntlBackslash\"] = \"IntlBackslash\";\n    Keys[\"IntlRo\"] = \"IntlRo\";\n    Keys[\"IntlYen\"] = \"IntlYen\";\n    // LETTERS\n    Keys[\"A\"] = \"KeyA\";\n    Keys[\"B\"] = \"KeyB\";\n    Keys[\"C\"] = \"KeyC\";\n    Keys[\"D\"] = \"KeyD\";\n    Keys[\"E\"] = \"KeyE\";\n    Keys[\"F\"] = \"KeyF\";\n    Keys[\"G\"] = \"KeyG\";\n    Keys[\"H\"] = \"KeyH\";\n    Keys[\"I\"] = \"KeyI\";\n    Keys[\"J\"] = \"KeyJ\";\n    Keys[\"K\"] = \"KeyK\";\n    Keys[\"L\"] = \"KeyL\";\n    Keys[\"M\"] = \"KeyM\";\n    Keys[\"N\"] = \"KeyN\";\n    Keys[\"O\"] = \"KeyO\";\n    Keys[\"P\"] = \"KeyP\";\n    Keys[\"Q\"] = \"KeyQ\";\n    Keys[\"R\"] = \"KeyR\";\n    Keys[\"S\"] = \"KeyS\";\n    Keys[\"T\"] = \"KeyT\";\n    Keys[\"U\"] = \"KeyU\";\n    Keys[\"V\"] = \"KeyV\";\n    Keys[\"W\"] = \"KeyW\";\n    Keys[\"X\"] = \"KeyX\";\n    Keys[\"Y\"] = \"KeyY\";\n    Keys[\"Z\"] = \"KeyZ\";\n    Keys[\"KeyA\"] = \"KeyA\";\n    Keys[\"KeyB\"] = \"KeyB\";\n    Keys[\"KeyC\"] = \"KeyC\";\n    Keys[\"KeyD\"] = \"KeyD\";\n    Keys[\"KeyE\"] = \"KeyE\";\n    Keys[\"KeyF\"] = \"KeyF\";\n    Keys[\"KeyG\"] = \"KeyG\";\n    Keys[\"KeyH\"] = \"KeyH\";\n    Keys[\"KeyI\"] = \"KeyI\";\n    Keys[\"KeyJ\"] = \"KeyJ\";\n    Keys[\"KeyK\"] = \"KeyK\";\n    Keys[\"KeyL\"] = \"KeyL\";\n    Keys[\"KeyM\"] = \"KeyM\";\n    Keys[\"KeyN\"] = \"KeyN\";\n    Keys[\"KeyO\"] = \"KeyO\";\n    Keys[\"KeyP\"] = \"KeyP\";\n    Keys[\"KeyQ\"] = \"KeyQ\";\n    Keys[\"KeyR\"] = \"KeyR\";\n    Keys[\"KeyS\"] = \"KeyS\";\n    Keys[\"KeyT\"] = \"KeyT\";\n    Keys[\"KeyU\"] = \"KeyU\";\n    Keys[\"KeyV\"] = \"KeyV\";\n    Keys[\"KeyW\"] = \"KeyW\";\n    Keys[\"KeyX\"] = \"KeyX\";\n    Keys[\"KeyY\"] = \"KeyY\";\n    Keys[\"KeyZ\"] = \"KeyZ\";\n    // SYMBOLS\n    Keys[\"Minus\"] = \"Minus\";\n    Keys[\"Period\"] = \"Period\";\n    Keys[\"Quote\"] = \"Quote\";\n    Keys[\"Semicolon\"] = \"Semicolon\";\n    Keys[\"Slash\"] = \"Slash\";\n    // Functional keys https://w3c.github.io/uievents-code/#key-alphanumeric-functional\n    Keys[\"AltLeft\"] = \"AltLeft\";\n    Keys[\"AltRight\"] = \"AltRight\";\n    Keys[\"Alt\"] = \"Alt\";\n    Keys[\"AltGraph\"] = \"AltGraph\";\n    Keys[\"Backspace\"] = \"Backspace\";\n    Keys[\"CapsLock\"] = \"CapsLock\";\n    Keys[\"ContextMenu\"] = \"ContextMenu\";\n    Keys[\"ControlLeft\"] = \"ControlLeft\";\n    Keys[\"ControlRight\"] = \"ControlRight\";\n    Keys[\"Enter\"] = \"Enter\";\n    Keys[\"MetaLeft\"] = \"MetaLeft\";\n    Keys[\"MetaRight\"] = \"MetaRight\";\n    Keys[\"ShiftLeft\"] = \"ShiftLeft\";\n    Keys[\"ShiftRight\"] = \"ShiftRight\";\n    Keys[\"Space\"] = \"Space\";\n    Keys[\"Tab\"] = \"Tab\";\n    Keys[\"Convert\"] = \"Convert\";\n    Keys[\"KanaMode\"] = \"KanaMode\";\n    Keys[\"NonConvert\"] = \"NonConvert\";\n    // Control Pad https://w3c.github.io/uievents-code/#key-controlpad-section\n    Keys[\"Delete\"] = \"Delete\";\n    Keys[\"End\"] = \"End\";\n    Keys[\"Help\"] = \"Help\";\n    Keys[\"Home\"] = \"Home\";\n    Keys[\"Insert\"] = \"Insert\";\n    Keys[\"PageDown\"] = \"PageDown\";\n    Keys[\"PageUp\"] = \"PageUp\";\n    // Arrow Pad https://w3c.github.io/uievents-code/#key-arrowpad-section\n    Keys[\"Up\"] = \"ArrowUp\";\n    Keys[\"Down\"] = \"ArrowDown\";\n    Keys[\"Left\"] = \"ArrowLeft\";\n    Keys[\"Right\"] = \"ArrowRight\";\n    Keys[\"ArrowUp\"] = \"ArrowUp\";\n    Keys[\"ArrowDown\"] = \"ArrowDown\";\n    Keys[\"ArrowLeft\"] = \"ArrowLeft\";\n    Keys[\"ArrowRight\"] = \"ArrowRight\";\n    // Numpad Section https://w3c.github.io/uievents-code/#key-numpad-section\n    Keys[\"NumLock\"] = \"NumLock\";\n    Keys[\"Numpad0\"] = \"Numpad0\";\n    Keys[\"Numpad1\"] = \"Numpad1\";\n    Keys[\"Numpad2\"] = \"Numpad2\";\n    Keys[\"Numpad3\"] = \"Numpad3\";\n    Keys[\"Numpad4\"] = \"Numpad4\";\n    Keys[\"Numpad5\"] = \"Numpad5\";\n    Keys[\"Numpad6\"] = \"Numpad6\";\n    Keys[\"Numpad7\"] = \"Numpad7\";\n    Keys[\"Numpad8\"] = \"Numpad8\";\n    Keys[\"Numpad9\"] = \"Numpad9\";\n    Keys[\"Num0\"] = \"Numpad0\";\n    Keys[\"Num1\"] = \"Numpad1\";\n    Keys[\"Num2\"] = \"Numpad2\";\n    Keys[\"Num3\"] = \"Numpad3\";\n    Keys[\"Num4\"] = \"Numpad4\";\n    Keys[\"Num5\"] = \"Numpad5\";\n    Keys[\"Num6\"] = \"Numpad6\";\n    Keys[\"Num7\"] = \"Numpad7\";\n    Keys[\"Num8\"] = \"Numpad8\";\n    Keys[\"Num9\"] = \"Numpad9\";\n    Keys[\"NumAdd\"] = \"NumpadAdd\";\n    Keys[\"NumpadAdd\"] = \"NumpadAdd\";\n    Keys[\"NumDecimal\"] = \"NumpadDecimal\";\n    Keys[\"NumpadDecimal\"] = \"NumpadDecimal\";\n    Keys[\"NumDivide\"] = \"NumpadDivide\";\n    Keys[\"NumpadDivide\"] = \"NumpadDivide\";\n    Keys[\"NumEnter\"] = \"NumpadEnter\";\n    Keys[\"NumpadEnter\"] = \"NumpadEnter\";\n    Keys[\"NumMultiply\"] = \"NumpadMultiply\";\n    Keys[\"NumpadMultiply\"] = \"NumpadMultiply\";\n    Keys[\"NumSubtract\"] = \"NumpadSubtract\";\n    Keys[\"NumpadSubtract\"] = \"NumpadSubtract\";\n    // NumComma = 'NumpadComma', // not x-browser\n    // NumpadComma = 'NumpadComma', // not x-browser\n    // Function section https://w3c.github.io/uievents-code/#key-function-section\n    Keys[\"Esc\"] = \"Escape\";\n    Keys[\"Escape\"] = \"Escape\";\n    Keys[\"F1\"] = \"F1\";\n    Keys[\"F2\"] = \"F2\";\n    Keys[\"F3\"] = \"F3\";\n    Keys[\"F4\"] = \"F4\";\n    Keys[\"F5\"] = \"F5\";\n    Keys[\"F6\"] = \"F6\";\n    Keys[\"F7\"] = \"F7\";\n    Keys[\"F8\"] = \"F8\";\n    Keys[\"F9\"] = \"F9\";\n    Keys[\"F10\"] = \"F10\";\n    Keys[\"F11\"] = \"F11\";\n    Keys[\"F12\"] = \"F12\";\n    Keys[\"F13\"] = \"F13\";\n    Keys[\"F14\"] = \"F14\";\n    Keys[\"F15\"] = \"F15\";\n    Keys[\"F16\"] = \"F16\";\n    Keys[\"F17\"] = \"F17\";\n    Keys[\"F18\"] = \"F18\";\n    Keys[\"F19\"] = \"F19\";\n    Keys[\"F20\"] = \"F20\";\n    Keys[\"PrintScreen\"] = \"PrintScreen\";\n    Keys[\"ScrollLock\"] = \"ScrollLock\";\n    Keys[\"Pause\"] = \"Pause\";\n    Keys[\"Unidentified\"] = \"Unidentified\";\n})(Keys || (Keys = {}));\n/**\n * Event thrown on a game object for a key event\n */\nclass KeyEvent extends GameEvent {\n    /**\n     * @param key  The key responsible for throwing the event\n     * @param value The key's typed value the browser detected\n     * @param originalEvent The original keyboard event that Excalibur handled\n     */\n    constructor(key, value, originalEvent) {\n        super();\n        this.key = key;\n        this.value = value;\n        this.originalEvent = originalEvent;\n    }\n}\nconst KeyEvents = {\n    Press: 'press',\n    Hold: 'hold',\n    Release: 'release'\n};\n/**\n * Provides keyboard support for Excalibur.\n */\nclass Keyboard {\n    constructor() {\n        this.events = new EventEmitter();\n        this._enabled = true;\n        /**\n         * Keys that are currently held down\n         */\n        this._keys = [];\n        /**\n         * Keys up in the current frame\n         */\n        this._keysUp = [];\n        /**\n         * Keys down in the current frame\n         */\n        this._keysDown = [];\n        this._releaseAllKeys = (ev) => {\n            for (const code of this._keys) {\n                const keyEvent = new KeyEvent(code, ev.key, ev);\n                this.events.emit('up', keyEvent);\n                this.events.emit('release', keyEvent);\n            }\n            this._keysUp = Array.from(new Set(this._keys.concat(this._keysUp)));\n            this._keys.length = 0;\n        };\n        this._handleKeyDown = (ev) => {\n            if (!this._enabled) {\n                return;\n            }\n            // handle macos meta key issue\n            // https://github.com/excaliburjs/Excalibur/issues/2608\n            if (!ev.metaKey && (this._keys.includes(Keys.MetaLeft) || this._keys.includes(Keys.MetaRight))) {\n                this._releaseAllKeys(ev);\n            }\n            const code = ev.code;\n            if (this._keys.indexOf(code) === -1) {\n                this._keys.push(code);\n                this._keysDown.push(code);\n                const keyEvent = new KeyEvent(code, ev.key, ev);\n                this.events.emit('down', keyEvent);\n                this.events.emit('press', keyEvent);\n            }\n        };\n        this._handleKeyUp = (ev) => {\n            if (!this._enabled) {\n                return;\n            }\n            const code = ev.code;\n            const key = this._keys.indexOf(code);\n            this._keys.splice(key, 1);\n            this._keysUp.push(code);\n            const keyEvent = new KeyEvent(code, ev.key, ev);\n            // alias the old api, we may want to deprecate this in the future\n            this.events.emit('up', keyEvent);\n            this.events.emit('release', keyEvent);\n            // handle macos meta key issue\n            // https://github.com/excaliburjs/Excalibur/issues/2608\n            if (ev.key === 'Meta') {\n                this._releaseAllKeys(ev);\n            }\n        };\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    /**\n     * Initialize Keyboard event listeners\n     */\n    init(keyboardOptions) {\n        let { global } = keyboardOptions;\n        const { grabWindowFocus } = keyboardOptions;\n        if (!global) {\n            if (isCrossOriginIframe()) {\n                global = window;\n                // Workaround for iframes like for itch.io or codesandbox\n                // https://www.reddit.com/r/gamemaker/comments/kfs5cs/keyboard_inputs_no_longer_working_in_html5_game/\n                // https://forum.gamemaker.io/index.php?threads/solved-keyboard-issue-on-itch-io.87336/\n                if (grabWindowFocus) {\n                    window.focus();\n                }\n                Logger.getInstance().warn('Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus');\n            }\n            else {\n                global = window.top;\n            }\n        }\n        global.addEventListener('blur', () => {\n            this._keys.length = 0; // empties array efficiently\n        });\n        // key up is on window because canvas cannot have focus\n        global.addEventListener('keyup', this._handleKeyUp);\n        // key down is on window because canvas cannot have focus\n        global.addEventListener('keydown', this._handleKeyDown);\n    }\n    toggleEnabled(enabled) {\n        this._enabled = enabled;\n    }\n    clear() {\n        this._keysDown.length = 0;\n        this._keysUp.length = 0;\n        this._keys.length = 0;\n    }\n    update() {\n        // Reset keysDown and keysUp after update is complete\n        this._keysDown.length = 0;\n        this._keysUp.length = 0;\n        // Emit synthetic \"hold\" event\n        for (let i = 0; i < this._keys.length; i++) {\n            this.events.emit('hold', new KeyEvent(this._keys[i]));\n        }\n    }\n    /**\n     * Gets list of keys being pressed down\n     */\n    getKeys() {\n        return this._keys;\n    }\n    /**\n     * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\n     * @param key Test whether a key was just pressed\n     */\n    wasPressed(key) {\n        if (!this._enabled) {\n            return false;\n        }\n        return this._keysDown.indexOf(key) > -1;\n    }\n    /**\n     * Tests if a certain key is held down. This is persisted between frames.\n     * @param key  Test whether a key is held down\n     */\n    isHeld(key) {\n        if (!this._enabled) {\n            return false;\n        }\n        return this._keys.indexOf(key) > -1;\n    }\n    /**\n     * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\n     * @param key  Test whether a key was just released\n     */\n    wasReleased(key) {\n        if (!this._enabled) {\n            return false;\n        }\n        return this._keysUp.indexOf(key) > -1;\n    }\n    /**\n     * Trigger a manual key event\n     * @param type\n     * @param key\n     * @param character\n     */\n    triggerEvent(type, key, character) {\n        if (type === 'down') {\n            this._handleKeyDown(new KeyboardEvent('keydown', {\n                code: key,\n                key: character !== null && character !== void 0 ? character : null\n            }));\n        }\n        if (type === 'up') {\n            this._handleKeyUp(new KeyboardEvent('keyup', {\n                code: key,\n                key: character !== null && character !== void 0 ? character : null\n            }));\n        }\n    }\n}\n\n;// ./Math/global-coordinates.ts\n\nclass GlobalCoordinates {\n    static fromPagePosition(xOrPos, yOrEngine, engineOrUndefined) {\n        let pageX;\n        let pageY;\n        let pagePos;\n        let engine;\n        if (arguments.length === 3) {\n            pageX = xOrPos;\n            pageY = yOrEngine;\n            pagePos = new Vector(pageX, pageY);\n            engine = engineOrUndefined;\n        }\n        else {\n            pagePos = xOrPos;\n            pageX = pagePos.x;\n            pageY = pagePos.y;\n            engine = yOrEngine;\n        }\n        const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\n        const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\n        return new GlobalCoordinates(worldPos, pagePos, screenPos);\n    }\n    constructor(worldPos, pagePos, screenPos) {\n        this.worldPos = worldPos;\n        this.pagePos = pagePos;\n        this.screenPos = screenPos;\n    }\n}\n\n;// ./Input/PointerEvent.ts\nclass PointerEvent {\n    cancel() {\n        this.active = false;\n    }\n    get pagePos() {\n        return this.coordinates.pagePos;\n    }\n    get screenPos() {\n        return this.coordinates.screenPos;\n    }\n    get worldPos() {\n        return this.coordinates.worldPos;\n    }\n    constructor(type, pointerId, button, pointerType, coordinates, nativeEvent) {\n        this.type = type;\n        this.pointerId = pointerId;\n        this.button = button;\n        this.pointerType = pointerType;\n        this.coordinates = coordinates;\n        this.nativeEvent = nativeEvent;\n        this.active = true;\n    }\n}\n\n;// ./Input/WheelEvent.ts\nclass WheelEvent {\n    cancel() {\n        this.active = false;\n    }\n    constructor(x, y, pageX, pageY, screenX, screenY, index, deltaX, deltaY, deltaZ, deltaMode, ev) {\n        this.x = x;\n        this.y = y;\n        this.pageX = pageX;\n        this.pageY = pageY;\n        this.screenX = screenX;\n        this.screenY = screenY;\n        this.index = index;\n        this.deltaX = deltaX;\n        this.deltaY = deltaY;\n        this.deltaZ = deltaZ;\n        this.deltaMode = deltaMode;\n        this.ev = ev;\n        this.active = true;\n    }\n}\n\n;// ./Input/PointerAbstraction.ts\n\n\n\nclass PointerAbstraction {\n    constructor() {\n        this.events = new EventEmitter();\n        /**\n         * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n         */\n        this.lastPagePos = Vector.Zero;\n        /**\n         * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n         */\n        this.lastScreenPos = Vector.Zero;\n        /**\n         * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n         */\n        this.lastWorldPos = Vector.Zero;\n        this._onPointerMove = (ev) => {\n            this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n            this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n            this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n        };\n        this._onPointerDown = (ev) => {\n            this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n            this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n            this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n        };\n        this.on('move', this._onPointerMove);\n        this.on('down', this._onPointerDown);\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    /**\n     * Called internally by excalibur to keep pointers up to date\n     * @internal\n     * @param engine\n     */\n    _updateWorldPosition(engine) {\n        const coord = GlobalCoordinates.fromPagePosition(this.lastPagePos, engine);\n        this.lastScreenPos = coord.screenPos;\n        this.lastWorldPos = coord.worldPos;\n    }\n}\n\n;// ./Input/WheelDeltaMode.ts\nvar WheelDeltaMode;\n(function (WheelDeltaMode) {\n    WheelDeltaMode[\"Pixel\"] = \"Pixel\";\n    WheelDeltaMode[\"Line\"] = \"Line\";\n    WheelDeltaMode[\"Page\"] = \"Page\";\n})(WheelDeltaMode || (WheelDeltaMode = {}));\n\n;// ./Input/NativePointerButton.ts\n/**\n * Native browser button enumeration\n */\nvar NativePointerButton;\n(function (NativePointerButton) {\n    NativePointerButton[NativePointerButton[\"NoButton\"] = -1] = \"NoButton\";\n    NativePointerButton[NativePointerButton[\"Left\"] = 0] = \"Left\";\n    NativePointerButton[NativePointerButton[\"Middle\"] = 1] = \"Middle\";\n    NativePointerButton[NativePointerButton[\"Right\"] = 2] = \"Right\";\n    NativePointerButton[NativePointerButton[\"Unknown\"] = 3] = \"Unknown\";\n})(NativePointerButton || (NativePointerButton = {}));\n\n;// ./Input/PointerButton.ts\n/**\n * The mouse button being pressed.\n */\nvar PointerButton;\n(function (PointerButton) {\n    PointerButton[\"Left\"] = \"Left\";\n    PointerButton[\"Middle\"] = \"Middle\";\n    PointerButton[\"Right\"] = \"Right\";\n    PointerButton[\"Unknown\"] = \"Unknown\";\n    PointerButton[\"NoButton\"] = \"NoButton\";\n})(PointerButton || (PointerButton = {}));\n\n;// ./Input/PointerType.ts\n/**\n * The type of pointer for a {@apilink PointerEvent}.\n */\nvar PointerType;\n(function (PointerType) {\n    PointerType[\"Touch\"] = \"Touch\";\n    PointerType[\"Mouse\"] = \"Mouse\";\n    PointerType[\"Pen\"] = \"Pen\";\n    PointerType[\"Unknown\"] = \"Unknown\";\n})(PointerType || (PointerType = {}));\n\n;// ./Input/PointerEventReceiver.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst PointerEvents = {\n    Move: 'move',\n    Down: 'down',\n    Up: 'up',\n    Wheel: 'wheel'\n};\n/**\n * Is this event a native touch event?\n */\nfunction isTouchEvent(value) {\n    // Guard for Safari <= 13.1\n    return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\n}\n/**\n * Is this event a native pointer event\n */\nfunction isPointerEvent(value) {\n    // Guard for Safari <= 13.1\n    return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\n}\n/**\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\n */\nclass PointerEventReceiver {\n    constructor(target, engine) {\n        this.target = target;\n        this.engine = engine;\n        this.events = new EventEmitter();\n        this.primary = new PointerAbstraction();\n        this._activeNativePointerIdsToNormalized = new Map();\n        this.lastFramePointerCoords = new Map();\n        this.currentFramePointerCoords = new Map();\n        this.currentFramePointerDown = new Map();\n        this.lastFramePointerDown = new Map();\n        this.currentFrameDown = [];\n        this.currentFrameUp = [];\n        this.currentFrameMove = [];\n        this.currentFrameCancel = [];\n        this.currentFrameWheel = [];\n        this._enabled = true;\n        this._pointers = [this.primary];\n        this._boundHandle = this._handle.bind(this);\n        this._boundWheel = this._handleWheel.bind(this);\n    }\n    toggleEnabled(enabled) {\n        this._enabled = enabled;\n    }\n    /**\n     * Creates a new PointerEventReceiver with a new target and engine while preserving existing pointer event\n     * handlers.\n     * @param target\n     * @param engine\n     */\n    recreate(target, engine) {\n        const eventReceiver = new PointerEventReceiver(target, engine);\n        eventReceiver.primary = this.primary;\n        eventReceiver._pointers = this._pointers;\n        return eventReceiver;\n    }\n    /**\n     * Locates a specific pointer by id, creates it if it doesn't exist\n     * @param index\n     */\n    at(index) {\n        if (index >= this._pointers.length) {\n            // Ensure there is a pointer to retrieve\n            for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n                this._pointers.push(new PointerAbstraction());\n            }\n        }\n        return this._pointers[index];\n    }\n    /**\n     * The number of pointers currently being tracked by excalibur\n     */\n    count() {\n        return this._pointers.length;\n    }\n    /**\n     * Is the specified pointer id down this frame\n     * @param pointerId\n     */\n    isDown(pointerId) {\n        var _a;\n        if (!this._enabled) {\n            return false;\n        }\n        return (_a = this.currentFramePointerDown.get(pointerId)) !== null && _a !== void 0 ? _a : false;\n    }\n    /**\n     * Was the specified pointer id down last frame\n     * @param pointerId\n     */\n    wasDown(pointerId) {\n        var _a;\n        if (!this._enabled) {\n            return false;\n        }\n        return (_a = this.lastFramePointerDown.get(pointerId)) !== null && _a !== void 0 ? _a : false;\n    }\n    /**\n     * Whether the Pointer is currently dragging.\n     */\n    isDragging(pointerId) {\n        if (!this._enabled) {\n            return false;\n        }\n        return this.isDown(pointerId);\n    }\n    /**\n     * Whether the Pointer just started dragging.\n     */\n    isDragStart(pointerId) {\n        if (!this._enabled) {\n            return false;\n        }\n        return this.isDown(pointerId) && !this.wasDown(pointerId);\n    }\n    /**\n     * Whether the Pointer just ended dragging.\n     */\n    isDragEnd(pointerId) {\n        if (!this._enabled) {\n            return false;\n        }\n        return !this.isDown(pointerId) && this.wasDown(pointerId);\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    /**\n     * Called internally by excalibur\n     *\n     * Updates the current frame pointer info and emits raw pointer events\n     *\n     * This does not emit events to entities, see PointerSystem\n     * @internal\n     */\n    update() {\n        this.lastFramePointerDown = new Map(this.currentFramePointerDown);\n        this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\n        for (const event of this.currentFrameDown) {\n            if (!event.active) {\n                continue;\n            }\n            this.emit('down', event);\n            const pointer = this.at(event.pointerId);\n            pointer.emit('down', event);\n            this.primary.emit('pointerdown', event);\n        }\n        for (const event of this.currentFrameUp) {\n            if (!event.active) {\n                continue;\n            }\n            this.emit('up', event);\n            const pointer = this.at(event.pointerId);\n            pointer.emit('up', event);\n        }\n        for (const event of this.currentFrameMove) {\n            if (!event.active) {\n                continue;\n            }\n            this.emit('move', event);\n            const pointer = this.at(event.pointerId);\n            pointer.emit('move', event);\n        }\n        for (const event of this.currentFrameCancel) {\n            if (!event.active) {\n                continue;\n            }\n            this.emit('cancel', event);\n            const pointer = this.at(event.pointerId);\n            pointer.emit('cancel', event);\n        }\n        for (const event of this.currentFrameWheel) {\n            if (!event.active) {\n                continue;\n            }\n            this.emit('pointerwheel', event);\n            this.emit('wheel', event);\n            this.primary.emit('pointerwheel', event);\n            this.primary.emit('wheel', event);\n        }\n        if (this.engine.currentScene.camera.hasChanged()) {\n            for (const pointer of this._pointers) {\n                pointer._updateWorldPosition(this.engine);\n            }\n        }\n    }\n    /**\n     * Clears the current frame event and pointer data\n     */\n    clear() {\n        for (const event of this.currentFrameUp) {\n            this.currentFramePointerCoords.delete(event.pointerId);\n            const ids = this._activeNativePointerIdsToNormalized.entries();\n            for (const [native, normalized] of ids) {\n                if (normalized === event.pointerId) {\n                    this._activeNativePointerIdsToNormalized.delete(native);\n                }\n            }\n        }\n        this.currentFrameDown.length = 0;\n        this.currentFrameUp.length = 0;\n        this.currentFrameMove.length = 0;\n        this.currentFrameCancel.length = 0;\n        this.currentFrameWheel.length = 0;\n    }\n    /**\n     * Initializes the pointer event receiver so that it can start listening to native\n     * browser events.\n     */\n    init(options) {\n        var _a;\n        if (this.engine.isDisposed()) {\n            return;\n        }\n        // Disabling the touch action avoids browser/platform gestures from firing on the canvas\n        // It is important on mobile to have touch action 'none'\n        // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\n        if (this.target === this.engine.canvas) {\n            this.engine.canvas.style.touchAction = 'none';\n        }\n        else {\n            document.body.style.touchAction = 'none';\n        }\n        // Preferred pointer events\n        if (window.PointerEvent) {\n            this.target.addEventListener('pointerdown', this._boundHandle);\n            this.target.addEventListener('pointerup', this._boundHandle);\n            this.target.addEventListener('pointermove', this._boundHandle);\n            this.target.addEventListener('pointercancel', this._boundHandle);\n        }\n        else {\n            // Touch Events\n            this.target.addEventListener('touchstart', this._boundHandle);\n            this.target.addEventListener('touchend', this._boundHandle);\n            this.target.addEventListener('touchmove', this._boundHandle);\n            this.target.addEventListener('touchcancel', this._boundHandle);\n            // Mouse Events\n            this.target.addEventListener('mousedown', this._boundHandle);\n            this.target.addEventListener('mouseup', this._boundHandle);\n            this.target.addEventListener('mousemove', this._boundHandle);\n        }\n        // MDN MouseWheelEvent\n        const wheelOptions = {\n            passive: !(this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n                this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas)\n        };\n        if ('onwheel' in document.createElement('div')) {\n            // Modern Browsers\n            this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\n        }\n        else if (document.onmousewheel !== undefined) {\n            // Webkit and IE\n            this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\n        }\n        else {\n            // Remaining browser and older Firefox\n            this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\n        }\n        const grabWindowFocus = (_a = options === null || options === void 0 ? void 0 : options.grabWindowFocus) !== null && _a !== void 0 ? _a : true;\n        // Handle cross origin iframe\n        if (grabWindowFocus && isCrossOriginIframe()) {\n            const grabFocus = () => {\n                window.focus();\n            };\n            // Preferred pointer events\n            if (window.PointerEvent) {\n                this.target.addEventListener('pointerdown', grabFocus);\n            }\n            else {\n                // Touch Events\n                this.target.addEventListener('touchstart', grabFocus);\n                // Mouse Events\n                this.target.addEventListener('mousedown', grabFocus);\n            }\n        }\n    }\n    detach() {\n        // Preferred pointer events\n        if (window.PointerEvent) {\n            this.target.removeEventListener('pointerdown', this._boundHandle);\n            this.target.removeEventListener('pointerup', this._boundHandle);\n            this.target.removeEventListener('pointermove', this._boundHandle);\n            this.target.removeEventListener('pointercancel', this._boundHandle);\n        }\n        else {\n            // Touch Events\n            this.target.removeEventListener('touchstart', this._boundHandle);\n            this.target.removeEventListener('touchend', this._boundHandle);\n            this.target.removeEventListener('touchmove', this._boundHandle);\n            this.target.removeEventListener('touchcancel', this._boundHandle);\n            // Mouse Events\n            this.target.removeEventListener('mousedown', this._boundHandle);\n            this.target.removeEventListener('mouseup', this._boundHandle);\n            this.target.removeEventListener('mousemove', this._boundHandle);\n        }\n        if ('onwheel' in document.createElement('div')) {\n            // Modern Browsers\n            this.target.removeEventListener('wheel', this._boundWheel);\n        }\n        else if (document.onmousewheel !== undefined) {\n            // Webkit and IE\n            this.target.addEventListener('mousewheel', this._boundWheel);\n        }\n        else {\n            // Remaining browser and older Firefox\n            this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\n        }\n    }\n    /**\n     * Take native pointer id and map it to index in active pointers\n     * @param nativePointerId\n     */\n    _normalizePointerId(nativePointerId) {\n        // Add to the the native pointer set id\n        this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\n        // Native pointer ids in ascending order\n        const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\n        // The index into sorted ids will be the new id, will always have an id\n        const id = currentPointerIds.findIndex((p) => p === nativePointerId);\n        // Save the mapping so we can reverse it later\n        this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\n        // ignore pointer because game isn't watching\n        return id;\n    }\n    /**\n     * Responsible for handling and parsing pointer events\n     */\n    _handle(ev) {\n        if (!this._enabled) {\n            return;\n        }\n        ev.preventDefault();\n        const eventCoords = new Map();\n        let button;\n        let pointerType;\n        if (isTouchEvent(ev)) {\n            button = PointerButton.Unknown;\n            pointerType = PointerType.Touch;\n            // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\n            for (let i = 0; i < ev.changedTouches.length; i++) {\n                const touch = ev.changedTouches[i];\n                const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\n                const nativePointerId = i + 1;\n                const pointerId = this._normalizePointerId(nativePointerId);\n                this.currentFramePointerCoords.set(pointerId, coordinates);\n                eventCoords.set(pointerId, coordinates);\n            }\n        }\n        else {\n            button = this._nativeButtonToPointerButton(ev.button);\n            pointerType = PointerType.Mouse;\n            const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\n            let nativePointerId = 1;\n            if (isPointerEvent(ev)) {\n                nativePointerId = ev.pointerId;\n                pointerType = this._stringToPointerType(ev.pointerType);\n            }\n            const pointerId = this._normalizePointerId(nativePointerId);\n            this.currentFramePointerCoords.set(pointerId, coordinates);\n            eventCoords.set(pointerId, coordinates);\n        }\n        for (const [pointerId, coord] of eventCoords.entries()) {\n            switch (ev.type) {\n                case 'mousedown':\n                case 'pointerdown':\n                case 'touchstart':\n                    this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\n                    this.currentFramePointerDown.set(pointerId, true);\n                    break;\n                case 'mouseup':\n                case 'pointerup':\n                case 'touchend':\n                    this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\n                    this.currentFramePointerDown.set(pointerId, false);\n                    break;\n                case 'mousemove':\n                case 'pointermove':\n                case 'touchmove':\n                    this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\n                    break;\n                case 'touchcancel':\n                case 'pointercancel':\n                    this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\n                    break;\n            }\n        }\n    }\n    _handleWheel(ev) {\n        if (!this._enabled) {\n            return;\n        }\n        // Should we prevent page scroll because of this event\n        if (this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n            (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)) {\n            ev.preventDefault();\n        }\n        const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\n        const world = this.engine.screen.screenToWorldCoordinates(screen);\n        /**\n         * A constant used to normalize wheel events across different browsers\n         *\n         * This normalization factor is pulled from\n         * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n         */\n        const ScrollWheelNormalizationFactor = -1 / 40;\n        const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n        const deltaY = ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\n        const deltaZ = ev.deltaZ || 0;\n        let deltaMode = WheelDeltaMode.Pixel;\n        if (ev.deltaMode) {\n            if (ev.deltaMode === 1) {\n                deltaMode = WheelDeltaMode.Line;\n            }\n            else if (ev.deltaMode === 2) {\n                deltaMode = WheelDeltaMode.Page;\n            }\n        }\n        const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\n        this.currentFrameWheel.push(we);\n    }\n    /**\n     * Triggers an excalibur pointer event in a world space pos\n     *\n     * Useful for testing pointers in excalibur\n     * @param type\n     * @param pos\n     */\n    triggerEvent(type, pos) {\n        const page = this.engine.screen.worldToPageCoordinates(pos);\n        // Send an event to the event receiver\n        if (window.PointerEvent) {\n            this._handle(new window.PointerEvent('pointer' + type, {\n                pointerId: 0,\n                clientX: page.x,\n                clientY: page.y\n            }));\n        }\n        else {\n            // Safari hack\n            this._handle(new window.MouseEvent('mouse' + type, {\n                clientX: page.x,\n                clientY: page.y\n            }));\n        }\n        // Force update pointer system\n        const pointerSystem = this.engine.currentScene.world.get(PointerSystem);\n        pointerSystem.preupdate(this.engine.currentScene, 1);\n        pointerSystem.update(1);\n    }\n    _nativeButtonToPointerButton(s) {\n        switch (s) {\n            case NativePointerButton.NoButton:\n                return PointerButton.NoButton;\n            case NativePointerButton.Left:\n                return PointerButton.Left;\n            case NativePointerButton.Middle:\n                return PointerButton.Middle;\n            case NativePointerButton.Right:\n                return PointerButton.Right;\n            case NativePointerButton.Unknown:\n                return PointerButton.Unknown;\n            default:\n                return fail(s);\n        }\n    }\n    _stringToPointerType(s) {\n        switch (s) {\n            case 'touch':\n                return PointerType.Touch;\n            case 'mouse':\n                return PointerType.Mouse;\n            case 'pen':\n                return PointerType.Pen;\n            default:\n                return PointerType.Unknown;\n        }\n    }\n}\n\n;// ./Input/InputHost.ts\n\n\n\n\nclass InputHost {\n    constructor(options) {\n        this._enabled = true;\n        const { pointerTarget, grabWindowFocus, engine } = options;\n        this.keyboard = new Keyboard();\n        this.pointers = new PointerEventReceiver(pointerTarget, engine);\n        this.gamepads = new Gamepads();\n        this.keyboard.init({ grabWindowFocus });\n        this.pointers.init({ grabWindowFocus });\n        this.gamepads.init();\n        this.inputMapper = new InputMapper({\n            keyboard: this.keyboard,\n            pointers: this.pointers,\n            gamepads: this.gamepads\n        });\n    }\n    get enabled() {\n        return this._enabled;\n    }\n    toggleEnabled(enabled) {\n        this._enabled = enabled;\n        this.keyboard.toggleEnabled(this._enabled);\n        this.pointers.toggleEnabled(this._enabled);\n        this.gamepads.toggleEnabled(this._enabled);\n    }\n    update() {\n        if (this._enabled) {\n            this.inputMapper.execute();\n            this.keyboard.update();\n            this.gamepads.update();\n        }\n    }\n    clear() {\n        this.keyboard.clear();\n        this.pointers.clear();\n        // this.gamepads.clear();\n    }\n}\n\n;// ./Scene.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nclass PreLoadEvent {\n}\nconst SceneEvents = {\n    Initialize: 'initialize',\n    Activate: 'activate',\n    Deactivate: 'deactivate',\n    PreUpdate: 'preupdate',\n    PostUpdate: 'postupdate',\n    PreDraw: 'predraw',\n    PostDraw: 'postdraw',\n    PreDebugDraw: 'predebugdraw',\n    PostDebugDraw: 'postdebugdraw',\n    PreLoad: 'preload'\n};\n/**\n *\n */\nfunction isSceneConstructor(x) {\n    var _a, _b;\n    return !!(x === null || x === void 0 ? void 0 : x.prototype) && !!((_b = (_a = x === null || x === void 0 ? void 0 : x.prototype) === null || _a === void 0 ? void 0 : _a.constructor) === null || _b === void 0 ? void 0 : _b.name);\n}\n/**\n * {@apilink Actor | `Actors`} are composed together into groupings called Scenes in\n * Excalibur. The metaphor models the same idea behind real world\n * actors in a scene. Only actors in scenes will be updated and drawn.\n *\n * Typical usages of a scene include: levels, menus, loading screens, etc.\n */\nclass Scene {\n    /**\n     * The actors in the current scene\n     */\n    get actors() {\n        return this.world.entityManager.entities.filter((e) => {\n            return e instanceof Actor;\n        });\n    }\n    /**\n     * The entities in the current scene\n     */\n    get entities() {\n        return this.world.entityManager.entities;\n    }\n    /**\n     * The triggers in the current scene\n     */\n    get triggers() {\n        return this.world.entityManager.entities.filter((e) => {\n            return e instanceof Trigger;\n        });\n    }\n    /**\n     * The {@apilink TileMap}s in the scene, if any\n     */\n    get tileMaps() {\n        return this.world.entityManager.entities.filter((e) => {\n            return e instanceof TileMap;\n        });\n    }\n    get timers() {\n        return this._timers;\n    }\n    constructor() {\n        // Initialize systems\n        this._logger = Logger.getInstance();\n        this.events = new EventEmitter();\n        /**\n         * Gets or sets the current camera for the scene\n         */\n        this.camera = new Camera();\n        /**\n         * The ECS world for the scene\n         */\n        this.world = new World(this);\n        /**\n         * The Excalibur physics world for the scene. Used to interact\n         * with colliders included in the scene.\n         *\n         * Can be used to perform scene ray casts, track colliders, broadphase, and narrowphase.\n         */\n        this.physics = new PhysicsWorld(DefaultPhysicsConfig);\n        this._isInitialized = false;\n        this._timers = [];\n        this._cancelQueue = [];\n        // Update\n        this.world.add(ActionsSystem);\n        this.world.add(new MotionSystem(this.world, this.physics));\n        this.world.add(new CollisionSystem(this.world, this.physics));\n        this.world.add(PointerSystem);\n        this.world.add(IsometricEntitySystem);\n        // Draw\n        this.world.add(OffscreenSystem);\n        this.world.add(GraphicsSystem);\n        this.world.add(DebugSystem);\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    /**\n     * Event hook to provide Scenes a way of loading scene specific resources.\n     *\n     * This is called before the Scene.onInitialize during scene transition. It will only ever fire once for a scene.\n     * @param loader\n     */\n    onPreLoad(loader) {\n        // will be overridden\n    }\n    /**\n     * Event hook fired directly before transition, either \"in\" or \"out\" of the scene\n     *\n     * This overrides the Engine scene definition. However transitions specified in goToScene take highest precedence\n     *\n     * ```typescript\n     * // Overrides all\n     * Engine.goToScene('scene', { destinationIn: ..., sourceOut: ... });\n     * ```\n     *\n     * This can be used to configure custom transitions for a scene dynamically\n     */\n    onTransition(direction) {\n        // will be overridden\n        return undefined;\n    }\n    /**\n     * This is called before the first update of the {@apilink Scene}. Initializes scene members like the camera. This method is meant to be\n     * overridden. This is where initialization of child actors should take place.\n     */\n    onInitialize(engine) {\n        // will be overridden\n    }\n    /**\n     * This is called when the scene is made active and started. It is meant to be overridden,\n     * this is where you should setup any DOM UI or event handlers needed for the scene.\n     */\n    onActivate(context) {\n        // will be overridden\n    }\n    /**\n     * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\n     * this is where you should cleanup any DOM UI or event handlers needed for the scene.\n     */\n    onDeactivate(context) {\n        // will be overridden\n    }\n    /**\n     * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPreUpdate` is called directly before a scene is updated.\n     */\n    onPreUpdate(engine, elapsedMs) {\n        // will be overridden\n    }\n    /**\n     * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPostUpdate` is called directly after a scene is updated.\n     */\n    onPostUpdate(engine, elapsedMs) {\n        // will be overridden\n    }\n    /**\n     * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPreDraw` is called directly before a scene is drawn.\n     *\n     */\n    onPreDraw(ctx, elapsedMs) {\n        // will be overridden\n    }\n    /**\n     * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n     *\n     * `onPostDraw` is called directly after a scene is drawn.\n     *\n     */\n    onPostDraw(ctx, elapsedMs) {\n        // will be overridden\n    }\n    /**\n     * Initializes actors in the scene\n     */\n    _initializeChildren() {\n        for (const child of this.entities) {\n            child._initialize(this.engine);\n        }\n    }\n    /**\n     * Gets whether or not the {@apilink Scene} has been initialized\n     */\n    get isInitialized() {\n        return this._isInitialized;\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Initializes the scene before the first update, meant to be called by engine not by users of\n     * Excalibur\n     * @internal\n     */\n    async _initialize(engine) {\n        var _a;\n        if (!this.isInitialized) {\n            try {\n                this.engine = engine;\n                // PhysicsWorld config is watched so things will automagically update\n                this.physics.config = this.engine.physics;\n                this.input = new InputHost({\n                    pointerTarget: engine.pointerScope === PointerScope.Canvas ? engine.canvas : document,\n                    grabWindowFocus: engine.grabWindowFocus,\n                    engine\n                });\n                // Initialize camera first\n                this.camera._initialize(engine);\n                this.world.systemManager.initialize();\n                // This order is important! we want to be sure any custom init that add actors\n                // fire before the actor init\n                await this.onInitialize(engine);\n                this._initializeChildren();\n                this._logger.debug('Scene.onInitialize', this, engine);\n                this.events.emit('initialize', new InitializeEvent(engine, this));\n            }\n            catch (e) {\n                this._logger.error(`Error during scene initialization for scene ${(_a = engine.director) === null || _a === void 0 ? void 0 : _a.getSceneName(this)}!`);\n                throw e;\n            }\n            this._isInitialized = true;\n        }\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\n     * @internal\n     */\n    async _activate(context) {\n        var _a, _b;\n        try {\n            this._logger.debug('Scene.onActivate', this);\n            this.input.toggleEnabled(true);\n            await this.onActivate(context);\n        }\n        catch (e) {\n            this._logger.error(`Error during scene activation for scene ${(_b = (_a = this.engine) === null || _a === void 0 ? void 0 : _a.director) === null || _b === void 0 ? void 0 : _b.getSceneName(this)}!`);\n            throw e;\n        }\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\n     * @internal\n     */\n    async _deactivate(context) {\n        this._logger.debug('Scene.onDeactivate', this);\n        this.input.toggleEnabled(false);\n        await this.onDeactivate(context);\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\n     * @internal\n     */\n    _preupdate(engine, elapsedMs) {\n        this.emit('preupdate', new PreUpdateEvent(engine, elapsedMs, this));\n        this.onPreUpdate(engine, elapsedMs);\n    }\n    /**\n     *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\n     * @internal\n     */\n    _postupdate(engine, elapsedMs) {\n        this.emit('postupdate', new PostUpdateEvent(engine, elapsedMs, this));\n        this.onPostUpdate(engine, elapsedMs);\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _predraw handler for {@apilink onPreDraw} lifecycle event\n     * @internal\n     */\n    _predraw(ctx, elapsedMs) {\n        this.emit('predraw', new PreDrawEvent(ctx, elapsedMs, this));\n        this.onPreDraw(ctx, elapsedMs);\n    }\n    /**\n     * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n     *\n     * Internal _postdraw handler for {@apilink onPostDraw} lifecycle event\n     * @internal\n     */\n    _postdraw(ctx, elapsedMs) {\n        this.emit('postdraw', new PostDrawEvent(ctx, elapsedMs, this));\n        this.onPostDraw(ctx, elapsedMs);\n    }\n    /**\n     * Updates all the actors and timers in the scene. Called by the {@apilink Engine}.\n     * @param engine  Reference to the current Engine\n     * @param elapsedMs   The number of milliseconds since the last update\n     */\n    update(engine, elapsedMs) {\n        var _a;\n        if (!this.isInitialized) {\n            this._logger.warnOnce(`Scene update called before initialize for scene ${(_a = engine.director) === null || _a === void 0 ? void 0 : _a.getSceneName(this)}!`);\n            return;\n        }\n        this._preupdate(engine, elapsedMs);\n        // TODO differed entity removal for timers\n        let i, len;\n        // Remove timers in the cancel queue before updating them\n        for (i = 0, len = this._cancelQueue.length; i < len; i++) {\n            this.removeTimer(this._cancelQueue[i]);\n        }\n        this._cancelQueue.length = 0;\n        // Cycle through timers updating timers\n        for (const timer of this._timers) {\n            timer.update(elapsedMs);\n        }\n        this.world.update(SystemType.Update, elapsedMs);\n        // Camera last keeps renders smooth that are based on entity/actor\n        if (this.camera) {\n            this.camera.update(engine, elapsedMs);\n        }\n        this._collectActorStats(engine);\n        this._postupdate(engine, elapsedMs);\n        this.input.update();\n    }\n    /**\n     * Draws all the actors in the Scene. Called by the {@apilink Engine}.\n     * @param ctx    The current rendering context\n     * @param elapsedMs  The number of milliseconds since the last draw\n     */\n    draw(ctx, elapsedMs) {\n        var _a;\n        if (!this.isInitialized) {\n            this._logger.warnOnce(`Scene draw called before initialize!`);\n            return;\n        }\n        this._predraw(ctx, elapsedMs);\n        this.world.update(SystemType.Draw, elapsedMs);\n        if ((_a = this.engine) === null || _a === void 0 ? void 0 : _a.isDebug) {\n            this.debugDraw(ctx);\n        }\n        this._postdraw(ctx, elapsedMs);\n    }\n    /**\n     * Draws all the actors' debug information in the Scene. Called by the {@apilink Engine}.\n     * @param ctx  The current rendering context\n     */\n    /* istanbul ignore next */\n    debugDraw(ctx) {\n        this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n        // pass\n        this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n    }\n    /**\n     * Checks whether an actor is contained in this scene or not\n     */\n    contains(actor) {\n        return this.actors.indexOf(actor) > -1;\n    }\n    add(entity) {\n        this.emit('entityadded', { target: entity });\n        this.world.add(entity);\n        entity.scene = this;\n        if (entity instanceof Timer) {\n            if (!contains(this._timers, entity)) {\n                this.addTimer(entity);\n            }\n            return;\n        }\n    }\n    /**\n     * Removes an {@apilink Entity} (Actor, TileMap, Trigger, etc) or {@apilink Timer} from it's current scene\n     * and adds it to this scene.\n     *\n     * Useful if you want to have an object be present in only 1 scene at a time.\n     * @param entity\n     */\n    transfer(entity) {\n        let scene;\n        if (entity instanceof Entity && entity.scene && entity.scene !== this) {\n            scene = entity.scene;\n            entity.scene.world.remove(entity, false);\n        }\n        if (entity instanceof Timer && entity.scene) {\n            scene = entity.scene;\n            entity.scene.removeTimer(entity);\n        }\n        scene === null || scene === void 0 ? void 0 : scene.emit('entityremoved', { target: entity });\n        this.add(entity);\n    }\n    remove(entity) {\n        if (entity instanceof Entity) {\n            this.emit('entityremoved', { target: entity });\n            if (entity.isActive) {\n                entity.kill();\n            }\n            this.world.remove(entity);\n        }\n        if (entity instanceof Timer) {\n            this.removeTimer(entity);\n        }\n    }\n    /**\n     * Removes all entities and timers from the scene, optionally indicate whether deferred should or shouldn't be used.\n     *\n     * By default entities use deferred removal\n     * @param deferred\n     */\n    clear(deferred = true) {\n        for (let i = this.entities.length - 1; i >= 0; i--) {\n            this.world.remove(this.entities[i], deferred);\n        }\n        for (let i = this.timers.length - 1; i >= 0; i--) {\n            this.removeTimer(this.timers[i]);\n        }\n    }\n    /**\n     * Adds a {@apilink Timer} to the scene\n     * @param timer  The timer to add\n     */\n    addTimer(timer) {\n        this._timers.push(timer);\n        timer.scene = this;\n        return timer;\n    }\n    /**\n     * Removes a {@apilink Timer} from the scene.\n     * @warning Can be dangerous, use {@apilink cancelTimer} instead\n     * @param timer  The timer to remove\n     */\n    removeTimer(timer) {\n        const i = this._timers.indexOf(timer);\n        if (i !== -1) {\n            this._timers.splice(i, 1);\n        }\n        return timer;\n    }\n    /**\n     * Cancels a {@apilink Timer}, removing it from the scene nicely\n     * @param timer  The timer to cancel\n     */\n    cancelTimer(timer) {\n        this._cancelQueue.push(timer);\n        return timer;\n    }\n    /**\n     * Tests whether a {@apilink Timer} is active in the scene\n     */\n    isTimerActive(timer) {\n        return this._timers.indexOf(timer) > -1 && !timer.complete;\n    }\n    isCurrentScene() {\n        if (this.engine) {\n            return this.engine.currentScene === this;\n        }\n        return false;\n    }\n    _collectActorStats(engine) {\n        const actors = this.actors;\n        for (let i = 0; i < actors.length; i++) {\n            const actor = actors[i];\n            if (actor instanceof ScreenElement) {\n                engine.stats.currFrame.actors.ui++;\n            }\n            engine.stats.currFrame.actors.alive++;\n            for (let j = 0; j < actor.children.length; j++) {\n                const child = actor.children[j];\n                if (isScreenElement(child)) {\n                    // TODO not true\n                    engine.stats.currFrame.actors.ui++;\n                }\n                else {\n                    engine.stats.currFrame.actors.alive++;\n                }\n            }\n        }\n    }\n}\n\n;// ./Graphics/PostProcessor/ColorBlindnessMode.ts\nvar ColorBlindnessMode;\n(function (ColorBlindnessMode) {\n    ColorBlindnessMode[\"Protanope\"] = \"Protanope\";\n    ColorBlindnessMode[\"Deuteranope\"] = \"Deuteranope\";\n    ColorBlindnessMode[\"Tritanope\"] = \"Tritanope\";\n})(ColorBlindnessMode || (ColorBlindnessMode = {}));\n\n;// ./Graphics/PostProcessor/color-blind-fragment.glsl\n/* harmony default export */ const color_blind_fragment = (\"#version 300 es\\nprecision mediump float;\\n// our texture\\nuniform sampler2D u_image;\\n// the texCoords passed in from the vertex shader.\\nin vec2 v_texcoord;\\n\\n// color blind type\\nuniform int u_type;\\n\\n// simulation?\\nuniform bool u_simulate;\\n\\nout vec4 fragColor;\\n\\nvoid main() {\\n  vec4 o =  texture(u_image, v_texcoord);\\n  // RGB to LMS matrix conversion\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\n  // Simulate color blindness\\n  float l;\\n  float m;\\n  float s;\\n  //MODE CODE//\\n  if (u_type == 0) {\\n    // Protanope\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\n  } else if (u_type == 1) {\\n    // Deuteranope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\n  } else if (u_type == 2) {\\n    // Tritanope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\n  }\\n\\n  // LMS to RGB matrix conversion\\n  vec4 error; // simulate the colors\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\n  error.a = 1.0;\\n  vec4 diff = o - error;\\n  vec4 correction; // correct the colors\\n  correction.r = 0.0;\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\n  correction = o + correction;\\n  correction.a = o.a;\\n  //SIMULATE//\\n\\n  // sim \\n  if (u_simulate) {\\n    fragColor = error.rgba;\\n  } else {\\n    fragColor = correction.rgba;\\n  }\\n}\");\n;// ./Graphics/PostProcessor/ScreenShader.ts\n\n\n\n\n/**\n * Helper that defines a whole screen renderer, just provide a fragment source!\n *\n * Currently supports 1 varying\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\n */\nclass ScreenShader {\n    constructor(gl, fragmentSource) {\n        if (false) {}\n        this._shader = new Shader({\n            gl,\n            vertexSource: `#version 300 es\n      in vec2 a_position;\n      in vec2 a_uv;\n      out vec2 v_texcoord;\n      out vec2 v_uv;\n\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        // Pass the texcoord to the fragment shader.\n        v_texcoord = a_uv;\n        v_uv = a_uv;\n      }`,\n            fragmentSource: fragmentSource\n        });\n        this._shader.compile();\n        // Setup memory layout\n        this._buffer = new VertexBuffer({\n            gl,\n            type: 'static',\n            // clip space quad + uv since we don't need a camera\n            data: new Float32Array([\n                -1, -1, 0, 0, -1, 1, 0, 1, 1, -1, 1, 0,\n                1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1\n            ])\n        });\n        this._layout = new VertexLayout({\n            gl,\n            shader: this._shader,\n            vertexBuffer: this._buffer,\n            attributes: [\n                ['a_position', 2],\n                ['a_uv', 2]\n            ]\n        });\n        this._buffer.upload();\n    }\n    getShader() {\n        return this._shader;\n    }\n    getLayout() {\n        return this._layout;\n    }\n}\n\n;// ./Graphics/PostProcessor/ColorBlindnessPostProcessor.ts\n\n\n\nclass ColorBlindnessPostProcessor {\n    constructor(_colorBlindnessMode, simulate = false) {\n        this._colorBlindnessMode = _colorBlindnessMode;\n        this._simulate = false;\n        this._simulate = simulate;\n    }\n    initialize(gl) {\n        this._shader = new ScreenShader(gl, color_blind_fragment);\n        this.simulate = this._simulate;\n        this.colorBlindnessMode = this._colorBlindnessMode;\n    }\n    getShader() {\n        return this._shader.getShader();\n    }\n    getLayout() {\n        return this._shader.getLayout();\n    }\n    set colorBlindnessMode(colorBlindMode) {\n        this._colorBlindnessMode = colorBlindMode;\n        if (this._shader) {\n            const shader = this._shader.getShader();\n            shader.use();\n            if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\n                shader.setUniformInt('u_type', 0);\n            }\n            else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\n                shader.setUniformInt('u_type', 1);\n            }\n            else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\n                shader.setUniformInt('u_type', 2);\n            }\n        }\n    }\n    get colorBlindnessMode() {\n        return this._colorBlindnessMode;\n    }\n    set simulate(value) {\n        this._simulate = value;\n        if (this._shader) {\n            const shader = this._shader.getShader();\n            shader.use();\n            shader.setUniformBoolean('u_simulate', value);\n        }\n    }\n    get simulate() {\n        return this._simulate;\n    }\n}\n\n;// ./Debug/DebugFlags.ts\n\n\n\nclass ColorBlindFlags {\n    constructor(engine) {\n        this._engine = engine;\n        this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\n    }\n    /**\n     * Correct colors for a specified color blindness\n     * @param colorBlindness\n     */\n    correct(colorBlindness) {\n        if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n            this.clear();\n            this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n            this._colorBlindPostProcessor.simulate = false;\n            this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n        }\n    }\n    /**\n     * Simulate colors for a specified color blindness\n     * @param colorBlindness\n     */\n    simulate(colorBlindness) {\n        if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n            this.clear();\n            this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n            this._colorBlindPostProcessor.simulate = true;\n            this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n        }\n    }\n    /**\n     * Remove color blindness post processor\n     */\n    clear() {\n        this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\n    }\n}\n\n;// ./Debug/DebugConfig.ts\n\n\n/**\n * Debug statistics and flags for Excalibur. If polling these values, it would be\n * best to do so on the `postupdate` event for {@apilink Engine}, after all values have been\n * updated during a frame.\n */\nclass DebugConfig {\n    constructor(engine) {\n        /**\n         * Performance statistics\n         */\n        this.stats = {\n            /**\n             * Current frame statistics. Engine reuses this instance, use {@apilink FrameStats.clone} to copy frame stats.\n             * Best accessed on {@apilink postframe} event. See {@apilink FrameStats}\n             */\n            currFrame: new FrameStats(),\n            /**\n             * Previous frame statistics. Engine reuses this instance, use {@apilink FrameStats.clone} to copy frame stats.\n             * Best accessed on {@apilink preframe} event. Best inspected on engine event `preframe`. See {@apilink FrameStats}\n             */\n            prevFrame: new FrameStats()\n        };\n        /**\n         * Filter debug context to named entities or entity ids\n         */\n        this.filter = {\n            /**\n             * Toggle filter on or off (default off) must be on for DebugDraw to use filters\n             */\n            useFilter: false,\n            /**\n             * Query for entities by name, if the entity name contains `nameQuery` it will be included\n             */\n            nameQuery: '',\n            /**\n             * Query for Entity ids, if the id matches it will be included\n             */\n            ids: []\n        };\n        /**\n         * Entity debug settings\n         */\n        this.entity = {\n            showAll: false,\n            showId: false,\n            showName: false\n        };\n        /**\n         * Transform component debug settings\n         */\n        this.transform = {\n            showAll: false,\n            debugZIndex: 10000000,\n            showPosition: false,\n            showPositionLabel: false,\n            positionColor: Color.Yellow,\n            showZIndex: false,\n            showScale: false,\n            scaleColor: Color.Green,\n            showRotation: false,\n            rotationColor: Color.Blue\n        };\n        /**\n         * Graphics component debug settings\n         */\n        this.graphics = {\n            showAll: false,\n            showBounds: false,\n            boundsColor: Color.Yellow\n        };\n        /**\n         * Collider component debug settings\n         */\n        this.collider = {\n            showAll: false,\n            showBounds: false,\n            boundsColor: Color.Blue,\n            showOwner: false,\n            showGeometry: true,\n            geometryColor: Color.Green,\n            geometryLineWidth: 1,\n            geometryPointSize: 0.5\n        };\n        /**\n         * Physics simulation debug settings\n         */\n        this.physics = {\n            showAll: false,\n            showBroadphaseSpacePartitionDebug: false,\n            showCollisionNormals: false,\n            collisionNormalColor: Color.Cyan,\n            showCollisionContacts: true,\n            contactSize: 2,\n            collisionContactColor: Color.Red\n        };\n        /**\n         * Motion component debug settings\n         */\n        this.motion = {\n            showAll: false,\n            showVelocity: false,\n            velocityColor: Color.Yellow,\n            showAcceleration: false,\n            accelerationColor: Color.Red\n        };\n        /**\n         * Body component debug settings\n         */\n        this.body = {\n            showAll: false,\n            showCollisionGroup: false,\n            showCollisionType: false,\n            showSleeping: false,\n            showMotion: false,\n            showMass: false\n        };\n        /**\n         * Camera debug settings\n         */\n        this.camera = {\n            showAll: false,\n            showFocus: false,\n            focusColor: Color.Red,\n            showZoom: false\n        };\n        this.tilemap = {\n            showAll: false,\n            showGrid: false,\n            gridColor: Color.Red,\n            gridWidth: 0.5,\n            showSolidBounds: false,\n            solidBoundsColor: Color.fromHex('#8080807F'), // grayish\n            showColliderGeometry: true\n        };\n        this.isometric = {\n            showAll: false,\n            showPosition: false,\n            positionColor: Color.Yellow,\n            positionSize: 1,\n            showGrid: false,\n            gridColor: Color.Red,\n            gridWidth: 1,\n            showColliderGeometry: true\n        };\n        this._engine = engine;\n        this.colorBlindMode = new ColorBlindFlags(this._engine);\n    }\n    /**\n     * Switch the current excalibur clock with the {@apilink TestClock} and return\n     * it in the same running state.\n     *\n     * This is useful when you need to debug frame by frame.\n     */\n    useTestClock() {\n        const clock = this._engine.clock;\n        const wasRunning = clock.isRunning();\n        clock.stop();\n        const testClock = clock.toTestClock();\n        if (wasRunning) {\n            testClock.start();\n        }\n        this._engine.clock = testClock;\n        return testClock;\n    }\n    /**\n     * Switch the current excalibur clock with the {@apilink StandardClock} and\n     * return it in the same running state.\n     *\n     * This is useful when you need to switch back to normal mode after\n     * debugging.\n     */\n    useStandardClock() {\n        const currentClock = this._engine.clock;\n        const wasRunning = currentClock.isRunning();\n        currentClock.stop();\n        const standardClock = currentClock.toStandardClock();\n        if (wasRunning) {\n            standardClock.start();\n        }\n        this._engine.clock = standardClock;\n        return standardClock;\n    }\n}\n/**\n * Implementation of a frame's stats. Meant to have values copied via {@apilink FrameStats.reset}, avoid\n * creating instances of this every frame.\n */\nclass FrameStats {\n    constructor() {\n        this._id = 0;\n        this._elapsedMs = 0;\n        this._fps = 0;\n        this._actorStats = {\n            alive: 0,\n            killed: 0,\n            ui: 0,\n            get remaining() {\n                return this.alive - this.killed;\n            },\n            get total() {\n                return this.remaining + this.ui;\n            }\n        };\n        this._durationStats = {\n            update: 0,\n            draw: 0,\n            get total() {\n                return this.update + this.draw;\n            }\n        };\n        this._physicsStats = new PhysicsStats();\n        this._graphicsStats = {\n            drawCalls: 0,\n            drawnImages: 0\n        };\n    }\n    /**\n     * Zero out values or clone other IFrameStat stats. Allows instance reuse.\n     * @param [otherStats] Optional stats to clone\n     */\n    reset(otherStats) {\n        if (otherStats) {\n            this.id = otherStats.id;\n            this.elapsedMs = otherStats.elapsedMs;\n            this.fps = otherStats.fps;\n            this.actors.alive = otherStats.actors.alive;\n            this.actors.killed = otherStats.actors.killed;\n            this.actors.ui = otherStats.actors.ui;\n            this.duration.update = otherStats.duration.update;\n            this.duration.draw = otherStats.duration.draw;\n            this._physicsStats.reset(otherStats.physics);\n            this.graphics.drawCalls = otherStats.graphics.drawCalls;\n            this.graphics.drawnImages = otherStats.graphics.drawnImages;\n        }\n        else {\n            this.id = this.elapsedMs = this.fps = 0;\n            this.actors.alive = this.actors.killed = this.actors.ui = 0;\n            this.duration.update = this.duration.draw = 0;\n            this._physicsStats.reset();\n            this.graphics.drawnImages = this.graphics.drawCalls = 0;\n        }\n    }\n    /**\n     * Provides a clone of this instance.\n     */\n    clone() {\n        const fs = new FrameStats();\n        fs.reset(this);\n        return fs;\n    }\n    /**\n     * Gets the frame's id\n     */\n    get id() {\n        return this._id;\n    }\n    /**\n     * Sets the frame's id\n     */\n    set id(value) {\n        this._id = value;\n    }\n    /**\n     * Gets the frame's delta (time since last frame)\n     */\n    get elapsedMs() {\n        return this._elapsedMs;\n    }\n    /**\n     * Sets the frame's delta (time since last frame). Internal use only.\n     * @internal\n     */\n    set elapsedMs(value) {\n        this._elapsedMs = value;\n    }\n    /**\n     * Gets the frame's frames-per-second (FPS)\n     */\n    get fps() {\n        return this._fps;\n    }\n    /**\n     * Sets the frame's frames-per-second (FPS). Internal use only.\n     * @internal\n     */\n    set fps(value) {\n        this._fps = value;\n    }\n    /**\n     * Gets the frame's actor statistics\n     */\n    get actors() {\n        return this._actorStats;\n    }\n    /**\n     * Gets the frame's duration statistics\n     */\n    get duration() {\n        return this._durationStats;\n    }\n    /**\n     * Gets the frame's physics statistics\n     */\n    get physics() {\n        return this._physicsStats;\n    }\n    /**\n     * Gets the frame's graphics statistics\n     */\n    get graphics() {\n        return this._graphicsStats;\n    }\n}\nclass PhysicsStats {\n    constructor() {\n        this._pairs = 0;\n        this._collisions = 0;\n        this._contacts = new Map();\n        this._fastBodies = 0;\n        this._fastBodyCollisions = 0;\n        this._broadphase = 0;\n        this._narrowphase = 0;\n    }\n    /**\n     * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\n     * @param [otherStats] Optional stats to clone\n     */\n    reset(otherStats) {\n        if (otherStats) {\n            this.pairs = otherStats.pairs;\n            this.collisions = otherStats.collisions;\n            this.contacts = otherStats.contacts;\n            this.fastBodies = otherStats.fastBodies;\n            this.fastBodyCollisions = otherStats.fastBodyCollisions;\n            this.broadphase = otherStats.broadphase;\n            this.narrowphase = otherStats.narrowphase;\n        }\n        else {\n            this.pairs = this.collisions = this.fastBodies = 0;\n            this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\n            this.contacts.clear();\n        }\n    }\n    /**\n     * Provides a clone of this instance.\n     */\n    clone() {\n        const ps = new PhysicsStats();\n        ps.reset(this);\n        return ps;\n    }\n    get pairs() {\n        return this._pairs;\n    }\n    set pairs(value) {\n        this._pairs = value;\n    }\n    get collisions() {\n        return this._collisions;\n    }\n    set collisions(value) {\n        this._collisions = value;\n    }\n    get contacts() {\n        return this._contacts;\n    }\n    set contacts(contacts) {\n        this._contacts = contacts;\n    }\n    get fastBodies() {\n        return this._fastBodies;\n    }\n    set fastBodies(value) {\n        this._fastBodies = value;\n    }\n    get fastBodyCollisions() {\n        return this._fastBodyCollisions;\n    }\n    set fastBodyCollisions(value) {\n        this._fastBodyCollisions = value;\n    }\n    get broadphase() {\n        return this._broadphase;\n    }\n    set broadphase(value) {\n        this._broadphase = value;\n    }\n    get narrowphase() {\n        return this._narrowphase;\n    }\n    set narrowphase(value) {\n        this._narrowphase = value;\n    }\n}\n\n;// ./Util/Browser.ts\nclass BrowserComponent {\n    on(eventName, handler) {\n        if (this._nativeHandlers[eventName]) {\n            this.off(eventName, this._nativeHandlers[eventName]);\n        }\n        this._nativeHandlers[eventName] = this._decorate(handler);\n        this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\n    }\n    off(eventName, handler) {\n        if (!handler) {\n            handler = this._nativeHandlers[eventName];\n        }\n        this.nativeComponent.removeEventListener(eventName, handler);\n        this._nativeHandlers[eventName] = null;\n    }\n    _decorate(handler) {\n        return (evt) => {\n            if (!this._paused) {\n                handler(evt);\n            }\n        };\n    }\n    pause() {\n        this._paused = true;\n    }\n    resume() {\n        this._paused = false;\n    }\n    clear() {\n        for (const event in this._nativeHandlers) {\n            this.off(event);\n        }\n    }\n    constructor(nativeComponent) {\n        this.nativeComponent = nativeComponent;\n        this._paused = false;\n        this._nativeHandlers = {};\n    }\n}\nclass BrowserEvents {\n    constructor(_windowGlobal, _documentGlobal) {\n        this._windowGlobal = _windowGlobal;\n        this._documentGlobal = _documentGlobal;\n        this._windowComponent = new BrowserComponent(this._windowGlobal);\n        this._documentComponent = new BrowserComponent(this._documentGlobal);\n    }\n    get window() {\n        return this._windowComponent;\n    }\n    get document() {\n        return this._documentComponent;\n    }\n    pause() {\n        this.window.pause();\n        this.document.pause();\n    }\n    resume() {\n        this.window.resume();\n        this.document.resume();\n    }\n    clear() {\n        this.window.clear();\n        this.document.clear();\n    }\n}\n\n;// ./Graphics/Context/ExcaliburGraphicsContext.ts\n\nconst DefaultAntialiasOptions = {\n    pixelArtSampler: false,\n    nativeContextAntialiasing: false,\n    multiSampleAntialiasing: true,\n    filtering: ImageFiltering.Blended,\n    canvasImageRendering: 'auto'\n};\nconst DefaultPixelArtOptions = {\n    pixelArtSampler: true,\n    nativeContextAntialiasing: false,\n    multiSampleAntialiasing: true,\n    filtering: ImageFiltering.Blended,\n    canvasImageRendering: 'auto'\n};\n\n;// ./Util/Fps.ts\nclass FpsSampler {\n    constructor(options) {\n        var _a;\n        this._samplePeriod = 100;\n        this._currentFrameTime = 0;\n        this._frames = 0;\n        this._previousSampleTime = 0;\n        this._beginFrameTime = 0;\n        this._fps = options.initialFps;\n        this._samplePeriod = (_a = options.samplePeriod) !== null && _a !== void 0 ? _a : this._samplePeriod;\n        this._currentFrameTime = 1000 / options.initialFps;\n        this._nowFn = options.nowFn;\n        this._previousSampleTime = this._nowFn();\n    }\n    /**\n     * Start of code block to sample FPS for\n     */\n    start() {\n        this._beginFrameTime = this._nowFn();\n    }\n    /**\n     * End of code block to sample FPS for\n     */\n    end() {\n        this._frames++;\n        const time = this._nowFn();\n        this._currentFrameTime = time - this._beginFrameTime;\n        if (time >= this._previousSampleTime + this._samplePeriod) {\n            this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\n            this._previousSampleTime = time;\n            this._frames = 0;\n        }\n    }\n    /**\n     * Return the currently sampled fps over the last sample period, by default every 100ms\n     */\n    get fps() {\n        return this._fps;\n    }\n    /**\n     * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\n     */\n    get instant() {\n        return 1000 / this._currentFrameTime;\n    }\n}\n\n;// ./Util/Clock.ts\n\n\n/**\n * Abstract Clock is the base type of all Clocks\n *\n * It has a few opinions\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\n * 2. The default timing api is implemented in now()\n *\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\n * method is unique to your clock implementation.\n */\nclass Clock {\n    constructor(options) {\n        var _a, _b, _c;\n        this._onFatalException = () => {\n            /* default nothing */\n        };\n        this._maxFps = Infinity;\n        this._lastTime = 0;\n        this._elapsed = 1;\n        this._scheduledCbs = [];\n        this._totalElapsed = 0;\n        this._options = options;\n        this.tick = options.tick;\n        this._lastTime = (_a = this.now()) !== null && _a !== void 0 ? _a : 0;\n        this._maxFps = (_b = options.maxFps) !== null && _b !== void 0 ? _b : this._maxFps;\n        this._onFatalException = (_c = options.onFatalException) !== null && _c !== void 0 ? _c : this._onFatalException;\n        this.fpsSampler = new FpsSampler({\n            initialFps: 60,\n            nowFn: () => this.now()\n        });\n    }\n    /**\n     * Get the elapsed time for the last completed frame\n     */\n    elapsed() {\n        return this._elapsed;\n    }\n    /**\n     * Get the current time in milliseconds\n     */\n    now() {\n        return performance.now();\n    }\n    toTestClock() {\n        const testClock = new TestClock({\n            ...this._options,\n            defaultUpdateMs: 16.6\n        });\n        return testClock;\n    }\n    toStandardClock() {\n        const clock = new StandardClock({\n            ...this._options\n        });\n        return clock;\n    }\n    setFatalExceptionHandler(handler) {\n        this._onFatalException = handler;\n    }\n    /**\n     * Schedule a callback to fire given a timeout in milliseconds using the excalibur {@apilink Clock}\n     *\n     * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\n     * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\n     * stopped or paused.\n     * @param cb callback to fire\n     * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\n     * @param timing Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\n     */\n    schedule(cb, timeoutMs = 0, timing = 'preframe') {\n        // Scheduled based on internal elapsed time\n        const scheduledTime = this._totalElapsed + timeoutMs;\n        this._scheduledCbs.push([cb, scheduledTime, timing]);\n    }\n    /**\n     * Called internally to trigger scheduled callbacks in the clock\n     * @param timing\n     * @internal\n     */\n    __runScheduledCbs(timing = 'preframe') {\n        // walk backwards to delete items as we loop\n        for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\n            if (timing === this._scheduledCbs[i][2] && this._scheduledCbs[i][1] <= this._totalElapsed) {\n                this._scheduledCbs[i][0](this._elapsed);\n                this._scheduledCbs.splice(i, 1);\n            }\n        }\n    }\n    update(overrideUpdateMs) {\n        try {\n            this.fpsSampler.start();\n            // Get the time to calculate time-elapsed\n            const now = this.now();\n            let elapsed = now - this._lastTime || 1; // first frame\n            // Constrain fps\n            const fpsInterval = 1000 / this._maxFps;\n            // only run frame if enough time has elapsed\n            if (elapsed >= fpsInterval) {\n                let leftover = 0;\n                if (fpsInterval !== 0) {\n                    leftover = elapsed % fpsInterval;\n                    elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\n                }\n                // Resolves issue #138 if the game has been paused, or blurred for\n                // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n                // and provides more expected behavior when the engine comes back\n                // into focus\n                if (elapsed > 200) {\n                    elapsed = 1;\n                }\n                // tick the mainloop and run scheduled callbacks\n                this._elapsed = overrideUpdateMs || elapsed;\n                this._totalElapsed += this._elapsed;\n                this.__runScheduledCbs('preframe');\n                this.tick(overrideUpdateMs || elapsed);\n                this.__runScheduledCbs('postframe');\n                if (fpsInterval !== 0) {\n                    this._lastTime = now - leftover;\n                }\n                else {\n                    this._lastTime = now;\n                }\n                this.fpsSampler.end();\n            }\n        }\n        catch (e) {\n            this._onFatalException(e);\n            this.stop();\n        }\n    }\n}\n/**\n * The {@apilink StandardClock} implements the requestAnimationFrame browser api to run the tick()\n */\nclass StandardClock extends Clock {\n    constructor(options) {\n        super(options);\n        this._running = false;\n    }\n    isRunning() {\n        return this._running;\n    }\n    start() {\n        if (this._running) {\n            return;\n        }\n        this._running = true;\n        const mainloop = () => {\n            // stop the loop\n            if (!this._running) {\n                return;\n            }\n            try {\n                // request next loop\n                this._requestId = window.requestAnimationFrame(mainloop);\n                this.update();\n            }\n            catch (e) {\n                window.cancelAnimationFrame(this._requestId);\n                throw e;\n            }\n        };\n        // begin the first frame\n        mainloop();\n    }\n    stop() {\n        window.cancelAnimationFrame(this._requestId);\n        this._running = false;\n    }\n}\n/**\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\n */\nclass TestClock extends Clock {\n    constructor(options) {\n        super({\n            ...options\n        });\n        this._logger = Logger.getInstance();\n        this._running = false;\n        this._currentTime = 0;\n        this._updateMs = options.defaultUpdateMs;\n    }\n    /**\n     * Get the current time in milliseconds\n     */\n    now() {\n        var _a;\n        return (_a = this._currentTime) !== null && _a !== void 0 ? _a : 0;\n    }\n    isRunning() {\n        return this._running;\n    }\n    start() {\n        this._running = true;\n    }\n    stop() {\n        this._running = false;\n    }\n    /**\n     * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\n     * @param overrideUpdateMs\n     */\n    step(overrideUpdateMs) {\n        const time = overrideUpdateMs !== null && overrideUpdateMs !== void 0 ? overrideUpdateMs : this._updateMs;\n        if (this._running) {\n            // to be comparable to RAF this needs to be a full blown Task\n            // For example, images cannot decode synchronously in a single step\n            this.update(time);\n            this._currentTime += time;\n        }\n        else {\n            this._logger.warn('The clock is not running, no step will be performed');\n        }\n    }\n    /**\n     * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\n     * @param numberOfSteps\n     * @param overrideUpdateMs\n     */\n    run(numberOfSteps, overrideUpdateMs) {\n        for (let i = 0; i < numberOfSteps; i++) {\n            this.step(overrideUpdateMs !== null && overrideUpdateMs !== void 0 ? overrideUpdateMs : this._updateMs);\n        }\n    }\n}\n\n// EXTERNAL MODULE: ./Util/Toaster.css\nvar Util_Toaster = __webpack_require__(296);\n;// ./Util/Toaster.ts\n\n/**\n * The Toaster is only meant to be called from inside Excalibur to display messages to players\n */\nclass Toaster {\n    constructor() {\n        this._toasterCss = Util_Toaster/* default */.A.toString();\n        this._isInitialized = false;\n    }\n    _initialize() {\n        if (!this._isInitialized) {\n            this._container = document.createElement('div');\n            this._container.id = 'ex-toast-container';\n            document.body.appendChild(this._container);\n            this._isInitialized = true;\n            this._styleBlock = document.createElement('style');\n            this._styleBlock.textContent = this._toasterCss;\n            document.head.appendChild(this._styleBlock);\n        }\n    }\n    dispose() {\n        this._container.parentElement.removeChild(this._container);\n        this._styleBlock.parentElement.removeChild(this._styleBlock);\n        this._isInitialized = false;\n    }\n    _createFragment(message) {\n        const toastMessage = document.createElement('span');\n        toastMessage.innerText = message;\n        return toastMessage;\n    }\n    /**\n     * Display a toast message to a player\n     * @param message Text of the message, messages may have a single \"[LINK]\" to influence placement\n     * @param linkTarget Optionally specify a link location\n     * @param linkName Optionally specify a name for that link location\n     */\n    toast(message, linkTarget, linkName) {\n        this._initialize();\n        const toast = document.createElement('div');\n        toast.className = 'ex-toast-message';\n        const messageFragments = message.split('[LINK]').map((message) => this._createFragment(message));\n        if (linkTarget) {\n            const link = document.createElement('a');\n            link.href = linkTarget;\n            if (linkName) {\n                link.innerText = linkName;\n            }\n            else {\n                link.innerText = linkTarget;\n            }\n            messageFragments.splice(1, 0, link);\n        }\n        // Assembly message\n        const finalMessage = document.createElement('div');\n        messageFragments.forEach((message) => {\n            finalMessage.appendChild(message);\n        });\n        toast.appendChild(finalMessage);\n        // Dismiss button\n        const dismissBtn = document.createElement('button');\n        dismissBtn.innerText = 'x';\n        dismissBtn.addEventListener('click', () => {\n            this._container.removeChild(toast);\n        });\n        toast.appendChild(dismissBtn);\n        // Escape to dismiss\n        const keydownHandler = (evt) => {\n            if (evt.key === 'Escape') {\n                try {\n                    this._container.removeChild(toast);\n                }\n                catch (_a) {\n                    // pass\n                }\n            }\n            document.removeEventListener('keydown', keydownHandler);\n        };\n        document.addEventListener('keydown', keydownHandler);\n        // Insert into container\n        const first = this._container.firstChild;\n        this._container.insertBefore(toast, first);\n    }\n}\n\n;// ./Director/Director.ts\n\n\n\n\n\n\nconst DirectorEvents = {\n    NavigationStart: 'navigationstart',\n    Navigation: 'navigation',\n    NavigationEnd: 'navigationend'\n};\n/**\n * The Director is responsible for managing scenes and changing scenes in Excalibur.\n *\n * It deals with transitions, scene loaders, switching scenes\n *\n * This is used internally by Excalibur, generally not mean to\n * be instantiated end users directly.\n */\nclass Director {\n    /**\n     * Gets whether the director currently transitioning between scenes\n     *\n     * Useful if you need to block behavior during transition\n     */\n    get isTransitioning() {\n        return this._isTransitioning;\n    }\n    constructor(_engine, scenes) {\n        this._engine = _engine;\n        this.events = new EventEmitter();\n        this._logger = Logger.getInstance();\n        this._initialized = false;\n        /**\n         * All registered scenes in Excalibur\n         */\n        this.scenes = {};\n        /**\n         * Holds all instantiated scenes\n         */\n        this._sceneToInstance = new Map();\n        this._sceneToLoader = new Map();\n        this._sceneToTransition = new Map();\n        /**\n         * Used to keep track of scenes that have already been loaded so we don't load multiple times\n         */\n        this._loadedScenes = new Set();\n        this._isTransitioning = false;\n        this.rootScene = this.currentScene = new Scene();\n        this.add('root', this.rootScene);\n        this.currentScene = this.rootScene;\n        this.currentSceneName = 'root';\n        for (const sceneKey in scenes) {\n            const sceneOrOptions = scenes[sceneKey];\n            this.add(sceneKey, sceneOrOptions);\n            if (sceneKey === 'root') {\n                this.rootScene = this.getSceneInstance('root'); // always a root scene\n                this.currentScene = this.rootScene;\n            }\n        }\n    }\n    /**\n     * Initialize the director's internal state\n     */\n    async onInitialize() {\n        if (!this._initialized) {\n            this._initialized = true;\n            if (this._deferredGoto) {\n                const deferredScene = this._deferredGoto;\n                this._deferredGoto = undefined;\n                const deferredTransition = this._deferredTransition;\n                this._deferredTransition = undefined;\n                const deferredSceneInstance = this.getSceneInstance(deferredScene);\n                if (deferredSceneInstance && deferredTransition) {\n                    deferredTransition._addToTargetScene(this._engine, deferredSceneInstance);\n                }\n                await this.swapScene(deferredScene);\n                if (deferredSceneInstance && deferredTransition) {\n                    await this.playTransition(deferredTransition, deferredSceneInstance);\n                }\n            }\n            else {\n                await this.swapScene('root');\n            }\n        }\n    }\n    get isInitialized() {\n        return this._initialized;\n    }\n    /**\n     * Configures the start scene, and optionally the transition & loader for the director\n     *\n     * Typically this is called at the beginning of the game to the start scene and transition and never again.\n     * @param startScene\n     * @param options\n     */\n    configureStart(startScene, options) {\n        const maybeLoaderOrCtor = options === null || options === void 0 ? void 0 : options.loader;\n        if (maybeLoaderOrCtor instanceof DefaultLoader) {\n            this.mainLoader = maybeLoaderOrCtor;\n        }\n        else if (isLoaderConstructor(maybeLoaderOrCtor)) {\n            this.mainLoader = new maybeLoaderOrCtor();\n        }\n        else {\n            this.mainLoader = new Loader();\n        }\n        let maybeStartTransition;\n        if (options === null || options === void 0 ? void 0 : options.inTransition) {\n            const { inTransition } = options;\n            maybeStartTransition = inTransition;\n        }\n        this.startScene = startScene;\n        // Fire and forget promise for the initial scene\n        if (maybeStartTransition) {\n            const startSceneInstance = this.getSceneInstance(this.startScene);\n            if (startSceneInstance) {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                maybeStartTransition._addToTargetScene(this._engine, startSceneInstance);\n                this.swapScene(this.startScene).then(() => {\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                    return this.playTransition(maybeStartTransition, startSceneInstance);\n                });\n            }\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.swapScene(this.startScene);\n        }\n        this.currentSceneName = this.startScene;\n    }\n    _getLoader(sceneName) {\n        return this._sceneToLoader.get(sceneName);\n    }\n    _getInTransition(sceneName) {\n        var _a;\n        const sceneOrRoute = this.scenes[sceneName];\n        if (sceneOrRoute instanceof Scene || isSceneConstructor(sceneOrRoute)) {\n            return undefined;\n        }\n        return (_a = sceneOrRoute === null || sceneOrRoute === void 0 ? void 0 : sceneOrRoute.transitions) === null || _a === void 0 ? void 0 : _a.in;\n    }\n    _getOutTransition(sceneName) {\n        var _a;\n        const sceneOrRoute = this.scenes[sceneName];\n        if (sceneOrRoute instanceof Scene || isSceneConstructor(sceneOrRoute)) {\n            return undefined;\n        }\n        return (_a = sceneOrRoute === null || sceneOrRoute === void 0 ? void 0 : sceneOrRoute.transitions) === null || _a === void 0 ? void 0 : _a.out;\n    }\n    getDeferredScene() {\n        const maybeDeferred = this.getSceneDefinition(this._deferredGoto);\n        if (this._deferredGoto && maybeDeferred) {\n            return maybeDeferred;\n        }\n        return null;\n    }\n    /**\n     * Returns a scene by name if it exists, might be the constructor and not the instance of a scene\n     * @param name\n     */\n    getSceneDefinition(name) {\n        const maybeScene = this.scenes[name];\n        if (maybeScene instanceof Scene || isSceneConstructor(maybeScene)) {\n            return maybeScene;\n        }\n        else if (maybeScene) {\n            return maybeScene.scene;\n        }\n        return undefined;\n    }\n    /**\n     * Returns the name of the registered scene, null if none can be found\n     * @param scene\n     */\n    getSceneName(scene) {\n        for (const [name, maybeScene] of Object.entries(this.scenes)) {\n            if (maybeScene instanceof Scene) {\n                if (scene === maybeScene) {\n                    return name;\n                }\n            }\n            else if (!isSceneConstructor(maybeScene)) {\n                if (scene === maybeScene.scene) {\n                    return name;\n                }\n            }\n        }\n        for (const [name, maybeScene] of Object.entries(this.scenes)) {\n            if (isSceneConstructor(maybeScene)) {\n                if (scene.constructor === maybeScene) {\n                    return name;\n                }\n            }\n            else if (!(maybeScene instanceof Scene)) {\n                if (scene.constructor === maybeScene.scene) {\n                    return name;\n                }\n            }\n        }\n        return null;\n    }\n    /**\n     * Returns the same Director, but asserts a scene DOES exist to the type system\n     * @param name\n     */\n    assertAdded(name) {\n        return this;\n    }\n    /**\n     * Returns the same Director, but asserts a scene DOES NOT exist to the type system\n     * @param name\n     */\n    assertRemoved(name) {\n        return this;\n    }\n    /**\n     * Adds additional Scenes to the game!\n     * @param name\n     * @param sceneOrRoute\n     */\n    add(name, sceneOrRoute) {\n        if (!(sceneOrRoute instanceof Scene) && !isSceneConstructor(sceneOrRoute)) {\n            const { loader, transitions } = sceneOrRoute;\n            const { in: inTransition, out: outTransition } = transitions !== null && transitions !== void 0 ? transitions : {};\n            this._sceneToTransition.set(name, { in: inTransition, out: outTransition });\n            if (isLoaderConstructor(loader)) {\n                this._sceneToLoader.set(name, new loader());\n            }\n            else if (loader) {\n                this._sceneToLoader.set(name, loader);\n            }\n        }\n        if (this.scenes[name]) {\n            this._logger.warn('Scene', name, 'already exists overwriting');\n        }\n        this.scenes[name] = sceneOrRoute;\n        return this.assertAdded(name);\n    }\n    remove(nameOrScene) {\n        if (nameOrScene instanceof Scene || isSceneConstructor(nameOrScene)) {\n            const sceneOrCtor = nameOrScene;\n            // remove scene\n            for (const key in this.scenes) {\n                if (this.scenes.hasOwnProperty(key)) {\n                    const potentialSceneOrOptions = this.scenes[key];\n                    let scene;\n                    if (potentialSceneOrOptions instanceof Scene || isSceneConstructor(potentialSceneOrOptions)) {\n                        scene = potentialSceneOrOptions;\n                    }\n                    else {\n                        scene = potentialSceneOrOptions.scene;\n                    }\n                    if (scene === sceneOrCtor) {\n                        if (key === this.currentSceneName) {\n                            throw new Error(`Cannot remove a currently active scene: ${key}`);\n                        }\n                        this._sceneToInstance.delete(key);\n                        this._sceneToTransition.delete(key);\n                        this._sceneToLoader.delete(key);\n                        delete this.scenes[key];\n                    }\n                }\n            }\n        }\n        if (typeof nameOrScene === 'string') {\n            if (nameOrScene === this.currentSceneName) {\n                throw new Error(`Cannot remove a currently active scene: ${nameOrScene}`);\n            }\n            // remove scene\n            this._sceneToInstance.delete(nameOrScene);\n            this._sceneToTransition.delete(nameOrScene);\n            this._sceneToLoader.delete(nameOrScene);\n            delete this.scenes[nameOrScene];\n        }\n    }\n    /**\n     * Go to a specific scene, and optionally override loaders and transitions\n     * @param destinationScene\n     * @param options\n     */\n    async goto(destinationScene, options) {\n        var _a, _b, _c, _d, _e, _f;\n        const maybeDest = this.getSceneInstance(destinationScene);\n        if (!maybeDest) {\n            this._logger.warn(`Scene ${destinationScene} does not exist! Check the name, are you sure you added it?`);\n            return;\n        }\n        const sourceSceneInstance = this.currentScene;\n        const sourceScene = this.currentSceneName;\n        const engineInputEnabled = (_b = (_a = this._engine.input) === null || _a === void 0 ? void 0 : _a.enabled) !== null && _b !== void 0 ? _b : true;\n        this._isTransitioning = true;\n        const maybeSourceOut = (_c = this.getSceneInstance(sourceScene)) === null || _c === void 0 ? void 0 : _c.onTransition('out');\n        const maybeDestinationIn = maybeDest === null || maybeDest === void 0 ? void 0 : maybeDest.onTransition('in');\n        options = {\n            // Engine configuration then dynamic scene transitions\n            ...{ sourceOut: (_d = this._getOutTransition(this.currentSceneName)) !== null && _d !== void 0 ? _d : maybeSourceOut },\n            ...{ destinationIn: (_e = this._getInTransition(destinationScene)) !== null && _e !== void 0 ? _e : maybeDestinationIn },\n            // Goto options\n            ...options\n        };\n        const { sourceOut, destinationIn, sceneActivationData } = options;\n        const outTransition = sourceOut !== null && sourceOut !== void 0 ? sourceOut : this._getOutTransition(this.currentSceneName);\n        const inTransition = destinationIn !== null && destinationIn !== void 0 ? destinationIn : this._getInTransition(destinationScene);\n        const hideLoader = (outTransition === null || outTransition === void 0 ? void 0 : outTransition.hideLoader) || (inTransition === null || inTransition === void 0 ? void 0 : inTransition.hideLoader);\n        if (hideLoader) {\n            // Start hidden loader early and take advantage of the transition\n            // Don't await and block on a hidden loader\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.maybeLoadScene(destinationScene, hideLoader);\n        }\n        this._emitEvent('navigationstart', sourceScene, destinationScene);\n        // Run the out transition on the current scene if present\n        if (outTransition) {\n            await this.playTransition(outTransition, sourceSceneInstance);\n        }\n        // Run the loader if present\n        await this.maybeLoadScene(destinationScene, hideLoader);\n        // Give incoming transition a chance to grab info from previous\n        if (inTransition) {\n            await inTransition.onPreviousSceneDeactivate(this.currentScene);\n        }\n        // Setup the in transition on the destination scene if present\n        // this is important to it can be initialized with the\n        if (inTransition) {\n            inTransition._addToTargetScene(this._engine, maybeDest);\n        }\n        // Swap to the new scene\n        // Runs scene lifecycle init and activate\n        await this.swapScene(destinationScene, sceneActivationData);\n        this._emitEvent('navigation', sourceScene, destinationScene);\n        // Run the in transition on the new scene if present\n        if (inTransition) {\n            await this.playTransition(inTransition, maybeDest);\n        }\n        this._emitEvent('navigationend', sourceScene, destinationScene);\n        (_f = this._engine.input) === null || _f === void 0 ? void 0 : _f.toggleEnabled(engineInputEnabled);\n        this._isTransitioning = false;\n    }\n    /**\n     * Retrieves a scene instance by key if it's registered.\n     *\n     * This will call any constructors that were given as a definition\n     * @param scene\n     */\n    getSceneInstance(scene) {\n        const sceneDefinition = this.getSceneDefinition(scene);\n        if (!sceneDefinition) {\n            return undefined;\n        }\n        if (this._sceneToInstance.has(scene)) {\n            return this._sceneToInstance.get(scene);\n        }\n        if (sceneDefinition instanceof Scene) {\n            this._sceneToInstance.set(scene, sceneDefinition);\n            return sceneDefinition;\n        }\n        const newScene = new sceneDefinition();\n        this._sceneToInstance.set(scene, newScene);\n        return newScene;\n    }\n    /**\n     * Triggers scene loading if has not already been loaded\n     * @param scene\n     * @param hideLoader\n     */\n    async maybeLoadScene(scene, hideLoader = false) {\n        var _a;\n        const loader = (_a = this._getLoader(scene)) !== null && _a !== void 0 ? _a : new DefaultLoader();\n        const sceneToLoad = this.getSceneDefinition(scene);\n        const sceneToLoadInstance = this.getSceneInstance(scene);\n        if (sceneToLoad && sceneToLoadInstance && !this._loadedScenes.has(sceneToLoadInstance)) {\n            sceneToLoadInstance.onPreLoad(loader);\n            sceneToLoadInstance.events.emit('preload', { loader });\n            if (hideLoader) {\n                // Don't await a hidden loader\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                this._engine.load(loader, hideLoader);\n            }\n            else {\n                await this._engine.load(loader);\n            }\n            this._loadedScenes.add(sceneToLoadInstance);\n        }\n    }\n    /**\n     * Plays a transition in the current scene and does book keeping for input.\n     * @param transition\n     */\n    async playTransition(transition, targetScene) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        if (!this.isInitialized) {\n            this._deferredTransition = transition;\n            return;\n        }\n        if (transition) {\n            this.currentTransition = transition;\n            const sceneInputEnabled = (_b = (_a = targetScene.input) === null || _a === void 0 ? void 0 : _a.enabled) !== null && _b !== void 0 ? _b : true;\n            (_c = targetScene.input) === null || _c === void 0 ? void 0 : _c.toggleEnabled(!transition.blockInput);\n            (_d = this._engine.input) === null || _d === void 0 ? void 0 : _d.toggleEnabled(!transition.blockInput);\n            this.currentTransition._addToTargetScene(this._engine, targetScene);\n            await this.currentTransition._play();\n            (_e = targetScene.input) === null || _e === void 0 ? void 0 : _e.toggleEnabled(sceneInputEnabled);\n        }\n        (_f = this.currentTransition) === null || _f === void 0 ? void 0 : _f.kill();\n        (_g = this.currentTransition) === null || _g === void 0 ? void 0 : _g.reset();\n        this.currentTransition = undefined;\n    }\n    /**\n     * Swaps the current and destination scene after performing required lifecycle events\n     * @param destinationScene\n     * @param data\n     */\n    async swapScene(destinationScene, data) {\n        const engine = this._engine;\n        // if not yet initialized defer goToScene\n        if (!this.isInitialized) {\n            this._deferredGoto = destinationScene;\n            return;\n        }\n        const maybeDest = this.getSceneInstance(destinationScene);\n        if (maybeDest) {\n            const previousScene = this.currentScene;\n            const nextScene = maybeDest;\n            this._logger.debug('Going to scene:', destinationScene);\n            // only deactivate when initialized\n            if (this.currentScene.isInitialized) {\n                const context = { engine, previousScene, nextScene };\n                await this.currentScene._deactivate(context);\n                this.currentScene.events.emit('deactivate', new DeactivateEvent(context, this.currentScene));\n                this.currentScene.input.clear();\n            }\n            // wait for the scene to be loaded if needed\n            const destLoader = this._sceneToLoader.get(destinationScene);\n            await (destLoader === null || destLoader === void 0 ? void 0 : destLoader.areResourcesLoaded());\n            // set current scene to new one\n            this.currentScene = nextScene;\n            this.currentSceneName = destinationScene;\n            engine.screen.setCurrentCamera(nextScene.camera);\n            // initialize the current scene if has not been already\n            await this.currentScene._initialize(engine);\n            const context = { engine, previousScene, nextScene, data };\n            await this.currentScene._activate(context);\n            this.currentScene.events.emit('activate', new ActivateEvent(context, this.currentScene));\n        }\n        else {\n            this._logger.error('Scene', destinationScene, 'does not exist!');\n        }\n    }\n    _emitEvent(eventName, sourceScene, destinationScene) {\n        const source = this.getSceneDefinition(sourceScene);\n        const dest = this.getSceneDefinition(destinationScene);\n        this.events.emit(eventName, {\n            sourceScene: source,\n            sourceName: sourceScene,\n            destinationScene: dest,\n            destinationName: destinationScene\n        });\n    }\n}\n\n;// ./Context.ts\n/**\n * Creates a injectable context that can be retrieved later with `useContext(context)`\n *\n * Example\n * ```typescript\n *\n * const AppContext = createContext({some: 'value'});\n * context.scope(val, () => {\n *    const value = useContext(AppContext);\n * })\n *\n * ```\n */\nfunction createContext() {\n    const ctx = {\n        scope: (value, cb) => {\n            const old = ctx.value;\n            ctx.value = value;\n            try {\n                return cb();\n            }\n            catch (e) {\n                throw e;\n            }\n            finally {\n                ctx.value = old;\n            }\n        },\n        value: undefined\n    };\n    return ctx;\n}\n/**\n * Retrieves the value from the current context\n */\nfunction useContext(context) {\n    return context.value;\n}\n\n;// ./GarbageCollector.ts\nconst DefaultGarbageCollectionOptions = {\n    textureCollectInterval: 60000\n    // TODO future work to integrate the font and text configuration, refactor existing collection mechanism\n    // fontCollectInterval: 60_000,\n    // textMeasurementCollectInterval: 60_000,\n};\nclass GarbageCollector {\n    constructor(options) {\n        this.options = options;\n        this._running = false;\n        this._collectionMap = new Map();\n        this._collectors = new Map();\n        /**\n         * Runs the collection loop to cleanup any stale resources given the registered collect handlers\n         */\n        this.collectStaleResources = (deadline) => {\n            if (!this._running) {\n                return;\n            }\n            for (const [type, [collector, timeoutInterval]] of this._collectors.entries()) {\n                const now = this.options.getTimestamp();\n                for (const [resource, [resourceType, time]] of this._collectionMap.entries()) {\n                    if (type !== resourceType || time + timeoutInterval >= now) {\n                        continue;\n                    }\n                    const collected = collector(resource);\n                    if (collected) {\n                        this._collectionMap.delete(resource);\n                    }\n                }\n            }\n            this._collectHandle = requestIdleCallback(this.collectStaleResources);\n        };\n    }\n    /**\n     *\n     * @param type Resource type\n     * @param timeoutInterval If resource type exceeds interval in milliseconds collect() is called\n     * @param collect Collection implementation, returns true if collected\n     */\n    registerCollector(type, timeoutInterval, collect) {\n        this._collectors.set(type, [collect, timeoutInterval]);\n    }\n    /**\n     * Add a resource to be tracked for collection\n     * @param type\n     * @param resource\n     */\n    addCollectableResource(type, resource) {\n        this._collectionMap.set(resource, [type, this.options.getTimestamp()]);\n    }\n    /**\n     * Update the resource last used timestamp preventing collection\n     * @param resource\n     */\n    touch(resource) {\n        const collectionData = this._collectionMap.get(resource);\n        if (collectionData) {\n            this._collectionMap.set(resource, [collectionData[0], this.options.getTimestamp()]);\n        }\n    }\n    /**\n     * Force collect all resources, useful for shutting down a game\n     * or if you know that you will not use anything you've allocated before now\n     */\n    forceCollectAll() {\n        for (const [_, [collector]] of this._collectors.entries()) {\n            for (const [resource] of this._collectionMap.entries()) {\n                const collected = collector(resource);\n                if (collected) {\n                    this._collectionMap.delete(resource);\n                }\n            }\n        }\n    }\n    /**\n     * Starts the garbage collection loop\n     */\n    start() {\n        this._running = true;\n        this.collectStaleResources();\n    }\n    /**\n     * Stops the garbage collection loop\n     */\n    stop() {\n        this._running = false;\n        cancelIdleCallback(this._collectHandle);\n    }\n}\n\n;// ./Engine.ts\n\n\n\n\n\n\npolyfill();\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst EngineEvents = {\n    FallbackGraphicsContext: 'fallbackgraphicscontext',\n    Initialize: 'initialize',\n    Visible: 'visible',\n    Hidden: 'hidden',\n    Start: 'start',\n    Stop: 'stop',\n    PreUpdate: 'preupdate',\n    PostUpdate: 'postupdate',\n    PreFrame: 'preframe',\n    PostFrame: 'postframe',\n    PreDraw: 'predraw',\n    PostDraw: 'postdraw'\n};\n/**\n * Enum representing the different mousewheel event bubble prevention\n */\nvar ScrollPreventionMode;\n(function (ScrollPreventionMode) {\n    /**\n     * Do not prevent any page scrolling\n     */\n    ScrollPreventionMode[ScrollPreventionMode[\"None\"] = 0] = \"None\";\n    /**\n     * Prevent page scroll if mouse is over the game canvas\n     */\n    ScrollPreventionMode[ScrollPreventionMode[\"Canvas\"] = 1] = \"Canvas\";\n    /**\n     * Prevent all page scrolling via mouse wheel\n     */\n    ScrollPreventionMode[ScrollPreventionMode[\"All\"] = 2] = \"All\";\n})(ScrollPreventionMode || (ScrollPreventionMode = {}));\n/**\n * The Excalibur Engine\n *\n * The {@apilink Engine} is the main driver for a game. It is responsible for\n * starting/stopping the game, maintaining state, transmitting events,\n * loading resources, and managing the scene.\n */\nclass Engine {\n    static useEngine() {\n        const value = useContext(Engine.Context);\n        if (!value) {\n            throw new Error('Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.');\n        }\n        return value;\n    }\n    /**\n     * The width of the game canvas in pixels (physical width component of the\n     * resolution of the canvas element)\n     */\n    get canvasWidth() {\n        return this.screen.canvasWidth;\n    }\n    /**\n     * Returns half width of the game canvas in pixels (half physical width component)\n     */\n    get halfCanvasWidth() {\n        return this.screen.halfCanvasWidth;\n    }\n    /**\n     * The height of the game canvas in pixels, (physical height component of\n     * the resolution of the canvas element)\n     */\n    get canvasHeight() {\n        return this.screen.canvasHeight;\n    }\n    /**\n     * Returns half height of the game canvas in pixels (half physical height component)\n     */\n    get halfCanvasHeight() {\n        return this.screen.halfCanvasHeight;\n    }\n    /**\n     * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get drawWidth() {\n        return this.screen.drawWidth;\n    }\n    /**\n     * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get halfDrawWidth() {\n        return this.screen.halfDrawWidth;\n    }\n    /**\n     * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get drawHeight() {\n        return this.screen.drawHeight;\n    }\n    /**\n     * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n     */\n    get halfDrawHeight() {\n        return this.screen.halfDrawHeight;\n    }\n    /**\n     * Returns whether excalibur detects the current screen to be HiDPI\n     */\n    get isHiDpi() {\n        return this.screen.isHiDpi;\n    }\n    /**\n     * Access {@apilink stats} that holds frame statistics.\n     */\n    get stats() {\n        return this.debug.stats;\n    }\n    /**\n     * The current {@apilink Scene} being drawn and updated on screen\n     */\n    get currentScene() {\n        return this.director.currentScene;\n    }\n    /**\n     * The current {@apilink Scene} being drawn and updated on screen\n     */\n    get currentSceneName() {\n        return this.director.currentSceneName;\n    }\n    /**\n     * The default {@apilink Scene} of the game, use {@apilink Engine.goToScene} to transition to different scenes.\n     */\n    get rootScene() {\n        return this.director.rootScene;\n    }\n    /**\n     * Contains all the scenes currently registered with Excalibur\n     */\n    get scenes() {\n        return this.director.scenes;\n    }\n    /**\n     * Indicates whether the engine is set to fullscreen or not\n     */\n    get isFullscreen() {\n        return this.screen.isFullScreen;\n    }\n    /**\n     * Indicates the current {@apilink DisplayMode} of the engine.\n     */\n    get displayMode() {\n        return this.screen.displayMode;\n    }\n    /**\n     * Returns the calculated pixel ration for use in rendering\n     */\n    get pixelRatio() {\n        return this.screen.pixelRatio;\n    }\n    get isDebug() {\n        return this._isDebug;\n    }\n    /**\n     * Hints the graphics context to truncate fractional world space coordinates\n     */\n    get snapToPixel() {\n        return this.graphicsContext.snapToPixel;\n    }\n    set snapToPixel(shouldSnapToPixel) {\n        this.graphicsContext.snapToPixel = shouldSnapToPixel;\n    }\n    emit(eventName, event) {\n        this.events.emit(eventName, event);\n    }\n    on(eventName, handler) {\n        return this.events.on(eventName, handler);\n    }\n    once(eventName, handler) {\n        return this.events.once(eventName, handler);\n    }\n    off(eventName, handler) {\n        this.events.off(eventName, handler);\n    }\n    /**\n     * Creates a new game using the given {@apilink EngineOptions}. By default, if no options are provided,\n     * the game will be rendered full screen (taking up all available browser window space).\n     * You can customize the game rendering through {@apilink EngineOptions}.\n     *\n     * Example:\n     *\n     * ```js\n     * var game = new ex.Engine({\n     *   width: 0, // the width of the canvas\n     *   height: 0, // the height of the canvas\n     *   enableCanvasTransparency: true, // the transparencySection of the canvas\n     *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\n     *   displayMode: ex.DisplayMode.FullScreen, // the display mode\n     *   pointerScope: ex.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\n     *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\n     * });\n     *\n     * // call game.start, which is a Promise\n     * game.start().then(function () {\n     *   // ready, set, go!\n     * });\n     * ```\n     */\n    constructor(options) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        /**\n         * Anything run under scope can use `useEngine()` to inject the current engine\n         * @param cb\n         */\n        this.scope = (cb) => Engine.Context.scope(this, cb);\n        /**\n         * Current Excalibur version string\n         *\n         * Useful for plugins or other tools that need to know what features are available\n         */\n        this.version = EX_VERSION;\n        /**\n         * Listen to and emit events on the Engine\n         */\n        this.events = new EventEmitter();\n        /**\n         * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\n         *\n         * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\n         * one that bounces between 30fps and 60fps\n         */\n        this.maxFps = Number.POSITIVE_INFINITY;\n        this._inputEnabled = true;\n        this._suppressPlayButton = false;\n        /**\n         * Indicates whether audio should be paused when the game is no longer visible.\n         */\n        this.pauseAudioWhenHidden = true;\n        /**\n         * Indicates whether the engine should draw with debug information\n         */\n        this._isDebug = false;\n        /**\n         * Sets the Transparency for the engine.\n         */\n        this.enableCanvasTransparency = true;\n        /**\n         * The action to take when a fatal exception is thrown\n         */\n        this.onFatalException = (e) => {\n            Logger.getInstance().fatal(e, e.stack);\n        };\n        this._toaster = new Toaster();\n        this._timescale = 1.0;\n        this._isInitialized = false;\n        this._originalOptions = {};\n        this._handleWebGLContextLost = (e) => {\n            var _a;\n            e.preventDefault();\n            this.clock.stop();\n            this._logger.fatalOnce('WebGL Graphics Lost', e);\n            const container = document.createElement('div');\n            container.id = 'ex-webgl-graphics-context-lost';\n            container.style.position = 'absolute';\n            container.style.zIndex = '99';\n            container.style.left = '50%';\n            container.style.top = '50%';\n            container.style.display = 'flex';\n            container.style.flexDirection = 'column';\n            container.style.transform = 'translate(-50%, -50%)';\n            container.style.backgroundColor = 'white';\n            container.style.padding = '10px';\n            container.style.borderStyle = 'solid 1px';\n            const div = document.createElement('div');\n            div.innerHTML = `\n      <h1>There was an issue rendering, please refresh the page.</h1>\n      <div>\n        <p>WebGL Graphics Context Lost</p>\n\n        <button id=\"ex-webgl-graphics-reload\">Refresh Page</button>\n\n        <p>There are a few reasons this might happen:</p>\n        <ul>\n          <li>Two or more pages are placing a high demand on the GPU</li>\n          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>\n          <li>The computer has multiple GPUs and the user has switched between them</li>\n          <li>Graphics driver has crashed or restarted</li>\n          <li>Graphics driver was updated</li>\n        </ul>\n      </div>\n    `;\n            container.appendChild(div);\n            if ((_a = this.canvas) === null || _a === void 0 ? void 0 : _a.parentElement) {\n                this.canvas.parentElement.appendChild(container);\n                const button = div.querySelector('#ex-webgl-graphics-reload');\n                button === null || button === void 0 ? void 0 : button.addEventListener('click', () => location.reload());\n            }\n        };\n        this._performanceThresholdTriggered = false;\n        this._fpsSamples = [];\n        this._disposed = false;\n        this._isLoading = false;\n        this._hideLoader = false;\n        this._isReadyFuture = new Future();\n        /**\n         * Returns the current frames elapsed milliseconds\n         */\n        this.currentFrameElapsedMs = 0;\n        /**\n         * Returns the current frame lag when in fixed update mode\n         */\n        this.currentFrameLagMs = 0;\n        this._lagMs = 0;\n        this._screenShotRequests = [];\n        options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\n        this._originalOptions = options;\n        Flags.freeze();\n        // Initialize browser events facade\n        this.browser = new BrowserEvents(window, document);\n        // Check compatibility\n        const detector = new Detector();\n        if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\n            const message = document.createElement('div');\n            message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\n            document.body.appendChild(message);\n            detector.failedTests.forEach(function (test) {\n                const testMessage = document.createElement('div');\n                testMessage.innerText = 'Browser feature missing ' + test;\n                document.body.appendChild(testMessage);\n            });\n            if (options.canvasElementId) {\n                const canvas = document.getElementById(options.canvasElementId);\n                if (canvas) {\n                    canvas.parentElement.removeChild(canvas);\n                }\n            }\n            return;\n        }\n        else {\n            this._compatible = true;\n        }\n        // Use native console API for color fun\n        // eslint-disable-next-line no-console\n        if (console.log && !options.suppressConsoleBootMessage) {\n            // eslint-disable-next-line no-console\n            console.log(`%cPowered by Excalibur.js (v${EX_VERSION})`, 'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;');\n            // eslint-disable-next-line no-console\n            console.log('\\n\\\n      /| ________________\\n\\\nO|===|* >________________>\\n\\\n      \\\\|');\n            // eslint-disable-next-line no-console\n            console.log('Visit', 'http://excaliburjs.com', 'for more information');\n        }\n        // Suppress play button\n        if (options.suppressPlayButton) {\n            this._suppressPlayButton = true;\n        }\n        this._logger = Logger.getInstance();\n        // If debug is enabled, let's log browser features to the console.\n        if (this._logger.defaultLevel === LogLevel.Debug) {\n            detector.logBrowserFeatures();\n        }\n        this._logger.debug('Building engine...');\n        if (options.garbageCollection === true) {\n            this.garbageCollectorConfig = {\n                ...DefaultGarbageCollectionOptions\n            };\n        }\n        else if (options.garbageCollection === false) {\n            this._logger.warn('WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted');\n            this.garbageCollectorConfig = null;\n        }\n        else {\n            this.garbageCollectorConfig = {\n                ...DefaultGarbageCollectionOptions,\n                ...options.garbageCollection\n            };\n        }\n        this._garbageCollector = new GarbageCollector({ getTimestamp: Date.now });\n        this.canvasElementId = options.canvasElementId;\n        if (options.canvasElementId) {\n            this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\n            //test for existence of element\n            if (document.getElementById(options.canvasElementId) === null) {\n                throw new Error('Cannot find existing element in the DOM, please ensure element is created prior to engine creation.');\n            }\n            this.canvas = document.getElementById(options.canvasElementId);\n        }\n        else if (options.canvasElement) {\n            this._logger.debug('Using Canvas element specified:', options.canvasElement);\n            this.canvas = options.canvasElement;\n        }\n        else {\n            this._logger.debug('Using generated canvas element');\n            this.canvas = document.createElement('canvas');\n        }\n        if (this.canvas && !options.enableCanvasContextMenu) {\n            this.canvas.addEventListener('contextmenu', (evt) => {\n                evt.preventDefault();\n            });\n        }\n        let displayMode = (_a = options.displayMode) !== null && _a !== void 0 ? _a : DisplayMode.Fixed;\n        if ((options.width && options.height) || options.viewport) {\n            if (options.displayMode === undefined) {\n                displayMode = DisplayMode.Fixed;\n            }\n            this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\n        }\n        else if (!options.displayMode) {\n            this._logger.debug('Engine viewport is fit');\n            displayMode = DisplayMode.FitScreen;\n        }\n        this.grabWindowFocus = options.grabWindowFocus;\n        this.pointerScope = options.pointerScope;\n        this._originalDisplayMode = displayMode;\n        let pixelArtSampler;\n        let uvPadding;\n        let nativeContextAntialiasing;\n        let canvasImageRendering;\n        let filtering;\n        let multiSampleAntialiasing;\n        if (typeof options.antialiasing === 'object') {\n            ({ pixelArtSampler, nativeContextAntialiasing, multiSampleAntialiasing, filtering, canvasImageRendering } = {\n                ...(options.pixelArt ? DefaultPixelArtOptions : DefaultAntialiasOptions),\n                ...options.antialiasing\n            });\n        }\n        else {\n            pixelArtSampler = !!options.pixelArt;\n            nativeContextAntialiasing = false;\n            multiSampleAntialiasing = options.antialiasing;\n            canvasImageRendering = options.antialiasing ? 'auto' : 'pixelated';\n            filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\n        }\n        if (nativeContextAntialiasing && multiSampleAntialiasing) {\n            this._logger.warnOnce(`Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing` +\n                ` at the same time, they are incompatible settings. If you aren\\'t sure use multiSampleAntialiasing`);\n        }\n        if (options.pixelArt) {\n            uvPadding = 0.25;\n        }\n        if (!options.antialiasing || filtering === ImageFiltering.Pixel) {\n            uvPadding = 0;\n        }\n        // Override with any user option, if non default to .25 for pixel art, 0.01 for everything else\n        uvPadding = (_c = (_b = options.uvPadding) !== null && _b !== void 0 ? _b : uvPadding) !== null && _c !== void 0 ? _c : 0.01;\n        // Canvas 2D fallback can be flagged on\n        let useCanvasGraphicsContext = Flags.isEnabled('use-canvas-context');\n        if (!useCanvasGraphicsContext) {\n            // Attempt webgl first\n            try {\n                this.graphicsContext = new ExcaliburGraphicsContextWebGL({\n                    canvasElement: this.canvas,\n                    enableTransparency: this.enableCanvasTransparency,\n                    pixelArtSampler: pixelArtSampler,\n                    antialiasing: nativeContextAntialiasing,\n                    multiSampleAntialiasing: multiSampleAntialiasing,\n                    uvPadding: uvPadding,\n                    powerPreference: options.powerPreference,\n                    backgroundColor: options.backgroundColor,\n                    snapToPixel: options.snapToPixel,\n                    useDrawSorting: options.useDrawSorting,\n                    garbageCollector: this.garbageCollectorConfig\n                        ? {\n                            garbageCollector: this._garbageCollector,\n                            collectionInterval: this.garbageCollectorConfig.textureCollectInterval\n                        }\n                        : null,\n                    handleContextLost: (_d = options.handleContextLost) !== null && _d !== void 0 ? _d : this._handleWebGLContextLost,\n                    handleContextRestored: options.handleContextRestored\n                });\n            }\n            catch (e) {\n                this._logger.warn(`Excalibur could not load webgl for some reason (${e.message}) and loaded a Canvas 2D fallback. ` +\n                    `Some features of Excalibur will not work in this mode. \\n\\n` +\n                    'Read more about this issue at https://excaliburjs.com/docs/performance');\n                // fallback to canvas in case of failure\n                useCanvasGraphicsContext = true;\n            }\n        }\n        if (useCanvasGraphicsContext) {\n            this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\n                canvasElement: this.canvas,\n                enableTransparency: this.enableCanvasTransparency,\n                antialiasing: nativeContextAntialiasing,\n                backgroundColor: options.backgroundColor,\n                snapToPixel: options.snapToPixel,\n                useDrawSorting: options.useDrawSorting\n            });\n        }\n        this.screen = new Screen({\n            canvas: this.canvas,\n            context: this.graphicsContext,\n            antialiasing: nativeContextAntialiasing,\n            canvasImageRendering: canvasImageRendering,\n            browser: this.browser,\n            viewport: (_e = options.viewport) !== null && _e !== void 0 ? _e : (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\n            resolution: options.resolution,\n            displayMode,\n            pixelRatio: options.suppressHiDPIScaling ? 1 : (_f = options.pixelRatio) !== null && _f !== void 0 ? _f : null\n        });\n        // TODO REMOVE STATIC!!!\n        // Set default filtering based on antialiasing\n        TextureLoader.filtering = filtering;\n        if (options.backgroundColor) {\n            this.backgroundColor = options.backgroundColor.clone();\n        }\n        this.maxFps = (_g = options.maxFps) !== null && _g !== void 0 ? _g : this.maxFps;\n        this.fixedUpdateTimestep = (_h = options.fixedUpdateTimestep) !== null && _h !== void 0 ? _h : this.fixedUpdateTimestep;\n        this.fixedUpdateFps = (_j = options.fixedUpdateFps) !== null && _j !== void 0 ? _j : this.fixedUpdateFps;\n        this.fixedUpdateTimestep = this.fixedUpdateTimestep || 1000 / this.fixedUpdateFps;\n        this.clock = new StandardClock({\n            maxFps: this.maxFps,\n            tick: this._mainloop.bind(this),\n            onFatalException: (e) => this.onFatalException(e)\n        });\n        this.enableCanvasTransparency = options.enableCanvasTransparency;\n        if (typeof options.physics === 'boolean') {\n            this.physics = {\n                ...DefaultPhysicsConfig,\n                enabled: options.physics\n            };\n        }\n        else {\n            this.physics = {\n                ...DefaultPhysicsConfig\n            };\n            mergeDeep(this.physics, options.physics);\n        }\n        this.debug = new DebugConfig(this);\n        this.director = new Director(this, options.scenes);\n        this._initialize(options);\n        window.___EXCALIBUR_DEVTOOL = this;\n        Engine.InstanceCount++;\n    }\n    _monitorPerformanceThresholdAndTriggerFallback() {\n        const { allow } = this._originalOptions.configurePerformanceCanvas2DFallback;\n        let { threshold, showPlayerMessage } = this._originalOptions.configurePerformanceCanvas2DFallback;\n        if (threshold === undefined) {\n            threshold = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold;\n        }\n        if (showPlayerMessage === undefined) {\n            showPlayerMessage = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage;\n        }\n        if (!Flags.isEnabled('use-canvas-context') && allow && this.ready && !this._performanceThresholdTriggered) {\n            // Calculate Average fps for last X number of frames after start\n            if (this._fpsSamples.length === threshold.numberOfFrames) {\n                this._fpsSamples.splice(0, 1);\n            }\n            this._fpsSamples.push(this.clock.fpsSampler.fps);\n            let total = 0;\n            for (let i = 0; i < this._fpsSamples.length; i++) {\n                total += this._fpsSamples[i];\n            }\n            const average = total / this._fpsSamples.length;\n            if (this._fpsSamples.length === threshold.numberOfFrames) {\n                if (average <= threshold.fps) {\n                    this._performanceThresholdTriggered = true;\n                    this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.\\n` +\n                        \"this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.\\n\\n\" +\n                        'If in Chrome:\\n' +\n                        '  * Visit Settings > Advanced > System, and ensure \"Use Hardware Acceleration\" is checked.\\n' +\n                        '  * Visit chrome://flags/#ignore-gpu-blocklist and ensure \"Override software rendering list\" is \"enabled\"\\n' +\n                        'If in Firefox, visit about:config\\n' +\n                        '  * Ensure webgl.disabled = false\\n' +\n                        '  * Ensure webgl.force-enabled = true\\n' +\n                        '  * Ensure layers.acceleration.force-enabled = true\\n\\n' +\n                        'Read more about this issue at https://excaliburjs.com/docs/performance');\n                    if (showPlayerMessage) {\n                        this._toaster.toast('Excalibur is encountering performance issues. ' +\n                            \"It's possible that your browser doesn't have hardware acceleration enabled. \" +\n                            'Visit [LINK] for more information and potential solutions.', 'https://excaliburjs.com/docs/performance');\n                    }\n                    this.useCanvas2DFallback();\n                    this.emit('fallbackgraphicscontext', this.graphicsContext);\n                }\n            }\n        }\n    }\n    /**\n     * Switches the engine's graphics context to the 2D Canvas.\n     * @warning Some features of Excalibur will not work in this mode.\n     */\n    useCanvas2DFallback() {\n        var _a, _b, _c;\n        // Swap out the canvas\n        const newCanvas = this.canvas.cloneNode(false);\n        this.canvas.parentNode.replaceChild(newCanvas, this.canvas);\n        this.canvas = newCanvas;\n        const options = { ...this._originalOptions, antialiasing: this.screen.antialiasing };\n        const displayMode = this._originalDisplayMode;\n        // New graphics context\n        this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\n            canvasElement: this.canvas,\n            enableTransparency: this.enableCanvasTransparency,\n            antialiasing: options.antialiasing,\n            backgroundColor: options.backgroundColor,\n            snapToPixel: options.snapToPixel,\n            useDrawSorting: options.useDrawSorting\n        });\n        // Reset screen\n        if (this.screen) {\n            this.screen.dispose();\n        }\n        this.screen = new Screen({\n            canvas: this.canvas,\n            context: this.graphicsContext,\n            antialiasing: (_a = options.antialiasing) !== null && _a !== void 0 ? _a : true,\n            browser: this.browser,\n            viewport: (_b = options.viewport) !== null && _b !== void 0 ? _b : (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\n            resolution: options.resolution,\n            displayMode,\n            pixelRatio: options.suppressHiDPIScaling ? 1 : (_c = options.pixelRatio) !== null && _c !== void 0 ? _c : null\n        });\n        this.screen.setCurrentCamera(this.currentScene.camera);\n        // Reset pointers\n        this.input.pointers.detach();\n        const pointerTarget = options && options.pointerScope === PointerScope.Document ? document : this.canvas;\n        this.input.pointers = this.input.pointers.recreate(pointerTarget, this);\n        this.input.pointers.init();\n    }\n    /**\n     * Attempts to completely clean up excalibur resources, including removing the canvas from the dom.\n     *\n     * To start again you will need to new up an Engine.\n     */\n    dispose() {\n        if (!this._disposed) {\n            this._disposed = true;\n            this.stop();\n            this._garbageCollector.forceCollectAll();\n            this.input.toggleEnabled(false);\n            this.canvas.parentNode.removeChild(this.canvas);\n            this.canvas = null;\n            this.screen.dispose();\n            this.graphicsContext.dispose();\n            this.graphicsContext = null;\n            Engine.InstanceCount--;\n        }\n    }\n    isDisposed() {\n        return this._disposed;\n    }\n    /**\n     * Returns a BoundingBox of the top left corner of the screen\n     * and the bottom right corner of the screen.\n     */\n    getWorldBounds() {\n        return this.screen.getWorldBounds();\n    }\n    /**\n     * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\n     */\n    get timescale() {\n        return this._timescale;\n    }\n    /**\n     * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\n     * when using time-based movement.\n     */\n    set timescale(value) {\n        if (value < 0) {\n            Logger.getInstance().warnOnce('engine.timescale to a value less than 0 are ignored');\n            return;\n        }\n        this._timescale = value;\n    }\n    /**\n     * Adds a {@apilink Timer} to the {@apilink currentScene}.\n     * @param timer  The timer to add to the {@apilink currentScene}.\n     */\n    addTimer(timer) {\n        return this.currentScene.addTimer(timer);\n    }\n    /**\n     * Removes a {@apilink Timer} from the {@apilink currentScene}.\n     * @param timer  The timer to remove to the {@apilink currentScene}.\n     */\n    removeTimer(timer) {\n        return this.currentScene.removeTimer(timer);\n    }\n    /**\n     * Adds a {@apilink Scene} to the engine, think of scenes in Excalibur as you\n     * would levels or menus.\n     * @param key  The name of the scene, must be unique\n     * @param scene The scene to add to the engine\n     */\n    addScene(key, scene) {\n        this.director.add(key, scene);\n        return this;\n    }\n    /**\n     * @internal\n     */\n    removeScene(entity) {\n        this.director.remove(entity);\n    }\n    add(entity) {\n        if (arguments.length === 2) {\n            this.director.add(arguments[0], arguments[1]);\n            return;\n        }\n        const maybeDeferred = this.director.getDeferredScene();\n        if (maybeDeferred instanceof Scene) {\n            maybeDeferred.add(entity);\n        }\n        else {\n            this.currentScene.add(entity);\n        }\n    }\n    remove(entity) {\n        if (entity instanceof Entity) {\n            this.currentScene.remove(entity);\n        }\n        if (entity instanceof Scene || isSceneConstructor(entity)) {\n            this.removeScene(entity);\n        }\n        if (typeof entity === 'string') {\n            this.removeScene(entity);\n        }\n    }\n    /**\n     * Changes the current scene with optionally supplied:\n     * * Activation data\n     * * Transitions\n     * * Loaders\n     *\n     * Example:\n     * ```typescript\n     * game.goToScene('myScene', {\n     *   sceneActivationData: {any: 'thing at all'},\n     *   destinationIn: new FadeInOut({duration: 1000, direction: 'in'}),\n     *   sourceOut: new FadeInOut({duration: 1000, direction: 'out'}),\n     *   loader: MyLoader\n     * });\n     * ```\n     *\n     * Scenes are defined in the Engine constructor\n     * ```typescript\n     * const engine = new ex.Engine({\n        scenes: {...}\n      });\n     * ```\n     * Or by adding dynamically\n     *\n     * ```typescript\n     * engine.addScene('myScene', new ex.Scene());\n     * ```\n     * @param destinationScene\n     * @param options\n     */\n    async goToScene(destinationScene, options) {\n        await this.scope(async () => {\n            await this.director.goto(destinationScene, options);\n        });\n    }\n    /**\n     * Transforms the current x, y from screen coordinates to world coordinates\n     * @param point  Screen coordinate to convert\n     */\n    screenToWorldCoordinates(point) {\n        return this.screen.screenToWorldCoordinates(point);\n    }\n    /**\n     * Transforms a world coordinate, to a screen coordinate\n     * @param point  World coordinate to convert\n     */\n    worldToScreenCoordinates(point) {\n        return this.screen.worldToScreenCoordinates(point);\n    }\n    /**\n     * Initializes the internal canvas, rendering context, display mode, and native event listeners\n     */\n    _initialize(options) {\n        var _a, _b;\n        this.pageScrollPreventionMode = options.scrollPreventionMode;\n        // initialize inputs\n        const pointerTarget = options && options.pointerScope === PointerScope.Document ? document : this.canvas;\n        const grabWindowFocus = (_b = (_a = this._originalOptions) === null || _a === void 0 ? void 0 : _a.grabWindowFocus) !== null && _b !== void 0 ? _b : true;\n        this.input = new InputHost({\n            pointerTarget,\n            grabWindowFocus,\n            engine: this\n        });\n        this.inputMapper = this.input.inputMapper;\n        // Issue #385 make use of the visibility api\n        // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\n        this.browser.document.on('visibilitychange', () => {\n            if (document.visibilityState === 'hidden') {\n                this.events.emit('hidden', new HiddenEvent(this));\n                this._logger.debug('Window hidden');\n            }\n            else if (document.visibilityState === 'visible') {\n                this.events.emit('visible', new VisibleEvent(this));\n                this._logger.debug('Window visible');\n            }\n        });\n        if (!this.canvasElementId && !options.canvasElement) {\n            document.body.appendChild(this.canvas);\n        }\n    }\n    toggleInputEnabled(enabled) {\n        this._inputEnabled = enabled;\n        this.input.toggleEnabled(this._inputEnabled);\n    }\n    onInitialize(engine) {\n        // Override me\n    }\n    /**\n     * Gets whether the actor is Initialized\n     */\n    get isInitialized() {\n        return this._isInitialized;\n    }\n    async _overrideInitialize(engine) {\n        if (!this.isInitialized) {\n            await this.director.onInitialize();\n            await this.onInitialize(engine);\n            this.events.emit('initialize', new InitializeEvent(engine, this));\n            this._isInitialized = true;\n        }\n    }\n    /**\n     * Updates the entire state of the game\n     * @param elapsedMs  Number of milliseconds elapsed since the last update.\n     */\n    _update(elapsedMs) {\n        var _a;\n        if (this._isLoading) {\n            // suspend updates until loading is finished\n            (_a = this._loader) === null || _a === void 0 ? void 0 : _a.onUpdate(this, elapsedMs);\n            // Update input listeners\n            this.input.update();\n            return;\n        }\n        // Publish preupdate events\n        this.clock.__runScheduledCbs('preupdate');\n        this._preupdate(elapsedMs);\n        // process engine level events\n        this.currentScene.update(this, elapsedMs);\n        // Update graphics postprocessors\n        this.graphicsContext.updatePostProcessors(elapsedMs);\n        // Publish update event\n        this.clock.__runScheduledCbs('postupdate');\n        this._postupdate(elapsedMs);\n        // Update input listeners\n        this.input.update();\n    }\n    /**\n     * @internal\n     */\n    _preupdate(elapsedMs) {\n        this.emit('preupdate', new PreUpdateEvent(this, elapsedMs, this));\n        this.onPreUpdate(this, elapsedMs);\n    }\n    onPreUpdate(engine, elapsedMs) {\n        // Override me\n    }\n    /**\n     * @internal\n     */\n    _postupdate(elapsedMs) {\n        this.emit('postupdate', new PostUpdateEvent(this, elapsedMs, this));\n        this.onPostUpdate(this, elapsedMs);\n    }\n    onPostUpdate(engine, elapsedMs) {\n        // Override me\n    }\n    /**\n     * Draws the entire game\n     * @param elapsedMs  Number of milliseconds elapsed since the last draw.\n     */\n    _draw(elapsedMs) {\n        var _a, _b;\n        // Use scene background color if present, fallback to engine\n        this.graphicsContext.backgroundColor = (_a = this.currentScene.backgroundColor) !== null && _a !== void 0 ? _a : this.backgroundColor;\n        this.graphicsContext.beginDrawLifecycle();\n        this.graphicsContext.clear();\n        this.clock.__runScheduledCbs('predraw');\n        this._predraw(this.graphicsContext, elapsedMs);\n        // Drawing nothing else while loading\n        if (this._isLoading) {\n            if (!this._hideLoader) {\n                (_b = this._loader) === null || _b === void 0 ? void 0 : _b.canvas.draw(this.graphicsContext, 0, 0);\n                this.clock.__runScheduledCbs('postdraw');\n                this.graphicsContext.flush();\n                this.graphicsContext.endDrawLifecycle();\n            }\n            return;\n        }\n        this.currentScene.draw(this.graphicsContext, elapsedMs);\n        this.clock.__runScheduledCbs('postdraw');\n        this._postdraw(this.graphicsContext, elapsedMs);\n        // Flush any pending drawings\n        this.graphicsContext.flush();\n        this.graphicsContext.endDrawLifecycle();\n        this._checkForScreenShots();\n    }\n    /**\n     * @internal\n     */\n    _predraw(ctx, elapsedMs) {\n        this.emit('predraw', new PreDrawEvent(ctx, elapsedMs, this));\n        this.onPreDraw(ctx, elapsedMs);\n    }\n    onPreDraw(ctx, elapsedMs) {\n        // Override me\n    }\n    /**\n     * @internal\n     */\n    _postdraw(ctx, elapsedMs) {\n        this.emit('postdraw', new PostDrawEvent(ctx, elapsedMs, this));\n        this.onPostDraw(ctx, elapsedMs);\n    }\n    onPostDraw(ctx, elapsedMs) {\n        // Override me\n    }\n    /**\n     * Enable or disable Excalibur debugging functionality.\n     * @param toggle a value that debug drawing will be changed to\n     */\n    showDebug(toggle) {\n        this._isDebug = toggle;\n    }\n    /**\n     * Toggle Excalibur debugging functionality.\n     */\n    toggleDebug() {\n        this._isDebug = !this._isDebug;\n        return this._isDebug;\n    }\n    /**\n     * Returns true when loading is totally complete and the player has clicked start\n     */\n    get loadingComplete() {\n        return !this._isLoading;\n    }\n    get ready() {\n        return this._isReadyFuture.isCompleted;\n    }\n    isReady() {\n        return this._isReadyFuture.promise;\n    }\n    async start(sceneNameOrLoader, options) {\n        await this.scope(async () => {\n            if (!this._compatible) {\n                throw new Error('Excalibur is incompatible with your browser');\n            }\n            this._isLoading = true;\n            let loader;\n            if (sceneNameOrLoader instanceof DefaultLoader) {\n                loader = sceneNameOrLoader;\n            }\n            else if (typeof sceneNameOrLoader === 'string') {\n                this.director.configureStart(sceneNameOrLoader, options);\n                loader = this.director.mainLoader;\n            }\n            // Start the excalibur clock which drives the mainloop\n            this._logger.debug('Starting game clock...');\n            this.browser.resume();\n            this.clock.start();\n            if (this.garbageCollectorConfig) {\n                this._garbageCollector.start();\n            }\n            this._logger.debug('Game clock started');\n            await this.load(loader !== null && loader !== void 0 ? loader : new Loader());\n            // Initialize before ready\n            await this._overrideInitialize(this);\n            this._isReadyFuture.resolve();\n            this.emit('start', new GameStartEvent(this));\n            return this._isReadyFuture.promise;\n        });\n    }\n    _mainloop(elapsed) {\n        this.scope(() => {\n            this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\n            const elapsedMs = elapsed * this.timescale;\n            this.currentFrameElapsedMs = elapsedMs;\n            // reset frame stats (reuse existing instances)\n            const frameId = this.stats.prevFrame.id + 1;\n            this.stats.currFrame.reset();\n            this.stats.currFrame.id = frameId;\n            this.stats.currFrame.elapsedMs = elapsedMs;\n            this.stats.currFrame.fps = this.clock.fpsSampler.fps;\n            GraphicsDiagnostics.clear();\n            const beforeUpdate = this.clock.now();\n            const fixedTimestepMs = this.fixedUpdateTimestep;\n            if (this.fixedUpdateTimestep) {\n                this._lagMs += elapsedMs;\n                while (this._lagMs >= fixedTimestepMs) {\n                    this._update(fixedTimestepMs);\n                    this._lagMs -= fixedTimestepMs;\n                }\n            }\n            else {\n                this._update(elapsedMs);\n            }\n            const afterUpdate = this.clock.now();\n            this.currentFrameLagMs = this._lagMs;\n            this._draw(elapsedMs);\n            const afterDraw = this.clock.now();\n            this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n            this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n            this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\n            this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\n            this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\n            this.stats.prevFrame.reset(this.stats.currFrame);\n            this._monitorPerformanceThresholdAndTriggerFallback();\n        });\n    }\n    /**\n     * Stops Excalibur's main loop, useful for pausing the game.\n     */\n    stop() {\n        if (this.clock.isRunning()) {\n            this.emit('stop', new GameStopEvent(this));\n            this.browser.pause();\n            this.clock.stop();\n            this._garbageCollector.stop();\n            this._logger.debug('Game stopped');\n        }\n    }\n    /**\n     * Returns the Engine's running status, Useful for checking whether engine is running or paused.\n     */\n    isRunning() {\n        return this.clock.isRunning();\n    }\n    /**\n     * Takes a screen shot of the current viewport and returns it as an\n     * HTML Image Element.\n     * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\n     */\n    screenshot(preserveHiDPIResolution = false) {\n        const screenShotPromise = new Promise((resolve) => {\n            this._screenShotRequests.push({ preserveHiDPIResolution, resolve });\n        });\n        return screenShotPromise;\n    }\n    _checkForScreenShots() {\n        // We must grab the draw buffer before we yield to the browser\n        // the draw buffer is cleared after compositing\n        // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\n        // forces the browser to copy buffers which can have a mass perf impact on mobile\n        for (const request of this._screenShotRequests) {\n            const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\n            const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\n            const screenshot = document.createElement('canvas');\n            screenshot.width = finalWidth;\n            screenshot.height = finalHeight;\n            const ctx = screenshot.getContext('2d');\n            ctx.imageSmoothingEnabled = this.screen.antialiasing;\n            ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\n            const result = new Image();\n            const raw = screenshot.toDataURL('image/png');\n            result.onload = () => {\n                request.resolve(result);\n            };\n            result.src = raw;\n        }\n        // Reset state\n        this._screenShotRequests.length = 0;\n    }\n    /**\n     * Another option available to you to load resources into the game.\n     * Immediately after calling this the game will pause and the loading screen\n     * will appear.\n     * @param loader  Some {@apilink Loadable} such as a {@apilink Loader} collection, {@apilink Sound}, or {@apilink Texture}.\n     */\n    async load(loader, hideLoader = false) {\n        await this.scope(async () => {\n            try {\n                // early exit if loaded\n                if (loader.isLoaded()) {\n                    return;\n                }\n                this._loader = loader;\n                this._isLoading = true;\n                this._hideLoader = hideLoader;\n                if (loader instanceof Loader) {\n                    loader.suppressPlayButton = loader.suppressPlayButton || this._suppressPlayButton;\n                }\n                this._loader.onInitialize(this);\n                await loader.load();\n            }\n            catch (e) {\n                this._logger.error('Error loading resources, things may not behave properly', e);\n                await Promise.resolve();\n            }\n            finally {\n                this._isLoading = false;\n                this._hideLoader = false;\n                this._loader = null;\n            }\n        });\n    }\n}\nEngine.Context = createContext();\nEngine.InstanceCount = 0;\n/**\n * Default {@apilink EngineOptions}\n */\nEngine._DEFAULT_ENGINE_OPTIONS = {\n    width: 0,\n    height: 0,\n    enableCanvasTransparency: true,\n    useDrawSorting: true,\n    configurePerformanceCanvas2DFallback: {\n        allow: false,\n        showPlayerMessage: false,\n        threshold: { fps: 20, numberOfFrames: 100 }\n    },\n    canvasElementId: '',\n    canvasElement: undefined,\n    enableCanvasContextMenu: false,\n    snapToPixel: false,\n    antialiasing: true,\n    pixelArt: false,\n    garbageCollection: true,\n    powerPreference: 'high-performance',\n    pointerScope: PointerScope.Canvas,\n    suppressConsoleBootMessage: null,\n    suppressMinimumBrowserFeatureDetection: null,\n    suppressHiDPIScaling: null,\n    suppressPlayButton: null,\n    grabWindowFocus: true,\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\n};\n\n;// ./Math/index.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n;// ./Debug/index.ts\n\n\n\n\n;// ./Label.ts\n\n\n\n\n\n/**\n * Labels are the way to draw small amounts of text to the screen. They are\n * actors and inherit all of the benefits and capabilities.\n */\nclass Label extends Actor {\n    set maxWidth(width) {\n        this._text.maxWidth = width;\n    }\n    get maxWidth() {\n        return this._text.maxWidth;\n    }\n    get font() {\n        return this._font;\n    }\n    set font(newFont) {\n        this._font = newFont;\n        this._text.font = newFont;\n    }\n    /**\n     * The text to draw.\n     */\n    get text() {\n        return this._text.text;\n    }\n    set text(text) {\n        this._text.text = text;\n    }\n    get color() {\n        return this._text.color;\n    }\n    set color(color) {\n        if (this._text) {\n            this._text.color = color;\n        }\n    }\n    get opacity() {\n        return this.graphics.opacity;\n    }\n    set opacity(opacity) {\n        this.graphics.opacity = opacity;\n    }\n    /**\n     * The {@apilink SpriteFont} to use, if any. Overrides {@apilink Font | `font`} if present.\n     */\n    get spriteFont() {\n        return this._spriteFont;\n    }\n    set spriteFont(sf) {\n        if (sf) {\n            this._spriteFont = sf;\n            this._text.font = this._spriteFont;\n        }\n    }\n    /**\n     * Build a new label\n     * @param options\n     */\n    constructor(options) {\n        super(options);\n        this._font = new Font();\n        this._text = new Text({ text: '', font: this._font });\n        const { text, pos, x, y, spriteFont, font, color, maxWidth } = { text: '', ...options };\n        this.pos = pos !== null && pos !== void 0 ? pos : (x && y ? vec(x, y) : this.pos);\n        this.text = text !== null && text !== void 0 ? text : this.text;\n        this.font = font !== null && font !== void 0 ? font : this.font;\n        this.maxWidth = maxWidth !== null && maxWidth !== void 0 ? maxWidth : this.maxWidth;\n        this.spriteFont = spriteFont !== null && spriteFont !== void 0 ? spriteFont : this.spriteFont;\n        this._text.color = color !== null && color !== void 0 ? color : this.color;\n        const gfx = this.get(GraphicsComponent);\n        gfx.anchor = Vector.Zero;\n        gfx.use(this._text);\n    }\n    _initialize(engine) {\n        super._initialize(engine);\n    }\n    /**\n     * Returns the width of the text in the label (in pixels);\n     */\n    getTextWidth() {\n        return this._text.width;\n    }\n}\n\n;// ./Particles/EmitterType.ts\n/**\n * An enum that represents the types of emitter nozzles\n */\nvar EmitterType;\n(function (EmitterType) {\n    /**\n     * Constant for the circular emitter type\n     */\n    EmitterType[\"Circle\"] = \"circle\";\n    /**\n     * Constant for the rectangular emitter type\n     */\n    EmitterType[\"Rectangle\"] = \"rectangle\";\n})(EmitterType || (EmitterType = {}));\n\n;// ./Particles/ParticleEmitter.ts\n\n\n\n\n\n\n\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend {@apilink Actor} allowing you to use all of the features that come with.\n *\n * These particles are simulated on the CPU in JavaScript\n */\nclass ParticleEmitter extends Actor {\n    /**\n     * @param config particle emitter options bag\n     */\n    constructor(config) {\n        var _a, _b;\n        super({ width: (_a = config.width) !== null && _a !== void 0 ? _a : 0, height: (_b = config.height) !== null && _b !== void 0 ? _b : 0 });\n        this._particlesToEmit = 0;\n        this._particlePool = new RentalPool(() => new Particle({}), (p) => p, 500);\n        this.numParticles = 0;\n        /**\n         * Gets or sets the isEmitting flag\n         */\n        this.isEmitting = true;\n        /**\n         * Gets or sets the backing deadParticle collection\n         */\n        this.deadParticles = [];\n        /**\n         * Gets or sets the emission rate for particles (particles/sec)\n         */\n        this.emitRate = 1; //particles/sec\n        /**\n         * Gets or sets the emitter type for the particle emitter\n         */\n        this.emitterType = EmitterType.Rectangle;\n        /**\n         * Gets or sets the emitter radius, only takes effect when the {@apilink emitterType} is {@apilink EmitterType.Circle}\n         */\n        this.radius = 0;\n        this.particle = {\n            /**\n             * Gets or sets the life of each particle in milliseconds\n             */\n            life: 2000,\n            transform: ParticleTransform.Global,\n            graphic: undefined,\n            opacity: 1,\n            angularVelocity: 0,\n            focus: undefined,\n            focusAccel: undefined,\n            randomRotation: false\n        };\n        const { particle, x, y, z, pos, isEmitting, emitRate, emitterType, radius, random } = { ...config };\n        this.particle = { ...this.particle, ...particle };\n        this.pos = pos !== null && pos !== void 0 ? pos : vec(x !== null && x !== void 0 ? x : 0, y !== null && y !== void 0 ? y : 0);\n        this.z = z !== null && z !== void 0 ? z : 0;\n        this.isEmitting = isEmitting !== null && isEmitting !== void 0 ? isEmitting : this.isEmitting;\n        this.emitRate = emitRate !== null && emitRate !== void 0 ? emitRate : this.emitRate;\n        this.emitterType = emitterType !== null && emitterType !== void 0 ? emitterType : this.emitterType;\n        this.radius = radius !== null && radius !== void 0 ? radius : this.radius;\n        this.body.collisionType = CollisionType.PreventCollision;\n        this.random = random !== null && random !== void 0 ? random : new Random();\n    }\n    removeParticle(particle) {\n        this.deadParticles.push(particle);\n    }\n    /**\n     * Causes the emitter to emit particles\n     * @param particleCount  Number of particles to emit right now\n     */\n    emitParticles(particleCount) {\n        var _a;\n        for (let i = 0; i < particleCount; i++) {\n            const p = this._createParticle();\n            if ((_a = this === null || this === void 0 ? void 0 : this.scene) === null || _a === void 0 ? void 0 : _a.world) {\n                if (this.particle.transform === ParticleTransform.Global) {\n                    this.scene.world.add(p);\n                }\n                else {\n                    this.addChild(p);\n                }\n            }\n        }\n    }\n    // Creates a new particle given the constraints of the emitter\n    _createParticle() {\n        let ranX = 0;\n        let ranY = 0;\n        const angle = randomInRange(this.particle.minAngle || 0, this.particle.maxAngle || Math.PI * 2, this.random);\n        const vel = randomInRange(this.particle.minSpeed || 0, this.particle.maxSpeed || 0, this.random);\n        const size = this.particle.startSize || randomInRange(this.particle.minSize || 5, this.particle.maxSize || 5, this.random);\n        const dx = vel * Math.cos(angle);\n        const dy = vel * Math.sin(angle);\n        if (this.emitterType === EmitterType.Rectangle) {\n            ranX = randomInRange(0, this.width, this.random);\n            ranY = randomInRange(0, this.height, this.random);\n        }\n        else if (this.emitterType === EmitterType.Circle) {\n            const radius = randomInRange(0, this.radius, this.random);\n            ranX = radius * Math.cos(angle);\n            ranY = radius * Math.sin(angle);\n        }\n        const p = this._particlePool.rent();\n        p.configure({\n            life: this.particle.life,\n            opacity: this.particle.opacity,\n            beginColor: this.particle.beginColor,\n            endColor: this.particle.endColor,\n            pos: vec(ranX, ranY),\n            vel: vec(dx, dy),\n            acc: this.particle.acc,\n            angularVelocity: this.particle.angularVelocity,\n            startSize: this.particle.startSize,\n            endSize: this.particle.endSize,\n            size: size,\n            graphic: this.particle.graphic,\n            fade: this.particle.fade\n        });\n        p.registerEmitter(this);\n        if (this.particle.randomRotation) {\n            p.transform.rotation = randomInRange(0, Math.PI * 2, this.random);\n        }\n        if (this.particle.focus) {\n            p.focus = this.particle.focus.add(vec(this.pos.x, this.pos.y));\n            p.focusAccel = this.particle.focusAccel;\n        }\n        return p;\n    }\n    update(engine, elapsedMs) {\n        var _a;\n        super.update(engine, elapsedMs);\n        if (this.isEmitting) {\n            this._particlesToEmit += this.emitRate * (elapsedMs / 1000);\n            if (this._particlesToEmit > 1.0) {\n                this.emitParticles(Math.floor(this._particlesToEmit));\n                this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n            }\n        }\n        // deferred removal\n        for (let i = 0; i < this.deadParticles.length; i++) {\n            if ((_a = this === null || this === void 0 ? void 0 : this.scene) === null || _a === void 0 ? void 0 : _a.world) {\n                this.scene.world.remove(this.deadParticles[i], false);\n                this._particlePool.return(this.deadParticles[i]);\n            }\n        }\n        this.deadParticles.length = 0;\n    }\n}\n\n;// ./Util/Assert.ts\n/**\n * Asserts will throw in `process.env.NODE_ENV === 'development'` builds if the expression evaluates false\n */\nfunction assert(message, expression) {\n    if (false) {}\n}\n\n;// ./Particles/GpuParticleRenderer.ts\n\n\n\n\n/**\n * Container for the GPU Particle State contains the internal state needed for the GPU\n * to render particles and maintain state.\n */\nclass GpuParticleRenderer {\n    constructor(emitter, random, options) {\n        var _a;\n        this.emitRate = 1;\n        this._initialized = false;\n        this._vaos = [];\n        this._buffers = [];\n        this._drawIndex = 0;\n        this._numInputFloats = 2 + 2 + 1 + 1 + 1;\n        this._particleIndex = 0;\n        this._uploadIndex = 0;\n        this._wrappedLife = 0;\n        this._wrappedParticles = 0;\n        this._particleLife = 0;\n        this._emitted = [];\n        this.emitter = emitter;\n        this.particle = options;\n        this._particleData = new Float32Array(this.emitter.maxParticles * this._numInputFloats);\n        this._random = random;\n        this._particleLife = (_a = this.particle.life) !== null && _a !== void 0 ? _a : 2000;\n    }\n    get isInitialized() {\n        return this._initialized;\n    }\n    get maxParticles() {\n        return this.emitter.maxParticles;\n    }\n    initialize(gl, context) {\n        if (this._initialized) {\n            return;\n        }\n        const numParticles = this.emitter.maxParticles;\n        const numInputFloats = this._numInputFloats;\n        const particleData = this._particleData;\n        const bytesPerFloat = 4;\n        const particleDataBuffer1 = gl.createBuffer();\n        const vao1 = gl.createVertexArray();\n        gl.bindVertexArray(vao1);\n        gl.bindBuffer(gl.ARRAY_BUFFER, particleDataBuffer1);\n        gl.bufferData(gl.ARRAY_BUFFER, numParticles * numInputFloats * bytesPerFloat, gl.DYNAMIC_DRAW);\n        gl.bufferSubData(gl.ARRAY_BUFFER, 0, particleData);\n        let offset = 0;\n        // position\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, 0);\n        offset += bytesPerFloat * 2;\n        // velocity\n        gl.vertexAttribPointer(1, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 2;\n        // rotation\n        gl.vertexAttribPointer(2, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 1;\n        // angularVelocity\n        gl.vertexAttribPointer(3, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 1;\n        // life\n        gl.vertexAttribPointer(4, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 1;\n        // enable attributes\n        gl.enableVertexAttribArray(0);\n        gl.enableVertexAttribArray(1);\n        gl.enableVertexAttribArray(2);\n        gl.enableVertexAttribArray(3);\n        gl.enableVertexAttribArray(4);\n        this._vaos.push(vao1);\n        this._buffers.push(particleDataBuffer1);\n        // Clean up\n        gl.bindVertexArray(null);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        const particleDataBuffer2 = gl.createBuffer();\n        const vao2 = gl.createVertexArray();\n        gl.bindVertexArray(vao2);\n        gl.bindBuffer(gl.ARRAY_BUFFER, particleDataBuffer2);\n        gl.bufferData(gl.ARRAY_BUFFER, numParticles * numInputFloats * bytesPerFloat, gl.DYNAMIC_DRAW);\n        offset = 0;\n        // position\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, 0);\n        offset += bytesPerFloat * 2;\n        // velocity\n        gl.vertexAttribPointer(1, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 2;\n        // rotation\n        gl.vertexAttribPointer(2, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 1;\n        // angularVelocity\n        gl.vertexAttribPointer(3, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 1;\n        // life\n        gl.vertexAttribPointer(4, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\n        offset += bytesPerFloat * 1;\n        // enable attributes\n        gl.enableVertexAttribArray(0);\n        gl.enableVertexAttribArray(1);\n        gl.enableVertexAttribArray(2);\n        gl.enableVertexAttribArray(3);\n        gl.enableVertexAttribArray(4);\n        this._vaos.push(vao2);\n        this._buffers.push(particleDataBuffer2);\n        // Clean up\n        gl.bindVertexArray(null);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        this._currentVao = this._vaos[this._drawIndex % 2];\n        this._currentBuffer = this._buffers[(this._drawIndex + 1) % 2];\n        this._initialized = true;\n    }\n    emitParticles(particleCount) {\n        const startIndex = this._particleIndex;\n        const maxSize = this.maxParticles * this._numInputFloats;\n        const endIndex = particleCount * this._numInputFloats + startIndex;\n        let countParticle = 0;\n        for (let i = startIndex; i < endIndex; i += this._numInputFloats) {\n            const angle = this._random.floating(this.particle.minAngle || 0, this.particle.maxAngle || TwoPI);\n            let ranX = 0;\n            let ranY = 0;\n            if (this.emitter.emitterType === EmitterType.Rectangle) {\n                ranX = this._random.floating(-0.5, 0.5) * this.emitter.width;\n                ranY = this._random.floating(-0.5, 0.5) * this.emitter.height;\n            }\n            else {\n                const radius = this._random.floating(0, this.emitter.radius);\n                ranX = radius * Math.cos(angle);\n                ranY = radius * Math.sin(angle);\n            }\n            const data = [\n                this.particle.transform === ParticleTransform.Local ? ranX : this.emitter.transform.pos.x + ranX,\n                this.particle.transform === ParticleTransform.Local ? ranY : this.emitter.transform.pos.y + ranY, // pos in world space\n                this._random.floating(this.particle.minSpeed || 0, this.particle.maxSpeed || 0),\n                this._random.floating(this.particle.minSpeed || 0, this.particle.maxSpeed || 0), // velocity\n                this.particle.randomRotation\n                    ? this._random.floating(this.particle.minAngle || 0, this.particle.maxAngle || TwoPI)\n                    : this.particle.rotation || 0, // rotation\n                this.particle.angularVelocity || 0, // angular velocity\n                this._particleLife // life\n            ];\n            countParticle++;\n            this._particleData.set(data, i % this._particleData.length);\n        }\n        if (endIndex >= maxSize) {\n            this._wrappedParticles += (endIndex - maxSize) / this._numInputFloats;\n            this._wrappedLife = this._particleLife;\n        }\n        else if (this._wrappedLife > 0) {\n            this._wrappedParticles += particleCount;\n        }\n        this._particleIndex = endIndex % maxSize;\n        this._emitted.push([this._particleLife, startIndex]);\n    }\n    _uploadEmitted(gl) {\n        // upload index is the index of the previous upload\n        // particle index is the current index of modification\n        if (this._particleIndex !== this._uploadIndex) {\n            // Bind one buffer to ARRAY_BUFFER and the other to TFB\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._buffers[(this._drawIndex + 1) % 2]);\n            if (this._particleIndex >= this._uploadIndex) {\n                gl.bufferSubData(gl.ARRAY_BUFFER, this._uploadIndex * 4, // dst byte offset 4 bytes per float\n                this._particleData, this._uploadIndex, this._particleIndex - this._uploadIndex);\n            }\n            else {\n                // upload before the wrap\n                // prettier-ignore\n                gl.bufferSubData(gl.ARRAY_BUFFER, this._uploadIndex * 4, this._particleData, this._uploadIndex, this._particleData.length - this._uploadIndex);\n                // upload after the wrap if there are any\n                if (this._wrappedParticles) {\n                    // prettier-ignore\n                    gl.bufferSubData(gl.ARRAY_BUFFER, 0, this._particleData, 0, this._wrappedParticles * this._numInputFloats);\n                }\n                this._wrappedLife = this._particleLife;\n            }\n            gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        }\n        this._uploadIndex = this._particleIndex % (this.maxParticles * this._numInputFloats);\n    }\n    update(elapsedMs) {\n        var _a;\n        this._particleLife = (_a = this.particle.life) !== null && _a !== void 0 ? _a : this._particleLife;\n        if (this._wrappedLife > 0) {\n            this._wrappedLife -= elapsedMs;\n        }\n        else {\n            this._wrappedLife = 0;\n            this._wrappedParticles = 0;\n        }\n        if (!this._emitted.length) {\n            return;\n        }\n        for (let i = this._emitted.length - 1; i >= 0; i--) {\n            const particle = this._emitted[i];\n            particle[0] -= elapsedMs;\n            const life = particle[0];\n            if (life <= 0) {\n                this._emitted.splice(i, 1);\n            }\n        }\n        this._emitted.sort((a, b) => a[0] - b[0]);\n    }\n    draw(gl) {\n        if (this._initialized) {\n            // Emit\n            this._uploadEmitted(gl);\n            // Bind one buffer to ARRAY_BUFFER and the other to transform feedback buffer\n            gl.bindVertexArray(this._currentVao);\n            gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer);\n            // Perform transform feedback (run the simulation) and the draw call all at once\n            if (this._wrappedLife && this._emitted[0] && this._emitted[0][1] > 0) {\n                const midpoint = this._emitted[0][1] / this._numInputFloats;\n                // draw oldest first (maybe make configurable)\n                assert(`midpoint greater than 0, actual: ${midpoint}`, () => midpoint > 0);\n                assert(`midpoint is less than max, actual: ${midpoint}`, () => midpoint < this.maxParticles);\n                gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer, this._emitted[0][1] * 4, (this.maxParticles - midpoint) * this._numInputFloats * 4);\n                gl.beginTransformFeedback(gl.POINTS);\n                gl.drawArrays(gl.POINTS, midpoint, this.maxParticles - midpoint);\n                gl.endTransformFeedback();\n                // then draw newer particles\n                gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer, 0, this._emitted[0][1] * 4);\n                gl.beginTransformFeedback(gl.POINTS);\n                gl.drawArrays(gl.POINTS, 0, midpoint);\n                gl.endTransformFeedback();\n            }\n            else {\n                gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer, 0, this._particleData.length * 4);\n                gl.beginTransformFeedback(gl.POINTS);\n                gl.drawArrays(gl.POINTS, 0, this.maxParticles);\n                gl.endTransformFeedback();\n            }\n            // Clean up after ourselves to avoid errors.\n            gl.bindVertexArray(null);\n            gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, null);\n            // flip flop buffers, one will be draw the other simulation\n            this._currentVao = this._vaos[this._drawIndex % 2];\n            this._currentBuffer = this._buffers[(this._drawIndex + 1) % 2];\n            this._drawIndex = (this._drawIndex + 1) % 2;\n        }\n    }\n}\nGpuParticleRenderer.GPU_MAX_PARTICLES = 100000;\n\n;// ./Particles/GpuParticleEmitter.ts\n\n\n\n\nclass GpuParticleEmitter extends Actor {\n    get pos() {\n        return this.transform.pos;\n    }\n    set pos(pos) {\n        this.transform.pos = pos;\n    }\n    get z() {\n        return this.transform.z;\n    }\n    set z(z) {\n        this.transform.z = z;\n    }\n    constructor(config) {\n        super({ name: `GpuParticleEmitter`, width: config.width, height: config.height }); // somewhat goofy way of doing width/height\n        this.particle = {\n            /**\n             * Gets or sets the life of each particle in milliseconds\n             */\n            life: 2000,\n            transform: ParticleTransform.Global,\n            graphic: undefined,\n            opacity: 1,\n            angularVelocity: 0,\n            focus: undefined,\n            focusAccel: undefined,\n            randomRotation: false\n        };\n        this.graphics = new GraphicsComponent();\n        this.isEmitting = false;\n        this.emitRate = 1;\n        this.emitterType = EmitterType.Rectangle;\n        this.radius = 0;\n        this.maxParticles = 2000;\n        this._particlesToEmit = 0;\n        this.addComponent(this.graphics, true);\n        this.graphics.onPostDraw = this.draw.bind(this);\n        const { particle, maxParticles, x, y, z, pos, isEmitting, emitRate, emitterType, radius, random } = { ...config };\n        this.maxParticles = clamp(maxParticles !== null && maxParticles !== void 0 ? maxParticles : this.maxParticles, 0, GpuParticleRenderer.GPU_MAX_PARTICLES);\n        this.pos = pos !== null && pos !== void 0 ? pos : vec(x !== null && x !== void 0 ? x : 0, y !== null && y !== void 0 ? y : 0);\n        this.z = z !== null && z !== void 0 ? z : 0;\n        this.isEmitting = isEmitting !== null && isEmitting !== void 0 ? isEmitting : this.isEmitting;\n        this.emitRate = emitRate !== null && emitRate !== void 0 ? emitRate : this.emitRate;\n        this.emitterType = emitterType !== null && emitterType !== void 0 ? emitterType : this.emitterType;\n        this.radius = radius !== null && radius !== void 0 ? radius : this.radius;\n        this.particle = { ...this.particle, ...particle };\n        this.random = random !== null && random !== void 0 ? random : new Random();\n        this.renderer = new GpuParticleRenderer(this, this.random, this.particle);\n    }\n    _initialize(engine) {\n        super._initialize(engine);\n        const context = engine.graphicsContext;\n        this.renderer.initialize(context.__gl, context);\n    }\n    update(engine, elapsedMs) {\n        super.update(engine, elapsedMs);\n        if (this.isEmitting) {\n            this._particlesToEmit += this.emitRate * (elapsedMs / 1000);\n            if (this._particlesToEmit > 1.0) {\n                this.emitParticles(Math.floor(this._particlesToEmit));\n                this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n            }\n        }\n        this.renderer.update(elapsedMs);\n    }\n    emitParticles(particleCount) {\n        this.renderer.emitParticles(particleCount);\n    }\n    draw(ctx, elapsedMilliseconds) {\n        ctx.draw('ex.particle', this.renderer, elapsedMilliseconds);\n    }\n}\n\n;// ./Particles/index.ts\n\n\n\n\n\n\n;// ./TileMap/IsometricMap.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\nclass IsometricTile extends Entity {\n    getGraphics() {\n        return this._graphics;\n    }\n    /**\n     * Tile graphics\n     */\n    addGraphic(graphic, options) {\n        this._graphics.push(graphic);\n        this._gfx.isVisible = this.map.isVisible;\n        this._gfx.opacity = this.map.opacity;\n        if (options === null || options === void 0 ? void 0 : options.offset) {\n            this._gfx.offset = options.offset;\n        }\n        // TODO detect when this changes on the map and apply to all tiles\n        this._gfx.localBounds = this._recalculateBounds();\n    }\n    _recalculateBounds() {\n        let bounds = this._tileBounds.clone();\n        for (const graphic of this._graphics) {\n            const offset = vec(this.map.graphicsOffset.x - this.map.tileWidth / 2, this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : graphic.height - this.map.tileHeight));\n            bounds = bounds.combine(graphic.localBounds.translate(offset));\n        }\n        return bounds;\n    }\n    removeGraphic(graphic) {\n        const index = this._graphics.indexOf(graphic);\n        if (index > -1) {\n            this._graphics.splice(index, 1);\n        }\n        this._gfx.localBounds = this._recalculateBounds();\n    }\n    clearGraphics() {\n        this._graphics.length = 0;\n        this._gfx.isVisible = false;\n        this._gfx.localBounds = this._recalculateBounds();\n    }\n    getColliders() {\n        return this._colliders;\n    }\n    /**\n     * Adds a collider to the IsometricTile\n     *\n     * **Note!** the {@apilink Tile.solid} must be set to true for it to act as a \"fixed\" collider\n     * @param collider\n     */\n    addCollider(collider) {\n        this._colliders.push(collider);\n        this.map.flagCollidersDirty();\n    }\n    /**\n     * Removes a collider from the IsometricTile\n     * @param collider\n     */\n    removeCollider(collider) {\n        const index = this._colliders.indexOf(collider);\n        if (index > -1) {\n            this._colliders.splice(index, 1);\n        }\n        this.map.flagCollidersDirty();\n    }\n    /**\n     * Clears all colliders from the IsometricTile\n     */\n    clearColliders() {\n        this._colliders.length = 0;\n        this.map.flagCollidersDirty();\n    }\n    /**\n     * Returns the top left corner of the {@apilink IsometricTile} in world space\n     */\n    get pos() {\n        return this.map.tileToWorld(vec(this.x, this.y));\n    }\n    /**\n     * Returns the center of the {@apilink IsometricTile}\n     */\n    get center() {\n        return this.pos.add(vec(0, this.map.tileHeight / 2));\n    }\n    /**\n     * Construct a new IsometricTile\n     * @param x tile coordinate in x (not world position)\n     * @param y tile coordinate in y (not world position)\n     * @param graphicsOffset offset that tile should be shifted by (default (0, 0))\n     * @param map reference to owning IsometricMap\n     */\n    constructor(x, y, graphicsOffset, map) {\n        super([\n            new TransformComponent(),\n            new GraphicsComponent({\n                offset: graphicsOffset !== null && graphicsOffset !== void 0 ? graphicsOffset : Vector.Zero,\n                onPostDraw: (gfx, elapsed) => this.draw(gfx, elapsed)\n            }),\n            new IsometricEntityComponent(map)\n        ]);\n        /**\n         * Indicates whether this tile is solid\n         */\n        this.solid = false;\n        this.events = new EventEmitter();\n        this._tileBounds = new BoundingBox();\n        this._graphics = [];\n        /**\n         * Tile colliders\n         */\n        this._colliders = [];\n        /**\n         * Arbitrary data storage per tile, useful for any game specific data\n         */\n        this.data = new Map();\n        this.x = x;\n        this.y = y;\n        this.map = map;\n        this._transform = this.get(TransformComponent);\n        this._isometricEntityComponent = this.get(IsometricEntityComponent);\n        const halfTileWidth = this.map.tileWidth / 2;\n        const halfTileHeight = this.map.tileHeight / 2;\n        // See https://clintbellanger.net/articles/isometric_math/ for formula\n        // The x position shifts left with every y step\n        const xPos = (this.x - this.y) * halfTileWidth;\n        // The y position needs to go down with every x step\n        const yPos = (this.x + this.y) * halfTileHeight;\n        this._transform.pos = vec(xPos, yPos);\n        this._isometricEntityComponent.elevation = map.elevation;\n        this._gfx = this.get(GraphicsComponent);\n        this._gfx.isVisible = false; // start not visible\n        const totalWidth = this.map.tileWidth;\n        const totalHeight = this.map.tileHeight;\n        // initial guess at gfx bounds based on the tile\n        const offset = vec(0, this.map.renderFromTopOfGraphic ? totalHeight : 0);\n        this._gfx.localBounds = this._tileBounds = new BoundingBox({\n            left: -totalWidth / 2,\n            top: -totalHeight,\n            right: totalWidth / 2,\n            bottom: totalHeight\n        }).translate(offset);\n    }\n    draw(gfx, _elapsed) {\n        const halfTileWidth = this.map.tileWidth / 2;\n        gfx.save();\n        // shift left origin to corner of map, not the left corner of the first sprite\n        gfx.translate(-halfTileWidth, 0);\n        for (const graphic of this._graphics) {\n            graphic.draw(gfx, this.map.graphicsOffset.x, this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : graphic.height - this.map.tileHeight));\n        }\n        gfx.restore();\n    }\n}\n/**\n * The IsometricMap is a special tile map that provides isometric rendering support to Excalibur\n *\n * The tileWidth and tileHeight should be the height and width in pixels of the parallelogram of the base of the tile art asset.\n * The tileWidth and tileHeight is not necessarily the same as your graphic pixel width and height.\n *\n * Please refer to the docs https://excaliburjs.com for more details calculating what your tile width and height should be given\n * your art assets.\n */\nclass IsometricMap extends Entity {\n    /**\n     * Whether tiles should be visible\n     * @deprecated use isVisible\n     */\n    get visible() {\n        return this.isVisible;\n    }\n    /**\n     * Whether tiles should be visible\n     * @deprecated use isVisible\n     */\n    set visible(val) {\n        this.isVisible = val;\n    }\n    constructor(options) {\n        super([\n            new TransformComponent(),\n            new BodyComponent({\n                type: CollisionType.Fixed\n            }),\n            new ColliderComponent(),\n            new PointerComponent(),\n            new DebugGraphicsComponent((ctx, debugFlags) => this.debug(ctx, debugFlags), false)\n        ], options.name);\n        this.elevation = 0;\n        /**\n         * Whether tiles should be visible\n         */\n        this.isVisible = true;\n        /**\n         * Opacity of tiles\n         */\n        this.opacity = 1.0;\n        /**\n         * Render the tile graphic from the top instead of the bottom\n         *\n         * default is `false` meaning rendering from the bottom\n         */\n        this.renderFromTopOfGraphic = false;\n        this.graphicsOffset = vec(0, 0);\n        this._collidersDirty = false;\n        this._originalOffsets = new WeakMap();\n        const { pos, tileWidth, tileHeight, columns: width, rows: height, renderFromTopOfGraphic, graphicsOffset, elevation } = options;\n        this.transform = this.get(TransformComponent);\n        if (pos) {\n            this.transform.pos = pos;\n        }\n        this.collider = this.get(ColliderComponent);\n        if (this.collider) {\n            this.collider.set((this._composite = new CompositeCollider([])));\n        }\n        this.pointer = this.get(PointerComponent);\n        this.renderFromTopOfGraphic = renderFromTopOfGraphic !== null && renderFromTopOfGraphic !== void 0 ? renderFromTopOfGraphic : this.renderFromTopOfGraphic;\n        this.graphicsOffset = graphicsOffset !== null && graphicsOffset !== void 0 ? graphicsOffset : this.graphicsOffset;\n        this.elevation = elevation !== null && elevation !== void 0 ? elevation : this.elevation;\n        this.tileWidth = tileWidth;\n        this.tileHeight = tileHeight;\n        this.columns = width;\n        this.rows = height;\n        this._pointerEventDispatcher = new PointerEventsToObjectDispatcher();\n        this.tiles = new Array(width * height);\n        // build up tile representation\n        for (let y = 0; y < height; y++) {\n            for (let x = 0; x < width; x++) {\n                const tile = new IsometricTile(x, y, this.graphicsOffset, this);\n                this.tiles[x + y * width] = tile;\n                this.addChild(tile);\n                this._pointerEventDispatcher.addObject(tile, (p) => this.getTileByPoint(p.worldPos) === tile, () => true);\n            }\n        }\n        this.pointer.localBounds = BoundingBox.fromDimension(tileWidth * width * this.transform.scale.x, tileHeight * height * this.transform.scale.y, vec(0.5, 0));\n    }\n    /**\n     * @internal\n     */\n    _processPointerToObject(receiver) {\n        this._pointerEventDispatcher.processPointerToObject(receiver, this.tiles);\n    }\n    /**\n     * @internal\n     */\n    _dispatchPointerEvents(receiver) {\n        this._pointerEventDispatcher.dispatchEvents(receiver, this.tiles);\n    }\n    update() {\n        if (this._collidersDirty) {\n            this.updateColliders();\n            this._collidersDirty = false;\n        }\n        this._pointerEventDispatcher.clear();\n    }\n    flagCollidersDirty() {\n        this._collidersDirty = true;\n    }\n    _getOrSetColliderOriginalOffset(collider) {\n        var _a;\n        if (!this._originalOffsets.has(collider)) {\n            const originalOffset = collider.offset;\n            this._originalOffsets.set(collider, originalOffset);\n            return originalOffset;\n        }\n        else {\n            return (_a = this._originalOffsets.get(collider)) !== null && _a !== void 0 ? _a : Vector.Zero;\n        }\n    }\n    updateColliders() {\n        this._composite.clearColliders();\n        const pos = this.get(TransformComponent).pos;\n        for (const tile of this.tiles) {\n            if (tile.solid) {\n                for (const collider of tile.getColliders()) {\n                    const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n                    collider.offset = this.tileToWorld(vec(tile.x, tile.y))\n                        .sub(pos)\n                        .add(originalOffset)\n                        .sub(vec(this.tileWidth / 2, this.tileHeight)); // We need to unshift height based on drawing\n                    collider.owner = this;\n                    this._composite.addCollider(collider);\n                }\n            }\n        }\n        this.collider.update();\n    }\n    /**\n     * Convert world space coordinates to the tile x, y coordinate\n     * @param worldCoordinate\n     */\n    worldToTile(worldCoordinate) {\n        // TODO I don't think this handles parent transform see TileMap\n        worldCoordinate = worldCoordinate.sub(this.transform.globalPos);\n        const halfTileWidth = this.tileWidth / 2;\n        const halfTileHeight = this.tileHeight / 2;\n        // See https://clintbellanger.net/articles/isometric_math/ for formula\n        return vec(~~((worldCoordinate.x / halfTileWidth + worldCoordinate.y / halfTileHeight) / 2), ~~((worldCoordinate.y / halfTileHeight - worldCoordinate.x / halfTileWidth) / 2));\n    }\n    /**\n     * Given a tile coordinate, return the top left corner in world space\n     * @param tileCoordinate\n     */\n    tileToWorld(tileCoordinate) {\n        const halfTileWidth = this.tileWidth / 2;\n        const halfTileHeight = this.tileHeight / 2;\n        // The x position shifts left with every y step\n        const xPos = (tileCoordinate.x - tileCoordinate.y) * halfTileWidth;\n        // The y position needs to go down with every x step\n        const yPos = (tileCoordinate.x + tileCoordinate.y) * halfTileHeight;\n        return vec(xPos, yPos).add(this.transform.pos);\n    }\n    /**\n     * Returns the {@apilink IsometricTile} by its x and y coordinates\n     */\n    getTile(x, y) {\n        if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\n            return null;\n        }\n        return this.tiles[x + y * this.columns];\n    }\n    /**\n     * Returns the {@apilink IsometricTile} by testing a point in world coordinates,\n     * returns `null` if no Tile was found.\n     */\n    getTileByPoint(point) {\n        const tileCoord = this.worldToTile(point);\n        const tile = this.getTile(tileCoord.x, tileCoord.y);\n        return tile;\n    }\n    _getMaxZIndex() {\n        let maxZ = Number.NEGATIVE_INFINITY;\n        for (const tile of this.tiles) {\n            const currentZ = tile.get(TransformComponent).z;\n            if (currentZ > maxZ) {\n                maxZ = currentZ;\n            }\n        }\n        return maxZ;\n    }\n    /**\n     * Debug draw for IsometricMap, called internally by excalibur when debug mode is toggled on\n     * @param gfx\n     */\n    debug(gfx, debugFlags) {\n        const { showAll, showPosition, positionColor, positionSize, showGrid, gridColor, gridWidth, showColliderGeometry } = debugFlags.isometric;\n        const { geometryColor, geometryLineWidth, geometryPointSize } = debugFlags.collider;\n        gfx.save();\n        gfx.z = this._getMaxZIndex() + 0.5;\n        if (showAll || showGrid) {\n            for (let y = 0; y < this.rows + 1; y++) {\n                const left = this.tileToWorld(vec(0, y));\n                const right = this.tileToWorld(vec(this.columns, y));\n                gfx.drawLine(left, right, gridColor, gridWidth);\n            }\n            for (let x = 0; x < this.columns + 1; x++) {\n                const top = this.tileToWorld(vec(x, 0));\n                const bottom = this.tileToWorld(vec(x, this.rows));\n                gfx.drawLine(top, bottom, gridColor, gridWidth);\n            }\n        }\n        if (showAll || showPosition) {\n            for (const tile of this.tiles) {\n                gfx.drawCircle(this.tileToWorld(vec(tile.x, tile.y)), positionSize, positionColor);\n            }\n        }\n        if (showAll || showColliderGeometry) {\n            for (const tile of this.tiles) {\n                if (tile.solid) {\n                    // only draw solid tiles\n                    for (const collider of tile.getColliders()) {\n                        collider.debug(gfx, geometryColor, { lineWidth: geometryLineWidth, pointSize: geometryPointSize });\n                    }\n                }\n            }\n        }\n        gfx.restore();\n    }\n}\n\n;// ./TileMap/index.ts\n\n\n\n\n\n;// ./Actions/Action/ActionSequence.ts\n\n\n/**\n * Action that can represent a sequence of actions, this can be useful in conjunction with\n * {@apilink ParallelActions} to run multiple sequences in parallel.\n */\nclass ActionSequence {\n    constructor(entity, actionBuilder) {\n        this.id = nextActionId();\n        this._stopped = false;\n        this._sequenceBuilder = actionBuilder;\n        this._sequenceContext = new ActionContext(entity);\n        this._actionQueue = this._sequenceContext.getQueue();\n        this._sequenceBuilder(this._sequenceContext);\n    }\n    update(elapsedMs) {\n        this._actionQueue.update(elapsedMs);\n    }\n    isComplete() {\n        return this._stopped || this._actionQueue.isComplete();\n    }\n    stop() {\n        this._stopped = true;\n    }\n    reset() {\n        this._stopped = false;\n        this._actionQueue.reset();\n    }\n    clone(entity) {\n        return new ActionSequence(entity, this._sequenceBuilder);\n    }\n}\n\n;// ./Actions/Action/ParallelActions.ts\n\n/**\n * Action that can run multiple {@apilink Action}s or {@apilink ActionSequence}s at the same time\n */\nclass ParallelActions {\n    constructor(parallelActions) {\n        this.id = nextActionId();\n        this._actions = parallelActions;\n    }\n    update(elapsedMs) {\n        for (let i = 0; i < this._actions.length; i++) {\n            this._actions[i].update(elapsedMs);\n        }\n    }\n    isComplete(entity) {\n        return this._actions.every((a) => a.isComplete(entity));\n    }\n    reset() {\n        this._actions.forEach((a) => a.reset());\n    }\n    stop() {\n        this._actions.forEach((a) => a.stop());\n    }\n}\n\n;// ./Actions/index.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n;// ./Collision/Detection/QuadTree.ts\n\n\n/**\n * QuadTree spatial data structure. Useful for quickly retrieving all objects that might\n * be in a specific location.\n */\nclass QuadTree {\n    constructor(bounds, options) {\n        this.bounds = bounds;\n        this.options = options;\n        this._defaultOptions = {\n            maxDepth: 10,\n            capacity: 10,\n            level: 0\n        };\n        this.items = [];\n        this._isDivided = false;\n        this.topLeft = null;\n        this.topRight = null;\n        this.bottomLeft = null;\n        this.bottomRight = null;\n        this.options = { ...this._defaultOptions, ...options };\n        this.halfWidth = bounds.width / 2;\n        this.halfHeight = bounds.height / 2;\n    }\n    /**\n     * Splits the quad tree one level deeper\n     */\n    _split() {\n        this._isDivided = true;\n        const newLevelOptions = {\n            maxDepth: this.options.maxDepth,\n            capacity: this.options.capacity,\n            level: this.options.level + 1\n        };\n        this.topLeft = new QuadTree(new BoundingBox({\n            left: this.bounds.left,\n            top: this.bounds.top,\n            right: this.bounds.left + this.halfWidth,\n            bottom: this.bounds.top + this.halfHeight\n        }), newLevelOptions);\n        this.topRight = new QuadTree(new BoundingBox({\n            left: this.bounds.left + this.halfWidth,\n            top: this.bounds.top,\n            right: this.bounds.right,\n            bottom: this.bounds.top + this.halfHeight\n        }), newLevelOptions);\n        this.bottomLeft = new QuadTree(new BoundingBox({\n            left: this.bounds.left,\n            top: this.bounds.top + this.halfHeight,\n            right: this.bounds.left + this.halfWidth,\n            bottom: this.bounds.bottom\n        }), newLevelOptions);\n        this.bottomRight = new QuadTree(new BoundingBox({\n            left: this.bounds.left + this.halfWidth,\n            top: this.bounds.top + this.halfHeight,\n            right: this.bounds.right,\n            bottom: this.bounds.bottom\n        }), newLevelOptions);\n    }\n    _insertIntoSubNodes(item) {\n        var _a, _b, _c, _d;\n        if ((_a = this.topLeft) === null || _a === void 0 ? void 0 : _a.bounds.overlaps(item.bounds)) {\n            this.topLeft.insert(item);\n        }\n        if ((_b = this.topRight) === null || _b === void 0 ? void 0 : _b.bounds.overlaps(item.bounds)) {\n            this.topRight.insert(item);\n        }\n        if ((_c = this.bottomLeft) === null || _c === void 0 ? void 0 : _c.bounds.overlaps(item.bounds)) {\n            this.bottomLeft.insert(item);\n        }\n        if ((_d = this.bottomRight) === null || _d === void 0 ? void 0 : _d.bounds.overlaps(item.bounds)) {\n            this.bottomRight.insert(item);\n        }\n    }\n    /**\n     * Insert an item to be tracked in the QuadTree\n     * @param item\n     */\n    insert(item) {\n        // add to subnodes if it matches\n        if (this._isDivided) {\n            this._insertIntoSubNodes(item);\n            return;\n        }\n        // leaf case\n        this.items.push(item);\n        // capacity\n        if (this.items.length > this.options.capacity && this.options.level < this.options.maxDepth) {\n            if (!this._isDivided) {\n                this._split();\n            }\n            // divide this level's items into it's subnodes\n            for (const item of this.items) {\n                this._insertIntoSubNodes(item);\n            }\n            // clear this level\n            this.items.length = 0;\n        }\n    }\n    /**\n     * Remove a tracked item in the QuadTree\n     * @param item\n     */\n    remove(item) {\n        var _a, _b, _c, _d;\n        if (!this.bounds.overlaps(item.bounds)) {\n            return;\n        }\n        if (!this._isDivided) {\n            const index = this.items.indexOf(item);\n            if (index > -1) {\n                this.items.splice(index, 1);\n            }\n            return;\n        }\n        if ((_a = this.topLeft) === null || _a === void 0 ? void 0 : _a.bounds.overlaps(item.bounds)) {\n            this.topLeft.remove(item);\n        }\n        if ((_b = this.topRight) === null || _b === void 0 ? void 0 : _b.bounds.overlaps(item.bounds)) {\n            this.topRight.remove(item);\n        }\n        if ((_c = this.bottomLeft) === null || _c === void 0 ? void 0 : _c.bounds.overlaps(item.bounds)) {\n            this.bottomLeft.remove(item);\n        }\n        if ((_d = this.bottomRight) === null || _d === void 0 ? void 0 : _d.bounds.overlaps(item.bounds)) {\n            this.bottomRight.remove(item);\n        }\n    }\n    /**\n     * Query the structure for all objects that intersect the bounding box\n     * @param boundingBox\n     * @returns items\n     */\n    query(boundingBox) {\n        let results = this.items;\n        if (this._isDivided) {\n            if (this.topLeft.bounds.overlaps(boundingBox)) {\n                results = results.concat(this.topLeft.query(boundingBox));\n            }\n            if (this.topRight.bounds.overlaps(boundingBox)) {\n                results = results.concat(this.topRight.query(boundingBox));\n            }\n            if (this.bottomLeft.bounds.overlaps(boundingBox)) {\n                results = results.concat(this.bottomLeft.query(boundingBox));\n            }\n            if (this.bottomRight.bounds.overlaps(boundingBox)) {\n                results = results.concat(this.bottomRight.query(boundingBox));\n            }\n        }\n        results = results.filter((item, index) => {\n            return results.indexOf(item) >= index;\n        });\n        return results;\n    }\n    clear() {\n        this.items = [];\n        this._isDivided = false;\n        this.topLeft = null;\n        this.topRight = null;\n        this.bottomLeft = null;\n        this.bottomRight = null;\n    }\n    getAllItems() {\n        let results = this.items;\n        if (this._isDivided) {\n            results = results.concat(this.topLeft.getAllItems());\n            results = results.concat(this.topRight.getAllItems());\n            results = results.concat(this.bottomLeft.getAllItems());\n            results = results.concat(this.bottomRight.getAllItems());\n        }\n        results = results.filter((item, index) => {\n            return results.indexOf(item) >= index;\n        });\n        return results;\n    }\n    getTreeDepth() {\n        if (!this._isDivided) {\n            return 0;\n        }\n        return (1 +\n            Math.max(this.topLeft.getTreeDepth(), this.topRight.getTreeDepth(), this.bottomLeft.getTreeDepth(), this.bottomRight.getTreeDepth()));\n    }\n    debug(ctx) {\n        this.bounds.draw(ctx, Color.Yellow);\n        if (this._isDivided) {\n            this.topLeft.bounds.draw(ctx, Color.Yellow);\n            this.topRight.bounds.draw(ctx, Color.Yellow);\n            this.bottomLeft.bounds.draw(ctx, Color.Yellow);\n            this.bottomRight.bounds.draw(ctx, Color.Yellow);\n        }\n    }\n}\n\n;// ./Collision/Index.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n;// ./Interfaces/LifecycleEvents.ts\n/**\n * Type guard checking for internal initialize method\n * @internal\n * @param a\n */\nfunction has_initialize(a) {\n    return !!a._initialize;\n}\n/**\n *\n */\nfunction has_add(a) {\n    return !!a.onAdd;\n}\n/**\n *\n */\nfunction has_remove(a) {\n    return !!a.onRemove;\n}\n/**\n *\n */\nfunction hasOnInitialize(a) {\n    return !!a.onInitialize;\n}\n/**\n *\n */\nfunction has_preupdate(a) {\n    return !!a._preupdate;\n}\n/**\n *\n */\nfunction hasOnPreUpdate(a) {\n    return !!a.onPreUpdate;\n}\n/**\n *\n */\nfunction has_postupdate(a) {\n    return !!a.onPostUpdate;\n}\n/**\n *\n */\nfunction hasOnPostUpdate(a) {\n    return !!a.onPostUpdate;\n}\n/**\n *\n */\nfunction hasOnAdd(a) {\n    return !!a.onAdd;\n}\n/**\n *\n */\nfunction hasOnRemove(a) {\n    return !!a.onRemove;\n}\n/**\n *\n */\nfunction hasPreDraw(a) {\n    return !!a.onPreDraw;\n}\n/**\n *\n */\nfunction hasPostDraw(a) {\n    return !!a.onPostDraw;\n}\n\n;// ./Interfaces/Index.ts\n\n\n\n\n\n\n\n\n;// ./Resources/Sound/Index.ts\n\n\n\n\n;// ./Resources/Gif.ts\n\n\n\n\n/**\n * The {@apilink Texture} object allows games built in Excalibur to load image resources.\n * {@apilink Texture} is an {@apilink Loadable} which means it can be passed to a {@apilink Loader}\n * to pre-load before starting a level or game.\n */\nclass Gif {\n    /**\n     * @param path       Path to the image resource\n     * @param bustCache  Optionally load texture with cache busting\n     */\n    constructor(path, bustCache = false) {\n        this.path = path;\n        /**\n         * The width of the texture in pixels\n         */\n        this.width = 0;\n        /**\n         * The height of the texture in pixels\n         */\n        this.height = 0;\n        this._images = [];\n        this.data = [];\n        this._sprites = [];\n        this._resource = new Resource(path, 'arraybuffer', bustCache);\n    }\n    /**\n     * Should excalibur add a cache busting querystring? By default false.\n     * Must be set before loading\n     */\n    get bustCache() {\n        return this._resource.bustCache;\n    }\n    set bustCache(val) {\n        this._resource.bustCache = val;\n    }\n    /**\n     * Begins loading the texture and returns a promise to be resolved on completion\n     */\n    async load() {\n        const arraybuffer = await this._resource.load();\n        this._stream = new Stream(arraybuffer);\n        this._gif = new GifParser(this._stream);\n        const images = this._gif.images.map((i) => new ImageSource(i.src, false));\n        // Load all textures\n        await Promise.all(images.map((t) => t.load()));\n        this.data = this._images = images;\n        this._sprites = this._images.map((image) => {\n            return image.toSprite();\n        });\n        return this.data;\n    }\n    isLoaded() {\n        return !!this.data;\n    }\n    /**\n     * Return a frame of the gif as a sprite by id\n     * @param id\n     */\n    toSprite(id = 0) {\n        var _a;\n        return (_a = this._sprites[id]) !== null && _a !== void 0 ? _a : null;\n    }\n    /**\n     * Return the gif as a spritesheet\n     */\n    toSpriteSheet() {\n        const sprites = this._sprites;\n        if (sprites.length) {\n            return new SpriteSheet({ sprites });\n        }\n        return null;\n    }\n    /**\n     * Transform the GIF into an animation with duration per frame\n     * @param durationPerFrameMs Optionally override duration per frame\n     */\n    toAnimation(durationPerFrameMs) {\n        var _a;\n        const images = (_a = this._gif) === null || _a === void 0 ? void 0 : _a.images;\n        if (images === null || images === void 0 ? void 0 : images.length) {\n            const frames = images.map((image, index) => {\n                var _a;\n                return {\n                    graphic: this._sprites[index],\n                    duration: ((_a = this._gif) === null || _a === void 0 ? void 0 : _a.frames[index].delayMs) || undefined\n                };\n            });\n            this._animation = new Animation({\n                frames,\n                frameDuration: durationPerFrameMs\n            });\n            return this._animation;\n        }\n        return null;\n    }\n    get readCheckBytes() {\n        var _a, _b;\n        return (_b = (_a = this._gif) === null || _a === void 0 ? void 0 : _a.checkBytes) !== null && _b !== void 0 ? _b : [];\n    }\n}\nconst bitsToNum = (ba) => {\n    return ba.reduce(function (s, n) {\n        return s * 2 + n;\n    }, 0);\n};\nconst byteToBitArr = (bite) => {\n    const a = [];\n    for (let i = 7; i >= 0; i--) {\n        a.push(!!(bite & (1 << i)));\n    }\n    return a;\n};\nclass Stream {\n    constructor(dataArray) {\n        this.len = 0;\n        this.position = 0;\n        this.readByte = () => {\n            if (this.position >= this.data.byteLength) {\n                throw new Error('Attempted to read past end of stream.');\n            }\n            return this.data[this.position++];\n        };\n        this.readBytes = (n) => {\n            const bytes = [];\n            for (let i = 0; i < n; i++) {\n                bytes.push(this.readByte());\n            }\n            return bytes;\n        };\n        this.read = (n) => {\n            let s = '';\n            for (let i = 0; i < n; i++) {\n                s += String.fromCharCode(this.readByte());\n            }\n            return s;\n        };\n        this.readUnsigned = () => {\n            // Little-endian.\n            const a = this.readBytes(2);\n            return (a[1] << 8) + a[0];\n        };\n        this.data = new Uint8Array(dataArray);\n        this.len = this.data.byteLength;\n        if (this.len === 0) {\n            throw new Error('No data loaded from file');\n        }\n    }\n}\nconst lzwDecode = function (minCodeSize, data) {\n    // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n    let pos = 0; // Maybe this streaming thing should be merged with the Stream?\n    const readCode = function (size) {\n        let code = 0;\n        for (let i = 0; i < size; i++) {\n            if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n                code |= 1 << i;\n            }\n            pos++;\n        }\n        return code;\n    };\n    const output = [];\n    const clearCode = 1 << minCodeSize;\n    const eoiCode = clearCode + 1;\n    let codeSize = minCodeSize + 1;\n    let dict = [];\n    const clear = function () {\n        dict = [];\n        codeSize = minCodeSize + 1;\n        for (let i = 0; i < clearCode; i++) {\n            dict[i] = [i];\n        }\n        dict[clearCode] = [];\n        dict[eoiCode] = null;\n    };\n    let code = 0;\n    let last = 0;\n    while (true) {\n        last = code;\n        code = readCode(codeSize);\n        if (code === clearCode) {\n            clear();\n            continue;\n        }\n        if (code === eoiCode) {\n            break;\n        }\n        if (code < dict.length) {\n            if (last !== clearCode) {\n                dict.push(dict[last].concat(dict[code][0]));\n            }\n        }\n        else {\n            if (code !== dict.length) {\n                throw new Error('Invalid LZW code.');\n            }\n            dict.push(dict[last].concat(dict[last][0]));\n        }\n        output.push.apply(output, dict[code]);\n        if (dict.length === 1 << codeSize && codeSize < 12) {\n            // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n            codeSize++;\n        }\n    }\n    // I don't know if this is technically an error, but some GIFs do it.\n    //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n    return output;\n};\n/**\n * GifParser for binary format\n *\n * Roughly based on the documentation https://giflib.sourceforge.net/whatsinagif/index.html\n */\nclass GifParser {\n    constructor(stream) {\n        this._handler = {};\n        this.frames = [];\n        this.images = [];\n        this.globalColorTableBytes = [];\n        this.checkBytes = [];\n        this.parseColorTableBytes = (entries) => {\n            // Each entry is 3 bytes, for RGB.\n            const colorTable = [];\n            for (let i = 0; i < entries; i++) {\n                const rgb = this._st.readBytes(3);\n                colorTable.push(rgb);\n            }\n            return colorTable;\n        };\n        this.readSubBlocks = () => {\n            let size, data;\n            data = '';\n            do {\n                size = this._st.readByte();\n                data += this._st.read(size);\n            } while (size !== 0);\n            return data;\n        };\n        this.parseHeader = () => {\n            const hdr = {\n                sig: '',\n                ver: '',\n                width: 0,\n                height: 0,\n                colorResolution: 0,\n                globalColorTableSize: 0,\n                gctFlag: false,\n                sortedFlag: false,\n                globalColorTable: [],\n                backgroundColorIndex: 0,\n                pixelAspectRatio: 0 // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n            };\n            hdr.sig = this._st.read(3);\n            hdr.ver = this._st.read(3);\n            if (hdr.sig !== 'GIF') {\n                throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n            }\n            hdr.width = this._st.readUnsigned();\n            hdr.height = this._st.readUnsigned();\n            this._currentFrameCanvas.width = hdr.width;\n            this._currentFrameCanvas.height = hdr.height;\n            const bits = byteToBitArr(this._st.readByte());\n            hdr.gctFlag = bits.shift();\n            hdr.colorResolution = bitsToNum(bits.splice(0, 3));\n            hdr.sortedFlag = bits.shift();\n            hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\n            hdr.backgroundColorIndex = this._st.readByte();\n            hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n            if (hdr.gctFlag) {\n                // hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\n                this.globalColorTableBytes = this.parseColorTableBytes(1 << (hdr.globalColorTableSize + 1));\n            }\n            if (this._handler.hdr && this._handler.hdr(hdr)) {\n                this.checkBytes.push(this._handler.hdr);\n            }\n        };\n        this.parseExt = (block) => {\n            const parseGCExt = (block) => {\n                this.checkBytes.push(this._st.readByte()); // Always 4\n                const bits = byteToBitArr(this._st.readByte());\n                block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n                block.disposalMethod = bitsToNum(bits.splice(0, 3));\n                block.userInputFlag = bits.shift();\n                block.transparentColorFlag = bits.shift();\n                block.delayTime = this._st.readUnsigned();\n                block.transparentColorIndex = this._st.readByte();\n                block.terminator = this._st.readByte(); // always 0\n                if (this._handler.gce && this._handler.gce(block)) {\n                    this.checkBytes.push(this._handler.gce);\n                }\n                return block;\n            };\n            const parseComExt = (block) => {\n                block.comment = this.readSubBlocks();\n                if (this._handler.com && this._handler.com(block)) {\n                    this.checkBytes.push(this._handler.com);\n                }\n            };\n            const parsePTExt = (block) => {\n                this.checkBytes.push(this._st.readByte()); // Always 12\n                block.ptHeader = this._st.readBytes(12);\n                block.ptData = this.readSubBlocks();\n                if (this._handler.pte && this._handler.pte(block)) {\n                    this.checkBytes.push(this._handler.pte);\n                }\n            };\n            const parseAppExt = (block) => {\n                const parseNetscapeExt = (block) => {\n                    this.checkBytes.push(this._st.readByte()); // Always 3\n                    block.unknown = this._st.readByte(); // Q: Always 1? What is this?\n                    block.iterations = this._st.readUnsigned();\n                    block.terminator = this._st.readByte();\n                    if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\n                        this.checkBytes.push(this._handler.app);\n                    }\n                };\n                const parseUnknownAppExt = (block) => {\n                    block.appData = this.readSubBlocks();\n                    // FIXME: This won't work if a handler wants to match on any identifier.\n                    if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\n                        this.checkBytes.push(this._handler.app[block.identifier]);\n                    }\n                };\n                this.checkBytes.push(this._st.readByte()); // Always 11\n                block.identifier = this._st.read(8);\n                block.authCode = this._st.read(3);\n                switch (block.identifier) {\n                    case 'NETSCAPE':\n                        parseNetscapeExt(block);\n                        break;\n                    default:\n                        parseUnknownAppExt(block);\n                        break;\n                }\n            };\n            const parseUnknownExt = (block) => {\n                block.data = this.readSubBlocks();\n                if (this._handler.unknown && this._handler.unknown(block)) {\n                    this.checkBytes.push(this._handler.unknown);\n                }\n            };\n            block.label = this._st.readByte();\n            switch (block.label) {\n                case 0xf9:\n                    block.extType = 'gce';\n                    this._gce = parseGCExt(block);\n                    break;\n                case 0xfe:\n                    block.extType = 'com';\n                    parseComExt(block);\n                    break;\n                case 0x01:\n                    block.extType = 'pte';\n                    parsePTExt(block);\n                    break;\n                case 0xff:\n                    block.extType = 'app';\n                    parseAppExt(block);\n                    break;\n                default:\n                    block.extType = 'unknown';\n                    parseUnknownExt(block);\n                    break;\n            }\n        };\n        this.parseImg = (img) => {\n            var _a;\n            const deinterlace = (pixels, width) => {\n                // Of course this defeats the purpose of interlacing. And it's *probably*\n                // the least efficient way it's ever been implemented. But nevertheless...\n                const newPixels = new Array(pixels.length);\n                const rows = pixels.length / width;\n                const cpRow = (toRow, fromRow) => {\n                    const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n                    newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n                };\n                const offsets = [0, 4, 2, 1];\n                const steps = [8, 8, 4, 2];\n                let fromRow = 0;\n                for (let pass = 0; pass < 4; pass++) {\n                    for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n                        cpRow(toRow, fromRow);\n                        fromRow++;\n                    }\n                }\n                return newPixels;\n            };\n            img.leftPos = this._st.readUnsigned();\n            img.topPos = this._st.readUnsigned();\n            img.width = this._st.readUnsigned();\n            img.height = this._st.readUnsigned();\n            const bits = byteToBitArr(this._st.readByte());\n            img.lctFlag = bits.shift();\n            img.interlaced = bits.shift();\n            img.sorted = bits.shift();\n            img.reserved = bits.splice(0, 2);\n            img.lctSize = bitsToNum(bits.splice(0, 3));\n            if (img.lctFlag) {\n                img.lctBytes = this.parseColorTableBytes(1 << (img.lctSize + 1));\n            }\n            img.lzwMinCodeSize = this._st.readByte();\n            const lzwData = this.readSubBlocks();\n            img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n            if (img.interlaced) {\n                // Move\n                img.pixels = deinterlace(img.pixels, img.width);\n            }\n            if ((_a = this._gce) === null || _a === void 0 ? void 0 : _a.delayTime) {\n                img.delayMs = this._gce.delayTime * 10;\n            }\n            this.frames.push(img);\n            this.arrayToImage(img, img.lctFlag ? img.lctBytes : this.globalColorTableBytes);\n            if (this._handler.img && this._handler.img(img)) {\n                this.checkBytes.push(this._handler);\n            }\n        };\n        this.parseBlocks = () => {\n            const block = {\n                sentinel: this._st.readByte(),\n                type: ''\n            };\n            const blockChar = String.fromCharCode(block.sentinel);\n            switch (blockChar) {\n                case '!':\n                    block.type = 'ext';\n                    this.parseExt(block);\n                    break;\n                case ',':\n                    block.type = 'img';\n                    this.parseImg(block);\n                    break;\n                case ';':\n                    block.type = 'eof';\n                    if (this._handler.eof && this._handler.eof(block)) {\n                        this.checkBytes.push(this._handler.eof);\n                    }\n                    break;\n                default:\n                    throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\n            }\n            if (block.type !== 'eof') {\n                this.parseBlocks();\n            }\n        };\n        this.arrayToImage = (frame, colorTable) => {\n            var _a, _b, _c, _d;\n            const canvas = document.createElement('canvas');\n            canvas.width = frame.width;\n            canvas.height = frame.height;\n            const context = canvas.getContext('2d');\n            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n            let transparentColorIndex = -1;\n            if ((_a = this._gce) === null || _a === void 0 ? void 0 : _a.transparentColorFlag) {\n                transparentColorIndex = this._gce.transparentColorIndex;\n            }\n            for (let pixel = 0; pixel < frame.pixels.length; pixel++) {\n                const colorIndex = frame.pixels[pixel];\n                const color = colorTable[colorIndex];\n                if (colorIndex === transparentColorIndex) {\n                    imageData.data.set([0, 0, 0, 0], pixel * 4);\n                }\n                else {\n                    imageData.data.set([...color, 255], pixel * 4);\n                }\n            }\n            context.putImageData(imageData, 0, 0);\n            // A value of 1 which tells the decoder to leave the image in place and draw the next image on top of it.\n            // A value of 2 would have meant that the canvas should be restored to the background color (as indicated by the logical screen descriptor).\n            // A value of 3 is defined to mean that the decoder should restore the canvas to its previous state before the current image was drawn.\n            // The behavior for values 4-7 are yet to be defined.\n            if (((_b = this._gce) === null || _b === void 0 ? void 0 : _b.disposalMethod) === 1 && this.images.length) {\n                this._currentFrameContext.drawImage(this.images[this.images.length - 1], 0, 0);\n            }\n            else if (((_c = this._gce) === null || _c === void 0 ? void 0 : _c.disposalMethod) === 2 && ((_d = this._hdr) === null || _d === void 0 ? void 0 : _d.gctFlag)) {\n                const bg = colorTable[this._hdr.backgroundColorIndex];\n                this._currentFrameContext.fillStyle = `rgb(${bg[0]}, ${bg[1]}, ${bg[2]})`;\n                this._currentFrameContext.fillRect(0, 0, this._hdr.width, this._hdr.height);\n            }\n            else {\n                this._currentFrameContext.clearRect(0, 0, this._currentFrameCanvas.width, this._currentFrameCanvas.height);\n            }\n            this._currentFrameContext.drawImage(canvas, frame.leftPos, frame.topPos, frame.width, frame.height);\n            const img = new Image();\n            img.src = this._currentFrameCanvas.toDataURL(); // default is png\n            this.images.push(img);\n        };\n        this._st = stream;\n        this._handler = {};\n        this._currentFrameCanvas = document.createElement('canvas');\n        this._currentFrameContext = this._currentFrameCanvas.getContext('2d');\n        this.parseHeader();\n        this.parseBlocks();\n    }\n}\n\n;// ./Resources/Font.ts\n\n\nclass FontSource {\n    constructor(\n    /**\n     * Path to the font resource relative from the HTML document hosting the game, or absolute\n     */\n    path, \n    /**\n     * The font family name\n     */\n    family, { bustCache, ...options } = {}) {\n        this.path = path;\n        this.family = family;\n        this._isLoaded = false;\n        this._resource = new Resource(path, 'blob', bustCache);\n        this._options = options;\n    }\n    async load() {\n        if (this.isLoaded()) {\n            return this.data;\n        }\n        try {\n            const blob = await this._resource.load();\n            const url = URL.createObjectURL(blob);\n            if (!this.data) {\n                this.data = new FontFace(this.family, `url(${url})`);\n                document.fonts.add(this.data);\n            }\n            await this.data.load();\n            this._isLoaded = true;\n        }\n        catch (error) {\n            throw `Error loading FontSource from path '${this.path}' with error [${error.message}]`;\n        }\n        return this.data;\n    }\n    isLoaded() {\n        return this._isLoaded;\n    }\n    /**\n     * Build a font from this FontSource.\n     * @param options {FontOptions} Override the font options\n     */\n    toFont(options) {\n        return new Font({ family: this.family, ...this._options, ...options });\n    }\n}\n\n;// ./Resources/Index.ts\n\n\n\n\n\n;// ./EntityComponentSystem/index.ts\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n;// ./Util/Coroutine.ts\n\n\n\nconst InsideCoroutineContext = createContext();\nconst generatorFunctionDeclaration = /^\\s*(?:function)?\\*/;\n/**\n *\n */\nfunction isCoroutineGenerator(x) {\n    if (typeof x !== 'function') {\n        return false;\n    }\n    if (generatorFunctionDeclaration.test(Function.prototype.toString.call(x))) {\n        return true;\n    }\n    if (!Object.getPrototypeOf) {\n        return false;\n    }\n    return Object.getPrototypeOf(x) === Object.getPrototypeOf(new Function('return function * () {}')());\n}\n/**\n *\n */\nfunction coroutine(...args) {\n    var _a;\n    const logger = Logger.getInstance();\n    let coroutineGenerator;\n    let thisArg;\n    let options;\n    let passedEngine;\n    // coroutine(coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\n    if (isCoroutineGenerator(args[0])) {\n        thisArg = globalThis;\n        coroutineGenerator = args[0];\n        options = args[1];\n    }\n    // coroutine(thisArg: any, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\n    if (isCoroutineGenerator(args[1])) {\n        thisArg = args[0];\n        coroutineGenerator = args[1];\n        options = args[2];\n    }\n    // coroutine(thisArg: any, engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\n    if (args[1] instanceof Engine) {\n        thisArg = args[0];\n        passedEngine = args[1];\n        coroutineGenerator = args[2];\n        options = args[3];\n    }\n    // coroutine(engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\n    if (args[0] instanceof Engine) {\n        thisArg = globalThis;\n        passedEngine = args[0];\n        coroutineGenerator = args[1];\n        options = args[2];\n    }\n    const inside = useContext(InsideCoroutineContext);\n    const schedule = options === null || options === void 0 ? void 0 : options.timing;\n    const autostart = inside ? false : (_a = options === null || options === void 0 ? void 0 : options.autostart) !== null && _a !== void 0 ? _a : true;\n    let engine;\n    try {\n        engine = passedEngine !== null && passedEngine !== void 0 ? passedEngine : Engine.useEngine();\n    }\n    catch (_) {\n        throw Error('Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.\\n' +\n            'Pass an engine parameter to ex.coroutine(engine, function * {...})');\n    }\n    let started = false;\n    let completed = false;\n    let cancelled = false;\n    const generatorFcn = coroutineGenerator.bind(thisArg);\n    const generator = generatorFcn();\n    let loop;\n    const complete = new Promise((resolve, reject) => {\n        loop = (elapsedMs) => {\n            try {\n                if (cancelled) {\n                    completed = true;\n                    resolve();\n                    return;\n                }\n                const { done, value } = InsideCoroutineContext.scope(true, () => generator.next(elapsedMs));\n                if (done || cancelled) {\n                    completed = true;\n                    resolve();\n                    return;\n                }\n                if (value instanceof Promise) {\n                    value.then(() => {\n                        // schedule next loop\n                        engine.clock.schedule(loop, 0, schedule);\n                    });\n                }\n                else if (value === undefined || value === void 0) {\n                    // schedule next frame\n                    engine.clock.schedule(loop, 0, schedule);\n                }\n                else {\n                    // schedule value milliseconds from now\n                    engine.clock.schedule(loop, value || 0, schedule);\n                }\n            }\n            catch (e) {\n                reject(e);\n                return;\n            }\n        };\n        if (autostart) {\n            started = true;\n            loop(engine.clock.elapsed()); // run first frame immediately\n        }\n    });\n    const co = {\n        isRunning: () => {\n            return started && !cancelled && !completed;\n        },\n        isComplete: () => {\n            return completed;\n        },\n        cancel: () => {\n            cancelled = true;\n        },\n        start: () => {\n            if (!started) {\n                started = true;\n                loop(engine.clock.elapsed());\n            }\n            else {\n                logger.warn('.start() was called on a coroutine that was already started, this is probably a bug:\\n', Function.prototype.toString.call(generatorFcn));\n            }\n            return co;\n        },\n        generator,\n        done: complete,\n        then: complete.then.bind(complete),\n        [Symbol.iterator]: () => {\n            // TODO warn if a coroutine is already running\n            // TODO warn if a coroutine is cancelled\n            return generator;\n        }\n    };\n    return co;\n}\n\n;// ./Director/Transition.ts\n\n\n\n\n\n\n\n\n\n/**\n * Base Transition that can be extended to provide custom scene transitions in Excalibur.\n */\nclass Transition extends Entity {\n    /**\n     * Returns a number between [0, 1] indicating what state the transition is in.\n     *\n     * * For 'out' direction transitions start at 0 and end at 1\n     * * For 'in' direction transitions start at 1 and end at 0\n     */\n    get progress() {\n        return this._currentProgress;\n    }\n    get complete() {\n        if (this.direction === 'out') {\n            return this.progress >= 1;\n        }\n        else {\n            return this.progress <= 0;\n        }\n    }\n    constructor(options) {\n        var _a, _b, _c, _d;\n        super();\n        this._logger = Logger.getInstance();\n        this.transform = new TransformComponent();\n        this.graphics = new GraphicsComponent();\n        this._completeFuture = new Future();\n        // State needs to be reset between uses\n        this.started = false;\n        this._currentDistance = 0;\n        this._currentProgress = 0;\n        this.done = this._completeFuture.promise;\n        this.name = `Transition#${this.id}`;\n        this.duration = options.duration;\n        this.easing = (_a = options.easing) !== null && _a !== void 0 ? _a : EasingFunctions.Linear;\n        this.direction = (_b = options.direction) !== null && _b !== void 0 ? _b : 'out';\n        this.hideLoader = (_c = options.hideLoader) !== null && _c !== void 0 ? _c : false;\n        this.blockInput = (_d = options.blockInput) !== null && _d !== void 0 ? _d : false;\n        this.transform.coordPlane = CoordPlane.Screen;\n        this.transform.pos = Vector.Zero;\n        this.transform.z = Infinity; // Transitions sit on top of everything\n        this.graphics.anchor = Vector.Zero;\n        this.addComponent(this.transform);\n        this.addComponent(this.graphics);\n        if (this.direction === 'out') {\n            this._currentProgress = 0;\n        }\n        else {\n            this._currentProgress = 1;\n        }\n    }\n    /**\n     * Overridable lifecycle method, called before each update.\n     *\n     * **WARNING BE SURE** to call `super.updateTransition()` if overriding in your own custom implementation\n     * @param engine\n     * @param elapsedMs\n     */\n    updateTransition(engine, elapsedMs) {\n        if (this.complete) {\n            return;\n        }\n        this._currentDistance += clamp(elapsedMs / this.duration, 0, 1);\n        if (this._currentDistance >= 1) {\n            this._currentDistance = 1;\n        }\n        if (this.direction === 'out') {\n            this._currentProgress = clamp(this.easing(this._currentDistance, 0, 1, 1), 0, 1);\n        }\n        else {\n            this._currentProgress = clamp(this.easing(this._currentDistance, 1, 0, 1), 0, 1);\n        }\n    }\n    /**\n     * Overridable lifecycle method, called right before the previous scene has deactivated.\n     *\n     * This gives incoming transition a chance to grab info from previous scene if desired\n     * @param scene\n     */\n    async onPreviousSceneDeactivate(scene) {\n        // override me\n    }\n    /**\n     * Overridable lifecycle method, called once at the beginning of the transition\n     *\n     * `progress` is given between 0 and 1\n     * @param progress\n     */\n    onStart(progress) {\n        // override me\n    }\n    /**\n     * Overridable lifecycle method, called every frame of the transition\n     *\n     * `progress` is given between 0 and 1\n     * @param progress\n     */\n    onUpdate(progress) {\n        // override me\n    }\n    /**\n     * Overridable lifecycle method, called at the end of the transition,\n     *\n     * `progress` is given between 0 and 1\n     * @param progress\n     */\n    onEnd(progress) {\n        // override me\n    }\n    /**\n     * Overridable lifecycle method, called when the transition is reset\n     *\n     * Use this to override and provide your own reset logic for internal state in custom transition implementations\n     */\n    onReset() {\n        // override me\n    }\n    /**\n     * reset() is called by the engine to reset transitions\n     */\n    reset() {\n        this.started = false;\n        this._completeFuture = new Future();\n        this.done = this._completeFuture.promise;\n        this._currentDistance = 0;\n        if (this.direction === 'out') {\n            this._currentProgress = 0;\n        }\n        else {\n            this._currentProgress = 1;\n        }\n        this.onReset();\n    }\n    /**\n     * @internal\n     */\n    _addToTargetScene(engine, targetScene) {\n        const currentScene = targetScene;\n        if (this.started) {\n            this._logger.warn(`Attempted to add a transition ${this.name} that is already playing.`);\n        }\n        if (currentScene.world.entityManager.getById(this.id)) {\n            return this._co;\n        }\n        this._engine = engine;\n        currentScene.add(this);\n        const self = this;\n        this._co = coroutine(engine, function* () {\n            while (!self.complete) {\n                const elapsed = yield; // per frame\n                self.updateTransition(self._engine, elapsed);\n                self._execute();\n            }\n        }, {\n            autostart: false\n        });\n        return this._co;\n    }\n    /**\n     * Called internally by excalibur to swap scenes with transition\n     * @internal\n     */\n    async _play() {\n        if (this.started) {\n            this.reset();\n            this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`);\n        }\n        if (!this._engine || !this._co) {\n            this.reset();\n            this._logger.warn(`Attempted to play a transition ${this.name} that hasn't been added`);\n        }\n        if (this._co) {\n            await this._co.start();\n        }\n    }\n    /**\n     * execute() is called by the engine every frame to update the Transition lifecycle onStart/onUpdate/onEnd\n     * @internal\n     */\n    _execute() {\n        if (!this.isInitialized) {\n            return;\n        }\n        if (!this.started) {\n            this.started = true;\n            this.onStart(this.progress);\n        }\n        this.onUpdate(this.progress);\n        if (this.complete && !this._completeFuture.isCompleted) {\n            this.onEnd(this.progress);\n            this._completeFuture.resolve();\n        }\n    }\n}\n\n;// ./Director/FadeInOut.ts\n\n\n\nclass FadeInOut extends Transition {\n    constructor(options) {\n        var _a, _b;\n        super({\n            ...options,\n            duration: (_a = options.duration) !== null && _a !== void 0 ? _a : 2000\n        });\n        this.name = `FadeInOut#${this.id}`;\n        this.color = (_b = options.color) !== null && _b !== void 0 ? _b : Color.Black;\n    }\n    onInitialize(engine) {\n        this.transform.pos = engine.screen.unsafeArea.topLeft;\n        this.screenCover = new Rectangle({\n            width: engine.screen.resolution.width,\n            height: engine.screen.resolution.height,\n            color: this.color\n        });\n        this.graphics.add(this.screenCover);\n        this.graphics.opacity = this.progress;\n    }\n    onReset() {\n        this.graphics.opacity = this.progress;\n    }\n    onStart(progress) {\n        this.graphics.opacity = progress;\n    }\n    onEnd(progress) {\n        this.graphics.opacity = progress;\n    }\n    onUpdate(progress) {\n        this.graphics.opacity = progress;\n    }\n}\n\n;// ./Director/CrossFade.ts\n\n\n\n/**\n * CrossFades between the previous scene and the destination scene\n *\n * Note: CrossFade only works as an \"in\" transition\n */\nclass CrossFade extends Transition {\n    constructor(options) {\n        super({ direction: 'in', ...options }); // default the correct direction\n        this.name = `CrossFade#${this.id}`;\n    }\n    async onPreviousSceneDeactivate(scene) {\n        this.image = await scene.engine.screenshot(true);\n        // Firefox is particularly slow\n        // needed in case the image isn't ready yet\n        await this.image.decode();\n    }\n    onInitialize(engine) {\n        this.engine = engine;\n        this.transform.pos = engine.screen.unsafeArea.topLeft;\n        this.screenCover = ImageSource.fromHtmlImageElement(this.image).toSprite();\n        this.graphics.add(this.screenCover);\n        // This is because we preserve hidpi res on the screen shot which COULD be bigger than the logical resolution\n        this.transform.scale = vec(1 / engine.screen.pixelRatio, 1 / engine.screen.pixelRatio);\n        this.graphics.opacity = this.progress;\n    }\n    onStart(_progress) {\n        this.graphics.opacity = this.progress;\n    }\n    onReset() {\n        this.graphics.opacity = this.progress;\n    }\n    onEnd(progress) {\n        this.graphics.opacity = progress;\n    }\n    onUpdate(progress) {\n        this.graphics.opacity = progress;\n    }\n}\n\n;// ./Director/Slide.ts\n\n\n\n\n\n/**\n * Slide`s between the previous scene and the destination scene\n *\n * Note: Slide` only works as an \"in\" transition\n */\nclass Slide extends Transition {\n    constructor(options) {\n        var _a;\n        super({ direction: 'in', ...options }); // default the correct direction\n        this._easing = EasingFunctions.Linear;\n        this.name = `Slide#${this.id}`;\n        this.slideDirection = options.slideDirection;\n        this.transform.coordPlane = CoordPlane.World;\n        this.graphics.forceOnScreen = true;\n        this._easing = (_a = options.easingFunction) !== null && _a !== void 0 ? _a : this._easing;\n        this._vectorEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n    }\n    async onPreviousSceneDeactivate(scene) {\n        this._image = await scene.engine.screenshot(true);\n        // Firefox is particularly slow\n        // needed in case the image isn't ready yet\n        await this._image.decode();\n        this._screenCover = ImageSource.fromHtmlImageElement(this._image).toSprite();\n    }\n    onInitialize(engine) {\n        this._engine = engine;\n        switch (this.slideDirection) {\n            case 'up': {\n                this._directionOffset = vec(0, -engine.screen.resolution.height);\n                break;\n            }\n            case 'down': {\n                this._directionOffset = vec(0, engine.screen.resolution.height);\n                break;\n            }\n            case 'left': {\n                this._directionOffset = vec(-engine.screen.resolution.width, 0);\n                break;\n            }\n            case 'right': {\n                this._directionOffset = vec(engine.screen.resolution.width, 0);\n                break;\n            }\n        }\n        this._camera = this._engine.currentScene.camera;\n        this._destinationCameraPosition = this._camera.pos.clone();\n        // For sliding shift the camera and the transition slide by offset\n        this._camera.pos = this._camera.pos.add(this._directionOffset);\n        this.transform.pos = this.transform.pos.add(this._directionOffset);\n        this._startCameraPosition = this._camera.pos.clone();\n        this.graphics.use(this._screenCover);\n        // This is because we preserve hidpi res on the screen shot which COULD be bigger than the logical resolution\n        this.transform.scale = vec(1 / engine.screen.pixelRatio, 1 / engine.screen.pixelRatio);\n    }\n    onUpdate(progress) {\n        // in-transitions count down from 1 -> 0, so our \"end\" is swapped\n        this._camera.pos = this._vectorEasing(progress, this._destinationCameraPosition, this._startCameraPosition, 1);\n    }\n}\n\n;// ./Director/index.ts\n\n\n\n\n\n\n\n\n;// ./Graphics/Line.ts\n\n\n\nclass Line extends Graphic {\n    constructor(options) {\n        super();\n        this.color = Color.Black;\n        this.thickness = 1;\n        const { start, end, color, thickness } = options;\n        this.start = start;\n        this.end = end;\n        this.color = color !== null && color !== void 0 ? color : this.color;\n        this.thickness = thickness !== null && thickness !== void 0 ? thickness : this.thickness;\n        this._localBounds = this._calculateBounds();\n        const { width, height } = this._localBounds;\n        this.width = width;\n        this.height = height;\n    }\n    get localBounds() {\n        return this._localBounds;\n    }\n    _calculateBounds() {\n        const lineNormal = this.end.sub(this.start).normal();\n        const halfThickness = this.thickness / 2;\n        const points = [\n            this.start.add(lineNormal.scale(halfThickness)),\n            this.end.add(lineNormal.scale(halfThickness)),\n            this.end.add(lineNormal.scale(-halfThickness)),\n            this.start.add(lineNormal.scale(-halfThickness))\n        ];\n        return BoundingBox.fromPoints(points);\n    }\n    _drawImage(ctx, _x, _y) {\n        ctx.drawLine(this.start, this.end, this.color, this.thickness);\n    }\n    clone() {\n        return new Line({\n            start: this.start,\n            end: this.end,\n            color: this.color,\n            thickness: this.thickness\n        });\n    }\n}\n\n;// ./Graphics/Polygon.ts\n\n\n\n/**\n * A polygon {@apilink Graphic} for drawing arbitrary polygons to the {@apilink ExcaliburGraphicsContext}\n *\n * Polygons default to {@apilink ImageFiltering.Blended}\n */\nclass Polygon extends Raster {\n    get points() {\n        return this._points;\n    }\n    set points(points) {\n        this._points = points;\n        const min = this.minPoint;\n        this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\n        this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\n        this.flagDirty();\n    }\n    get minPoint() {\n        const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\n        const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\n        return vec(minX, minY);\n    }\n    constructor(options) {\n        super(options);\n        this._points = [];\n        this.points = options.points;\n        this.filtering = ImageFiltering.Blended;\n        this.rasterize();\n    }\n    clone() {\n        return new Polygon({\n            points: this.points.map((p) => p.clone()),\n            ...this.cloneGraphicOptions(),\n            ...this.cloneRasterOptions()\n        });\n    }\n    execute(ctx) {\n        if (this.points && this.points.length) {\n            ctx.beginPath();\n            // Iterate through the supplied points and construct a 'polygon'\n            const min = this.minPoint.negate();\n            const firstPoint = this.points[0].add(min);\n            ctx.moveTo(firstPoint.x, firstPoint.y);\n            this.points.forEach((point) => {\n                ctx.lineTo(point.x + min.x, point.y + min.y);\n            });\n            ctx.lineTo(firstPoint.x, firstPoint.y);\n            ctx.closePath();\n            if (this.color) {\n                ctx.fill();\n            }\n            if (this.strokeColor) {\n                ctx.stroke();\n            }\n        }\n    }\n}\n\n;// ./Graphics/NineSlice.ts\n\n\n\n/**\n * Nine slice stretch mode\n */\nvar NineSliceStretch;\n(function (NineSliceStretch) {\n    /**\n     * Stretch the image across a dimension\n     */\n    NineSliceStretch[\"Stretch\"] = \"stretch\";\n    /**\n     * Tile the image across a dimension\n     */\n    NineSliceStretch[\"Tile\"] = \"tile\";\n    /**\n     * Tile the image across a dimension but only by whole image amounts\n     */\n    NineSliceStretch[\"TileFit\"] = \"tile-fit\";\n})(NineSliceStretch || (NineSliceStretch = {}));\nclass NineSlice extends Graphic {\n    constructor(config) {\n        super(config);\n        this._logger = Logger.getInstance();\n        this._config = config;\n        this._imgSource = config.source;\n        this._canvasA = document.createElement('canvas');\n        this._canvasB = document.createElement('canvas');\n        this._canvasC = document.createElement('canvas');\n        this._canvasD = document.createElement('canvas');\n        this._canvasE = document.createElement('canvas');\n        this._canvasF = document.createElement('canvas');\n        this._canvasG = document.createElement('canvas');\n        this._canvasH = document.createElement('canvas');\n        this._canvasI = document.createElement('canvas');\n        this._initialize();\n        this._imgSource.ready.then(() => {\n            this._initialize();\n        });\n    }\n    /**\n     * Sets the target width of the 9 slice (pixels), and recalculates the 9 slice if desired (auto)\n     * @param newWidth\n     * @param auto\n     */\n    setTargetWidth(newWidth, auto = false) {\n        this._config.width = newWidth;\n        if (auto) {\n            this._initialize();\n        }\n    }\n    /**\n     * Sets the target height of the 9 slice (pixels), and recalculates the 9 slice if desired (auto)\n     * @param newHeight\n     * @param auto\n     */\n    setTargetHeight(newHeight, auto = false) {\n        this._config.height = newHeight;\n        if (auto) {\n            this._initialize();\n        }\n    }\n    /**\n     *  Sets the 9 slice margins (pixels), and recalculates the 9 slice if desired (auto)\n     */\n    setMargins(left, top, right, bottom, auto = false) {\n        this._config.sourceConfig.leftMargin = left;\n        this._config.sourceConfig.topMargin = top;\n        this._config.sourceConfig.rightMargin = right;\n        this._config.sourceConfig.bottomMargin = bottom;\n        if (auto) {\n            this._initialize();\n        }\n    }\n    /**\n     *  Sets the stretching strategy for the 9 slice, and recalculates the 9 slice if desired (auto)\n     *\n     */\n    setStretch(type, stretch, auto = false) {\n        if (type === 'horizontal') {\n            this._config.destinationConfig.horizontalStretch = stretch;\n        }\n        else if (type === 'vertical') {\n            this._config.destinationConfig.verticalStretch = stretch;\n        }\n        else {\n            this._config.destinationConfig.horizontalStretch = stretch;\n            this._config.destinationConfig.verticalStretch = stretch;\n        }\n        if (auto) {\n            this._initialize();\n        }\n    }\n    /**\n     *  Returns the config of the 9 slice\n     */\n    getConfig() {\n        return this._config;\n    }\n    /**\n     * Draws 1 of the 9 tiles based on parameters passed in\n     * context is the ExcaliburGraphicsContext from the _drawImage function\n     * destinationSize is the size of the destination image as a vector (width,height)\n     * targetCanvas is the canvas to draw to\n     * horizontalStretch and verticalStretch are the horizontal and vertical stretching strategies\n     * marginW and marginH are optional margins for the 9 slice for positioning\n     * @param context\n     * @param targetCanvas\n     * @param destinationSize\n     * @param horizontalStretch\n     * @param verticalStretch\n     * @param marginWidth\n     * @param marginHeight\n     */\n    _drawTile(context, targetCanvas, destinationSize, horizontalStretch, verticalStretch, marginWidth, marginHeight) {\n        const tempMarginW = marginWidth || 0;\n        const tempMarginH = marginHeight || 0;\n        let tempSizeX, tempPositionX, tempSizeY, tempPositionY;\n        const numTilesX = this._getNumberOfTiles(targetCanvas.width, destinationSize.x, horizontalStretch);\n        const numTilesY = this._getNumberOfTiles(targetCanvas.height, destinationSize.y, verticalStretch);\n        for (let i = 0; i < numTilesX; i++) {\n            for (let j = 0; j < numTilesY; j++) {\n                let { tempSize, tempPosition } = this._calculateParams(i, numTilesX, targetCanvas.width, destinationSize.x, this._config.destinationConfig.horizontalStretch);\n                tempSizeX = tempSize;\n                tempPositionX = tempPosition;\n                ({ tempSize, tempPosition } = this._calculateParams(j, numTilesY, targetCanvas.height, destinationSize.y, this._config.destinationConfig.verticalStretch));\n                tempSizeY = tempSize;\n                tempPositionY = tempPosition;\n                context.drawImage(targetCanvas, 0, 0, targetCanvas.width, targetCanvas.height, tempMarginW + tempPositionX, tempMarginH + tempPositionY, tempSizeX, tempSizeY);\n            }\n        }\n    }\n    /**\n     *  Draws the 9 slices to the canvas\n     */\n    _drawImage(ex, x, y) {\n        if (this._imgSource.isLoaded()) {\n            // Top left, no stretching\n            this._drawTile(ex, this._canvasA, new Vector(this._config.sourceConfig.leftMargin, this._config.sourceConfig.topMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch);\n            // Top, middle, horizontal stretching\n            this._drawTile(ex, this._canvasB, new Vector(this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin, this._config.sourceConfig.topMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, this._config.sourceConfig.leftMargin, 0);\n            // Top right, no stretching\n            this._drawTile(ex, this._canvasC, new Vector(this._config.sourceConfig.rightMargin, this._config.sourceConfig.topMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, this._config.width - this._config.sourceConfig.rightMargin, 0);\n            // middle, left, vertical stretching\n            this._drawTile(ex, this._canvasD, new Vector(this._config.sourceConfig.leftMargin, this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, 0, this._config.sourceConfig.topMargin);\n            // center, both stretching\n            if (this._config.destinationConfig.drawCenter) {\n                this._drawTile(ex, this._canvasE, new Vector(this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin, this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, this._config.sourceConfig.leftMargin, this._config.sourceConfig.topMargin);\n            }\n            // middle, right, vertical stretching\n            this._drawTile(ex, this._canvasF, new Vector(this._config.sourceConfig.rightMargin, this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, this._config.width - this._config.sourceConfig.rightMargin, this._config.sourceConfig.topMargin);\n            // bottom left, no stretching\n            this._drawTile(ex, this._canvasG, new Vector(this._config.sourceConfig.leftMargin, this._config.sourceConfig.bottomMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, 0, this._config.height - this._config.sourceConfig.bottomMargin);\n            // bottom middle, horizontal stretching\n            this._drawTile(ex, this._canvasH, new Vector(this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin, this._config.sourceConfig.bottomMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, this._config.sourceConfig.leftMargin, this._config.height - this._config.sourceConfig.bottomMargin);\n            // bottom right, no stretching\n            this._drawTile(ex, this._canvasI, new Vector(this._config.sourceConfig.rightMargin, this._config.sourceConfig.bottomMargin), this._config.destinationConfig.horizontalStretch, this._config.destinationConfig.verticalStretch, this._config.width - this._config.sourceConfig.rightMargin, this._config.height - this._config.sourceConfig.bottomMargin);\n        }\n        else {\n            this._logger.warnOnce(`NineSlice ImageSource ${this._imgSource.path}` +\n                ` is not yet loaded and won't be drawn. Please call .load() or include in a Loader.\\n\\n` +\n                `Read https://excaliburjs.com/docs/imagesource for more information.`);\n        }\n    }\n    /**\n     * Slices the source sprite into the 9 slice canvases internally\n     */\n    _initialize() {\n        this._sourceSprite = this._imgSource.image;\n        // top left slice\n        this._canvasA.width = this._config.sourceConfig.leftMargin;\n        this._canvasA.height = this._config.sourceConfig.topMargin;\n        const aCtx = this._canvasA.getContext('2d');\n        aCtx === null || aCtx === void 0 ? void 0 : aCtx.drawImage(this._sourceSprite, 0, 0, this._canvasA.width, this._canvasA.height, 0, 0, this._canvasA.width, this._canvasA.height);\n        // top slice\n        this._canvasB.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\n        this._canvasB.height = this._config.sourceConfig.topMargin;\n        const bCtx = this._canvasB.getContext('2d');\n        bCtx === null || bCtx === void 0 ? void 0 : bCtx.drawImage(this._sourceSprite, this._config.sourceConfig.leftMargin, 0, this._canvasB.width, this._canvasB.height, 0, 0, this._canvasB.width, this._canvasB.height);\n        // top right slice\n        this._canvasC.width = this._config.sourceConfig.rightMargin;\n        this._canvasC.height = this._config.sourceConfig.topMargin;\n        const cCtx = this._canvasC.getContext('2d');\n        cCtx === null || cCtx === void 0 ? void 0 : cCtx.drawImage(this._sourceSprite, this._sourceSprite.width - this._config.sourceConfig.rightMargin, 0, this._canvasC.width, this._canvasC.height, 0, 0, this._canvasC.width, this._canvasC.height);\n        // middle left slice\n        this._canvasD.width = this._config.sourceConfig.leftMargin;\n        this._canvasD.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\n        const dCtx = this._canvasD.getContext('2d');\n        dCtx === null || dCtx === void 0 ? void 0 : dCtx.drawImage(this._sourceSprite, 0, this._config.sourceConfig.topMargin, this._canvasD.width, this._canvasD.height, 0, 0, this._canvasD.width, this._canvasD.height);\n        // middle slice\n        this._canvasE.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\n        this._canvasE.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\n        const eCtx = this._canvasE.getContext('2d');\n        eCtx === null || eCtx === void 0 ? void 0 : eCtx.drawImage(this._sourceSprite, this._config.sourceConfig.leftMargin, this._config.sourceConfig.topMargin, this._canvasE.width, this._canvasE.height, 0, 0, this._canvasE.width, this._canvasE.height);\n        // middle right slice\n        this._canvasF.width = this._config.sourceConfig.rightMargin;\n        this._canvasF.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\n        const fCtx = this._canvasF.getContext('2d');\n        fCtx === null || fCtx === void 0 ? void 0 : fCtx.drawImage(this._sourceSprite, this._config.sourceConfig.width - this._config.sourceConfig.rightMargin, this._config.sourceConfig.topMargin, this._canvasF.width, this._canvasF.height, 0, 0, this._canvasF.width, this._canvasF.height);\n        // bottom left slice\n        this._canvasG.width = this._config.sourceConfig.leftMargin;\n        this._canvasG.height = this._config.sourceConfig.bottomMargin;\n        const gCtx = this._canvasG.getContext('2d');\n        gCtx === null || gCtx === void 0 ? void 0 : gCtx.drawImage(this._sourceSprite, 0, this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin, this._canvasG.width, this._canvasG.height, 0, 0, this._canvasG.width, this._canvasG.height);\n        // bottom slice\n        this._canvasH.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\n        this._canvasH.height = this._config.sourceConfig.bottomMargin;\n        const hCtx = this._canvasH.getContext('2d');\n        hCtx === null || hCtx === void 0 ? void 0 : hCtx.drawImage(this._sourceSprite, this._config.sourceConfig.leftMargin, this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin, this._canvasH.width, this._canvasH.height, 0, 0, this._canvasH.width, this._canvasH.height);\n        // bottom right slice\n        this._canvasI.width = this._config.sourceConfig.rightMargin;\n        this._canvasI.height = this._config.sourceConfig.bottomMargin;\n        const iCtx = this._canvasI.getContext('2d');\n        iCtx === null || iCtx === void 0 ? void 0 : iCtx.drawImage(this._sourceSprite, this._sourceSprite.width - this._config.sourceConfig.rightMargin, this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin, this._canvasI.width, this._canvasI.height, 0, 0, this._canvasI.width, this._canvasI.height);\n    }\n    /**\n     * Clones the 9 slice\n     */\n    clone() {\n        return new NineSlice(this._config);\n    }\n    /**\n     * Returns the number of tiles\n     */\n    _getNumberOfTiles(tileSize, destinationSize, strategy) {\n        switch (strategy) {\n            case NineSliceStretch.Stretch:\n                return 1;\n            case NineSliceStretch.Tile:\n                return Math.ceil(destinationSize / tileSize);\n            case NineSliceStretch.TileFit:\n                return Math.ceil(destinationSize / tileSize);\n        }\n    }\n    /**\n     * Returns the position and size of the tile\n     */\n    _calculateParams(tileNum, numTiles, tileSize, destinationSize, strategy) {\n        switch (strategy) {\n            case NineSliceStretch.Stretch:\n                return {\n                    tempPosition: 0,\n                    tempSize: destinationSize\n                };\n            case NineSliceStretch.Tile:\n                // if last tile, adjust size\n                if (tileNum === numTiles - 1) {\n                    //last tile\n                    return {\n                        tempPosition: tileNum * tileSize,\n                        tempSize: tileSize - (numTiles * tileSize - destinationSize)\n                    };\n                }\n                else {\n                    return {\n                        tempPosition: tileNum * tileSize,\n                        tempSize: tileSize\n                    };\n                }\n            case NineSliceStretch.TileFit:\n                const reducedTileSize = destinationSize / numTiles;\n                const position = tileNum * reducedTileSize;\n                return {\n                    tempPosition: position,\n                    tempSize: reducedTileSize\n                };\n        }\n    }\n}\n\n;// ./Graphics/TiledSprite.ts\n\n\n\n\nclass TiledSprite extends Sprite {\n    constructor(options) {\n        super({\n            image: options.image,\n            sourceView: options.sourceView,\n            destSize: { width: options.width, height: options.height }\n        });\n        this._ready = new Future();\n        this.ready = this._ready.promise;\n        this._options = options;\n        if (this.image.isLoaded()) {\n            this._applyTiling();\n        }\n        else {\n            this.image.ready.then(() => this._applyTiling());\n        }\n    }\n    static fromSprite(sprite, options) {\n        return new TiledSprite({\n            width: sprite.width,\n            height: sprite.height,\n            ...options,\n            image: sprite.image\n        });\n    }\n    _applyTiling() {\n        const { width, height, filtering, wrapping } = { ...this._options };\n        const spriteCanvas = document.createElement('canvas');\n        spriteCanvas.width = this.sourceView.width;\n        spriteCanvas.height = this.sourceView.height;\n        const spriteCtx = spriteCanvas.getContext('2d');\n        // prettier-ignore\n        spriteCtx.drawImage(this.image.image, this.sourceView.x, this.sourceView.y, this.sourceView.width, this.sourceView.height, 0, 0, this.sourceView.width, this.sourceView.height);\n        // prettier-ignore\n        const tiledImageSource = ImageSource.fromHtmlCanvasElement(spriteCanvas, {\n            wrapping: wrapping !== null && wrapping !== void 0 ? wrapping : ImageWrapping.Repeat,\n            filtering\n        });\n        if (width) {\n            this.destSize.width = width;\n            this.sourceView.width = width;\n        }\n        if (height) {\n            this.destSize.height = height;\n            this.sourceView.height = height;\n        }\n        this.sourceView.x = 0;\n        this.sourceView.y = 0;\n        this.image = tiledImageSource;\n        // this._ready.resolve();\n        this.image.ready.then(() => this._ready.resolve());\n    }\n}\n\n;// ./Graphics/TiledAnimation.ts\n\n\n\n\n\nclass TiledAnimation extends Animation {\n    constructor(options) {\n        super({\n            ...options,\n            frames: options.animation.frames.slice(),\n            strategy: options.animation.strategy,\n            frameDuration: options.animation.frameDuration,\n            speed: options.animation.speed,\n            reverse: options.animation.isReversed\n        });\n        this._ready = new Future();\n        this.ready = this._ready.promise;\n        this._tiledWidth = 0;\n        this._tiledHeight = 0;\n        this._sourceView = {};\n        this._sourceView = { ...options.sourceView };\n        this._tiledWidth = options.width;\n        this._tiledHeight = options.height;\n        const promises = [];\n        for (let i = 0; i < this.frames.length; i++) {\n            const graphic = this.frames[i].graphic;\n            if (graphic && graphic instanceof Sprite) {\n                const tiledSprite = new TiledSprite({\n                    image: graphic.image,\n                    width: options.width,\n                    height: options.height,\n                    sourceView: { ...graphic.sourceView },\n                    wrapping: options.wrapping,\n                    filtering: options.filtering\n                });\n                this.frames[i].graphic = tiledSprite;\n                // There is a new calc'd sourceView when ready\n                tiledSprite.ready.then(() => {\n                    tiledSprite.sourceView = { ...tiledSprite.sourceView, ...this._sourceView };\n                });\n                promises.push(tiledSprite.ready);\n            }\n        }\n        Promise.allSettled(promises).then(() => this._ready.resolve());\n    }\n    static fromAnimation(animation, options) {\n        return new TiledAnimation({\n            width: animation.width,\n            height: animation.height,\n            ...options,\n            animation\n        });\n    }\n    _updateSourceView() {\n        for (let i = 0; i < this.frames.length; i++) {\n            const graphic = this.frames[i].graphic;\n            if (graphic && graphic instanceof Sprite) {\n                graphic.sourceView = { ...graphic.sourceView, ...this._sourceView };\n            }\n        }\n    }\n    get sourceView() {\n        return watch(this._sourceView, () => this._updateSourceView());\n    }\n    set sourceView(sourceView) {\n        this._sourceView = watch(sourceView, () => this._updateSourceView());\n        this._updateSourceView();\n    }\n    _updateWidthHeight() {\n        for (let i = 0; i < this.frames.length; i++) {\n            const graphic = this.frames[i].graphic;\n            if (graphic && graphic instanceof Sprite) {\n                graphic.sourceView.height = this._tiledHeight || graphic.height;\n                graphic.destSize.height = this._tiledHeight || graphic.height;\n                graphic.sourceView.width = this._tiledWidth || graphic.width;\n                graphic.destSize.width = this._tiledWidth || graphic.width;\n            }\n        }\n    }\n    get width() {\n        return this._tiledWidth;\n    }\n    get height() {\n        return this._tiledHeight;\n    }\n    set width(width) {\n        this._tiledWidth = width;\n        this._updateWidthHeight();\n    }\n    set height(height) {\n        this._tiledHeight = height;\n        this._updateWidthHeight();\n    }\n}\n\n;// ./Graphics/index.ts\n// Graphics\n\n\n\n\n\n\n\n// Graphics ECS\n\n\n\n\n\n// Raster graphics\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// TODO DELETEME\n\n\n// Post Processor\n\n\n\n\n\n\n\n// Rendering\n\n\n\n\n\n\n// Debug\n\n// Util\n\n\n\n;// ./Util/Index.ts\n\n\n\n\n\n\n\n;// ./Util/Decorators.ts\n\n\nconst maxMessages = 5;\nconst obsoleteMessage = {};\nconst resetObsoleteCounter = () => {\n    for (const message in obsoleteMessage) {\n        obsoleteMessage[message] = 0;\n    }\n};\nconst logMessage = (message, options) => {\n    const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\n    if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\n        Logger.getInstance().warn(message);\n        // tslint:disable-next-line: no-console\n        if (console.trace && options.showStackTrace) {\n            // tslint:disable-next-line: no-console\n            console.trace();\n        }\n    }\n    obsoleteMessage[message]++;\n};\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nfunction obsolete(options) {\n    options = {\n        message: 'This feature will be removed in future versions of Excalibur.',\n        alternateMethod: null,\n        showStackTrace: false,\n        ...options\n    };\n    return function (target, property, descriptor) {\n        if (descriptor &&\n            !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')) {\n            throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n        }\n        const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n        const message = `${methodSignature} is marked obsolete: ${options.message}` +\n            (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n        if (!obsoleteMessage[message]) {\n            obsoleteMessage[message] = 0;\n        }\n        // If descriptor is null it is a class\n        const method = descriptor ? { ...descriptor } : target;\n        if (!descriptor) {\n            // with es2015 classes we need to change our decoration tactic\n            class DecoratedClass extends method {\n                constructor(...args) {\n                    logMessage(message, options);\n                    super(...args);\n                }\n            }\n            return DecoratedClass;\n        }\n        if (descriptor && descriptor.value) {\n            method.value = function () {\n                logMessage(message, options);\n                return descriptor.value.apply(this, arguments);\n            };\n            return method;\n        }\n        if (descriptor && descriptor.get) {\n            method.get = function () {\n                logMessage(message, options);\n                return descriptor.get.apply(this, arguments);\n            };\n        }\n        if (descriptor && descriptor.set) {\n            method.set = function () {\n                logMessage(message, options);\n                return descriptor.set.apply(this, arguments);\n            };\n        }\n        return method;\n    };\n}\n\n;// ./Util/Semaphore.ts\n\nclass AsyncWaitQueue {\n    constructor() {\n        // Code from StephenCleary https://gist.github.com/StephenCleary/ba50b2da419c03b9cba1d20cb4654d5e\n        this._queue = [];\n    }\n    get length() {\n        return this._queue.length;\n    }\n    enqueue() {\n        const future = new Future();\n        this._queue.push(future);\n        return future.promise;\n    }\n    dequeue(value) {\n        const future = this._queue.shift();\n        future.resolve(value);\n    }\n}\n/**\n * Semaphore allows you to limit the amount of async calls happening between `enter()` and `exit()`\n *\n * This can be useful when limiting the number of http calls, browser api calls, etc either for performance or to work\n * around browser limitations like max Image.decode() calls in chromium being 256.\n */\nclass Semaphore {\n    constructor(_count) {\n        this._count = _count;\n        this._waitQueue = new AsyncWaitQueue();\n    }\n    get count() {\n        return this._count;\n    }\n    get waiting() {\n        return this._waitQueue.length;\n    }\n    // eslint-disable-next-line require-await\n    async enter() {\n        if (this._count !== 0) {\n            this._count--;\n            return Promise.resolve();\n        }\n        return this._waitQueue.enqueue();\n    }\n    exit(count = 1) {\n        if (count === 0) {\n            return;\n        }\n        while (count !== 0 && this._waitQueue.length !== 0) {\n            this._waitQueue.dequeue(null);\n            count--;\n        }\n        this._count += count;\n    }\n}\n\n;// ./index.ts\n/**\n * The current Excalibur version string\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\n */\nconst EX_VERSION = \"0.30.0-alpha.1295+8faedcb\";\n\npolyfill();\n// This file is used as the bundle entry point and exports everything\n// that will be exposed as the `ex` global variable.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// ex.Events namespace\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// ex.Util namespaces\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// ex.Deprecated\n// import * as deprecated from './Deprecated';\n// export { deprecated as Deprecated };\n// export * from './Deprecated';\n\nvar __webpack_exports__ActionCompleteEvent = __webpack_exports__.eKr;\nvar __webpack_exports__ActionContext = __webpack_exports__.yVm;\nvar __webpack_exports__ActionQueue = __webpack_exports__.a7j;\nvar __webpack_exports__ActionSequence = __webpack_exports__.U_w;\nvar __webpack_exports__ActionStartEvent = __webpack_exports__.JF2;\nvar __webpack_exports__ActionsComponent = __webpack_exports__.htg;\nvar __webpack_exports__ActionsSystem = __webpack_exports__.HXL;\nvar __webpack_exports__ActivateEvent = __webpack_exports__.mcg;\nvar __webpack_exports__Actor = __webpack_exports__.Agj;\nvar __webpack_exports__ActorEvents = __webpack_exports__.J3_;\nvar __webpack_exports__AddEvent = __webpack_exports__.Wgv;\nvar __webpack_exports__AddedComponent = __webpack_exports__.u6S;\nvar __webpack_exports__AffineMatrix = __webpack_exports__.x7M;\nvar __webpack_exports__Animation = __webpack_exports__.X55;\nvar __webpack_exports__AnimationDirection = __webpack_exports__.m3M;\nvar __webpack_exports__AnimationEvents = __webpack_exports__.aE5;\nvar __webpack_exports__AnimationStrategy = __webpack_exports__.YJU;\nvar __webpack_exports__ArcadeSolver = __webpack_exports__.eZi;\nvar __webpack_exports__AudioContextFactory = __webpack_exports__.GNv;\nvar __webpack_exports__Axes = __webpack_exports__.Y56;\nvar __webpack_exports__Axis = __webpack_exports__._0v;\nvar __webpack_exports__BaseAlign = __webpack_exports__.vhs;\nvar __webpack_exports__BezierCurve = __webpack_exports__.vrQ;\nvar __webpack_exports__Blink = __webpack_exports__.Z8b;\nvar __webpack_exports__BodyComponent = __webpack_exports__.Yfw;\nvar __webpack_exports__BoundingBox = __webpack_exports__.IcQ;\nvar __webpack_exports__BrowserComponent = __webpack_exports__.kgJ;\nvar __webpack_exports__BrowserEvents = __webpack_exports__.GTT;\nvar __webpack_exports__Buttons = __webpack_exports__.ypY;\nvar __webpack_exports__Camera = __webpack_exports__.i7d;\nvar __webpack_exports__CameraEvents = __webpack_exports__.fQ3;\nvar __webpack_exports__Canvas = __webpack_exports__.HlI;\nvar __webpack_exports__Circle = __webpack_exports__.jlt;\nvar __webpack_exports__CircleCollider = __webpack_exports__.VQc;\nvar __webpack_exports__Clock = __webpack_exports__.zD7;\nvar __webpack_exports__ClosestLineJumpTable = __webpack_exports__.AUF;\nvar __webpack_exports__Collider = __webpack_exports__.JoF;\nvar __webpack_exports__ColliderComponent = __webpack_exports__.MlA;\nvar __webpack_exports__CollisionContact = __webpack_exports__.PZh;\nvar __webpack_exports__CollisionEndEvent = __webpack_exports__.qA;\nvar __webpack_exports__CollisionGroup = __webpack_exports__.CrD;\nvar __webpack_exports__CollisionGroupManager = __webpack_exports__.dQK;\nvar __webpack_exports__CollisionJumpTable = __webpack_exports__.D3r;\nvar __webpack_exports__CollisionPostSolveEvent = __webpack_exports__.Qpo;\nvar __webpack_exports__CollisionPreSolveEvent = __webpack_exports__.D9n;\nvar __webpack_exports__CollisionStartEvent = __webpack_exports__.b6v;\nvar __webpack_exports__CollisionSystem = __webpack_exports__.mvh;\nvar __webpack_exports__CollisionType = __webpack_exports__.Bpo;\nvar __webpack_exports__Color = __webpack_exports__.Q1f;\nvar __webpack_exports__ColorBlindFlags = __webpack_exports__.IKv;\nvar __webpack_exports__ColorBlindnessMode = __webpack_exports__.fcV;\nvar __webpack_exports__ColorBlindnessPostProcessor = __webpack_exports__.Glf;\nvar __webpack_exports__Component = __webpack_exports__.uAl;\nvar __webpack_exports__CompositeCollider = __webpack_exports__.ElT;\nvar __webpack_exports__ConsoleAppender = __webpack_exports__.Z8r;\nvar __webpack_exports__ContactConstraintPoint = __webpack_exports__.QSL;\nvar __webpack_exports__ContactEndEvent = __webpack_exports__.sPV;\nvar __webpack_exports__ContactSolveBias = __webpack_exports__.nAn;\nvar __webpack_exports__ContactStartEvent = __webpack_exports__.zCU;\nvar __webpack_exports__CoordPlane = __webpack_exports__.QrV;\nvar __webpack_exports__CrossFade = __webpack_exports__.fF9;\nvar __webpack_exports__CurveBy = __webpack_exports__.Jqv;\nvar __webpack_exports__CurveTo = __webpack_exports__.d_u;\nvar __webpack_exports__DeactivateEvent = __webpack_exports__.xI8;\nvar __webpack_exports__Debug = __webpack_exports__.yar;\nvar __webpack_exports__DebugConfig = __webpack_exports__.SP7;\nvar __webpack_exports__DebugGraphicsComponent = __webpack_exports__.oRy;\nvar __webpack_exports__DebugSystem = __webpack_exports__.f5X;\nvar __webpack_exports__DebugText = __webpack_exports__.V1c;\nvar __webpack_exports__DefaultAntialiasOptions = __webpack_exports__.Mlx;\nvar __webpack_exports__DefaultGarbageCollectionOptions = __webpack_exports__.ZiM;\nvar __webpack_exports__DefaultLoader = __webpack_exports__.ZCo;\nvar __webpack_exports__DefaultPhysicsConfig = __webpack_exports__.Vy3;\nvar __webpack_exports__DefaultPixelArtOptions = __webpack_exports__.J5p;\nvar __webpack_exports__DegreeOfFreedom = __webpack_exports__.mL_;\nvar __webpack_exports__Delay = __webpack_exports__.Guw;\nvar __webpack_exports__Detector = __webpack_exports__.N5j;\nvar __webpack_exports__Die = __webpack_exports__.pgY;\nvar __webpack_exports__Direction = __webpack_exports__.OP3;\nvar __webpack_exports__Director = __webpack_exports__.rl5;\nvar __webpack_exports__DirectorEvents = __webpack_exports__.eod;\nvar __webpack_exports__DisplayMode = __webpack_exports__.q5Z;\nvar __webpack_exports__DynamicTree = __webpack_exports__.YUC;\nvar __webpack_exports__DynamicTreeCollisionProcessor = __webpack_exports__.saR;\nvar __webpack_exports__EX_VERSION = __webpack_exports__.hvr;\nvar __webpack_exports__EaseBy = __webpack_exports__.Qol;\nvar __webpack_exports__EaseTo = __webpack_exports__.Wf4;\nvar __webpack_exports__EasingFunctions = __webpack_exports__.JCs;\nvar __webpack_exports__EdgeCollider = __webpack_exports__.gJV;\nvar __webpack_exports__ElasticToActorStrategy = __webpack_exports__.fWD;\nvar __webpack_exports__EmitterType = __webpack_exports__.Va_;\nvar __webpack_exports__Engine = __webpack_exports__.N$8;\nvar __webpack_exports__EngineEvents = __webpack_exports__._jQ;\nvar __webpack_exports__EnterTriggerEvent = __webpack_exports__.rxj;\nvar __webpack_exports__EnterViewPortEvent = __webpack_exports__.rhv;\nvar __webpack_exports__Entity = __webpack_exports__.wCu;\nvar __webpack_exports__EntityEvents = __webpack_exports__.HAp;\nvar __webpack_exports__EntityManager = __webpack_exports__.Zy1;\nvar __webpack_exports__EventEmitter = __webpack_exports__.bkB;\nvar __webpack_exports__EventTypes = __webpack_exports__.wfL;\nvar __webpack_exports__Events = __webpack_exports__.sVA;\nvar __webpack_exports__ExResponse = __webpack_exports__.$Gs;\nvar __webpack_exports__ExcaliburGraphicsContext2DCanvas = __webpack_exports__.CJ0;\nvar __webpack_exports__ExcaliburGraphicsContextWebGL = __webpack_exports__.NWh;\nvar __webpack_exports__ExitTriggerEvent = __webpack_exports__.tWi;\nvar __webpack_exports__ExitViewPortEvent = __webpack_exports__.xAj;\nvar __webpack_exports__Fade = __webpack_exports__.zWh;\nvar __webpack_exports__FadeInOut = __webpack_exports__.i_4;\nvar __webpack_exports__Flags = __webpack_exports__.iIx;\nvar __webpack_exports__Flash = __webpack_exports__.Hxo;\nvar __webpack_exports__Follow = __webpack_exports__.c9e;\nvar __webpack_exports__Font = __webpack_exports__.KQV;\nvar __webpack_exports__FontCache = __webpack_exports__.weH;\nvar __webpack_exports__FontSource = __webpack_exports__.jXp;\nvar __webpack_exports__FontStyle = __webpack_exports__.zzY;\nvar __webpack_exports__FontUnit = __webpack_exports__.yRQ;\nvar __webpack_exports__FpsSampler = __webpack_exports__.MtE;\nvar __webpack_exports__FrameStats = __webpack_exports__.rPj;\nvar __webpack_exports__Future = __webpack_exports__.KLc;\nvar __webpack_exports__GameEvent = __webpack_exports__.Fir;\nvar __webpack_exports__GameStartEvent = __webpack_exports__.V5f;\nvar __webpack_exports__GameStopEvent = __webpack_exports__.Xj7;\nvar __webpack_exports__Gamepad = __webpack_exports__.Wud;\nvar __webpack_exports__GamepadAxisEvent = __webpack_exports__.FVg;\nvar __webpack_exports__GamepadButtonEvent = __webpack_exports__.g5Y;\nvar __webpack_exports__GamepadConnectEvent = __webpack_exports__.YQB;\nvar __webpack_exports__GamepadDisconnectEvent = __webpack_exports__.KPb;\nvar __webpack_exports__Gamepads = __webpack_exports__.nHK;\nvar __webpack_exports__GarbageCollector = __webpack_exports__.Jrb;\nvar __webpack_exports__Gif = __webpack_exports__.TX_;\nvar __webpack_exports__GifParser = __webpack_exports__.Olt;\nvar __webpack_exports__GlobalCoordinates = __webpack_exports__.r3n;\nvar __webpack_exports__GpuParticleEmitter = __webpack_exports__.Fvk;\nvar __webpack_exports__GpuParticleRenderer = __webpack_exports__.gpR;\nvar __webpack_exports__Graphic = __webpack_exports__.vYh;\nvar __webpack_exports__GraphicsComponent = __webpack_exports__.hnk;\nvar __webpack_exports__GraphicsGroup = __webpack_exports__.D2R;\nvar __webpack_exports__GraphicsSystem = __webpack_exports__.n1o;\nvar __webpack_exports__HashColliderProxy = __webpack_exports__.h9O;\nvar __webpack_exports__HashGridCell = __webpack_exports__.X5j;\nvar __webpack_exports__HashGridProxy = __webpack_exports__.p3P;\nvar __webpack_exports__HiddenEvent = __webpack_exports__.RLG;\nvar __webpack_exports__HorizontalFirst = __webpack_exports__.fBU;\nvar __webpack_exports__ImageFiltering = __webpack_exports__.Adb;\nvar __webpack_exports__ImageSource = __webpack_exports__.bEs;\nvar __webpack_exports__ImageSourceAttributeConstants = __webpack_exports__.wCy;\nvar __webpack_exports__ImageWrapping = __webpack_exports__.CbD;\nvar __webpack_exports__InitializeEvent = __webpack_exports__.x_C;\nvar __webpack_exports__InputHost = __webpack_exports__.pGf;\nvar __webpack_exports__InputMapper = __webpack_exports__.ibQ;\nvar __webpack_exports__IsometricEntityComponent = __webpack_exports__.shR;\nvar __webpack_exports__IsometricEntitySystem = __webpack_exports__.Yjk;\nvar __webpack_exports__IsometricMap = __webpack_exports__._u1;\nvar __webpack_exports__IsometricTile = __webpack_exports__.OBI;\nvar __webpack_exports__KeyEvent = __webpack_exports__.klh;\nvar __webpack_exports__Keyboard = __webpack_exports__.s3S;\nvar __webpack_exports__Keys = __webpack_exports__.D$R;\nvar __webpack_exports__KillEvent = __webpack_exports__.xth;\nvar __webpack_exports__Label = __webpack_exports__.JU7;\nvar __webpack_exports__LimitCameraBoundsStrategy = __webpack_exports__.h9x;\nvar __webpack_exports__Line = __webpack_exports__.N1A;\nvar __webpack_exports__LineSegment = __webpack_exports__.e_k;\nvar __webpack_exports__Loader = __webpack_exports__.aHM;\nvar __webpack_exports__LoaderEvents = __webpack_exports__.tlv;\nvar __webpack_exports__LockCameraToActorAxisStrategy = __webpack_exports__.Vi9;\nvar __webpack_exports__LockCameraToActorStrategy = __webpack_exports__.ieR;\nvar __webpack_exports__LogLevel = __webpack_exports__.$bb;\nvar __webpack_exports__Logger = __webpack_exports__.VyI;\nvar __webpack_exports__Material = __webpack_exports__.imn;\nvar __webpack_exports__Matrix = __webpack_exports__.uqu;\nvar __webpack_exports__MatrixLocations = __webpack_exports__.QnL;\nvar __webpack_exports__MediaEvent = __webpack_exports__.vnc;\nvar __webpack_exports__Meet = __webpack_exports__.wk_;\nvar __webpack_exports__MotionComponent = __webpack_exports__.GH0;\nvar __webpack_exports__MotionSystem = __webpack_exports__._1r;\nvar __webpack_exports__MoveBy = __webpack_exports__.l0X;\nvar __webpack_exports__MoveByWithOptions = __webpack_exports__.bT;\nvar __webpack_exports__MoveTo = __webpack_exports__.HHX;\nvar __webpack_exports__MoveToWithOptions = __webpack_exports__.jtW;\nvar __webpack_exports__NativePointerButton = __webpack_exports__.tjk;\nvar __webpack_exports__NativeSoundEvent = __webpack_exports__.rWe;\nvar __webpack_exports__NativeSoundProcessedEvent = __webpack_exports__.j9l;\nvar __webpack_exports__NineSlice = __webpack_exports__.l0$;\nvar __webpack_exports__NineSliceStretch = __webpack_exports__.sGJ;\nvar __webpack_exports__None = __webpack_exports__.NVp;\nvar __webpack_exports__Observable = __webpack_exports__.cPK;\nvar __webpack_exports__OffscreenSystem = __webpack_exports__.XoL;\nvar __webpack_exports__Pair = __webpack_exports__.RmF;\nvar __webpack_exports__ParallaxComponent = __webpack_exports__.DXI;\nvar __webpack_exports__ParallelActions = __webpack_exports__.tCD;\nvar __webpack_exports__Particle = __webpack_exports__.J3D;\nvar __webpack_exports__ParticleEmitter = __webpack_exports__.vCJ;\nvar __webpack_exports__ParticleRenderer = __webpack_exports__.e6k;\nvar __webpack_exports__ParticleTransform = __webpack_exports__.f9l;\nvar __webpack_exports__PhysicsStats = __webpack_exports__.v9m;\nvar __webpack_exports__PhysicsWorld = __webpack_exports__.yRJ;\nvar __webpack_exports__PointerAbstraction = __webpack_exports__.EU6;\nvar __webpack_exports__PointerButton = __webpack_exports__.m3O;\nvar __webpack_exports__PointerComponent = __webpack_exports__.Ryz;\nvar __webpack_exports__PointerEvent = __webpack_exports__.OxP;\nvar __webpack_exports__PointerEventReceiver = __webpack_exports__.LEs;\nvar __webpack_exports__PointerScope = __webpack_exports__.Ec;\nvar __webpack_exports__PointerSystem = __webpack_exports__.Pi5;\nvar __webpack_exports__PointerType = __webpack_exports__.gmH;\nvar __webpack_exports__Polygon = __webpack_exports__.tS;\nvar __webpack_exports__PolygonCollider = __webpack_exports__.XxX;\nvar __webpack_exports__Pool = __webpack_exports__.bCz;\nvar __webpack_exports__PostCollisionEvent = __webpack_exports__.nYS;\nvar __webpack_exports__PostDebugDrawEvent = __webpack_exports__.yiT;\nvar __webpack_exports__PostDrawEvent = __webpack_exports__.NHl;\nvar __webpack_exports__PostFrameEvent = __webpack_exports__.mO8;\nvar __webpack_exports__PostKillEvent = __webpack_exports__.PXI;\nvar __webpack_exports__PostTransformDrawEvent = __webpack_exports__.bn5;\nvar __webpack_exports__PostUpdateEvent = __webpack_exports__.Ywr;\nvar __webpack_exports__PreCollisionEvent = __webpack_exports__.cMd;\nvar __webpack_exports__PreDebugDrawEvent = __webpack_exports__.Bs6;\nvar __webpack_exports__PreDrawEvent = __webpack_exports__.G0k;\nvar __webpack_exports__PreFrameEvent = __webpack_exports__.pyn;\nvar __webpack_exports__PreKillEvent = __webpack_exports__.QeM;\nvar __webpack_exports__PreLoadEvent = __webpack_exports__.aPX;\nvar __webpack_exports__PreTransformDrawEvent = __webpack_exports__.ITP;\nvar __webpack_exports__PreUpdateEvent = __webpack_exports__.BY0;\nvar __webpack_exports__Projection = __webpack_exports__.MFw;\nvar __webpack_exports__QuadIndexBuffer = __webpack_exports__.sBn;\nvar __webpack_exports__QuadTree = __webpack_exports__.S3L;\nvar __webpack_exports__Query = __webpack_exports__.XKQ;\nvar __webpack_exports__QueryManager = __webpack_exports__.ESI;\nvar __webpack_exports__RadiusAroundActorStrategy = __webpack_exports__.uxz;\nvar __webpack_exports__Random = __webpack_exports__.o8N;\nvar __webpack_exports__Raster = __webpack_exports__.u_r;\nvar __webpack_exports__Ray = __webpack_exports__.RlV;\nvar __webpack_exports__RealisticSolver = __webpack_exports__.gVA;\nvar __webpack_exports__Rectangle = __webpack_exports__.M_G;\nvar __webpack_exports__RemoveEvent = __webpack_exports__.BpG;\nvar __webpack_exports__RemovedComponent = __webpack_exports__.GRB;\nvar __webpack_exports__Repeat = __webpack_exports__.kM6;\nvar __webpack_exports__RepeatForever = __webpack_exports__.dO8;\nvar __webpack_exports__Resolution = __webpack_exports__.jgM;\nvar __webpack_exports__Resource = __webpack_exports__.FWq;\nvar __webpack_exports__ResourceEvents = __webpack_exports__.s3j;\nvar __webpack_exports__RotateBy = __webpack_exports__.hlw;\nvar __webpack_exports__RotateByWithOptions = __webpack_exports__.L0q;\nvar __webpack_exports__RotateTo = __webpack_exports__.B7e;\nvar __webpack_exports__RotateToWithOptions = __webpack_exports__.PGN;\nvar __webpack_exports__RotationType = __webpack_exports__.H_X;\nvar __webpack_exports__ScaleBy = __webpack_exports__.S_d;\nvar __webpack_exports__ScaleByWithOptions = __webpack_exports__._Tq;\nvar __webpack_exports__ScaleTo = __webpack_exports__.U7E;\nvar __webpack_exports__ScaleToWithOptions = __webpack_exports__.IOH;\nvar __webpack_exports__Scene = __webpack_exports__.Z58;\nvar __webpack_exports__SceneEvents = __webpack_exports__.yh2;\nvar __webpack_exports__Screen = __webpack_exports__.ff$;\nvar __webpack_exports__ScreenAppender = __webpack_exports__.cWi;\nvar __webpack_exports__ScreenElement = __webpack_exports__.NBt;\nvar __webpack_exports__ScreenEvents = __webpack_exports__.oNz;\nvar __webpack_exports__ScreenShader = __webpack_exports__.QlU;\nvar __webpack_exports__ScrollPreventionMode = __webpack_exports__.Xey;\nvar __webpack_exports__Semaphore = __webpack_exports__.jft;\nvar __webpack_exports__SeparatingAxis = __webpack_exports__._r8;\nvar __webpack_exports__SeparationInfo = __webpack_exports__.bTC;\nvar __webpack_exports__Shader = __webpack_exports__.Mtr;\nvar __webpack_exports__Shape = __webpack_exports__.ypk;\nvar __webpack_exports__Side = __webpack_exports__.mnM;\nvar __webpack_exports__Slide = __webpack_exports__.q7S;\nvar __webpack_exports__SolverStrategy = __webpack_exports__.bAZ;\nvar __webpack_exports__Sound = __webpack_exports__.ABN;\nvar __webpack_exports__SoundEvents = __webpack_exports__.VK6;\nvar __webpack_exports__SparseHashGrid = __webpack_exports__.Hj2;\nvar __webpack_exports__SparseHashGridCollisionProcessor = __webpack_exports__.Df8;\nvar __webpack_exports__SpatialPartitionStrategy = __webpack_exports__.oOx;\nvar __webpack_exports__Sprite = __webpack_exports__.kxk;\nvar __webpack_exports__SpriteFont = __webpack_exports__.DT1;\nvar __webpack_exports__SpriteSheet = __webpack_exports__.FLG;\nvar __webpack_exports__StandardClock = __webpack_exports__.qN_;\nvar __webpack_exports__StateMachine = __webpack_exports__.Z37;\nvar __webpack_exports__StrategyContainer = __webpack_exports__.FtL;\nvar __webpack_exports__Stream = __webpack_exports__.Z6X;\nvar __webpack_exports__System = __webpack_exports__.iQT;\nvar __webpack_exports__SystemManager = __webpack_exports__.ziO;\nvar __webpack_exports__SystemPriority = __webpack_exports__.OEF;\nvar __webpack_exports__SystemType = __webpack_exports__.uuE;\nvar __webpack_exports__TagQuery = __webpack_exports__.tiv;\nvar __webpack_exports__TestClock = __webpack_exports__.T$Y;\nvar __webpack_exports__Text = __webpack_exports__.EYj;\nvar __webpack_exports__TextAlign = __webpack_exports__.nOB;\nvar __webpack_exports__TextureLoader = __webpack_exports__.Tap;\nvar __webpack_exports__Tile = __webpack_exports__.FAs;\nvar __webpack_exports__TileMap = __webpack_exports__.B_P;\nvar __webpack_exports__TileMapEvents = __webpack_exports__.aA5;\nvar __webpack_exports__TiledAnimation = __webpack_exports__.J3s;\nvar __webpack_exports__TiledSprite = __webpack_exports__.Y0Q;\nvar __webpack_exports__Timer = __webpack_exports__.M4G;\nvar __webpack_exports__Toaster = __webpack_exports__.l$l;\nvar __webpack_exports__Transform = __webpack_exports__.dLy;\nvar __webpack_exports__TransformComponent = __webpack_exports__.WZP;\nvar __webpack_exports__Transition = __webpack_exports__.eB6;\nvar __webpack_exports__TreeNode = __webpack_exports__.nFK;\nvar __webpack_exports__Trigger = __webpack_exports__.l9z;\nvar __webpack_exports__TriggerEvents = __webpack_exports__.YOF;\nvar __webpack_exports__TwoPI = __webpack_exports__.yhB;\nvar __webpack_exports__Util = __webpack_exports__.J0N;\nvar __webpack_exports__Vector = __webpack_exports__.Miz;\nvar __webpack_exports__VectorView = __webpack_exports__.Bj4;\nvar __webpack_exports__VertexBuffer = __webpack_exports__.Rcs;\nvar __webpack_exports__VertexLayout = __webpack_exports__.vJ4;\nvar __webpack_exports__VerticalFirst = __webpack_exports__.TqC;\nvar __webpack_exports__VisibleEvent = __webpack_exports__.nM0;\nvar __webpack_exports__WebAudio = __webpack_exports__.X1u;\nvar __webpack_exports__WebAudioInstance = __webpack_exports__.SpZ;\nvar __webpack_exports__WheelDeltaMode = __webpack_exports__.DX8;\nvar __webpack_exports__WheelEvent = __webpack_exports__.Yx$;\nvar __webpack_exports__World = __webpack_exports__.HK4;\nvar __webpack_exports__approximatelyEqual = __webpack_exports__.yt5;\nvar __webpack_exports__assert = __webpack_exports__.vAR;\nvar __webpack_exports__canonicalizeAngle = __webpack_exports__.SE$;\nvar __webpack_exports__clamp = __webpack_exports__.qE8;\nvar __webpack_exports__coroutine = __webpack_exports__.Pz7;\nvar __webpack_exports__createId = __webpack_exports__.sX_;\nvar __webpack_exports__frac = __webpack_exports__.JuI;\nvar __webpack_exports__hasGraphicsTick = __webpack_exports__.Nl$;\nvar __webpack_exports__hasOnAdd = __webpack_exports__.zDr;\nvar __webpack_exports__hasOnInitialize = __webpack_exports__.OwT;\nvar __webpack_exports__hasOnPostUpdate = __webpack_exports__.P$G;\nvar __webpack_exports__hasOnPreUpdate = __webpack_exports__.mHV;\nvar __webpack_exports__hasOnRemove = __webpack_exports__.kEA;\nvar __webpack_exports__hasPostDraw = __webpack_exports__.Fx_;\nvar __webpack_exports__hasPreDraw = __webpack_exports__.WFC;\nvar __webpack_exports__has_add = __webpack_exports__.vKu;\nvar __webpack_exports__has_initialize = __webpack_exports__.aDq;\nvar __webpack_exports__has_postupdate = __webpack_exports__.jIg;\nvar __webpack_exports__has_preupdate = __webpack_exports__.UH3;\nvar __webpack_exports__has_remove = __webpack_exports__.AJO;\nvar __webpack_exports__inverseLerp = __webpack_exports__.U4;\nvar __webpack_exports__inverseLerpVector = __webpack_exports__.xAc;\nvar __webpack_exports__isActor = __webpack_exports__._3Y;\nvar __webpack_exports__isAddedComponent = __webpack_exports__.K6X;\nvar __webpack_exports__isComponentCtor = __webpack_exports__.C1Y;\nvar __webpack_exports__isLoaderConstructor = __webpack_exports__.Aw1;\nvar __webpack_exports__isMoveByOptions = __webpack_exports__.tm8;\nvar __webpack_exports__isMoveToOptions = __webpack_exports__.LBV;\nvar __webpack_exports__isRemovedComponent = __webpack_exports__.A8$;\nvar __webpack_exports__isRotateByOptions = __webpack_exports__.F5e;\nvar __webpack_exports__isRotateToOptions = __webpack_exports__.ran;\nvar __webpack_exports__isScaleByOptions = __webpack_exports__.c8L;\nvar __webpack_exports__isScaleToOptions = __webpack_exports__.o6M;\nvar __webpack_exports__isSceneConstructor = __webpack_exports__.hsx;\nvar __webpack_exports__isScreenElement = __webpack_exports__.l9E;\nvar __webpack_exports__isSystemConstructor = __webpack_exports__.aSf;\nvar __webpack_exports__lerp = __webpack_exports__.CcK;\nvar __webpack_exports__lerpAngle = __webpack_exports__.nU8;\nvar __webpack_exports__lerpVector = __webpack_exports__.td6;\nvar __webpack_exports__maxMessages = __webpack_exports__.Zex;\nvar __webpack_exports__nextActionId = __webpack_exports__.bkJ;\nvar __webpack_exports__obsolete = __webpack_exports__.mXP;\nvar __webpack_exports__parseImageFiltering = __webpack_exports__.vt$;\nvar __webpack_exports__parseImageWrapping = __webpack_exports__.hCA;\nvar __webpack_exports__pixelSnapEpsilon = __webpack_exports__.pjR;\nvar __webpack_exports__randomInRange = __webpack_exports__.U43;\nvar __webpack_exports__randomIntInRange = __webpack_exports__.pSZ;\nvar __webpack_exports__range = __webpack_exports__.y17;\nvar __webpack_exports__remap = __webpack_exports__.Ew7;\nvar __webpack_exports__remapVector = __webpack_exports__.hG1;\nvar __webpack_exports__resetObsoleteCounter = __webpack_exports__.jVr;\nvar __webpack_exports__sign = __webpack_exports__._SZ;\nvar __webpack_exports__toDegrees = __webpack_exports__.xWn;\nvar __webpack_exports__toRadians = __webpack_exports__.ehJ;\nvar __webpack_exports__vec = __webpack_exports__.t6s;\nvar __webpack_exports__webgl = __webpack_exports__.Eyn;\nexport { __webpack_exports__ActionCompleteEvent as ActionCompleteEvent, __webpack_exports__ActionContext as ActionContext, __webpack_exports__ActionQueue as ActionQueue, __webpack_exports__ActionSequence as ActionSequence, __webpack_exports__ActionStartEvent as ActionStartEvent, __webpack_exports__ActionsComponent as ActionsComponent, __webpack_exports__ActionsSystem as ActionsSystem, __webpack_exports__ActivateEvent as ActivateEvent, __webpack_exports__Actor as Actor, __webpack_exports__ActorEvents as ActorEvents, __webpack_exports__AddEvent as AddEvent, __webpack_exports__AddedComponent as AddedComponent, __webpack_exports__AffineMatrix as AffineMatrix, __webpack_exports__Animation as Animation, __webpack_exports__AnimationDirection as AnimationDirection, __webpack_exports__AnimationEvents as AnimationEvents, __webpack_exports__AnimationStrategy as AnimationStrategy, __webpack_exports__ArcadeSolver as ArcadeSolver, __webpack_exports__AudioContextFactory as AudioContextFactory, __webpack_exports__Axes as Axes, __webpack_exports__Axis as Axis, __webpack_exports__BaseAlign as BaseAlign, __webpack_exports__BezierCurve as BezierCurve, __webpack_exports__Blink as Blink, __webpack_exports__BodyComponent as BodyComponent, __webpack_exports__BoundingBox as BoundingBox, __webpack_exports__BrowserComponent as BrowserComponent, __webpack_exports__BrowserEvents as BrowserEvents, __webpack_exports__Buttons as Buttons, __webpack_exports__Camera as Camera, __webpack_exports__CameraEvents as CameraEvents, __webpack_exports__Canvas as Canvas, __webpack_exports__Circle as Circle, __webpack_exports__CircleCollider as CircleCollider, __webpack_exports__Clock as Clock, __webpack_exports__ClosestLineJumpTable as ClosestLineJumpTable, __webpack_exports__Collider as Collider, __webpack_exports__ColliderComponent as ColliderComponent, __webpack_exports__CollisionContact as CollisionContact, __webpack_exports__CollisionEndEvent as CollisionEndEvent, __webpack_exports__CollisionGroup as CollisionGroup, __webpack_exports__CollisionGroupManager as CollisionGroupManager, __webpack_exports__CollisionJumpTable as CollisionJumpTable, __webpack_exports__CollisionPostSolveEvent as CollisionPostSolveEvent, __webpack_exports__CollisionPreSolveEvent as CollisionPreSolveEvent, __webpack_exports__CollisionStartEvent as CollisionStartEvent, __webpack_exports__CollisionSystem as CollisionSystem, __webpack_exports__CollisionType as CollisionType, __webpack_exports__Color as Color, __webpack_exports__ColorBlindFlags as ColorBlindFlags, __webpack_exports__ColorBlindnessMode as ColorBlindnessMode, __webpack_exports__ColorBlindnessPostProcessor as ColorBlindnessPostProcessor, __webpack_exports__Component as Component, __webpack_exports__CompositeCollider as CompositeCollider, __webpack_exports__ConsoleAppender as ConsoleAppender, __webpack_exports__ContactConstraintPoint as ContactConstraintPoint, __webpack_exports__ContactEndEvent as ContactEndEvent, __webpack_exports__ContactSolveBias as ContactSolveBias, __webpack_exports__ContactStartEvent as ContactStartEvent, __webpack_exports__CoordPlane as CoordPlane, __webpack_exports__CrossFade as CrossFade, __webpack_exports__CurveBy as CurveBy, __webpack_exports__CurveTo as CurveTo, __webpack_exports__DeactivateEvent as DeactivateEvent, __webpack_exports__Debug as Debug, __webpack_exports__DebugConfig as DebugConfig, __webpack_exports__DebugGraphicsComponent as DebugGraphicsComponent, __webpack_exports__DebugSystem as DebugSystem, __webpack_exports__DebugText as DebugText, __webpack_exports__DefaultAntialiasOptions as DefaultAntialiasOptions, __webpack_exports__DefaultGarbageCollectionOptions as DefaultGarbageCollectionOptions, __webpack_exports__DefaultLoader as DefaultLoader, __webpack_exports__DefaultPhysicsConfig as DefaultPhysicsConfig, __webpack_exports__DefaultPixelArtOptions as DefaultPixelArtOptions, __webpack_exports__DegreeOfFreedom as DegreeOfFreedom, __webpack_exports__Delay as Delay, __webpack_exports__Detector as Detector, __webpack_exports__Die as Die, __webpack_exports__Direction as Direction, __webpack_exports__Director as Director, __webpack_exports__DirectorEvents as DirectorEvents, __webpack_exports__DisplayMode as DisplayMode, __webpack_exports__DynamicTree as DynamicTree, __webpack_exports__DynamicTreeCollisionProcessor as DynamicTreeCollisionProcessor, __webpack_exports__EX_VERSION as EX_VERSION, __webpack_exports__EaseBy as EaseBy, __webpack_exports__EaseTo as EaseTo, __webpack_exports__EasingFunctions as EasingFunctions, __webpack_exports__EdgeCollider as EdgeCollider, __webpack_exports__ElasticToActorStrategy as ElasticToActorStrategy, __webpack_exports__EmitterType as EmitterType, __webpack_exports__Engine as Engine, __webpack_exports__EngineEvents as EngineEvents, __webpack_exports__EnterTriggerEvent as EnterTriggerEvent, __webpack_exports__EnterViewPortEvent as EnterViewPortEvent, __webpack_exports__Entity as Entity, __webpack_exports__EntityEvents as EntityEvents, __webpack_exports__EntityManager as EntityManager, __webpack_exports__EventEmitter as EventEmitter, __webpack_exports__EventTypes as EventTypes, __webpack_exports__Events as Events, __webpack_exports__ExResponse as ExResponse, __webpack_exports__ExcaliburGraphicsContext2DCanvas as ExcaliburGraphicsContext2DCanvas, __webpack_exports__ExcaliburGraphicsContextWebGL as ExcaliburGraphicsContextWebGL, __webpack_exports__ExitTriggerEvent as ExitTriggerEvent, __webpack_exports__ExitViewPortEvent as ExitViewPortEvent, __webpack_exports__Fade as Fade, __webpack_exports__FadeInOut as FadeInOut, __webpack_exports__Flags as Flags, __webpack_exports__Flash as Flash, __webpack_exports__Follow as Follow, __webpack_exports__Font as Font, __webpack_exports__FontCache as FontCache, __webpack_exports__FontSource as FontSource, __webpack_exports__FontStyle as FontStyle, __webpack_exports__FontUnit as FontUnit, __webpack_exports__FpsSampler as FpsSampler, __webpack_exports__FrameStats as FrameStats, __webpack_exports__Future as Future, __webpack_exports__GameEvent as GameEvent, __webpack_exports__GameStartEvent as GameStartEvent, __webpack_exports__GameStopEvent as GameStopEvent, __webpack_exports__Gamepad as Gamepad, __webpack_exports__GamepadAxisEvent as GamepadAxisEvent, __webpack_exports__GamepadButtonEvent as GamepadButtonEvent, __webpack_exports__GamepadConnectEvent as GamepadConnectEvent, __webpack_exports__GamepadDisconnectEvent as GamepadDisconnectEvent, __webpack_exports__Gamepads as Gamepads, __webpack_exports__GarbageCollector as GarbageCollector, __webpack_exports__Gif as Gif, __webpack_exports__GifParser as GifParser, __webpack_exports__GlobalCoordinates as GlobalCoordinates, __webpack_exports__GpuParticleEmitter as GpuParticleEmitter, __webpack_exports__GpuParticleRenderer as GpuParticleRenderer, __webpack_exports__Graphic as Graphic, __webpack_exports__GraphicsComponent as GraphicsComponent, __webpack_exports__GraphicsGroup as GraphicsGroup, __webpack_exports__GraphicsSystem as GraphicsSystem, __webpack_exports__HashColliderProxy as HashColliderProxy, __webpack_exports__HashGridCell as HashGridCell, __webpack_exports__HashGridProxy as HashGridProxy, __webpack_exports__HiddenEvent as HiddenEvent, __webpack_exports__HorizontalFirst as HorizontalFirst, __webpack_exports__ImageFiltering as ImageFiltering, __webpack_exports__ImageSource as ImageSource, __webpack_exports__ImageSourceAttributeConstants as ImageSourceAttributeConstants, __webpack_exports__ImageWrapping as ImageWrapping, __webpack_exports__InitializeEvent as InitializeEvent, __webpack_exports__InputHost as InputHost, __webpack_exports__InputMapper as InputMapper, __webpack_exports__IsometricEntityComponent as IsometricEntityComponent, __webpack_exports__IsometricEntitySystem as IsometricEntitySystem, __webpack_exports__IsometricMap as IsometricMap, __webpack_exports__IsometricTile as IsometricTile, __webpack_exports__KeyEvent as KeyEvent, __webpack_exports__Keyboard as Keyboard, __webpack_exports__Keys as Keys, __webpack_exports__KillEvent as KillEvent, __webpack_exports__Label as Label, __webpack_exports__LimitCameraBoundsStrategy as LimitCameraBoundsStrategy, __webpack_exports__Line as Line, __webpack_exports__LineSegment as LineSegment, __webpack_exports__Loader as Loader, __webpack_exports__LoaderEvents as LoaderEvents, __webpack_exports__LockCameraToActorAxisStrategy as LockCameraToActorAxisStrategy, __webpack_exports__LockCameraToActorStrategy as LockCameraToActorStrategy, __webpack_exports__LogLevel as LogLevel, __webpack_exports__Logger as Logger, __webpack_exports__Material as Material, __webpack_exports__Matrix as Matrix, __webpack_exports__MatrixLocations as MatrixLocations, __webpack_exports__MediaEvent as MediaEvent, __webpack_exports__Meet as Meet, __webpack_exports__MotionComponent as MotionComponent, __webpack_exports__MotionSystem as MotionSystem, __webpack_exports__MoveBy as MoveBy, __webpack_exports__MoveByWithOptions as MoveByWithOptions, __webpack_exports__MoveTo as MoveTo, __webpack_exports__MoveToWithOptions as MoveToWithOptions, __webpack_exports__NativePointerButton as NativePointerButton, __webpack_exports__NativeSoundEvent as NativeSoundEvent, __webpack_exports__NativeSoundProcessedEvent as NativeSoundProcessedEvent, __webpack_exports__NineSlice as NineSlice, __webpack_exports__NineSliceStretch as NineSliceStretch, __webpack_exports__None as None, __webpack_exports__Observable as Observable, __webpack_exports__OffscreenSystem as OffscreenSystem, __webpack_exports__Pair as Pair, __webpack_exports__ParallaxComponent as ParallaxComponent, __webpack_exports__ParallelActions as ParallelActions, __webpack_exports__Particle as Particle, __webpack_exports__ParticleEmitter as ParticleEmitter, __webpack_exports__ParticleRenderer as ParticleRenderer, __webpack_exports__ParticleTransform as ParticleTransform, __webpack_exports__PhysicsStats as PhysicsStats, __webpack_exports__PhysicsWorld as PhysicsWorld, __webpack_exports__PointerAbstraction as PointerAbstraction, __webpack_exports__PointerButton as PointerButton, __webpack_exports__PointerComponent as PointerComponent, __webpack_exports__PointerEvent as PointerEvent, __webpack_exports__PointerEventReceiver as PointerEventReceiver, __webpack_exports__PointerScope as PointerScope, __webpack_exports__PointerSystem as PointerSystem, __webpack_exports__PointerType as PointerType, __webpack_exports__Polygon as Polygon, __webpack_exports__PolygonCollider as PolygonCollider, __webpack_exports__Pool as Pool, __webpack_exports__PostCollisionEvent as PostCollisionEvent, __webpack_exports__PostDebugDrawEvent as PostDebugDrawEvent, __webpack_exports__PostDrawEvent as PostDrawEvent, __webpack_exports__PostFrameEvent as PostFrameEvent, __webpack_exports__PostKillEvent as PostKillEvent, __webpack_exports__PostTransformDrawEvent as PostTransformDrawEvent, __webpack_exports__PostUpdateEvent as PostUpdateEvent, __webpack_exports__PreCollisionEvent as PreCollisionEvent, __webpack_exports__PreDebugDrawEvent as PreDebugDrawEvent, __webpack_exports__PreDrawEvent as PreDrawEvent, __webpack_exports__PreFrameEvent as PreFrameEvent, __webpack_exports__PreKillEvent as PreKillEvent, __webpack_exports__PreLoadEvent as PreLoadEvent, __webpack_exports__PreTransformDrawEvent as PreTransformDrawEvent, __webpack_exports__PreUpdateEvent as PreUpdateEvent, __webpack_exports__Projection as Projection, __webpack_exports__QuadIndexBuffer as QuadIndexBuffer, __webpack_exports__QuadTree as QuadTree, __webpack_exports__Query as Query, __webpack_exports__QueryManager as QueryManager, __webpack_exports__RadiusAroundActorStrategy as RadiusAroundActorStrategy, __webpack_exports__Random as Random, __webpack_exports__Raster as Raster, __webpack_exports__Ray as Ray, __webpack_exports__RealisticSolver as RealisticSolver, __webpack_exports__Rectangle as Rectangle, __webpack_exports__RemoveEvent as RemoveEvent, __webpack_exports__RemovedComponent as RemovedComponent, __webpack_exports__Repeat as Repeat, __webpack_exports__RepeatForever as RepeatForever, __webpack_exports__Resolution as Resolution, __webpack_exports__Resource as Resource, __webpack_exports__ResourceEvents as ResourceEvents, __webpack_exports__RotateBy as RotateBy, __webpack_exports__RotateByWithOptions as RotateByWithOptions, __webpack_exports__RotateTo as RotateTo, __webpack_exports__RotateToWithOptions as RotateToWithOptions, __webpack_exports__RotationType as RotationType, __webpack_exports__ScaleBy as ScaleBy, __webpack_exports__ScaleByWithOptions as ScaleByWithOptions, __webpack_exports__ScaleTo as ScaleTo, __webpack_exports__ScaleToWithOptions as ScaleToWithOptions, __webpack_exports__Scene as Scene, __webpack_exports__SceneEvents as SceneEvents, __webpack_exports__Screen as Screen, __webpack_exports__ScreenAppender as ScreenAppender, __webpack_exports__ScreenElement as ScreenElement, __webpack_exports__ScreenEvents as ScreenEvents, __webpack_exports__ScreenShader as ScreenShader, __webpack_exports__ScrollPreventionMode as ScrollPreventionMode, __webpack_exports__Semaphore as Semaphore, __webpack_exports__SeparatingAxis as SeparatingAxis, __webpack_exports__SeparationInfo as SeparationInfo, __webpack_exports__Shader as Shader, __webpack_exports__Shape as Shape, __webpack_exports__Side as Side, __webpack_exports__Slide as Slide, __webpack_exports__SolverStrategy as SolverStrategy, __webpack_exports__Sound as Sound, __webpack_exports__SoundEvents as SoundEvents, __webpack_exports__SparseHashGrid as SparseHashGrid, __webpack_exports__SparseHashGridCollisionProcessor as SparseHashGridCollisionProcessor, __webpack_exports__SpatialPartitionStrategy as SpatialPartitionStrategy, __webpack_exports__Sprite as Sprite, __webpack_exports__SpriteFont as SpriteFont, __webpack_exports__SpriteSheet as SpriteSheet, __webpack_exports__StandardClock as StandardClock, __webpack_exports__StateMachine as StateMachine, __webpack_exports__StrategyContainer as StrategyContainer, __webpack_exports__Stream as Stream, __webpack_exports__System as System, __webpack_exports__SystemManager as SystemManager, __webpack_exports__SystemPriority as SystemPriority, __webpack_exports__SystemType as SystemType, __webpack_exports__TagQuery as TagQuery, __webpack_exports__TestClock as TestClock, __webpack_exports__Text as Text, __webpack_exports__TextAlign as TextAlign, __webpack_exports__TextureLoader as TextureLoader, __webpack_exports__Tile as Tile, __webpack_exports__TileMap as TileMap, __webpack_exports__TileMapEvents as TileMapEvents, __webpack_exports__TiledAnimation as TiledAnimation, __webpack_exports__TiledSprite as TiledSprite, __webpack_exports__Timer as Timer, __webpack_exports__Toaster as Toaster, __webpack_exports__Transform as Transform, __webpack_exports__TransformComponent as TransformComponent, __webpack_exports__Transition as Transition, __webpack_exports__TreeNode as TreeNode, __webpack_exports__Trigger as Trigger, __webpack_exports__TriggerEvents as TriggerEvents, __webpack_exports__TwoPI as TwoPI, __webpack_exports__Util as Util, __webpack_exports__Vector as Vector, __webpack_exports__VectorView as VectorView, __webpack_exports__VertexBuffer as VertexBuffer, __webpack_exports__VertexLayout as VertexLayout, __webpack_exports__VerticalFirst as VerticalFirst, __webpack_exports__VisibleEvent as VisibleEvent, __webpack_exports__WebAudio as WebAudio, __webpack_exports__WebAudioInstance as WebAudioInstance, __webpack_exports__WheelDeltaMode as WheelDeltaMode, __webpack_exports__WheelEvent as WheelEvent, __webpack_exports__World as World, __webpack_exports__approximatelyEqual as approximatelyEqual, __webpack_exports__assert as assert, __webpack_exports__canonicalizeAngle as canonicalizeAngle, __webpack_exports__clamp as clamp, __webpack_exports__coroutine as coroutine, __webpack_exports__createId as createId, __webpack_exports__frac as frac, __webpack_exports__hasGraphicsTick as hasGraphicsTick, __webpack_exports__hasOnAdd as hasOnAdd, __webpack_exports__hasOnInitialize as hasOnInitialize, __webpack_exports__hasOnPostUpdate as hasOnPostUpdate, __webpack_exports__hasOnPreUpdate as hasOnPreUpdate, __webpack_exports__hasOnRemove as hasOnRemove, __webpack_exports__hasPostDraw as hasPostDraw, __webpack_exports__hasPreDraw as hasPreDraw, __webpack_exports__has_add as has_add, __webpack_exports__has_initialize as has_initialize, __webpack_exports__has_postupdate as has_postupdate, __webpack_exports__has_preupdate as has_preupdate, __webpack_exports__has_remove as has_remove, __webpack_exports__inverseLerp as inverseLerp, __webpack_exports__inverseLerpVector as inverseLerpVector, __webpack_exports__isActor as isActor, __webpack_exports__isAddedComponent as isAddedComponent, __webpack_exports__isComponentCtor as isComponentCtor, __webpack_exports__isLoaderConstructor as isLoaderConstructor, __webpack_exports__isMoveByOptions as isMoveByOptions, __webpack_exports__isMoveToOptions as isMoveToOptions, __webpack_exports__isRemovedComponent as isRemovedComponent, __webpack_exports__isRotateByOptions as isRotateByOptions, __webpack_exports__isRotateToOptions as isRotateToOptions, __webpack_exports__isScaleByOptions as isScaleByOptions, __webpack_exports__isScaleToOptions as isScaleToOptions, __webpack_exports__isSceneConstructor as isSceneConstructor, __webpack_exports__isScreenElement as isScreenElement, __webpack_exports__isSystemConstructor as isSystemConstructor, __webpack_exports__lerp as lerp, __webpack_exports__lerpAngle as lerpAngle, __webpack_exports__lerpVector as lerpVector, __webpack_exports__maxMessages as maxMessages, __webpack_exports__nextActionId as nextActionId, __webpack_exports__obsolete as obsolete, __webpack_exports__parseImageFiltering as parseImageFiltering, __webpack_exports__parseImageWrapping as parseImageWrapping, __webpack_exports__pixelSnapEpsilon as pixelSnapEpsilon, __webpack_exports__randomInRange as randomInRange, __webpack_exports__randomIntInRange as randomIntInRange, __webpack_exports__range as range, __webpack_exports__remap as remap, __webpack_exports__remapVector as remapVector, __webpack_exports__resetObsoleteCounter as resetObsoleteCounter, __webpack_exports__sign as sign, __webpack_exports__toDegrees as toDegrees, __webpack_exports__toRadians as toRadians, __webpack_exports__vec as vec, __webpack_exports__webgl as webgl };\n\n//# sourceMappingURL=excalibur.js.map"],"names":["__webpack_modules__","module","d","A","_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__","_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default","n","_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__","___CSS_LOADER_EXPORT___","_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default","push","id","__WEBPACK_DEFAULT_EXPORT__","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","__webpack_module_cache__","moduleId","cachedModule","getter","__esModule","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","eKr","yVm","a7j","U_w","JF2","htg","HXL","mcg","Agj","J3_","Wgv","u6S","x7M","X55","m3M","aE5","YJU","eZi","GNv","Y56","_0v","vhs","vrQ","Z8b","Yfw","IcQ","kgJ","GTT","ypY","i7d","fQ3","HlI","jlt","VQc","zD7","AUF","JoF","MlA","PZh","qA","CrD","dQK","D3r","Qpo","D9n","b6v","mvh","Bpo","Q1f","IKv","fcV","Glf","uAl","ElT","Z8r","QSL","sPV","nAn","zCU","QrV","fF9","Jqv","d_u","xI8","yar","SP7","oRy","f5X","V1c","Mlx","ZiM","ZCo","Vy3","J5p","mL_","Guw","N5j","pgY","OP3","rl5","eod","q5Z","YUC","saR","hvr","Qol","Wf4","JCs","gJV","fWD","Va_","N$8","_jQ","rxj","rhv","wCu","HAp","Zy1","bkB","wfL","sVA","$Gs","CJ0","NWh","tWi","xAj","zWh","i_4","iIx","Hxo","c9e","KQV","weH","jXp","zzY","yRQ","MtE","rPj","KLc","Fir","V5f","Xj7","Wud","FVg","g5Y","YQB","KPb","nHK","Jrb","TX_","Olt","r3n","Fvk","gpR","vYh","hnk","D2R","n1o","h9O","X5j","p3P","RLG","fBU","Adb","bEs","wCy","CbD","x_C","pGf","ibQ","shR","Yjk","_u1","OBI","klh","s3S","D$R","xth","JU7","h9x","N1A","e_k","aHM","tlv","Vi9","ieR","$bb","VyI","imn","uqu","QnL","vnc","wk_","GH0","_1r","l0X","bT","HHX","jtW","tjk","rWe","j9l","l0$","sGJ","NVp","cPK","XoL","RmF","DXI","tCD","J3D","vCJ","e6k","f9l","v9m","yRJ","EU6","m3O","Ryz","OxP","LEs","Ec","Pi5","gmH","tS","XxX","bCz","nYS","yiT","NHl","mO8","PXI","bn5","Ywr","cMd","Bs6","G0k","pyn","QeM","aPX","ITP","BY0","MFw","sBn","S3L","XKQ","ESI","uxz","o8N","u_r","RlV","gVA","M_G","BpG","GRB","kM6","dO8","jgM","FWq","s3j","hlw","L0q","B7e","PGN","H_X","S_d","_Tq","U7E","IOH","Z58","yh2","ff$","cWi","NBt","oNz","QlU","Xey","jft","_r8","bTC","Mtr","ypk","mnM","q7S","bAZ","ABN","VK6","Hj2","Df8","oOx","kxk","DT1","FLG","qN_","Z37","FtL","Z6X","iQT","ziO","OEF","uuE","tiv","T$Y","EYj","nOB","Tap","FAs","B_P","aA5","J3s","Y0Q","M4G","l$l","dLy","WZP","eB6","nFK","l9z","YOF","yhB","J0N","Miz","Bj4","Rcs","vJ4","TqC","nM0","X1u","SpZ","DX8","Yx$","HK4","yt5","vAR","SE$","qE8","Pz7","sX_","JuI","Nl$","zDr","OwT","P$G","mHV","kEA","Fx_","WFC","vKu","aDq","jIg","UH3","AJO","U4","xAc","_3Y","K6X","C1Y","Aw1","tm8","LBV","A8$","F5e","ran","c8L","o6M","hsx","l9E","aSf","CcK","nU8","td6","Zex","bkJ","mXP","vt$","hCA","pjR","U43","pSZ","y17","Ew7","hG1","jVr","_SZ","xWn","ehJ","t6s","Eyn","webgl_util_namespaceObject","getAttributeComponentSize","getAttributePointerType","getGLTypeFromSource","getGlTypeSizeBytes","getMaxShaderComplexity","isAttributeInSource","DrawUtil_namespaceObject","circle","line","point","roundRect","vector","Events_namespaceObject","ActionCompleteEvent","ActionStartEvent","ActivateEvent","AddEvent","CollisionEndEvent","CollisionPostSolveEvent","CollisionPreSolveEvent","CollisionStartEvent","ContactEndEvent","ContactStartEvent","DeactivateEvent","EnterTriggerEvent","EnterViewPortEvent","EventTypes","ExitTriggerEvent","ExitViewPortEvent","GameEvent","GameStartEvent","GameStopEvent","GamepadAxisEvent","GamepadButtonEvent","GamepadConnectEvent","GamepadDisconnectEvent","HiddenEvent","InitializeEvent","KillEvent","PostCollisionEvent","PostDebugDrawEvent","PostDrawEvent","PostFrameEvent","PostKillEvent","PostTransformDrawEvent","PostUpdateEvent","PreCollisionEvent","PreDebugDrawEvent","PreDrawEvent","PreFrameEvent","PreKillEvent","PreTransformDrawEvent","PreUpdateEvent","RemoveEvent","VisibleEvent","PointerScope","Util_Index_namespaceObject","polyfill","window","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","requestIdleCallback","cb","start","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","cancelIdleCallback","clearTimeout","ConsoleAppender","DrawUtil","EasingFunctions","LogLevel","Logger","Observable","ScreenAppender","addItemToArray","contains","delay","fail","getPosition","isObject","mergeDeep","omit","removeItemFromArray","Flags","useCanvasGraphicsContext","enable","useLegacyImageRenderer","freeze","_FROZEN","_reset","_FLAGS","flagName","Error","disable","isEnabled","show","keys","createId","type","Future","constructor","_isCompleted","promise","_resolver","_rejecter","isCompleted","error","EventEmitter","_paused","_empty","_listeners","_listenersOnce","_pipes","clear","on","eventName","handler","_a","close","off","once","_b","newListeners","filter","h","newOnceListeners","emit","event","listeners","onces","pipe","emitter","indexOf","splice","unpipe","pause","unpause","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_u","_s","_t","_c","_l","_f","_mt","Array","s","_index","_twist","mag01","y","nextInt","next","floating","min","integer","floor","bool","likelihood","pickOne","array","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","result","currentPick","tempArray","slice","index","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","frac","x","ceil","sign","val","clamp","approximatelyEqual","val1","val2","tolerance","abs","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","from","to","_x","randomInRange","random","randomIntInRange","round","Vector","Zero","One","Half","Up","Down","Left","Right","fromAngle","cos","sin","isValid","vec","isNaN","Infinity","distance","vec1","vec2","sqrt","pow","_y","setTo","equals","EQUALS_EPSILON","v","deltaX","deltaY","squareDistance","clampMagnitude","magnitude","newSize","size","newLength","normalize","scale","newMagnitude","average","add","sizeOrScale","dest","sub","addEqual","subEqual","scaleEqual","dot","cross","num","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","fixed","toFixed","Color","g","b","fromRGB","fromRGBString","string","match","parseInt","parseFloat","fromHex","hex","fromHSL","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","c","hexRepresentation","String","fillStyle","Black","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Rose","Pink","Magenta","Violet","Purple","Blue","Azure","Cyan","Viridian","Teal","Green","Chartreuse","Transparent","ExcaliburBlue","Brown","hue2rgb","p","q","t","Side","MatrixLocations","_appenders","defaultLevel","Info","_logOnceSet","Set","_INSTANCE","addAppender","getInstance","appender","clearAppenders","_log","level","args","len","log","_logOnce","serialized","has","debug","Debug","debugOnce","info","infoOnce","warn","Warn","warnOnce","errorOnce","fatal","Fatal","fatalOnce","console","consoleArgs","unshift","apply","options","_messages","_pos","_color","_options","canvas","document","createElement","_ctx","getContext","style","position","zIndex","body","appendChild","_positionScreenAppenderCanvas","engine","events","_d","width","resolution","height","pagePos","screenToPageCoordinates","left","top","xPos","message","clearRect","pos","fillText","getOpposite","side","Top","Bottom","None","fromDirection","direction","BoundingBox","leftOrOptions","right","bottom","_points","reset","getSideFromIntersection","intersection","fromPoints","points","minX","minY","maxX","maxY","fromDimension","hasZeroDimensions","center","topLeft","bottomRight","topRight","bottomLeft","translate","getPoints","shifted","transform","matrix","xa1","xa2","xb1","xb2","ya1","ya2","yb1","yb2","matrixPos","getPerimeter","_left","_right","_top","_bottom","rayCast","ray","farClipDistance","tMin","tMax","xInv","dir","Number","MAX_VALUE","yInv","tx1","tx2","ty1","ty2","rayCastTime","combine","other","compositeBB","dimensions","overlaps","epsilon","e","totalBoundingBox","intersect","overlapX","overlapY","intersectWithSide","bb","draw","ex","drawRect","el","getBoundingClientRect","rect","scrollX","scrollY","milliseconds","clock","future","schedule","bind","object","newObj","includes","isArray","target","sources","source","shift","assign","Matrix","Float32Array","_scaleX","_scaleSignX","_scaleY","_scaleSignY","ortho","near","far","mat","toDOMMatrix","DOMMatrix","fromFloat32Array","identity","translation","sx","sy","rotation","angleRadians","vectorOrMatrix","resultX","resultY","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","AffineMatrix","Float64Array","_scale","determinant","inverse","det","signX","signY","multiplyQuadInPlace","quad","resultTopLeftX","resultTopLeftY","resultTopRightX","resultTopRightY","resultBottomLeftX","resultBottomLeftY","resultBottomRightX","resultBottomRightY","to4x4","xScaleSq","yScaleSq","RentalPool","builder","cleaner","preAllocate","_pool","_size","grow","amount","rent","clean","pop","TransformStack","_transforms","_currentTransform","save","restore","return","current","ContextState","opacity","z","tint","material","StateStack","_states","_cloneState","ResourceEvents","Complete","Load","LoadStart","Progress","Resource","path","responseType","bustCache","logger","isLoaded","_cacheBust","uri","test","load","request","XMLHttpRequest","open","addEventListener","status","response","statusText","Blob","errorText","send","watch","change","__isProxy","Proxy","set","createHandler","typeType","Graphic","isStale","_transformStale","flipHorizontal","_flipHorizontal","flipVertical","_flipVertical","_rotation","origin","_origin","_e","_g","_ID","showDebug","_width","_height","cloneGraphicOptions","localBounds","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","Sprite","image","super","_logger","_dirty","sourceView","destSize","_updateSpriteDimensions","ready","then","newWidth","newHeight","nativeWidth","nativeHeight","drawImage","ImageFiltering","ImageWrapping","parseImageFiltering","Pixel","Blended","parseImageWrapping","Clamp","Repeat","Mirror","TextureLoader","gl","_garbageCollector","_textureMap","Map","_collect","_gl","name","dataset","originalSrc","_LOGGER","delete","_MAX_TEXTURE_SIZE","getParameter","MAX_TEXTURE_SIZE","collectionInterval","garbageCollector","registerCollector","dispose","forceUpdate","filtering","wrapping","wrappingConfig","tex","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","touch","createTexture","checkImageSizeSupportedAndLog","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","xWrap","yWrap","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","REPEAT","MIRRORED_REPEAT","TEXTURE_WRAP_T","filterMode","TEXTURE_MIN_FILTER","NEAREST","LINEAR","TEXTURE_MAG_FILTER","addCollectableResource","texture","deleteTexture","ImageSourceAttributeConstants","Filtering","WrappingX","WrappingY","ImageSource","naturalWidth","naturalHeight","_src","src","pathOrBase64","bustCacheOrOptions","Image","_readyFuture","_resource","endsWith","fromHtmlImageElement","imageSource","setAttribute","fromHtmlCanvasElement","toBlob","blob","url","URL","createObjectURL","onload","revokeObjectURL","fromSvgString","svgSource","loadedFuture","toSprite","unload","SpriteFont","_text","alphabet","shadow","caseInsensitive","spacing","lineHeight","spriteSheet","_getCharacterSprites","text","results","textToRender","toLocaleLowerCase","letterIndex","letter","spriteIndex","letterSprite","sprites","measureText","maxWidth","lines","_getLinesFromText","maxWidthLine","reduce","sprite","xCursor","yCursor","render","bounds","offset","_cachedText","_cachedRenderWidth","_cachedLines","split","newLine","SpriteSheet","rows","columns","getSprite","_h","_j","spriteWithOptions","fromImageSourceWithSourceViews","sourceViews","fromImageSource","grid","cols","spriteWidth","spriteHeight","originOffset","margin","offsetDefaults","marginDefaults","DebugText","fontSheet","_imageSource","_spriteSheet","_spriteFont","write","ctx","RenderSource","_texture","use","activeTexture","TEXTURE0","RenderTarget","antialias","samples","transparency","MAX_SAMPLES","drawingBufferFormat","bufferFormat","RGBA8","RGB8","_setupRenderBuffer","_setupFramebuffer","setResolution","_frameTexture","_renderBuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorageMultisample","renderBuffer","renderFrameBuffer","_renderFrameBuffer","frameBuffer","_frameBuffer","frameTexture","createRenderbuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferRenderbuffer","COLOR_ATTACHMENT0","attachmentPoint","framebufferTexture2D","toRenderSource","blitRenderBufferToFrameBuffer","blitToScreen","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER","clearBufferfv","COLOR","blitFramebuffer","COLOR_BUFFER_BIT","copyToTexture","copyTexImage2D","viewport","INT","UNSIGNED_INT","FLOAT","SHORT","UNSIGNED_SHORT","BYTE","variable","matches","RegExp","exec","groups","BOOL","LOW_FLOAT","HIGH_FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","numIfs","assembleTestShader","testShader","testComplexity","replace","canCompile","shader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","Shader","compiled","_compiled","uniforms","attributes","vertexSource","fragmentSource","onPreLink","onPostCompile","_onPreLink","_onPostCompile","deleteProgram","program","useProgram","_ACTIVE_SHADER_INSTANCE","isCurrentlyBound","compile","vertexShader","_compileShader","VERTEX_SHADER","fragmentShader","_createProgram","getAttributes","attribute","getUniforms","uniform","uniformCount","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","uniformLocation","getUniformLocation","glType","location","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","attributeLocation","getAttribLocation","normalized","setTexture","slotNumber","setUniformInt","setUniform","trySetUniformInt","trySetUniform","setUniformIntArray","trySetUniformIntArray","setUniformBoolean","trySetUniformBoolean","setUniformFloat","trySetUniformFloat","setUniformFloatArray","trySetUniformFloatArray","setUniformFloatVector","trySetUniformFloatVector","setUniformFloatColor","trySetUniformFloatColor","setUniformMatrix","setUniformAffineMatrix","trySetUniformMatrix","uniformType","createProgram","attachShader","linkProgram","LINK_STATUS","getProgramInfoLog","typeName","errorInfo","getShaderInfoLog","_processSourceForError","errorLineStart","search","errorLineEnd","_","error2","VertexBuffer","buffer","createBuffer","bufferData","bindBuffer","ARRAY_BUFFER","STATIC_DRAW","DYNAMIC_DRAW","unbind","upload","count","bufferSubData","deleteBuffer","VertexLayout","vertexBuffer","_vertexBuffer","_attributes","_suppressWarnings","_layout","_vertexTotalSizeBytes","_initialized","suppressWarnings","_shader","initialize","totalVertexSizeBytes","shaderAttributes","attrib","componentsPerVertex","vertAttribute","typeSize","_vao","createVertexArray","bindVertexArray","vert","vertexAttribIPointer","vertexAttribPointer","enableVertexAttribArray","uploadBuffer","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","LineRenderer","priority","_maxLines","_vertexIndex","_lineCount","_startScratch","_endScratch","context","_context","end","_isFull","flush","getTransform","finalStart","finalEnd","hasPendingDraws","drawArrays","LINES","PointRenderer","_maxPoints","_pointCount","_buffer","snapToPixel","finalPoint","pixelSnapEpsilon","POINTS","ScreenPassPainter","renderWithPostProcessor","postprocessor","getShader","getLayout","TRIANGLES","renderToScreen","QuadIndexBuffer","numberOfQuads","useUint16","ELEMENT_ARRAY_BUFFER","totalVertices","maxUint16","maxUint16Index","bufferGlType","Uint16Array","Uint32Array","currentQuad","ImageRenderer","_maxImages","_maxTextures","_imageCount","_textures","_textureIndex","_textureToIndex","_images","_imageToWidth","_imageToHeight","_view","_dest","_quad","_defaultTint","pixelArtSampler","uvPadding","maxTexture","MAX_TEXTURE_IMAGE_UNITS","maxComplexity","transformedFrag","_transformFragmentSource","_quads","maxTextures","newSource","texturePickerBuilder","_addImageAsTexture","maybeFiltering","getAttribute","wrapX","wrapY","force","textureLoader","removeAttribute","_bindTextures","_getTextureIdForImage","maybeTexture","_getImageWidth","maybeWidth","_getImageHeight","maybeHeight","swidth","sheight","dx","dy","dwidth","dheight","maybeImageWidth","maybeImageHeight","sw","sh","textureId","imageWidth","imageHeight","uvx0","uvy0","uvx1","uvy1","txWidth","txHeight","drawElements","RectangleRenderer","_maxRectangles","_rectangleCount","_transparent","_scratch1","_scratch2","_scratch3","_scratch4","drawLine","drawRectangle","thickness","halfThick","startTop","startBottom","endTop","endBottom","stroke","strokeThickness","CircleRenderer","_maxCircles","_circleCount","radius","Pool","recycler","maxObjects","totalAllocations","objects","disableWarnings","preallocate","using","done","borrow","poolIndex","DrawCall","renderer","state","Material","graphicsContext","images","_name","_vertexSource","_fragmentSource","ExcaliburGraphicsContextWebGL","_graphicsContext","_initialize","addImageSource","graphicsContextWebGL","__gl","_maxTextureSlots","isUsingScreenTexture","update","textureUniformName","removeImageSource","textureName","_loadImageSource","imageElement","uploadAndBind","startingTextureSlot","textureSlot","entries","MaterialRenderer","vertexIndex","view","topLeftScreen","bottomRightScreen","screenUVX0","screenUVY0","screenUVX1","screenUVY1","performance","materialScreenTexture","CoordPlane","AnimationDirection","AnimationStrategy","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","WatchVector","original","newX","newY","transform_Transform","_parent","_children","flagDirty","_globalPos","parent","_globalScale","globalScaleX","globalScale","globalScaleY","_z","_isDirty","_isInverseDirty","_matrix","_inverse","_scratch","children","globalPos","localPos","canonRotation","globalRotation","inverseRotation","inverseScale","globalZ","_calculateMatrix","applyInverse","setTransform","isMirrored","cloneWithParent","isComponentCtor","Component","owner","newComponent","observers","subscriptions","register","observer","subscribe","func","unregister","unsubscribe","notifyAll","observersLength","notify","subscriptionsLength","TransformComponent","arguments","_parentComponent","_transform","_addChildTransform","child","childTxComponent","zIndexChanged$","_coordPlane","World","onAdd","childrenAdded$","childrenRemoved$","onRemove","_previousOwner","oldz","coordPlane","component","AnimationEvents","Frame","Loop","End","Animation","frames","strategy","frameDuration","_idempotencyToken","_firstTick","_currentFrame","_timeLeftInFrame","_pingPongDirection","_done","_playing","_speed","_reversed","speed","totalDuration","reverse","goToFrame","f","maybeFrame","currentFrame","graphic","fromSpriteSheet","spriteSheetIndex","durationPerFrameMs","maxIndex","invalidIndices","duration","fromSpriteSheetCoordinates","frameCoordinates","defaultDuration","coord","currentFrameIndex","currentFrameTimeLeft","isPlaying","isReversed","Backward","Forward","play","canFinish","Freeze","frameNumber","frameIndex","_nextFrame","PingPong","tick","elapsedMilliseconds","idempotencyToken","GraphicsGroup","useAnchor","members","_updateDimensions","member","useBounds","_isAnimationOrGroup","Raster","lineCap","quality","_smoothing","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","bitmapHeight","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperties","execute","imageSmoothingEnabled","setLineDash","getLineDash","strokeStyle","FontUnit","TextAlign","BaseAlign","FontStyle","Direction","x1","y1","x2","y2","cap","beginPath","moveTo","lineTo","closePath","arc","fill","br","tl","tr","bl","defaultRadius","quadraticCurveTo","FontTextInstance","font","_textFragments","disposed","_setDimension","_lastHashCode","getHashCode","_applyFont","metrics","textHeight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","actualBoundingBoxLeft","actualBoundingBoxRight","textBounds","bitmap","lineHeightRatio","fontString","textAlign","baseAlign","includeColor","resetTransform","textBaseline","shadowColor","blur","shadowBlur","shadowOffsetX","shadowOffsetY","_drawText","strokeText","_splitTextBitmap","textImages","currentX","currentY","_ex","hashCode","frag","FontCache","hash","_MEASURE_CACHE","measurement","measureTextWithoutCache","getTextInstance","textInstance","_TEXT_CACHE","_TEXT_USAGE","checkAndClearCache","deferred","currentHashCodes","time","FONT_TIMEOUT","forEach","newTextMeasurementCache","cacheSize","clearCache","Font","_o","_p","_q","_r","_v","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textMeasurement","colorOverride","Text","_textWidth","_textHeight","_calculateDimension","_font","hasGraphicsTick","GraphicsComponent","visible","isVisible","_offset","recalculateBounds","_anchor","currentGraphic","graphics","_current","_graphics","forceOnScreen","copyGraphics","onPreDraw","onPostDraw","onPreTransformDraw","onPostTransformDraw","graphicOrOptions","getGraphic","getOptions","getNames","currentOptions","nameOrGraphic","optionsToSet","graphicToSet","remove","hide","_localBounds","offsetX","offsetY","elapsed","_bubbles","bubbles","stopPropagation","self","elapsedMs","prevStats","stats","gamepad","button","axis","contact","lastContact","entity","action","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","EntityEvents","Add","Remove","Initialize","PreUpdate","PostUpdate","Kill","Entity","componentsOrOptions","componentsToAdd","nameToAdd","_tags","componentAdded$","componentRemoved$","tagAdded$","tagRemoved$","components","componentValues","_componentsToRemove","scene","isActive","_isInitialized","_isAdded","silence","silenceWarnings","addComponent","active","kill","unparent","isKilled","tags","hasTag","tag","addTag","removeTag","types","getComponents","values","hasAll","requiredTypes","hasAllTags","requiredTags","removeChild","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","componentInstance","addTemplate","templateEntity","_getClassHierarchyRoot","componentType","getPrototypeOf","removeComponent","dependencies","ctor","rootComponent","typeOrInstance","componentToRemove","componentIndex","clearComponents","processComponentRemoval","isInitialized","isAdded","onInitialize","_add","_remove","_preupdate","onPreUpdate","_postupdate","onPostUpdate","MotionComponent","vel","acc","scaleFactor","angularVelocity","torque","inertia","EulerIntegrator","integrate","motion","totalAcc","seconds","_ACC","_VEL","_POS","_VEL_ACC","_SCALE_FACTOR","_SCALE","Particle","beginColor","endColor","life","fade","_rRate","_gRate","_bRate","_aRate","_currentColor","sizeRate","isOffscreen","particleTransform","ParticleTransform","Global","configure","registerEmitter","_emitter","startSize","endSize","drawPoint","removeParticle","accel","focus","focusAccel","DefaultConfig","ParticleRenderer","transformFeedbackVaryings","INTERLEAVED_ATTRIBS","_getTexture","particle","Local","ImageRendererV2","_components","_quadMesh","_meshBuffer","_transformData","totalSize","vertexAttribDivisor","_bindData","drawArraysInstanced","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","lineOptions","pointOptions","drawText","_state","_ortho","checkIfResolutionSupported","dim","supported","_renderers","imageRenderer","_isDrawLifecycle","useDrawSorting","_drawCallPool","_drawCallIndex","_drawCalls","_postProcessTargets","_postprocessors","backgroundColor","multiSampleAntialiasing","_isContextLost","_disposed","_totalPostProcessorTime","canvasElement","enableTransparency","antialiasing","powerPreference","handleContextLost","handleContextRestored","premultipliedAlpha","alpha","depth","_init","clearColor","BLEND","blendEquation","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","blendEquationSeparate","blendFuncSeparate","depthMask","_screenRenderer","_renderTarget","_msaaTarget","rendererName","_isCurrentRenderer","_currentRenderer","beginDrawLifecycle","endDrawLifecycle","drawCall","updateViewport","trace","drawCircle","addPostProcessor","removePostProcessor","clearPostProcessors","updatePostProcessors","find","u","onUpdate","createMaterial","currentTarget","originalSort","firstIndex","sort","originalSortOrder","oldTransform","oldState","currentRendererName","currentRenderer","ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon","ExcaliburGraphicsContext2DCanvasDebug","__ctx","strokeRect","ExcaliburGraphicsContext2DCanvas","_resolution","globalAlpha","fillRect","_postprocessor","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","ScreenEvents","ScreenResize","PixelRatioChange","FullScreenChange","Screen","_antialiasing","_canvasImageRendering","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullscreen","_isDisposed","_fullscreenChangeHandler","fullscreen","isFullScreen","_pixelRatioChangeHandler","_listenForPixelRatio","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","pixelRatio","_resizeHandler","_setResolutionAndViewportByDisplayMode","_contentArea","_unsafeArea","_contentResolution","_displayMode","displayMode","Fixed","_canvas","canvasImageRendering","_browser","browser","_applyDisplayMode","_mediaQueryList","removeListener","nativeComponent","matchMedia","addListener","_resizeObserver","disconnect","removeEventListener","worldToPagePixelRatio","pageOrigin","worldToPageCoordinates","pixelRatioOverride","isHiDpi","FillContainer","FitContainer","FitContainerAndFill","FitContainerAndZoom","parentElement","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","currentPixelRatio","newResolutionSupported","imageRendering","widthUnit","heightUnit","documentElement","setProperty","isSmooth","isFullscreen","goFullScreen","elementId","enterFullscreen","maybeElement","getElementById","requestFullscreen","exitFullScreen","exitFullscreen","_viewportToPixels","offsetWidth","offsetHeight","pageToScreenCoordinates","innerWidth","innerHeight","screenHeight","screenWidth","contentArea","screenMarginY","screenMarginX","screenToWorldCoordinates","worldToScreenCoordinates","pageToWorldCoordinates","getWorldBounds","zoom","drawPos","getScreenBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","drawWidth","halfDrawWidth","drawHeight","halfDrawHeight","unsafeArea","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitScreenAndFill","vw","vh","_computeFitAndFill","_computeFitContainerAndFill","clip","_computeFitScreenAndZoom","_computeFitAndZoom","_computeFitContainerAndZoom","scaleX","scaleY","maxScaleFactor","zoomedWidth","zoomedHeight","_computeFitContainer","clientWidth","clientHeight","Window","ResizeObserver","observe","FillScreen","FitScreen","FitScreenAndFill","FitScreenAndZoom","AudioContextFactory","create","WebAudio","unlock","_UNLOCKED","unlockTimeoutTimer","resume","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","isUnlocked","Canvas","cache","ExResponse","any","json","arraybuffer","StateMachine","states","currentState","_currentState","machineDescription","machine","stateName","transitionState","transitions","startState","go","eventData","potentialNewState","onExit","onEnter","onState","saveKey","localStorage","setItem","parse","getItem","WebAudioInstance","_createNewBufferSource","_instance","_audioContext","loop","playbackRate","_playbackRate","_volumeNode","_handleEnd","_playingFuture","_loop","volume","_volume","_stateMachine","in","gain","setTargetAtTime","_duration","getTotalPlaybackDuration","createGain","PLAYING","pausedAt","startedAt","_playStarted","stop","SEEK","STOPPED","PAUSED","isPaused","isStopped","playStarted","seek","getPlaybackPosition","MediaEvent","_value","_path","_val","propagate","layPath","_actor","NativeSoundEvent","track","NativeSoundProcessedEvent","_processedData","canPlayFile","file","Audio","filetype","canPlayType","SoundEvents","VolumeChange","Processed","Pause","Stop","PlaybackEnd","Resume","PlaybackStart","Sound","_tracks","instances","paths","_isStopped","_wasPlayingOnHidden","audiobuffer","decodeAudio","wireEngine","_engine","pauseAudioWhenHidden","instanceCount","some","_resumePlayback","_startPlayback","trackId","_getTrackInstance","getTrackId","resumed","all","complete","newTrack","LoaderEvents","BeforeLoad","AfterLoad","UserAction","LoadResourceStart","LoadResourceEnd","isLoaderConstructor","DefaultLoader","resources","_resources","onDraw","_numLoaded","_totalTimeMs","_loadingFuture","loadables","addResources","onUserAction","onBeforeLoad","onAfterLoad","addResource","loadable","markResourceComplete","progress","total","textbox","areResourcesLoaded","async","finally","resource","Director_Loader","Loader","_image","_imageElement","_imageLoaded","logo","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","textContent","_playButtonStyles","head","startButtonFactory","loadablesOrOptions","_originalOptions","_playButtonShown","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","playButtonText","buttonElement","display","_DEFAULT_LOADER_OPTIONS","showPlayButton","resizeHandler","_positionPlayButton","evt","click","playButtonClicked","startButtonHandler","hidePlayButton","fullscreenAfterLoad","fullscreenContainer","HTMLElement","decode","buttonWidth","buttonHeight","playButtonPosition","logoY","logoX","logoPosition","oldAntialias","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","feature","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","CollisionType","SolverStrategy","ContactSolveBias","CollisionGroupManager","mask","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","existingGroup","group","CollisionGroup","_CURRENT_BIT","groupByName","_STARTING_BIT","category","_category","_mask","canCollide","overlap1","overlap2","collisionGroups","combinedName","combinedMask","collidesWith","padStart","All","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","collisionType","PreventCollision","collide","hasCollider","collider","idA","idB","Projection","projection","getOverlap","TreeNode","isLeaf","DynamicTree","_config","worldBounds","root","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","boundsPadding","multdx","velocityMultiplier","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","getLength","intersectPoint","getPoint","DynamicTreeCollisionProcessor","_pairs","_collisionPairCache","_colliders","_dynamicCollisionTree","dynamicTree","getColliders","pointOrBounds","maxDistance","collisionGroup","collisionMask","searchAllColliders","maybeBody","ignoreCollisionGroupAll","hit","CompositeCollider","colliders","untrack","_pairExists","broadphase","targets","potentialColliders","j","pair","physics","pairs","continuous","checkForFastBodies","Active","updateDistance","minDimension","disableMinimumSpeedForFastBody","fastBodies","updateVec","oldPos","centerPoint","furthestPoint","getFurthestPoint","minCollider","surfaceEpsilon","minTranslate","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","composite","touching","VerticalFirst","vertical","horizontal","HorizontalFirst","SpatialPartitionStrategy","DefaultPhysicsConfig","enabled","gravity","solver","Arcade","substep","compositeStrategy","bodies","canSleepByDefault","sleepEpsilon","wakeThreshold","sleepBias","defaultMass","spatialPartition","SparseHashGrid","sparseHashGrid","arcade","contactSolveBias","realistic","positionIterations","velocityIterations","slop","steeringFactor","warmStart","_compositeStrategy","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","maybeLine","minLength","minLine","hits","minHit","minDistance","project","projections","proj","newProjection","LineSegment","slope","intercept","_normal","_dir","_slope","getEdge","midpoint","flip","below","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","ClosestLine","line1","line2","EPSILON","line1Dir","line2Dir","d1Squared","d2Squared","closestPoint","denom","closestPointOnLine1","closestPointOnLine2","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","aSides","getSides","bSides","closestLine","PolygonEdgeClosestLine","polygon","edge","otherDirection","rayTowardsOther","thisPoint","thisFace","getClosestFace","edgeLine","asLine","face","PolygonCircleClosestLine","otherWorldPos","p0","circlex","circley","CircleCircleClosestLine","circleA","circleB","thisDirection","rayTowardsThis","otherPoint","CircleEdgeClosestLine","circleWorldPos","EdgeEdgeClosestLine","edgeA","edgeB","CircleCollider","_globalMatrix","_radius","_naturalRadius","_localBoundsDirty","orig","u1","toi","discriminant","toi1","toi2","positiveToi","minToi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","scalars","dotProduct","CollisionContact","mtv","tangent","localPoints","_canceled","colliderAId","colliderBId","matchAwake","isSleeping","sleepMotion","isCanceled","cancel","bias","SeparationInfo","localAxis","localSide","localPoint","SeparatingAxis","findPolygonPolygonSeparation","polyA","polyB","findPolygonPolygonSeparationDegenerate","bestSeparation","bestSideIndex","toPolyBSpace","_SCRATCH_MATRIX","toPolyBSpaceRotation","normalsA","normals","pointsA","pointsB","pointsAIndex","_ZERO","_SCRATCH_NORMAL","_SCRATCH_POINT","smallestLocalPoint","smallestPointDistance","pointsBIndex","_SCRATCH_SUB_POINT","bestSide2","separationInfo","SeparationPool","separation","sideId","findCirclePolygonSeparation","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","bestSide","bestAxis","bestOtherPoint","sides","localSides","getLocalSides","vertB","vertSeparation","ScratchZero","ScratchNormal","ScratchMatrix","circleAPos","circleBPos","combinedRadius","mvt","local","sameDir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","separationB","main","toIncidentFrame","toIncidentFrameRotation","referenceEdgeNormal","minEdge","incidentEdgeIndex","referenceSide","referenceDirection","clipRight","clipLeft","clipPoints","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","registerGraphicsContext","debugDrawCall","drawLines","drawPolygon","firstPoint","drawBounds","boundingBox","drawRay","_localSidesDirty","_transformedPointsDirty","_sidesDirty","_normals","_checkAndUpdateWinding","_calculateNormals","_transformedPoints","_sides","_localSides","isConvex","suppressConvexWarning","_calculateTransformation","_isCounterClockwiseWinding","sum","oldPoint","newPoint","oldDirection","orientation","angleSum","tessellate","polygons","Shape","Polygon","triangulate","triangles","vertices","vertexCount","getPrevIndex","getNextIndex","prev","va","vb","vc","leftArm","rightArm","convexVertices","isPointInTriangle","ab","bc","ca","ap","bp","cp","cross1","cross2","cross3","findEarTip","isEar","cutEarTip","getTransformedPoints","currentSide","mostDirection","testRay","intersectCount","sideIndex","pts","POSITIVE_INFINITY","faceIndex","_cachedMass","_cachedInertia","denominator","iplusone","crossTerm","contactSide","minContactTime","contactIndex","contactTime","scalar","Box","Circle","Edge","Capsule","ColliderComponent","$colliderAdded","$colliderRemoved","_collidersToRemove","_collider","processColliderRemoval","flipped","precollision","Actor","onPreCollisionResolve","postcollision","onPostCollisionResolve","onCollisionStart","onCollisionEnd","useBoxCollider","usePolygonCollider","poly","useCircleCollider","useEdgeCollider","useCompositeCollider","DegreeOfFreedom","__oldTransformCaptured","enableFixedUpdateInterpolate","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","_oldGlobalPos","oldVel","oldAcc","_impulseScratch","_distanceFromCenterScratch","_bodyConfig","config","updatePhysicsConfig","_mass","_DEFAULT_CONFIG","canSleep","updateDefaultPhysicsConfig","newMass","_cachedInverseInertia","inverseMass","sleeping","setSleeping","updateMotion","currentMotion","maybeCollider","inverseInertia","oldGlobalPos","oldRotation","oldScale","applyImpulse","impulse","finalImpulse","X","Y","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","Rectangle","PointerComponent","useColliderShape","useGraphicsBounds","CreateReversibleEasingFunction","easing","CreateVectorEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","ActionQueue","_actions","_currentAction","_completedActions","_entity","clearActions","getActions","getIncompleteActions","getCurrentAction","hasNext","isComplete","_ACTION_ID","nextActionId","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","RotationType","lerp","lerpAngle","startAngleRadians","endAngleRadians","rotationType","shortestPathIsPositive","distance1","distance2","shortDistance","longDistance","ShortestPath","LongestPath","Clockwise","CounterClockwise","lerpVector","inverseLerp","inverseLerpVector","remap","minSource","maxSource","minDestination","maxDestination","remapVector","isMoveByOptions","durationMs","MoveByWithOptions","_started","_easing","_tx","_motion","_durationMs","_currentMs","_start","_end","currentPos","newPosX","newPosY","velX","velY","MoveBy","_distance","isMoveToOptions","MoveToWithOptions","MoveTo","destX","destY","isRotateToOptions","RotateToWithOptions","_endAngle","_startAngle","_rotationType","rx","RotateTo","_currentNonCannonAngle","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","distanceTraveled","isRotateByOptions","angleRadiansOffset","RotateByWithOptions","RotateBy","isScaleToOptions","ScaleToWithOptions","_endScale","_startScale","newScale","ScaleTo","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","isScaleByOptions","scaleOffset","ScaleByWithOptions","_scaleOffset","ScaleBy","scaleOffsetX","scaleOffsetY","_directionX","_directionY","CallMethod","method","_hasBeenCalled","_method","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","EaseBy","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","Fade","endOpacity","_multiplier","_endOpacity","_remainingTime","_originalTime","Delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actor","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","Flash","_total","_currentDuration","_material","BezierCurve","_distLookup","controlPoints","_controlPoints","_calculateLookup","arcLength","_arcLength","setControlPoint","totalLength","pt","_getTimeGivenDistance","getTangent","timeSquared","p1","p2","p3","getUniformTangent","desiredDistance","uniformTime","getNormal","getUniformNormal","getUniformPoint","CurveTo","_mode","_curve","mode","CurveBy","_queue","runAction","curveBy","curveTo","easeTo","easeBy","xOrPosOrOptions","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVectorOrOptions","yOffsetOrSpeed","xOffset","yOffset","rotateTo","angleRadiansOrOptions","rotateBy","angleRadiansOffsetOrOptions","scaleTo","sizeXOrVectorOrOptions","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVectorOrOptions","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","flash","die","callMethod","times","repeatForever","follow","meet","toPromise","_getCtx","xOffsetOrVectorOptions","isActor","ActorEvents","CollisionStart","CollisionEnd","PreCollision","PostCollision","PreKill","PostKill","PreDraw","PostDraw","PreTransformDraw","PostTransformDraw","PreDebugDraw","PostDebugDraw","PointerUp","PointerDown","PointerEnter","PointerLeave","PointerMove","PointerCancel","Wheel","PointerDrag","PointerDragEnd","PointerDragEnter","PointerDragLeave","PointerDragMove","EnterViewPort","ExitViewPort","ActionStart","ActionComplete","thePos","theVel","theAcc","theAngle","_handleAnchorChange","_handleOffsetChange","isOffScreen","draggable","_draggable","isDraggable","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","_pointerDragLeaveHandler","_dragging","pe","defaults","_silenceWarnings","pointer","actions","Passive","builtInComponents","_prekill","onPreKill","_postkill","onPostKill","unkill","newZ","getGlobalPos","localCenter","getGlobalScale","getGlobalRotation","recurse","geom","containment","within","otherCollider","me","isScreenElement","ScreenElement","useWorld","coords","Timer","_complete","_totalTimeAlive","_running","_numberOfTicks","interval","repeats","maxNumberOfRepeats","randomRange","_baseInterval","_generateRandomInterval","fcn","numberOfRepeats","_MAX_ID","_callbacks","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","cancelTimer","ParallaxComponent","parallaxFactor","DebugGraphicsComponent","useTransform","hasNestedEvents","_dispatchPointerEvents","_processPointerToObject","PointerTargetObjectProxy","init","PointerEventsToObjectDispatcher","_proxyPool","_objectToProxy","_proxies","_lastFrameObjectToPointers","_currentFrameObjectToPointers","addObject","proxy","_getProxy","removeObject","_objectCurrentlyUnderPointer","pointerId","_objectWasUnderPointer","_entered","addPointerToObject","maybeProxy","_addPointerToProxy","pointers","dispatchEvents","receiver","sortedObjects","lastFrameEntities","currentFrameEntities","lastMovePerPointer","lastUpPerPointer","lastDownPerPointer","_processDownAndEmit","_processUpAndEmit","_processMoveAndEmit","lastUpDownMoveEvents","_processEnterLeaveAndEmit","_processCancelAndEmit","_processWheelAndEmit","processPointerToObject","objectIndex","currentFramePointerCoords","currentFrameDown","isDragStart","currentFrameUp","isDragEnd","currentFrameMove","isDragging","currentFrameCancel","currentFrameWheel","TileMapEvents","TileMap","flagCollidersDirty","_collidersDirty","flagTilesDirty","tiles","tileWidth","tileHeight","_token","_rows","_cols","renderFromTopOfGraphic","meshingLookBehind","_oldRotation","_originalOffsets","WeakMap","debugFlags","_composite","_oldPos","_oldScale","_pointerEventDispatcher","currentCol","tile","Tile","_getOrSetColliderOriginalOffset","originalOffset","_updateColliders","shareEdges","checkAndCombine","maxLookBack","solid","defaultGeometry","getTileByIndex","getTile","getTileByPoint","_getTileCoordinates","getRows","getColumns","getOnScreenTiles","maybeParallax","oneMinusFactor","parallaxOffset","currentScene","tileStartX","tileStartY","tileEndX","tileEndY","graphicsIndex","graphicsLen","offsets","getGraphicsOffsets","getGraphics","gfx","showAll","showGrid","gridColor","gridWidth","showSolidBounds","showColliderBounds","solidBoundsColor","colliderBoundsColor","showColliderGeometry","tilemap","geometryColor","geometryLineWidth","geometryPointSize","pointSize","_posDirty","_recalculate","_solid","_offsets","addGraphic","removeGraphic","clearGraphics","geometryPos","_geometry","_bounds","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","Axis","cam","_eng","currentFocus","getFocus","cameraVel","stretch","boundSizeChecked","focusX","focusY","CameraEvents","Camera","_cameraStrategies","dz","az","_angularVelocity","_posChanged","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_halfWidth","_halfHeight","_snapPos","hasChanged","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","_screen","currentRes","loadingComplete","res","updateTransform","runStrategies","newZoom","zoomEasing","lerpPoint","moveEasing","_isDoneShaking","fixedUpdateTimestep","blend","currentFrameLagMs","interpolatedPos","snapPos","newCanvasWidth","newCanvasHeight","cameraPos","TriggerEvents","ExitTrigger","EnterTrigger","Trigger","_matchesTarget","_dispatchAction","SystemPriority","Highest","Higher","Average","Lower","Lowest","SystemType","System","EntityManager","_world","entities","_entityIndex","_childAddedHandlerMap","_childRemovedHandlerMap","_createChildAddedHandler","addEntity","_createChildRemovedHandler","removeEntity","_entitiesToRemove","updateEntities","entityIndex","findEntitiesForRemoval","queryManager","childAdded","childRemoved","idOrEntity","childAddedHandler","childRemovedHandler","currFrame","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","Query","requiredComponents","entityAdded$","entityRemoved$","checkAndAdd","getEntities","TagQuery","QueryManager","_queries","_addComponentHandlers","_removeComponentHandlers","_componentToQueriesIndex","_tagQueries","_addTagHandlers","_removeTagHandlers","_tagToQueriesIndex","_createAddComponentHandler","_createRemoveComponentHandler","_createAddTagHandler","_createRemoveTagHandler","createQuery","queries","createTagQuery","maybeAddComponent","maybeRemoveComponent","maybeAddTag","maybeRemoveTag","tagQuery","isSystemConstructor","SystemManager","systems","initialized","systemType","addSystem","systemOrCtor","system","removeSystem","updateSystems","preupdate","postupdate","entityManager","systemManager","queryTags","Update","entityOrSystem","clearEntities","clearSystems","MotionSystem","world","_physicsConfigDirty","$configUpdate","optionalBody","captureOldTransformWithChildren","ArcadeSolver","directionMap","distanceMap","solve","preSolve","aDir","bDir","aDist","bDist","solvePosition","solveVelocity","postSolve","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","originalVelocityAndRestitution","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contactPoints","pointIndex","restitution","relativeVelocity","constraints","maxCorrection","steeringForce","impulseForce","impulseDelta","maxFriction","newImpulse","normalVelocity","CollisionSystem","_processor","_physics","collisionProcessor","_configDirty","_lastFrameContacts","_currentFrameContacts","_arcadeSolver","_realisticSolver","_trackCollider","_untrackCollider","colliderComponent","_motionSystem","colliderComp","compositeColliders","getSolver","step","compositeId","substring","runContactStartEnd","Realistic","blendTransform","oldTx","newTx","oldTxWithNewParent","oldGlobalScale","oldGlobalRotation","interpolatedScale","interpolatedRotation","GraphicsSystem","sortedTransforms","_sortedTransforms","Draw","_zHasChanged","_zIndexUpdate","_targetInterpolationTransform","transformIndex","parallax","_applyTransform","_applyOpacity","_drawGraphicsComponent","graphicsComponent","transformComponent","oldFlipHorizontal","oldFlipVertical","isDebug","showBounds","boundsColor","ancestors","ancestor","maybeGraphics","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","debugDraw","bodySettings","cameraSettings","useFilter","ids","nameQuery","cursor","_pushCameraTransform","debugZIndex","showPosition","positionColor","showPositionLabel","showZIndex","showId","showName","showRotation","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","showOwner","_popCameraTransform","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","contactSize","collisionContactColor","collisionNormalColor","showFocus","focusColor","showZoom","HashGridProxy","gridSize","cells","hasZeroBounds","leftX","rightX","bottomY","topY","cell","proxies","updateBounds","HashGridCell","calculateHashKey","_hashGridCellPool","instance","objectToProxy","proxyFactory","_buildProxy","boundsOrPoint","xCoord","yCoord","proxyIndex","cellIndex","transparent","PointerSystem","_graphicsHashGrid","_entityToPointer","overrideUseColliderShape","overrideUseGraphicsBounds","_sortedEntities","screenPos","maybeGfx","_scene","_receivers","input","_engineReceiver","maybePointer","ActionsSystem","IsometricEntityComponent","mapOrOptions","elevation","IsometricEntitySystem","iso","OffscreenSystem","_worldBounds","entityOffscreen","_isOffscreen","transformedBounds","HashColliderProxy","SparseHashGridCollisionProcessor","_nonPairs","_pairPool","hashGrid","unitRay","dydx","dxdy","unitStepX","unitStepY","startXCoord","startYCoord","stepDir","currentXCoord","currentYCoord","currentRayLengthX","currentRayLengthY","collidersVisited","maxIterations","cellHits","colliderIndex","hit1","hit2","compColliders","_canCollide","proxyId","otherIndex","PhysicsWorld","newConfig","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_enabled","_clonePads","toggleEnabled","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","at","timestamp","bi","ai","navigatorGamepad","Buttons","getButton","pressed","updateButton","Axes","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_axes","_buttons","_buttonsUp","_buttonsDown","isButtonPressed","isButtonHeld","wasButtonPressed","wasButtonReleased","Boolean","buttonIndex","axesIndex","Keys","InputMapper","inputs","_handlers","command","inputHandler","commandHandler","isCrossOriginIframe","noop","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","_releaseAllKeys","ev","code","keyEvent","_handleKeyDown","metaKey","MetaLeft","MetaRight","_handleKeyUp","keyboardOptions","global","grabWindowFocus","getKeys","wasPressed","isHeld","wasReleased","triggerEvent","character","KeyboardEvent","GlobalCoordinates","fromPagePosition","xOrPos","yOrEngine","engineOrUndefined","pageX","pageY","PointerEvent","coordinates","pointerType","nativeEvent","WheelEvent","screenX","screenY","deltaZ","deltaMode","PointerAbstraction","lastPagePos","lastScreenPos","lastWorldPos","_onPointerMove","_onPointerDown","_updateWorldPosition","WheelDeltaMode","NativePointerButton","PointerButton","PointerType","PointerEventReceiver","primary","_activeNativePointerIdsToNormalized","lastFramePointerCoords","currentFramePointerDown","lastFramePointerDown","_pointers","_boundHandle","_handle","_boundWheel","_handleWheel","recreate","eventReceiver","isDown","wasDown","native","isDisposed","touchAction","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode","onmousewheel","grabFocus","detach","_normalizePointerId","nativePointerId","findIndex","preventDefault","eventCoords","globalThis","TouchEvent","Unknown","Touch","changedTouches","_nativeButtonToPointerButton","Mouse","isPointerEvent","_stringToPointerType","ScrollWheelNormalizationFactor","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Line","Page","we","page","clientX","clientY","MouseEvent","pointerSystem","NoButton","Middle","Pen","InputHost","pointerTarget","keyboard","inputMapper","PreLoadEvent","SceneEvents","Activate","Deactivate","PreLoad","isSceneConstructor","Scene","triggers","tileMaps","timers","_timers","_cancelQueue","onPreLoad","loader","onTransition","onActivate","onDeactivate","_initializeChildren","pointerScope","director","getSceneName","_activate","_deactivate","_predraw","_postdraw","removeTimer","timer","_collectActorStats","addTimer","transfer","isTimerActive","isCurrentScene","ui","alive","ColorBlindnessMode","ScreenShader","ColorBlindnessPostProcessor","_colorBlindnessMode","simulate","_simulate","colorBlindnessMode","colorBlindMode","Protanope","Deuteranope","Tritanope","ColorBlindFlags","_colorBlindPostProcessor","correct","colorBlindness","DebugConfig","FrameStats","prevFrame","isometric","positionSize","useTestClock","wasRunning","testClock","toTestClock","useStandardClock","currentClock","standardClock","toStandardClock","_id","_elapsedMs","_fps","_actorStats","remaining","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","drawCalls","drawnImages","otherStats","fps","fs","_collisions","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","BrowserComponent","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","DefaultAntialiasOptions","nativeContextAntialiasing","DefaultPixelArtOptions","FpsSampler","_samplePeriod","_currentFrameTime","_frames","_previousSampleTime","_beginFrameTime","initialFps","samplePeriod","_nowFn","nowFn","instant","Clock","_onFatalException","_maxFps","_lastTime","_elapsed","_scheduledCbs","_totalElapsed","maxFps","onFatalException","fpsSampler","TestClock","defaultUpdateMs","StandardClock","setFatalExceptionHandler","timeoutMs","timing","scheduledTime","__runScheduledCbs","overrideUpdateMs","fpsInterval","leftover","mainloop","_requestId","_currentTime","_updateMs","run","numberOfSteps","Util_Toaster","Toaster","_toasterCss","_container","_createFragment","toastMessage","innerText","toast","linkTarget","linkName","className","messageFragments","link","href","finalMessage","dismissBtn","keydownHandler","first","firstChild","insertBefore","DirectorEvents","NavigationStart","Navigation","NavigationEnd","Director","isTransitioning","_isTransitioning","scenes","_sceneToInstance","_sceneToLoader","_sceneToTransition","_loadedScenes","rootScene","currentSceneName","sceneKey","sceneOrOptions","getSceneInstance","_deferredGoto","deferredScene","deferredTransition","_deferredTransition","deferredSceneInstance","_addToTargetScene","swapScene","playTransition","configureStart","startScene","maybeLoaderOrCtor","maybeStartTransition","mainLoader","inTransition","startSceneInstance","_getLoader","sceneName","_getInTransition","sceneOrRoute","_getOutTransition","out","getDeferredScene","maybeDeferred","getSceneDefinition","maybeScene","assertAdded","assertRemoved","outTransition","nameOrScene","sceneOrCtor","potentialSceneOrOptions","goto","destinationScene","maybeDest","sourceSceneInstance","sourceScene","engineInputEnabled","maybeSourceOut","maybeDestinationIn","sourceOut","destinationIn","sceneActivationData","hideLoader","maybeLoadScene","_emitEvent","onPreviousSceneDeactivate","sceneDefinition","newScene","sceneToLoad","sceneToLoadInstance","transition","targetScene","currentTransition","sceneInputEnabled","blockInput","_play","previousScene","nextScene","destLoader","sourceName","destinationName","createContext","scope","old","useContext","DefaultGarbageCollectionOptions","textureCollectInterval","GarbageCollector","_collectionMap","_collectors","collectStaleResources","deadline","collector","timeoutInterval","getTimestamp","resourceType","_collectHandle","collect","collectionData","forceCollectAll","EngineEvents","FallbackGraphicsContext","Visible","Hidden","Start","PreFrame","PostFrame","EmitterType","Engine","useEngine","Context","_isDebug","shouldSnapToPixel","version","EX_VERSION","_inputEnabled","_suppressPlayButton","enableCanvasTransparency","stack","_toaster","_timescale","_handleWebGLContextLost","container","flexDirection","borderStyle","div","innerHTML","querySelector","reload","_performanceThresholdTriggered","_fpsSamples","_isLoading","_hideLoader","_isReadyFuture","currentFrameElapsedMs","_lagMs","_screenShotRequests","_DEFAULT_ENGINE_OPTIONS","detector","suppressMinimumBrowserFeatureDetection","_compatible","testMessage","canvasElementId","suppressConsoleBootMessage","garbageCollection","garbageCollectorConfig","enableCanvasContextMenu","_originalDisplayMode","pixelArt","suppressHiDPIScaling","fixedUpdateFps","_mainloop","___EXCALIBUR_DEVTOOL","InstanceCount","_monitorPerformanceThresholdAndTriggerFallback","allow","configurePerformanceCanvas2DFallback","showPlayerMessage","numberOfFrames","useCanvas2DFallback","newCanvas","cloneNode","parentNode","replaceChild","Document","timescale","addScene","removeScene","goToScene","scrollPreventionMode","visibilityState","toggleInputEnabled","_overrideInitialize","_update","_loader","_draw","_checkForScreenShots","toggle","toggleDebug","isReady","sceneNameOrLoader","frameId","beforeUpdate","fixedTimestepMs","afterUpdate","afterDraw","screenshot","preserveHiDPIResolution","finalWidth","finalHeight","raw","Label","newFont","spriteFont","sf","getTextWidth","ParticleEmitter","_particlesToEmit","_particlePool","numParticles","isEmitting","deadParticles","emitRate","emitterType","randomRotation","emitParticles","particleCount","_createParticle","ranX","ranY","minAngle","maxAngle","minSpeed","maxSpeed","minSize","maxSize","assert","expression","GpuParticleRenderer","_vaos","_buffers","_drawIndex","_numInputFloats","_particleIndex","_uploadIndex","_wrappedLife","_wrappedParticles","_particleLife","_emitted","_particleData","maxParticles","_random","numInputFloats","particleData","particleDataBuffer1","vao1","bytesPerFloat","particleDataBuffer2","vao2","_currentVao","_currentBuffer","startIndex","endIndex","_uploadEmitted","bindBufferBase","TRANSFORM_FEEDBACK_BUFFER","bindBufferRange","beginTransformFeedback","endTransformFeedback","GPU_MAX_PARTICLES","GpuParticleEmitter","IsometricTile","_gfx","_recalculateBounds","_tileBounds","graphicsOffset","tileToWorld","_isometricEntityComponent","halfTileWidth","halfTileHeight","yPos","totalWidth","totalHeight","IsometricMap","updateColliders","worldToTile","worldCoordinate","tileCoordinate","tileCoord","_getMaxZIndex","maxZ","NEGATIVE_INFINITY","currentZ","ActionSequence","actionBuilder","_sequenceBuilder","_sequenceContext","ParallelActions","parallelActions","every","QuadTree","_defaultOptions","maxDepth","capacity","items","_isDivided","halfWidth","halfHeight","_split","newLevelOptions","_insertIntoSubNodes","insert","getAllItems","getTreeDepth","has_initialize","has_add","has_remove","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasOnAdd","hasOnRemove","hasPreDraw","hasPostDraw","Gif","_sprites","_stream","Stream","_gif","GifParser","toSpriteSheet","toAnimation","delayMs","_animation","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","fromCharCode","readUnsigned","Uint8Array","stream","_handler","globalColorTableBytes","parseColorTableBytes","colorTable","rgb","_st","readSubBlocks","parseHeader","hdr","sig","ver","colorResolution","globalColorTableSize","gctFlag","sortedFlag","globalColorTable","backgroundColorIndex","pixelAspectRatio","_currentFrameCanvas","bits","parseExt","block","parseGCExt","reserved","disposalMethod","userInputFlag","transparentColorFlag","delayTime","transparentColorIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","_gce","parseImg","img","leftPos","topPos","lctFlag","interlaced","sorted","lctSize","lctBytes","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","charCodeAt","output","clearCode","eoiCode","codeSize","dict","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","steps","pass","deinterlace","arrayToImage","parseBlocks","sentinel","eof","frame","imageData","getImageData","pixel","colorIndex","putImageData","_currentFrameContext","_hdr","bg","FontSource","_isLoaded","FontFace","fonts","toFont","InsideCoroutineContext","generatorFunctionDeclaration","isCoroutineGenerator","Function","coroutine","coroutineGenerator","thisArg","passedEngine","inside","autostart","started","completed","cancelled","generatorFcn","generator","co","iterator","Transition","_currentProgress","_completeFuture","_currentDistance","updateTransition","onStart","onEnd","onReset","_co","_execute","FadeInOut","screenCover","CrossFade","_progress","Slide","slideDirection","easingFunction","_vectorEasing","_screenCover","_directionOffset","_destinationCameraPosition","_startCameraPosition","_calculateBounds","lineNormal","halfThickness","minPoint","NineSliceStretch","NineSlice","_imgSource","_canvasA","_canvasB","_canvasC","_canvasD","_canvasE","_canvasF","_canvasG","_canvasH","_canvasI","setTargetWidth","auto","setTargetHeight","setMargins","sourceConfig","leftMargin","topMargin","rightMargin","bottomMargin","setStretch","destinationConfig","horizontalStretch","verticalStretch","getConfig","_drawTile","targetCanvas","destinationSize","marginWidth","marginHeight","tempMarginW","tempMarginH","tempSizeX","tempPositionX","tempSizeY","tempPositionY","numTilesX","_getNumberOfTiles","numTilesY","tempSize","tempPosition","_calculateParams","drawCenter","_sourceSprite","aCtx","bCtx","cCtx","dCtx","eCtx","fCtx","gCtx","hCtx","iCtx","tileSize","Stretch","TileFit","tileNum","numTiles","reducedTileSize","TiledSprite","_ready","_applyTiling","fromSprite","spriteCanvas","tiledImageSource","TiledAnimation","animation","_tiledWidth","_tiledHeight","_sourceView","promises","tiledSprite","allSettled","fromAnimation","_updateSourceView","_updateWidthHeight","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","showStackTrace","obsolete","alternateMethod","property","descriptor","SyntaxError","DecoratedClass","AsyncWaitQueue","enqueue","dequeue","Semaphore","_count","_waitQueue","waiting","enter","exit","__webpack_exports__Actor","__webpack_exports__Animation","__webpack_exports__Color","__webpack_exports__DisplayMode","__webpack_exports__Engine","__webpack_exports__FadeInOut","__webpack_exports__ImageSource","__webpack_exports__ImageWrapping","__webpack_exports__Keys","__webpack_exports__Loader","__webpack_exports__Random","__webpack_exports__Scene","__webpack_exports__ScreenElement","__webpack_exports__SolverStrategy","__webpack_exports__Sound","__webpack_exports__SpriteSheet","__webpack_exports__Timer","__webpack_exports__vec"],"sourceRoot":""}